<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Separate Concerns</title>
  <link
    href="https://blog.separateconcerns.com/feed.atom"
    rel="self" type="application/atom+xml"
  />
  <link
    href="https://blog.separateconcerns.com"
    rel="alternate" type="application/xhtml+xml"
  />
  <id>tag:blog.separateconcerns.com,2012-12-13:atomfeed</id>
  <updated>2025-08-24T13:28:39Z</updated>
  <author>
    <name>Pierre 'catwell' Chapuis</name>
    <uri>https://catwell.info/</uri>
  </author>
  <entry>
    <title>Beliefs</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2025-08-24-beliefs.html"
    />
    <id>tag:blog.separateconcerns.com,2025-08-24:beliefs</id>
    <published>2025-08-24T15:30:00Z</published>
    <updated>2025-08-24T15:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Since 2017 I have maintained a short list in a file called <code>BELIEFS.md</code>. It is somewhat similar to my <a href="https://blog.separateconcerns.com/2019-02-15-architecture-principles.html">Software Architecture Principles</a> but for things not directly related to programming. I have decided to move it here.</p>
<p>Because <a href="https://blog.separateconcerns.com/2019-10-19-opinions.html">opinions should be (somewhat) weakly held</a> I have updated it from time to time, and I intend to do the same here.</p>
<ul>
<li>
<p>Caring about one&#8217;s work over time is <a href="https://twitter.com/Nick_Craver/status/778205276184928256">the most important thing</a> to be good at your job.</p>
</li>
<li>
<p><a href="https://twitter.com/pchapuis/status/806075078274404353">Why did the robot do that?</a> will be a very important question in the years to come.</p>
</li>
<li>
<p>Transformative innovations typically come from technologists. They are often introduced against the will of people in positions of power. Their authors initially do not understand the scale of what they are doing.</p>
</li>
<li>
<p>In B2B, knowing the product (its metrics, its users&#8230;) and the market has significantly more value than the product itself. (added in 2020)</p>
</li>
<li>
<p>AI will reach its potential when it is embodied. AGI is not necessary for an AI revolution if we get affordable versatile robotics. (added in 2025)</p>
</li>
</ul>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts &amp; Links 12</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2025-08-21-thoughts-12.html"
    />
    <id>tag:blog.separateconcerns.com,2025-08-21:thoughts-12</id>
    <published>2025-08-21T17:00:00Z</published>
    <updated>2025-08-21T17:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>&#8220;Thoughts &amp; Links&#8221; are posts mixing topics on my mind and interesting things I have read recently. Less thought out than regular posts.</p>
</blockquote>
<section id="A-trade-ending-or-evolving">
<h2><a href="https://n.survol.fr/n/fin-ou-transformation-dun-metier">A trade ending or evolving</a></h2>
<p>A post about our job by Éric, from last February (in French). He shares a lot of my thoughts on the topic. Here is a (translated) selection.</p>
<blockquote>
<p>I fear a real crisis in our trade in a few years. Some — many — will be left on the sidelines.</p>
</blockquote>
<blockquote>
<p>If you are very tech-minded, you should do math, data manipulation, statistics and generally AI. It will be harder and require more advanced competencies than being a developer, but there will be jobs.
If you want to create, for me the future lies in product-related roles, product management with a technical emphasis and interest. It means caring about the business, market, customers, etc.</p>
</blockquote>
<blockquote>
<p>For those of you still mostly writing code, I would switch to LLMs ASAP. I know you don&#8217;t feel the need, that those tools make mistakes you don&#8217;t, that today it slows you down. [&#8230;]
There will be room for older code experts for a long time, in maintenance and large companies that are several generations behind. We still need COBOL developers today. But is it really the position you aspire to?</p>
</blockquote>
</section>
<section id="Breaking-rules">
<h2><a href="https://www.seangoedecke.com/breaking-rules/">Breaking rules</a></h2>
<p>A post by Sean Goedecke about how strong engineers break rules and get away with it. (On a side note, I am impressed by how Sean manages to publish interesting content so frequently.)</p>
<p>Like I <a href="https://bsky.app/profile/catwell.info/post/3lmgzjmono22m">said on Bluesky</a> it is a very important point to learn mid-career. The caveat is that most people <strong>will</strong> take it too far at some point. You should do it anyway — you need to learn exactly the right balance and nobody will teach you.</p>
</section>
<section id="What-kind-of-work">
<h2><a href="https://www.seangoedecke.com/my-engineering-values-2025/">What kind of work</a></h2>
<p>Sean (again!) has written a post about what kind of work he wants. Actually, he did it twice; this is an update from his first post back in 2021. I think this is a very interesting exercise and I should do it sometime. (It is hard for me because I have conflicting interests so I keep oscillating between technically exciting, product-focused roles and ones that are more business- and customer-facing.)</p>
</section>
<section id="Fallacies-of-code-generation">
<h2><a href="https://olano.dev/blog/fallacies-of-code-generation/">Fallacies of code generation</a></h2>
<p>My favorites:</p>
<blockquote>
<ul>
<li>
Writing code is the hardest part of software development
</li>
<li>
A system can be maintained without being understood
</li>
</ul>
</blockquote>
<p>Some I am not sure about:</p>
<blockquote>
<ul>
<li>
LLMs will become reliable decision makers
</li>
<li>
Users will tolerate bad quality
</li>
</ul>
</blockquote>
<p>For the first one, I do not think anyone on Earth is competent to guess what LLMs or whatever will replace them will be able to do or not in a few years. People who say they will never be able to do something typically have either a very shallow understanding or a restrictive (and irrelevant) definition of LLMs.</p>
<p>For the second one, I sadly know from experience that users do tolerate bad quality. Not <strong>all</strong> users, but often enough for the worse alternative to win.</p>
</section>
<section id="Happy-Ears">
<h2><a href="https://x.com/gwenshap/status/1905426007949279251">Happy Ears</a></h2>
<p>A long-form post on X (that should be a blog post&#8230;) about something every engineer involved in a sales process — or talking to customers in any capacity — needs to learn.</p>
<p>Interacting with customers as an engineer is very different and sometimes contradicts what an engineer working on a product does. I love doing both — and I think it is important that some people do both — but it is always going to be hard and feel a bit schizophrenic.</p>
</section>
<section id="Policy-of-transience">
<h2><a href="https://www.chiark.greenend.org.uk/~sgtatham/quasiblog/transience/">Policy of transience</a></h2>
<p>A post by Simon Tatham. His policy is:</p>
<blockquote>
<p>Things should either be deliberately permanent in an organized way, or strictly temporary.</p>
</blockquote>
<p>I do the same. The first thing I do when I log onto a new machine is disable persistent shell history, I turn my computer off every night and configure my browser not to remember tabs.</p>
<p>I really liked that post because I have been doing this forever — and I know most people do not — but I never really thought about why or formalized it. In my case it was initially because I used a lot of different and often shared machines, but now I just prefer it that way. I guess it is somewhat similar to how some cooks are obsessed with clearing the worktop as soon as they can.</p>
</section>
<section id="BitTorrent-generation">
<h2><a href="https://www.la-grange.net/2025/05/19/rouge">BitTorrent generation</a></h2>
<p>A (sub)post by Karl Dubost about copyright and that message posted by someone else on Bluesky:</p>
<blockquote>
<p>20 years ago we were suing teenagers for millions of dollars because they were torrenting a single Metallica album and now billionaires are demanding the free right to every work in history, so they can re-sell it. The law only ever serves capital.</p>
</blockquote>
<p>Karl writes (translated from French):</p>
<blockquote>
<p>Sam Altman was born on 22 April 1985, so he is 40. BitTorrent came out in 2001, 24 years ago. [&#8230;] Sam Altman was 16. So he&#8217;s only doing now what he was doing when he was a teenager. My answer: teenagers from that era have grown up and some became CEOs. There&#8217;s no mystery.</p>
</blockquote>
<p>2001 was the year I really went online and started getting involved with the F/OSS movement. I am from the same generation as Altman, the BitTorrent (and Napster) generation, the Aaron Swartz generation, and I will always be against policies that prevent copying and sharing digital content.</p>
<p>On the same topic, Karl also wrote <a href="https://www.la-grange.net/2025/06/04/creation">here</a>:</p>
<blockquote>
<p>I am a creator. I constantly steal others&#8217; work. It is the nature of creation. We do not live in a vacuum. We imitate life around us. Babies, kids do that. We keep doing that our whole life. We do not ask consent from all those who have created something before us to create ourselves. We train on everything we see.
Stealing is not the problem. [&#8230;] Consent is not the problem. The main problem is ownership and the ability of certain actors to capture that ownership and prevent others from enjoying it.</p>
</blockquote>
<p>(On a side note: I do not enjoy translating Karl. I really enjoy his style in French; I always feel like I do not do him justice.)</p>
</section>
<section id="Go-is-a-good-language-for-agents">
<h2>Go is a good language for agents</h2>
<p>Armin Ronacher <a href="https://lucumr.pocoo.org/2025/6/12/agentic-coding/">writes</a>:</p>
<blockquote>
<p>Rob Pike famously described Go as suitable for developers who aren&#8217;t equipped to handle a complex language. Substitute &#8220;developers&#8221; with &#8220;agents&#8221; and it perfectly captures why Go&#8217;s simplicity benefits agentic coding.</p>
</blockquote>
<p>But I think the most important part is the structural typing:</p>
<blockquote>
<p>Interfaces in Go are structural. If a type has the methods an interface expects, then it conforms. This is incredibly easy for LLMs to &#8220;understand&#8221;. There is very little surprise for the agent.</p>
</blockquote>
<p>Other important points are speed (both of execution and compilation) and low ecosystem churn.</p>
</section>
<section id="Breaking-the-Spell">
<h2><a href="https://phrack.org/issues/71/1">Breaking the Spell</a></h2>
<p>A year ago, this text came out in Phrack. It is about how we need hackers more than ever to keep understanding the complex and ever-changing systems AI unleashes on us. (Go read it now and come back!)</p>
<p>A big reason I left the AI field and the end of 2013 is I did not like deep learning. I was a proponent of simple, sharp tools in the Unix tradition. I wanted to understand things entirely despite the complexity, like I did with distributed systems. I said &#8220;I am a physicist, not a biologist&#8221;.</p>
<p>I came back in 2022 because AI is there to stay. It <strong>will</strong> run the world, and we will need hackers to poke at both its physics and biology. A lot has changed since 2013; interpretability research is a thing now, and we have had tools to build something we understand from something we do not understand <a href="https://blog.separateconcerns.com/2013-03-03-viterbi-algorithm.html">for a long time</a>.</p>
<p>So I am <a href="https://blog.separateconcerns.com/2024-10-16-not-leaving-ai.html">here to stay</a> and understand as much of it all as my feeble human brain lets me.</p>
<p>On a related note, I liked that on <a href="https://henryhmko.github.io/about/about.html">Henry Ko&#8217;s About page</a>:</p>
<blockquote>
<p>I am interested in ideas that share a theme of &#8220;doing more with less&#8221;.</p>
</blockquote>
<p>He is talking about less energy, less data&#8230; and I would add less architectural complexity. That&#8217;s how we hackers can help.</p>
</section>
<section id="Code-is-scaffolding">
<h2><a href="https://devpoga.org/code-as-evolving-scaffolding/">Code is scaffolding</a></h2>
<blockquote>
<p>Every program is just scaffolding for your next understanding. [&#8230;] The code isn&#8217;t just temporary because we&#8217;ll rewrite it. It&#8217;s temporary because our understanding keeps evolving. [&#8230;] Your current understanding is probably wrong. Build simple scaffolding that lets you discover why.</p>
</blockquote>
<p>One way to understand why AI-assisted coding is so powerful is to see it as an aerial lift. Sometimes you can get to a better understanding in seconds without bothering with all the scaffolding.</p>
</section>
<section id="Robotics">
<h2>Robotics</h2>
<p>There has been movement in the field, including in France, from <a href="https://huggingface.co/docs/lerobot/index">Hugging Face&#8217;s LeRobot</a> to the founding of <a href="https://genesis-ai.company">Genesis AI</a>.</p>
<p>That is something I am <strong>really</strong> excited about. I mean come on, we can live in Star Wars! More seriously, automating physical jobs and tasks is still one of the top things that could change our lives. It will disrupt them too, sure, but I am optimistic about the end result on this one.</p>
</section>
<section id="Shorten-your-feedback-loop">
<h2>Shorten your feedback loop</h2>
<p>When asked &#8220;What trick of the trade took you too long to learn?&#8221;, Hillel Wayne <a href="https://lobste.rs/s/a1njck/what_trick_trade_took_you_too_long_learn#c_ml21et">answered</a>:</p>
<blockquote>
<p>Shorten your feedback loop. No, shorter than that.</p>
</blockquote>
<p>This is such a good answer, and one that I have agreed with forever (I mean, I have been using Lua for 20 years&#8230;) that I have added it to <a href="https://blog.separateconcerns.com/2019-02-15-architecture-principles.html">my core principles</a>.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>How I use AI coding tools (in summer 2025)</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2025-08-08-ai-tools.html"
    />
    <id>tag:blog.separateconcerns.com,2025-08-08:ai-tools</id>
    <published>2025-08-08T21:55:00Z</published>
    <updated>2025-08-08T21:55:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>Note: Yes I use em-dashes when I write, and no this is not AI. When I blog I typically only use <a href="https://writewithharper.com">Harper</a> to check for spelling and syntax.</p>
</blockquote>
<p>I have talked about my use of AI to write code <a href="https://blog.separateconcerns.com/2023-10-21-automating-job.html">here</a>, but that was almost two years ago. Things have changed since then and I wanted to talk briefly about how.</p>
<section id="Claude-Code">
<h2>Claude Code</h2>
<p>The most important change is that I now use <a href="https://www.anthropic.com/claude-code">Claude Code</a>. I don&#8217;t use it all the time, but here are a few ways I do:</p>
<ul>
<li>
When I implement features in a codebase I know well, I write a detailed prompt describing how I want the feature implemented and give it to Claude.
</li>
<li>
When I need to kickstart a project quickly with technology I do not know well, I ask Claude and it typically does a better job than me — and most importantly faster.
</li>
<li>
When I get an error message I cannot immediately understand I paste it into Claude Code, and more often than not it finds how to fix it.
</li>
</ul>
<p>Here is one way I do <strong>not</strong> use Claude: when I work on hard problems where I do not know the solution. I use code as a thinking tool, and using an LLM disturbs that process.</p>
<p>In general, I see Claude as a junior but very fast pair programmer. It won&#8217;t help with hard things but it will gain you a lot of time for the simple ones if you guide it well and check its work.</p>
</section>
<section id="Lovable">
<h2>Lovable</h2>
<p>Another tool that I used a lot is <a href="https://lovable.dev">Lovable</a>, and I have a complicated relationship with it. The way I used it was, someone else vibe-coded an app and I stepped in when things became too complex for Lovable.</p>
<p>At first I was very impressed. In a few prompts anyone can get a usable application prototype, all in the browser. This makes most no-code frontend development tools irrelevant.</p>
<p>The more I used it, though, the more I saw its limits. The recently released agent mode makes it better, but it still has flaws such as writing spaghetti code and not cleaning up dead code. As time progresses, its context becomes polluted by the messy codebase and it gets lost. I think the stack they chose (React and Radix) does not help with that.</p>
<p>The way to fix it is what I did: clone the repository, refactor by hand or with the help of Claude Code, and put things back in a state where the model will start making the right decisions again.</p>
<p>But the main issue with Lovable is not the model, it is everything around it. It uses Supabase as its only backend, which is very limited. Most importantly there is no proper way to have separate environments, not even a development environment separate from production. They need to fix that and understand that if they want to have successful applications in production they must consider the fact that they will be worked on by teams.</p>
</section>
<section id="Others">
<h2>Others</h2>
<p>I still use GitHub Copilot for autocomplete. It is just better than the default, especially in Sublime Text.</p>
<p>I also use <a href="https://chat.mistral.ai/">Mistral&#8217;s Le Chat</a> for random things, like most people use ChatGPT.</p>
<p>I have not yet tried alternatives to Claude Code except for <a href="https://aider.chat">Aider</a> which I used earlier. I am most interested in <a href="https://sourcegraph.com/amp">Amp</a> for looking well-made, <a href="https://opencode.ai">opencode</a> for being Open Source and <a href="https://github.com/google-gemini/gemini-cli">gemini-cli</a> for being basically free (as in beer).</p>
<p>I think in a few months to years more asynchronous tools such as Devin, OpenAI&#8217;s Codex or Google&#8217;s Jules may become interesting, but they are not for me just now.</p>
<p>If you are looking for content elsewhere to make up your mind, I think <a href="https://simonwillison.net/2025/Jun/18/coding-agents/">this post by Simon Willison</a> is very relevant, and I like what <a href="https://www.youtube.com/@zeeg99">David</a> and <a href="https://www.youtube.com/@ArminRonacher">Armin</a> post.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Evolution of AI</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2025-02-26-ai-evolution.html"
    />
    <id>tag:blog.separateconcerns.com,2025-02-26:ai-evolution</id>
    <published>2025-02-26T14:30:00Z</published>
    <updated>2025-02-26T14:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>The rapid evolution of AI makes me change my mind often regarding its future evolution. However, since the beginning of the deep learning era, I hold a belief that in the long run the distinction between &#8220;training&#8221; and &#8220;inference&#8221; will fade and AI will learn <a href="https://en.wikipedia.org/wiki/Online_algorithm">online</a>.</p>
<p>I think economics make it unlikely that the current practice of collecting data then training a model on it and doing it all over again for the next iteration will subside. I find it more likely that at some point all of the following will happen:</p>
<ul>
<li>
AI systems will no longer be pure deep learning models but more complex systems including memory. This is <a href="https://research.ibm.com/blog/memory-augmented-LLMs">already happening</a>, and I expect it to continue. Parameter count will continue to increase and require sparsity at inference, similar to <a href="https://huggingface.co/blog/moe">MoE</a>.
</li>
<li>
Large-scale systems will keep a context per user or entity they interact with. It will be possible to access several of those contexts at runtime. I am not entirely sure of the shape this will take but there are already various options to save context in LLMs, <a href="https://arxiv.org/abs/2311.03285">serve concurrent LoRAs</a>, and <a href="https://arxiv.org/abs/2209.07663">more exotic approaches</a>.
</li>
<li>
New model generations will not be trained from scratch. We will develop approaches to transfer knowledge from one generation to the next, even if they have radically different architectures. This could include things like <a href="https://sakana.ai/evolutionary-model-merge/">merging</a> and knowledge distillation as pre-training. There could be several teachers, i.e. a generalist model could be fine-tuned to learn from a smaller specialist teacher.
</li>
<li>
With usage increasing, user interactions will become an essential — maybe eventually the primary — source of training data. It will be integrated into the model in &#8220;soft real-time&#8221; through <a href="https://medium.com/@bavalpreetsinghh/rlhf-ppo-vs-dpo-26b1438cf22b">some form of online RLHF</a>. This pairs nicely with the previous point, which means this online learning can be transferred.
</li>
<li>
Much smaller task-specific models will be distilled from those large generalist models for embedded use in applications and on-device.
</li>
</ul>
<p>This vision is largely coherent with Google&#8217;s <a href="https://blog.google/technology/ai/introducing-pathways-next-generation-ai-architecture/">Pathways</a>, and I suppose other large players are seeing the same thing.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts &amp; Links 11</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2025-02-16-thoughts-11.html"
    />
    <id>tag:blog.separateconcerns.com,2025-02-16:thoughts-11</id>
    <published>2025-02-16T14:15:00Z</published>
    <updated>2025-02-16T14:15:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>&#8220;Thoughts &amp; Links&#8221; are posts mixing topics on my mind and interesting things I have read recently. Less thought out than regular posts.</p>
</blockquote>
<p>Mostly links today. I have renamed the post series &#8220;Thoughts &amp; Links&#8221; since this is what they are.</p>
<section id="I-miss-FAKEGRIMLOCK">
<h2>I miss FAKEGRIMLOCK</h2>
<p>If you know, you know. If you don&#8217;t, picture this: it&#8217;s the second tech boom (early 2010s), most people did not experience the dot-com bubble and are figuring this stuff out, and some of the best advice you can find online comes from a robot dinosaur that writes in all caps. You can find some of its content online, for instance <a href="https://avc.com/2011/09/minimum-viable-personality/">on Fred Wilson&#8217;s blog</a>.</p>
</section>
<section id="Paul-Graham-on-Yahoo-2010">
<h2><a href="https://paulgraham.com/yahoo.html">Paul Graham on Yahoo (2010)</a></h2>
<blockquote>
<p>In technology, once you have bad programmers, you&#8217;re doomed. I can&#8217;t think of an instance where a company has sunk into technical mediocrity and recovered.</p>
</blockquote>
<blockquote>
<p>In the early days Facebook made a point of hiring programmers even for jobs that would not ordinarily consist of programming, like HR and marketing.</p>
</blockquote>
<blockquote>
<p>Hacker culture often seems kind of irresponsible. That&#8217;s why people proposing to destroy it use phrases like &#8220;adult supervision.&#8221; [&#8230;] But there are worse things than seeming irresponsible. Losing, for example.</p>
</blockquote>
</section>
<section id="Quentin-Adam-on-EU-tech">
<h2><a href="https://www.latribune.fr/opinions/l-ia-un-test-pour-la-politique-industrielle-europeenne-1018022.html">Quentin Adam on EU tech</a></h2>
<p>This is a tribune by <a href="https://www.waxzce.org">Quentin Adam</a> on AI and industrial policy in the EU. Excerpt translated from French:</p>
<blockquote>
<p>We need companies led by technology leaders, trained engineers who deeply understand the challenges of the sector. [&#8230;] It is time to stop only investing in managers and to fund those who know how to build.</p>
</blockquote>
</section>
<section id="Two-bitter-lessons-from-the-rebuild-of-Notre-Dame">
<h2><a href="https://philippesilberzahn.com/2024/12/02/restauration-de-notre-dame-derriere-l-exploit-deux-ameres-lecons-sur-l-excellence-francaise/">Two bitter lessons from the rebuild of Notre Dame</a></h2>
<p>Philippe Silberzahn writes on how France can do great things, but 1) to preserve the past and not build the future and 2) only by circumventing legislation.</p>
<p>Translated from French (there is a pun in the original I could&#8217;t <a href="https://blog.separateconcerns.com/2025-02-02-found-in-translation.html">find a good translation</a> for):</p>
<blockquote>
<p>I meet a lot of [public and private sector leaders], they all have the same lament: we are suffocating under millimetric regulations. The country belongs to inspectors who spun out of control. Excellence has become impossible.</p>
</blockquote>
</section>
<section id="More-human-management-is-meaningless">
<h2><a href="https://philippesilberzahn.com/2025/02/10/un-management-plus-humain-ca-ne-veut-rien-dire/">&#8220;More human&#8221; management is meaningless</a></h2>
<p>Philippe Silberzahn again, translated from French again.</p>
<blockquote>
<p>Management without exigence is inhuman. How many talented engineers [&#8230;] languish in companies where nothing ever happens except for a continuous flow of bureaucratic events? [&#8230;] Accepting the mediocrity of an employee is disrespectful. They are invisibilized: &#8220;You are doing a bad job but I won&#8217;t tell you, and even less demand you improve.&#8221; It means you&#8217;re not worth it, I won&#8217;t help you produce work you can be proud of. [&#8230;] And collectively, we will make crap, or even better: we will make nothing at all. And we will die slowly.</p>
</blockquote>
</section>
<section id="Upspin-is-shutting-down">
<h2><a href="https://groups.google.com/g/upspin/c/Whma_O-iexM/m/6loeUgKYDwAJ">Upspin is shutting down</a></h2>
<blockquote>
<p>Upspin, like Unix and Plan 9, was intended to foster communities of sharing, but has been less successful at that than we hoped. As a consequence, with regret, we have decided to turn down the central infrastructure such as the keyserver over the coming months.</p>
</blockquote>
</section>
<section id="AI-hardware">
<h2>AI hardware</h2>
<p>Last December I bookmarked <a href="https://semianalysis.com/2024/12/25/nvidias-christmas-present-gb300-b300-reasoning-inference-amazon-memory-supply-chain/">this</a>:</p>
<blockquote>
<p>Nvidia’s not the only one that can increase memory capacity of course. ASICs can do this and in fact AMD may be well positioned due to their higher memory capacity versus Nvidia [&#8230;] Well except Santa Huang has a Red-Nosed Reindeer called NVLink. No other accelerator in the world has all-to-all switched connectivity. No other accelerator in the world can do all reduce through a switch.</p>
</blockquote>
<p>Then DeepSeek proved this was not the moat we thought it was. Meanwhile Mistral is doing over 1000 tokens per second on a 123B model by leveraging Cerebras for inference, and Tenstorrent is shipping&#8230; fun times!</p>
</section>
<section id="George-Hotz---The-Soul">
<h2>George Hotz - <a href="https://geohot.github.io/blog/jekyll/update/2024/12/01/the-soul.html">The Soul</a></h2>
<blockquote>
<p>You are a machine learning algorithm. You have some priors in your DNA. You learn on data, RL style because your actions affect the next data you see; the dataset depends on the model. [&#8230;] How much of [Christianity&#8217;s decline] is people starting to figure this out?</p>
</blockquote>
</section>
<section id="Carson-Gross---Coding-Dirty">
<h2>Carson Gross - <a href="https://htmx.org/essays/codin-dirty/">Coding  Dirty</a></h2>
<p>The author of htmx on some &#8220;dirty&#8221; code practices he considers good:</p>
<blockquote>
<ul>
<li>
(Some) big functions are good, actually
</li>
<li>
Prefer integration tests to unit tests
</li>
<li>
Keep your class/interface/concept count down
</li>
</ul>
</blockquote>
</section>
<section id="Engineers-know">
<h2>Engineers know</h2>
<p>Avery Pennarun, founder of Tailscale, <a href="https://x.com/apenwarr/status/1855998935292121307">on X</a>:</p>
<blockquote>
<p>Engineers (who aren&#8217;t kept isolated in a back room) are pretty good at knowing what&#8217;s important to work on. They just don&#8217;t think they are. And they especially don&#8217;t think other engineers are.</p>
</blockquote>
<p>I answered:</p>
<blockquote>
<p>And French engineers are probably even worse&#8230; You have no idea how many think you need a business degree to understand a customer, or anything remotely related to strategy.</p>
</blockquote>
<p>He answered:</p>
<blockquote>
<p>I keep sensing the &#8220;people live up (or down) to the expectations you put on them&#8221; effect. If you expect people to have bad ideas, they won&#8217;t be careful. If you tell people they get to choose what&#8217;s important, there&#8217;s no safety net, they&#8217;ll live up to what&#8217;s needed.</p>
</blockquote>
<p>Insightful.</p>
</section>
<section id="Reflections-on-Palantir">
<h2><a href="https://nabeelqu.co/reflections-on-palantir">Reflections on Palantir</a></h2>
<p>A long article by Nabeel S. Qureshi on his experience at Palantir. The most interesting part for me is how Palantir uses Forward-Deployed Engineers differently from most companies.</p>
<blockquote>
<p>[FDEs] gain intricate knowledge of business processes in difficult industries (manufacturing, healthcare, intel, aerospace, etc.) and then use that knowledge to design software that actually solves the problem. [Product Development] engineers then &#8220;productize&#8221; what the FDEs build, and — more generally — build software that provides leverage for the FDEs to do their work better and faster.</p>
</blockquote>
</section>
<section id="The-One-Developer-Framework">
<h2>The One Developer Framework</h2>
<p>I like how DHH increasingly focuses on single-developer teams. <a href="https://x.com/dhh/status/1796229972488749062">On X</a>:</p>
<blockquote>
<p>I view everything I work on through that One Developer Framework lens. Not interested in tooling, approaches, or concepts that demand a team of thinly-sliced specialists to tick. One developer must be able to understand/use it all. From Hello World to IPO! Let&#8217;s go, nerds :)</p>
</blockquote>
</section>
<section id="Stop-trying-to-make-everyhting-too-easy">
<h2>Stop trying to make everyhting too easy</h2>
<p>Howard Chu <a href="https://mastodon.social/@hyc/112844972710932126">on Mastodon</a>:</p>
<blockquote>
<p>A lot of user interactions these days are <strong>too</strong> user friendly, and when deployed in the real world you discover that you really need a bit of friction, to prevent things from being too easy. Child-proof packaging on medicines is one example where you purposefully raise difficulty. [&#8230;] Stop trying to make everything &#8220;so easy a child can do it.&#8221; Some things need to have a higher barrier to entry. Focus on educating people to be smart enough and responsible enough to clear the hurdles.</p>
</blockquote>
</section>
<section id="Scott-Chacon---Why-GitHub-Actually-Won">
<h2>Scott Chacon - <a href="https://blog.gitbutler.com/why-github-actually-won/">Why GitHub Actually Won</a></h2>
<blockquote>
<p>We won because we started at the right time and we had taste. We were there when a new paradigm was being born and we approached the problem of helping people embrace that new paradigm with a developer experience centric approach that nobody else had the capacity for or interest in.</p>
</blockquote>
</section>
<section id="Hugo-Lassiège-—-The-role-of-Staff-software-engineers">
<h2>Hugo Lassiège — The role of Staff+ software engineers</h2>
<p><a href="https://youtu.be/O_e1mN_YTt4?t=525">On YouTube</a>, translated from French:</p>
<blockquote>
<p>As you progress, you must be able to analyze a situation more and more remote from pure technology, and it is interesting to do so because you will also need to understand marketing, sales, finance, and so on. No company that does not have technical people involved with business strategy can have a tech or product approach anyway. All those companies I hear complain like: &#8220;We do not innovate enough! We hired the best developers but can&#8217;t see a significant impact&#8230;&#8221; Systematically, we notice no tech person is working on strategy. There is no tech person at product meetings, no tech person at executive committees, etc.</p>
</blockquote>
</section>
<section id="Hugo-Lassiège-—-Security-at-Startups">
<h2>Hugo Lassiège — Security at Startups</h2>
<p><a href="https://youtu.be/nIYE1HQVIVw?t=190">On YouTube</a>, translated from French:</p>
<blockquote>
<p>At a startup, what I call &#8220;human capital&#8221; is rare and limited. You cannot hire armies of people, so you need rare birds able to do several things well, or at least people with the potential to become them.</p>
</blockquote>
<p>The literal translation of what he says in French is &#8220;you need five-legged sheep&#8221;, I couldn&#8217;t find a good translation in English.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Found in Translation</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2025-02-02-found-in-translation.html"
    />
    <id>tag:blog.separateconcerns.com,2025-02-02:found-in-translation</id>
    <published>2025-02-02T19:45:00Z</published>
    <updated>2025-02-02T19:45:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>There is an <a href="https://en.wikipedia.org/wiki/Ivan_Illich">Ivan Illich</a> quote that I often see in French, for instance in <a href="https://www.linkedin.com/in/pierrepezziardi/">Pierre Pezziardi&#8217;s LinkedIn banner</a>:</p>
<blockquote>
<p>L’outil simple, pauvre, transparent est un humble serviteur ; l’outil élaboré, complexe, secret est un maître arrogant.</p>
</blockquote>
<p>Here is how I would translate it into English:</p>
<blockquote>
<p>Simple, plain, transparent tools are but humble servants. Elaborate, complex, secret tools are arrogant masters.</p>
</blockquote>
<p>But this quote comes from La Convivialité, the French translation of Tools for Conviviality, so why translate when we can find the original?</p>
<p>In the French book, the quote is the last sentence of the Overprogramming chapter, which ends like this:</p>
<blockquote>
<p>Au fur et à mesure que des outils post-industriels rationnels se répandront, les tabous du spécialiste suivront l’outillage industriel dans sa chute, comme ils l’avaient accompagné dans sa gloire. L’outil simple, pauvre, transparent est un humble serviteur ; l’outil élaboré, complexe, secret est un maître arrogant.</p>
</blockquote>
<p>The original English version, however, is this:</p>
<blockquote>
<p>Professional taboos and industrial tools stand and fall together once truly rational, postindustrial tools are available. Only the convergent use of convivial tools in all significant areas of need-satisfaction can render their use in each sector truly effective. Only among convivially structured tools can people learn to use the new levels of power that modern technology can incorporate in them.</p>
</blockquote>
<p>This is completely different! Which means this quote was probably from Luce Giard et Vincent Bardet, who helped Illich with the French version of his book.</p>
<p>I have known about this for a while but I decided to blog about it because of a discussion I had at <a href="https://blog.separateconcerns.com/2025-02-02-fosdem-2025.html">FOSDEM</a> about LLMs replacing human translators. And indeed for most content LLMs do a good job, but it is unlikely that an LLM would do something like this. This is not what they are trained to do. There is an opinionated, artistic component to the job of literary translation.</p>
<p>Note: Karl Dubost also frequently <a href="https://www.la-grange.net/2025/01/20/savoir">blogs about</a> <a href="https://www.la-grange.net/2025/01/25/traduire">this topic</a>.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>FOSDEM 2025</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2025-02-02-fosdem-2025.html"
    />
    <id>tag:blog.separateconcerns.com,2025-02-02:fosdem-2025</id>
    <published>2025-02-02T10:20:00Z</published>
    <updated>2025-02-02T19:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I am attending FOSDEM in Brussels for the 13th time physically. This is an event I anticipate every year, where I get to meet old friends and new people, watch interesting talks, and drink some Belgian beer.</p>
<p>This year I spent some time with <a href="https://github.com/gawen">Gawen</a>, <a href="https://blog.zwindler.fr">Denis</a>, <a href="https://hisham.hm">Hisham</a>, my brother François, and a few other current and former colleagues.</p>
<p>Here is a list of talks I saw:</p>
<ul>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-5094-open-cloud-mesh/">Open Cloud Mesh</a> — Michiel de Jong
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-5867-why-don-t-we-have-libsync-yet-/">Why don&#8217;t we have libsync yet?</a> — Victor Grishchenko
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-4132-ladybird-a-new-independent-browser-written-from-scratch/">Ladybird — a new independent browser written from scratch</a> — Jelle Raaijmakers
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-4635-explore-large-image-datasets-with-panoptic/">Explore large image datasets with Panoptic</a> — Félix Alié, David Godicke &amp; Edouard Bouté
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-6648-14-years-of-systemd/">14 Years of systemd</a> — Lennart Poettering
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-4494-introduction-to-serverless-workflow-dsl/">Introduction to Serverless Workflow DSL</a> — Charles d&#8217;Avernas, Jean-Baptiste Bianchi &amp; Ricardo Zanini Fernandes
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-4506-porting-luarocks-to-teal-exploring-the-benefits-of-statically-typed-code-in-lua/">Porting LuaRocks to Teal: Exploring the Benefits of Statically Typed Code in Lua</a> — Victor Ilchev
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-5923-zml-a-high-performance-ai-inference-stack-built-for-production-and-multi-accelerator-deployment/">ZML: A High-Performance AI Inference Stack Built for Production and Multi-Accelerator Deployment</a> — Rene Schallner &amp; Guillaume Wenzek
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-5991-history-and-advances-of-quantization-in-llama-cpp/">History and advances of quantization in llama.cpp</a> — Tanya Dadasheva &amp; Iwan Kawrakow
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-5531-from-queries-to-pints-building-a-beer-recommendation-system-with-pgvector/">From Queries to Pints: Building a Beer Recommendation System with pgvector</a> — Andrzej Nowicki
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-4603-anatomy-of-table-level-locks-in-postgresql/">Anatomy of Table-Level Locks in PostgreSQL</a> — Gulcin Yildirim Jelinek
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-6214-llm-tool-use-in-vllm/">LLM Tool use in vLLM</a> — Max de Bayser
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-5118-scoping-out-the-tenstorrent-wormhole/">Scoping out the Tenstorrent Wormhole</a> — Peter Cawley
</li>
<li>
<a href="https://fosdem.org/2025/schedule/event/fosdem-2025-6147-what-should-teal-be-musings-on-foss-project-directions/">What should Teal be? — musings on FOSS project directions</a> — Hisham Muhammad
</li>
</ul>
<p>I also sometimes use the opportunity to write a little code, this year I <a href="https://github.com/aio-libs/aiomonitor/issues/418">fiddled with aiomonitor and async generators in Python</a>.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>How I use the Teal LSP with Sublime Text</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2025-01-04-teal-lsp-sublime.html"
    />
    <id>tag:blog.separateconcerns.com,2025-01-04:teal-lsp-sublime</id>
    <published>2025-01-04T16:45:00Z</published>
    <updated>2025-01-04T16:45:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>This is just a short post to describe how I use the <a href="https://github.com/teal-language/teal-language-server">Teal language server</a>. My setup is a bit specific: I use <a href="https://www.sublimetext.com">Sublime Text</a> on Arch Linux and I often run development branches of Teal so I run the LSP from source. I will assume you put it in <code>/.../git</code>.</p>
<p>I also use <a href="https://loadk.com">localua</a> to manage all my Lua / Teal environments and I have <code>.lua/bin</code> in my <code>PATH</code> (which means that <code>luarocks</code>, <code>lua</code> and <code>tl</code> point to the local versions in my shell).</p>
<section id="Setup-the-LSP">
<h2>Setup the LSP</h2>
<p>Install <code>tree-sitter-cli</code> which is a system dependency, clone the repository somewhere, initialize a local Lua environment and install the dependencies with LuaRocks:</p>
<pre><code class="language-bash">sudo pacman -S tree-sitter-cli
cd /.../git
git clone git@github.com:teal-language/teal-language-server.git
curl https://loadk.com/localua.sh -O
sh localua.sh .lua
luarocks make
luarocks install tlcheck
</code></pre>
<p>Run <code>teal-language-server --help</code> to check it works.</p>
</section>
<section id="Setup-Sublime-Text">
<h2>Setup Sublime Text</h2>
<p>Open the LSP settings (<code>Preferences &gt; Package Settings &gt; LSP &gt; Settings</code>) and configure Teal like this:</p>
<pre><code class="language-json">{
    "clients": {
        "teal": {
            "enabled": true,
            "command": [
                "/.../git/teal-language-server/.lua/bin/teal-language-server"
            ],
            "selector": "source.teal"
        }
    }
}
</code></pre>
</section>
<section id="Add-a-tlconfiglua-file-to-your-project">
<h2>Add a <code>tlconfig.lua</code> file to your project</h2>
<p>If you do not use this step, the LSP will only lookup dependencies in its own Lua environment. You want it to look in your project instead.</p>
<p>The contents of <code>tlconfig.lua</code> can look like this:</p>
<pre><code class="language-lua">return {
  source_dir = ".",
  include_dir = { ".", ".lua/share/lua/5.4" },
  gen_compat = "off",
  gen_target = "5.3",
}
</code></pre>
<p>The important part is <code>.lua/share/lua/5.4</code> in <code>include_dir</code>. For the rest, settings depend on your project.</p>
<p>Note that even if you use Lua 5.4 <code>gen_target</code> must be <code>5.3</code>, otherwise the LSP will not work currently even if you specify <code>gen_compat = "off"</code>.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>I am not leaving AI</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2024-10-16-not-leaving-ai.html"
    />
    <id>tag:blog.separateconcerns.com,2024-10-16:not-leaving-ai</id>
    <published>2024-10-16T08:00:00Z</published>
    <updated>2024-10-16T08:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I started my professional career almost 15 years ago <a href="https://blog.separateconcerns.com/2013-06-20-three-years-proprietary-projects.html">working for a Machine Learning / Computer Vision company</a> that did image recognition on mobile. At the end of 2013, I chose to leave it for <a href="https://blog.separateconcerns.com/2018-01-06-four-years.html">Lima</a>, in part because even at Moodstocks I was always more of a Distributed Systems / Algorithms person than a Deep Learning person.</p>
<p>Now, after 10 years away from the field, <a href="https://blog.separateconcerns.com/2023-03-31-joining-finegrain.html">I am back working on AI for images</a>, this time more specifically on <a href="https://finegrain.ai">automated and realistic image edition</a>, with a part of the old Moodstocks team who spent years at Google after the acquisition.</p>
<p>I did not make that choice lightly, I spent some time pondering it, because I knew it would require a significant time investment. AI is a complex, fast-moving field where not everything you learned elsewhere applies. Now that I am back, it is unlikely that I will leave it anytime soon.</p>
<p>I got several interesting job offers recently, for Staff+ roles at great companies with classical distributed systems problems that would have appealed to me a few years ago. But it is likely that the real dist.sys fun in the next few years will be in AI, both <a href="https://www.semianalysis.com/p/multi-datacenter-training-openais">for training</a> and inference. The field has grown fast, and the tooling and practices could not keep up so there is a lot to build.</p>
<p>Those who know me may also remember I always had a problem with the issue of interpretability / explainability of deep learning models, but in recent years I feel we have collectively improved on that, although there is still much to be done.</p>
<p>In addition to that, I do not intend to leave Finegrain specifically either! We have a great team and we approach problems differently from most AI companies. We have products starting to ship, and a lot to do to improve them. I don&#8217;t think I should be anywhere else.</p>
<p>Anyway, I am taking the end of the week off to attend and help with the <a href="https://www.dotai.io">dotAI conference</a>, and I will be back to work next Monday. In the meantime, <a href="https://editor.finegrain.ai/signup">try the Finegrain Editor</a> if you haven&#8217;t already :)</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts 10 - Tolerance, Mental Health, Having Fun</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2024-08-30-thoughts-10.html"
    />
    <id>tag:blog.separateconcerns.com,2024-08-30:thoughts-10</id>
    <published>2024-08-30T08:40:00Z</published>
    <updated>2024-10-08T17:15:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>&#8220;Thoughts&#8221; are posts about what has been on my mind. Sometimes practical, sometimes not; often just things I read recently. Less thought out than regular posts.</p>
</blockquote>
<p>I have not made a &#8220;Thoughts&#8221; post in 4.5 months so I had a lot of topics in store. I have decided to focus on &#8220;soft&#8221; topics only this time, so if you are only looking for technical content you can skip this post.</p>
<section id="Tolerance">
<h2>Tolerance</h2>
<p>In 1959, <a href="https://en.wikipedia.org/wiki/Bertrand_Russell">Bertrand Russell</a> was <a href="https://www.youtube.com/watch?v=BupO0oOAyBw&amp;t=1600s">asked on BBC</a> what would be worth telling later generations.</p>
<p>His answer was divided into two parts, intellectual and moral. The latter, I think, may be of some use today.</p>
<blockquote>
<p>Love is wise, hatred is foolish.</p>
<p>In this world, which is getting more and more closely interconnected, we have to learn to tolerate each other. We have to learn to put up with the fact that some people say things that we don’t like.</p>
<p>We can only live together in that way. And if we are to live together and not die together, we must learn a kind of charity and a kind of tolerance which is absolutely vital to the continuation of human life on this planet.</p>
</blockquote>
<p>We tend not to do that. We take sides arbitrarily, probably more easily online than offline. We create fractures that make participation in any community more tiring than it should be. <a href="https://continuations.com/post/751642413712523264/i-miss-writing-here">Albert Wenger puts it like this</a>:</p>
<blockquote>
<p>The world is continuing to descend back into tribalism. [&#8230;] Words have been rendered devoid of meaning and reduced to pledges of allegiance to a tribe. [&#8230;]</p>
<p>I don’t belong to any of the tribes nor would I want to. But the effort required to maintain internally consistent and intellectually honest positions in such an environment is daunting. And it often seems futile.</p>
</blockquote>
</section>
<section id="Mental-health">
<h2>Mental health</h2>
<p>I generally avoid that topic online, but I will make an exception.</p>
<p>Brain chemistry is complicated, and mental health is a multi-dimensional spectrum. We vaguely mark regions of that spectrum and give them disorder names; it is a necessarily simplified model. The frontiers of those regions are blurry and differ between cultures and over time. Two decades ago, for instance, behavior considered normal for kids in France would often have resulted in medication for ADHD in the US.</p>
<p>Today the number of diagnoses and self-diagnoses is clearly exploding. Part of the reason is that influencers, sometimes paid by medical companies, have made neurodivergence &#8220;trendy&#8221;: people feel like having a disorder makes them belong to a community. It is even worse for kids, with parents &#8220;diagnosing&#8221; them and managing to find medical professionals to confirm those diagnoses.</p>
<p>The problem is that studies have shown that believing that you have a mental disorder when you do not can make you exhibit the same symptoms. However they do not come from the same causes, so medication will not work beyond the placebo effect, but it will mess with your brain chemistry.</p>
<p>A psychiatrist once told me: &#8220;If we can avoid treating something like a disease, we should.&#8221; I think this is the right approach. We must go back to considering more zones of the spectrum &#8220;normal&#8221;.</p>
<p>Note that I am not saying you should not go to therapy! If anything learning <a href="https://en.wikipedia.org/wiki/Cognitive_behavioral_therapy">CBT</a> basics could benefit everyone. But we should <strong>normalize</strong> therapy instead of labeling everyone with a mental disorder.</p>
<p>Although I have been thinking about this topic for a long time, posting about it here was prompted first by <a href="https://world.hey.com/dhh/the-endangered-state-of-normality-d632a7fe">a post by DHH</a>, and more recently by <a href="https://www.youtube.com/watch?v=3a_as1UDDwU">a video in French</a> where I learned about the influence of medical companies like Done and Cerebral. I also have <a href="https://www.amazon.com/Crazy-Like-Us-Globalization-American/dp/1416587098">a book</a> about how the American approach to mental health impacts the rest of the world on my reading list.</p>
</section>
<section id="Have-fun">
<h2>Have fun</h2>
<p>DHH (again) <a href="https://world.hey.com/dhh/why-i-retired-from-the-tech-crusades-107a51ea">explains very well</a> why I do not use languages like Rust or C++. (*)</p>
<blockquote>
<p>There is no universal set of trade-offs that&#8217;ll make something objectively &#8220;work best&#8221;. Half the programming conundrum lies in connecting to an enduring source of motivation. I wouldn&#8217;t be a happy camper if I had to spend my days programming Rust (but I LOVE so many of the tools coming out of that community by people who DO enjoy just that).</p>
</blockquote>
<p>I work mostly with Python nowadays, it is not my favorite language but I tolerate it. <a href="https://astral.sh">Tools written in Rust</a> are making my life <strong>much</strong> better, yet I would not pick Rust if <strong>I</strong> had to write such tools, even if <a href="https://x.com/awesomekling/status/1822241531501162806">it may be the best tool for that job</a>.</p>
<p>Beginners often ask me what programming language or algorithms they should learn, and I tell them it does not matter at this stage: they should learn what motivates them the most. The older I get, the more I think this remains somewhat true your whole career.</p>
<p>Programmers <strong>need</strong> slack and fun projects, or their output degrades real fast. Young people with no kids can compensate for boring work with side projects, but as you get older you must make sure you find some fun at work. Jason Cohen talks about <a href="https://longform.asmartbear.com/procrastinate/">procrastinating for success</a>.</p>
<blockquote>
<p>Finally, sometimes you’ve got to let yourself do fun stuff at the expense of priorities. Most of what you do in a little company isn’t what you enjoy doing; it’s easy to become frustrated and burned-out. So sometimes you need to allow yourself to recover with plain fun. Whatever the cost of putting off duties, burn-out is even more costly.</p>
</blockquote>
<p>I would add a little nuance to this: it is perfectly possible that, at some point in your life, your work will motivate you so much that you won&#8217;t want to do anything else. And that is perfectly fine, you just have to recognize when that is no longer the case.</p>
<p>Anyway, happy people become successful, not the other way around. There is <a href="https://www.amazon.com/Happiness-Advantage-Positive-Brain-Success/dp/0307591557/">a book</a> about this. We are all different, so figure out what <strong>you</strong> need to be happy now, and go get it.</p>
<p><em>(*) The reason I do not like C++ or Rust is not because they are efficient, statically-typed programming languages, it is the complexity. I did write a lot of C and I am enthusiastic about Zig, for instance.</em></p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Avoiding N+1 queries in Strawberry GraphQL with DataLoaders</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2024-05-28-graphql-dataloaders.html"
    />
    <id>tag:blog.separateconcerns.com,2024-05-28:graphql-dataloaders</id>
    <published>2024-05-28T19:40:00Z</published>
    <updated>2024-05-28T19:40:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>If you prefer, the code for this article is also available in <a href="https://gist.github.com/catwell/e47e70b47550ba2fb07d04a41bb8baf0">a gist</a>.</p>
</blockquote>
<p>GraphQL is great because it lets consumers define the schema of their requests, however that makes it somehow harder to optimize than typical REST requests. If you implement GraphQL navively, you will quickly get the infamous N+1 issue. Let me demonstrate the issue with an example project using <a href="https://quart.palletsprojects.com/">Quart</a>, <a href="https://quart-db.readthedocs.io/">Quart-DB</a>, <a href="https://www.postgresql.org">PostgreSQL</a> and <a href="https://strawberry.rocks">Strawberry</a>.</p>
<p>Let us start by defining a simple schema for a music collection and populating the database with a migration:</p>
<pre><code class="language-python">from quart_db import Connection


async def create_schema(cnx: Connection) -&gt; None:
    await cnx.execute(
        """
            CREATE TABLE bands (
                id bigint PRIMARY KEY,
                name text NOT NULL
            );
            CREATE TABLE albums (
                id bigint PRIMARY KEY,
                name text NOT NULL,
                band_id bigint REFERENCES bands(id)
            );
            CREATE TABLE songs (
                id bigint GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
                name text NOT NULL,
                album_id bigint REFERENCES albums(id)
            );
        """
    )


async def populate(cnx: Connection) -&gt; None:
    await cnx.execute(
        """
            INSERT INTO bands (id, name) VALUES
                (1, 'Dark Tranquillity'),
                (2, 'Pineapple Thief'),
                (3, 'Wintersun');

            INSERT INTO albums (id, name, band_id) VALUES
                (1, 'Haven', 1),
                (2, 'Fiction', 1),
                (3, 'Atoma', 1),
                (4, 'Time I', 3),
                (5, 'Your Wilderness', 2),
                (6, 'Versions of the Truth', 2);

            INSERT INTO songs (name, album_id) VALUES
                ('The Wonders at Your Feet', 1),
                ('Not Built to Last', 1),
                ('Indifferent Suns', 1),
                ('At Loss for Words', 1),
                ('Terminus', 2),
                ('Inside the Particle Storm', 2),
                ('Focus Shift', 2),
                ('Forward Momentum', 3),
                ('Caves and Embers', 3),
                ('When Mountains Fall', 4),
                ('Sons of Winter and Stars', 4),
                ('Land of Snow and Sorrow', 4),
                ('Time', 4),
                ('The Final Thing on My Mind', 5),
                ('Tear You Up', 5);
        """
    )


async def migrate(cnx: Connection) -&gt; None:
    await create_schema(cnx)
    await populate(cnx)
</code></pre>
<p>We expose bands, albums and songs; now let us build a GraphQL interface to query them the naive way:</p>
<pre><code class="language-python">import logging
from typing import Any

import strawberry
from quart_cors import cors
from quart_db import QuartDB
from strawberry.quart.views import GraphQLView as QuartGraphQLView

from quart import Quart, Request, Response

app = Quart("sfdl")
app.logger.setLevel(logging.INFO)

app.config["QUART_DB_DATABASE_URL"] = "postgresql://postgres@localhost/cwl_sfdl"
app.config["QUART_DB_AUTO_REQUEST_CONNECTION"] = False
db = QuartDB(app)

cors(app, allow_origin="*", allow_methods=["GET", "POST"])


@strawberry.type
class Song:
    id: int
    name: str
    album_id: int


@strawberry.type
class Album:
    id: int
    name: str
    band_id: int

    @strawberry.field
    async def songs(self) -&gt; list[Song]:
        query = """
            SELECT id, name, album_id
            FROM songs
            WHERE album_id = :album_id
        """
        async with db.connection() as cnx:
            result = await cnx.fetch_all(query, {"album_id": self.id})
        songs = [Song(**row) for row in result]
        app.logger.info(f"Got {len(songs)} songs.")
        return songs


@strawberry.type
class Band:
    id: int
    name: str

    @strawberry.field
    async def albums(self) -&gt; list[Album]:
        query = """
            SELECT id, name, band_id
            FROM albums
            WHERE band_id = :band_id
        """
        async with db.connection() as cnx:
            result = await cnx.fetch_all(query, {"band_id": self.id})
        albums = [Album(**row) for row in result]
        app.logger.info(f"Got {len(albums)} albums.")
        return albums


@strawberry.type
class Query:
    @strawberry.field
    async def bands(self) -&gt; list[Band]:
        query = """
            SELECT id, name
            FROM bands
        """
        async with db.connection() as cnx:
            result = await cnx.fetch_all(query)
        bands = [Band(**row) for row in result]
        app.logger.info(f"Got {len(bands)} bands.")
        return bands


class GraphQLView(QuartGraphQLView):
    async def get_context(self, request: Request, response: Response) -&gt; dict[str, Any]:
        return {"request": request, "response": response}


view = GraphQLView.as_view(
    "graphql_view",
    schema=strawberry.Schema(query=Query),
    graphql_ide="graphiql",
)
app.add_url_rule("/", view_func=view)
</code></pre>
<p>We can try it with GraphiQL, to check that it works:</p>
<p><img alt="music collection request in GraphiQL" src="img/strawberry-song-collection.png"/></p>
<p>It does, but if we look at the logs we see this:</p>
<pre><code class="language-text">INFO in __init__: Got 3 bands.
INFO in __init__: Got 2 albums.
INFO in __init__: Got 1 albums.
INFO in __init__: Got 3 albums.
INFO in __init__: Got 2 songs.
INFO in __init__: Got 4 songs.
INFO in __init__: Got 0 songs.
INFO in __init__: Got 4 songs.
INFO in __init__: Got 2 songs.
INFO in __init__: Got 3 songs.
[59520] [INFO] 127.0.0.1:52944 POST / 1.1 200 806 5311
</code></pre>
<p>It does too many requests: first it gets all the artists, then for each artist it gets the albums, then for each album it gets the songs&#8230; That is the N+1 problem.</p>
<p>If you look it up online, you will quickly find out that a popular solution is dataloaders. However, a lot of examples you will find do not correspond exactly to that problem, because they only demonstrate how to use dataloaders on primary keys, whereas here we want to load on a foreign key. This is the case of <a href="https://strawberry.rocks/docs/guides/dataloaders">the official Strawberry documentation</a>, which you should still read too if you use that library.</p>
<p>The important thing to understand with dataloaders is that they take a list of keys and return a list of answers of the same size, correponding to those keys. So you cannot, for instance, have a dataloader that takes a list of album IDs and returns a list of all the songs in those albums. However, the trick is that you <strong>can</strong> have a dataloader that returns a list of <strong>lists</strong> of songs corresponding to each album!</p>
<p>Now let us rewrite our example with that pattern:</p>
<pre><code class="language-python">import logging
from collections import defaultdict
from functools import cached_property
from typing import Any

import strawberry
from quart_cors import cors
from quart_db import QuartDB
from strawberry.dataloader import DataLoader
from strawberry.quart.views import GraphQLView as QuartGraphQLView
from strawberry.types import Info

from quart import Quart, Request, Response

app = Quart("sfdl")
app.logger.setLevel(logging.INFO)

app.config["QUART_DB_DATABASE_URL"] = "postgresql://postgres@localhost/cwl_sfdl"
app.config["QUART_DB_AUTO_REQUEST_CONNECTION"] = False
db = QuartDB(app)

cors(app, allow_origin="*", allow_methods=["GET", "POST"])


@strawberry.type
class Song:
    id: int
    name: str
    album_id: int


@strawberry.type
class Album:
    id: int
    name: str
    band_id: int

    @strawberry.field
    async def songs(self, info: Info) -&gt; list[Song]:
        dl = info.context["dataloaders"].songs_for_albums
        return await dl.load(self.id)


@strawberry.type
class Band:
    id: int
    name: str

    @strawberry.field
    async def albums(self, info: Info) -&gt; list[Album]:
        dl = info.context["dataloaders"].albums_for_bands
        return await dl.load(self.id)


@strawberry.type
class Query:
    @strawberry.field
    async def bands(self) -&gt; list[Band]:
        query = """
            SELECT id, name
            FROM bands
        """
        async with db.connection() as cnx:
            result = await cnx.fetch_all(query)
        bands = [Band(**row) for row in result]
        app.logger.info(f"Got {len(bands)} bands.")
        return bands


class DataLoaders:
    @staticmethod
    async def load_songs_for_albums(keys: list[int]) -&gt; list[list[Song]]:
        query = """
            SELECT id, name, album_id
            FROM songs
            WHERE album_id = ANY(:keys)
        """
        async with db.connection() as cnx:
            result = await cnx.fetch_all(query, {"keys": keys})
        songs = [Song(**row) for row in result]
        app.logger.info(f"Got {len(songs)} songs.")
        by_key: defaultdict[int, list[Song]] = defaultdict(list)
        for song in songs:
            by_key[song.album_id].append(song)
        return [by_key[k] for k in keys]

    @staticmethod
    async def load_albums_for_bands(keys: list[int]) -&gt; list[list[Album]]:
        query = """
            SELECT id, name, band_id
            FROM albums
            WHERE band_id = ANY(:keys)
        """
        async with db.connection() as cnx:
            result = await cnx.fetch_all(query, {"keys": keys})
        albums = [Album(**row) for row in result]
        app.logger.info(f"Got {len(albums)} albums.")
        by_key: defaultdict[int, list[Album]] = defaultdict(list)
        for album in albums:
            by_key[album.band_id].append(album)
        return [by_key[k] for k in keys]

    @cached_property
    def songs_for_albums(self) -&gt; DataLoader[int, list[Song]]:
        return DataLoader(self.load_songs_for_albums)

    @cached_property
    def albums_for_bands(self) -&gt; DataLoader[int, list[Album]]:
        return DataLoader(self.load_albums_for_bands)


class GraphQLView(QuartGraphQLView):
    async def get_context(self, request: Request, response: Response) -&gt; dict[str, Any]:
        return {"request": request, "response": response, "dataloaders": DataLoaders()}


view = GraphQLView.as_view(
    "graphql_view",
    schema=strawberry.Schema(query=Query),
    graphql_ide="graphiql",
)
app.add_url_rule("/", view_func=view)
</code></pre>
<p>The request for the whole collection still works, but now if we look at the logs we can see this:</p>
<pre><code class="language-text">INFO in __init__: Got 3 bands.
INFO in __init__: Got 6 albums.
INFO in __init__: Got 15 songs.
[59520] [INFO] 127.0.0.1:60244 POST / 1.1 200 806 4509
</code></pre>
<p>No more N+1, our job is done here.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts 9 — Google vs Amazon, Radicality, Typing</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2024-04-15-thoughts-9.html"
    />
    <id>tag:blog.separateconcerns.com,2024-04-15:thoughts-9</id>
    <published>2024-04-15T21:15:00Z</published>
    <updated>2024-04-15T21:15:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>&#8220;Thoughts&#8221; are posts about what has been on my mind. Sometimes practical, sometimes not; often just things I read recently. Less thought out than regular posts.</p>
</blockquote>
<section id="Differences-between-Google-and-Amazon">
<h2>Differences between Google and Amazon</h2>
<p>It is always interesting to compare those two companies. They differ in their fundamental principles and goals, the way they operate, their technical stacks&#8230;</p>
<p>The mother of all comparisons is <a href="http://files.catwell.info/misc/mirror/steve-yegge-google-amazon.txt">Steve Yegge&#8217;s famous rant</a>. More recently, I have also really enjoyed posts by <a href="https://carloarg02.medium.com">Carlos Arguelles</a> who went from Amazon to Google and (very recently) back.</p>
<p>In <a href="https://blog.schmizz.net/disaggregated-wal">the disaggregated write-ahead log</a>, Shikhar Bhushan highlights an important difference between the two giants&#8217; architectures. At Google the distributed filesystem (Colossus, formerly GFS) is a fundamental building block. It is not global but zonal, and replication is built on top of it. At AWS the globally distributed log — which is not exposed as a public service  —  is a fundamental primitive, and S3 is built on top of it. Shikhar is now <a href="https://s2.dev">building that service</a>.</p>
<p>Jaana Dogan also <a href="https://twitter.com/rakyll/status/1775957427755917363">recently tweeted</a> about another difference:</p>
<blockquote>
<p>At Google, a lot of time is spent on rewriting infra or migrating to new infra. AWS rarely kills its services, hence if there are no new hard problems due to  growing scale or something, it&#8217;s fairly cheap to keep the lights on.</p>
</blockquote>
<p>That would be part of the explanation for why Google often <a href="https://twitter.com/killedbygoogle">kills its services</a> when Amazon maintains them. Although I think Amazon&#8217;s customer obsession is crucial too.</p>
</section>
<section id="Is-radicality-needed-to-solve-Big-Problems">
<h2>Is radicality needed to solve Big Problems?</h2>
<p>I have been re-reading some older articles by Philippe Silberzahn (in French) and <a href="https://philippesilberzahn.com/2021/11/15/transformation-face-aux-grands-problemes-faut-il-etre-radical/">this one deserves a mention</a>.</p>
<p>He describes how many people have a view that &#8220;Big Problems&#8221; such as climate change can only be solved with radical actions. He posits that it stems from at least six mental models:</p>
<ol>
<li>
A Big Problem requires a Big Solution
</li>
<li>
There is no doubt about the existence of the Big Problem
</li>
<li>
The end justifies the means
</li>
<li>
There is a simple solution to a complex problem
</li>
<li>
There are no adverse effects
</li>
<li>
The resolution of the problem does not require compromise
</li>
</ol>
<p>His view is that Big Problems often have a large social component, and that the large change required to solve them does not usually come from radicality but from small actions carried out by people with alternative mental models.</p>
</section>
<section id="Statically-typing-dynamic-languages">
<h2>Statically typing dynamic languages</h2>
<p>Note: I am expanding on something I <a href="https://bsky.app/profile/catwell.info/post/3kp7hvmyl6n22">posted elsewhere</a> here.</p>
<p>I think I finally understood a problem I have with many type systems added on top of dynamic languages. In practice, they work against <a href="https://en.wikipedia.org/wiki/SOLID">the I and D of SOLID</a>. You can make Interface Segregation work, but you need granular interfaces and intersection types. As for Dependency Inversion, typing makes boundary code very verbose, and using Dependency Inversion reduces the advantages of using typed libraries anyway, since if you do it well library types should not leak from the boundary into client code.</p>
<p>It is also interesting to note that AI appears to be bad at writing code with inverted control. It shows it &#8220;reasons bottom-up&#8221;, which makes sense when you know how it works. So the end result of typing + copilot is that I write code that is less flexible and that requires larger diffs to change. It is not necessarily <strong>harder</strong> to change, because the tooling helps.</p>
<p>I have a feeling it is not always good or bad, it probably depends on the kind of code I write. SOLID is not absolute. But it is annoying me that things that I still view as &#8220;mere tools&#8221; introduce so much friction to achieve patterns that I consider elegant and useful.</p>
<p>On a related note, Armin Ronacher — who mostly switched to Rust nowadays — has <a href="https://lucumr.pocoo.org/2023/12/1/the-python-that-was/">an interesting blog post about his view of typed Python</a> too.</p>
</section>
<section id="Soft-skills-posts">
<h2>Soft skills posts</h2>
<p>Daniel Mangum thinks <a href="https://danielmangum.com/posts/most-important-skill-startup-engineering-leadership/">the most important skill in startup engineering leadership</a> is pacing. I agree wholeheartedly. Pacing in startups is hard to get right: it depends on many forces, it is often a tradeoff, and getting it wrong can be disastrous.</p>
<p>Phil Eaton — who recently changed jobs — wrote <a href="https://notes.eatonphil.com/2024-03-11-first-month-on-a-database-team.html">a very good post</a> about what to do when you join a new company or team in a senior position. He also mentions internal blogs, which is something I rarely see but always thought was worth doing since I read about it in <a href="https://scottberkun.com/yearwithoutpants/">The Year Without Pants</a>.</p>
<p>In <a href="https://vickiboykis.com/2024/03/13/both-pyramids-are-white/">Both pyramids are white</a>, Vicki Boykis talks about a specific kind of groupthink. Unlike the pyramids, it is not black or white, there is a tradeoff between dissenting when necessary and <strong>not</strong> dissenting when not. We all have a natural tendency for one or the other, that we need to acknowledge and fight to find the right balance.</p>
</section>
<section id="More-technical-posts">
<h2>More technical posts</h2>
<p>Dave Paola explains <a href="https://thedailydeveloper.substack.com/p/why-are-non-dry-specs-more-maintainable">why non-DRY specs are more maintainable</a>. There was no need to convince me on this. He quotes Richard Gabriel:</p>
<blockquote>
<p>The primary feature for easy maintenance is locality. Locality is that characteristic of source code that enables a programmer to understand that source by looking at only a small portion of it.</p>
</blockquote>
<p>Speaking of Richard Gabriel, I have read a few articles about <a href="https://gregoryszorc.com/blog/2021/04/13/rust-is-for-professionals/">Rust</a> and <a href="https://notes.eatonphil.com/2024-03-15-zig-rust-and-other-languages.html">Zig</a> recently. The more I do the more I think it may be a Worse is Better situation in modern systems software. It has <a href="https://www.dreamsongs.com/WorseIsBetter.html">never been clear</a> if one is actually better. The Better (Rust) side seems to be winning market share for now, but personally I am more drawn to Zig.</p>
<p>Tom Tunguz thinks <a href="https://tomtunguz.com/why-databases-wont-charge-storage/">databases won&#8217;t charge for storage in the future</a>. The pendulum keeps swinging between colocating compute with data and separating them. Both have advantages and drawbacks. I have successfully argued for colocation in several cases (&#8220;bringing compute to the data&#8221;), but it is true that for some categories of systems they tend to be decoupling successfully today. <a href="https://quickwit.io">Quickwit</a> is a great example.</p>
<p>Finally, Justin Jaffrey points to cases <a href="https://buttondown.email/jaffray/archive/when-compositionality-fails/">where compositionality fails</a>. We love clean abstractions that do not leak, but when you get into the nitty-gritty details of some kinds of software, you cannot realistically have them. Justin mentions distributed systems and query planners, and this also makes me think about compilation stacks. You might <strong>think</strong> there is a nice layered model, but when you look at the details it is often far from being the case.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts 8 — Simplicity, Progress, Culture</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2024-02-11-thoughts-8.html"
    />
    <id>tag:blog.separateconcerns.com,2024-02-11:thoughts-8</id>
    <published>2024-02-11T14:40:00Z</published>
    <updated>2024-02-11T14:40:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>&#8220;Thoughts&#8221; are posts about what has been on my mind. Sometimes practical, sometimes not; often just things I read recently. Less thought out than regular posts.</p>
</blockquote>
<section id="Automate-But-Automate-Last">
<h2><a href="https://matt-rickard.com/automate-but-automate-last">Automate (But Automate Last)</a></h2>
<p>Matt Rickard talking about the fifth step of Elon Musk&#8217;s manufacturing algorithm. Automating too early is one of the mistakes I have seen the most in software companies. Once people see the benefits of automation, they tend to abuse it. Doing that results in poor comprehension of the system and friction when changes are needed.</p>
<p>All of the steps of Musk&#8217;s algorithm are relevant to software too, as is the fact that they are in chronological order. I won&#8217;t copy/paste them here, go read the end of Matt&#8217;s post. As far as I know, its source is <a href="https://www.amazon.com/Elon-Musk-Walter-Isaacson-ebook/dp/B0BW9TRGKV/">Walter Isaacson&#8217;s book</a>.</p>
</section>
<section id="The-model-is-not-the-product">
<h2><a href="https://matt-rickard.com/the-model-is-not-the-product">The model is not the product</a></h2>
<p>Matt (again) on how the way we see Generative AI today is only a temporary state. In most cases, raw models will not be exposed to users. We will often want AI use to be more subtle, hidden in the background even. To achieve that we will need a better, more deterministic and flexible interface around the models. This is why I predict a project such as <a href="https://outlines-dev.github.io/outlines/">Outlines</a> or <a href="https://lmql.ai">LQML</a> is likely to become very important soon.</p>
</section>
<section id="DHH-on-zero-interest-rates-and-low-productivity">
<h2>DHH on zero-interest rates and low productivity</h2>
<p>In his Rails World keynote, DHH <a href="https://www.youtube.com/watch?v=iqXjGiQ_D-A&amp;t=778s">talked about how</a> the low interest rates we had for over a decade were a likely cause of the success of complex, over-engineered tools and the hyper-specialization of software jobs.</p>
<p>I think this <strong>may</strong> be true, and if so I hope the pendulum is swinging back.</p>
</section>
<section id="Toward-a-shallower-future">
<h2><a href="https://www.noahpinion.blog/p/toward-a-shallower-future">Toward a shallower future</a></h2>
<p>This is a long and very interesting post. Greatness is often born of terrible situations: misery, war, disease&#8230; But then if progress can eliminate those issues, should we do it? Noah Smith argues that yes, we should, hence the subtitle:</p>
<blockquote>
<p>Adversity isn&#8217;t worth the price of adversity.</p>
</blockquote>
<p>You may note that this theme is somehow related to <a href="https://blog.separateconcerns.com/2024-01-06-talos.html">this post</a>. The related meanings of life and progress is a topic I&#8217;m thinking about a lot at the moment.</p>
</section>
<section id="Archive-your-projects">
<h2><a href="https://ratfactor.com/cards/archive-your-projects">Archive your projects</a></h2>
<p>When you ship something significant you should take some time to either ensure it will be preserved and accessible by you forever, or at least that you can remember it years later, by writing about it and taking screenshots for instance.</p>
<p>Note that I disagree with the &#8220;It&#8217;s never too late&#8221; part. I have not done that for some early work projects in my career, and I regret it now. Do it while you can.</p>
</section>
<section id="Easy-vs-Simple">
<h2>Easy vs Simple</h2>
<p>The tension between Simple and Easy has always been an important point for me. Hajime Hoshi <a href="https://twitter.com/hajimehoshi/status/1740250213712044198">gives an interesting definition</a>:</p>
<blockquote>
<p>Easy: how quickly you can achieve what you want<br>
Simple: how quickly you can understand the model</p>
</blockquote>
<p>Easy is nice to have, Simple is crucial. The effect of &#8220;easy&#8221; is linear whereas the effect of &#8220;simple&#8221; is exponential. Never trade the latter for the former.</p>
</section>
<section id="AI-an-energy-bomb">
<h2><a href="https://legrandcontinent.eu/fr/2023/12/29/lia-une-bombe-energetique-en-2024/">AI, an energy bomb?</a></h2>
<p>An article in French and paywalled, sorry. But the issue of energy generation and consumption has been on my mind for a long time, and is even more pregnant now. Also a <a href="https://blog.separateconcerns.com/2024-01-06-talos.html">Talos Principle 2</a> issue!</p>
</section>
<section id="EU-CRA:-What-does-it-mean-for-open-source">
<h2><a href="https://berthub.eu/articles/posts/eu-cra-what-does-it-mean-for-open-source/">EU CRA: What does it mean for open source?</a></h2>
<p>Regulation is probably a niche topic for this blog, but it is one I have been following for a long time — ever since I got involved in activism against software patents in the mid-2000s.</p>
<p>This is the best article I have found on the Cyber Resilience Act. Like most EU regulations it is not black and white. If you are interested, go read it and make up your own mind.</p>
<p>The main problem I have with regulation is that the effects are not always easy to predict and not properly re-evaluated. For instance, I believe several laws passed to protect EU citizens and industry against US giants are having the opposite effect. We often forget that added complexity often introduces economies of scale.</p>
</section>
<section id="There-Is-No-Business-Case-For-Civilisation">
<h2><a href="https://planetocracy.substack.com/p/theres-is-no-business-case-for-civilisation">There Is No Business Case For Civilisation</a></h2>
<p>OK, there is no question that this one is a <a href="https://blog.separateconcerns.com/2024-01-06-talos.html">Talos topic</a> :)</p>
<blockquote>
<p>Not everything in life is a pitch to a VC. Organising human activity purely on the basis of return on investment is a dead end philosophy masquerading as rationalism.</p>
</blockquote>
<blockquote>
<p>Better just to be brave, hold your head up and say “this is what I believe”, and then apply rationality to how you should shape the universe to realise your values. A great country does great things because of greatness itself.</p>
</blockquote>
</section>
<section id="Don't-write-bugs">
<h2><a href="https://www.teamten.com/lawrence/programming/dont-write-bugs.html">Don&#8217;t write bugs</a></h2>
<p>Some programmers just want to ship fast and don&#8217;t care about writing fragile or broken code, they will &#8220;fix it later&#8221;. It might work for your personal project, but as soon as you work with other people you&#8217;re losing everyone else&#8217;s time by doing that.</p>
<p>It sounds obvious, but I see people blame reviewers too often. No. The purpose of code review is to discuss design decisions, not find the bugs you wrote because you didn&#8217;t pay attention to edge cases or side effects.</p>
<p>Oh, and sure a few unit tests may help too! But they&#8217;re not the main point. They&#8217;re more a consequence, and a proof that you thought about things, as well as a way to prevent someone else — or future you — from breaking assumptions in the future.</p>
</section>
<section id="There-is-no-compromise">
<h2><a href="https://eventuallycoding.com/en/2024/01/no-compromise">There is no compromise</a></h2>
<p>A good blog post about team culture. In particular, acknowledging that <strong>some</strong> diversity is good, but that it does not mean there should be no shared culture at all within a team or a company.</p>
<p>The remote vs co-located work example is good. I know great fully-remote companies, and some where everyone works 100% from the office. Many of the people who love the former would hate the latter, and vice-versa. Why would you insist on joining a company that works differently from what you like and change its culture?</p>
<p>Similarly, there are companies where everyone is very close and others where relationships are purely professional. Why would you insist that one or the other is wrong? If you want to join a team, adapt to its culture, or find another one that fits you better.</p>
<p>Culture and values are not something you write on a document and mandate top-down, they&#8217;re bottom-up and organic. The best way you can shape culture if you really want to is by picking who you hire carefully. The worst thing you can do is mission someone to change a team or a company&#8217;s culture. If you ever are in a context where someone tries to do that and you cannot reason with them, there is only one thing to do: run.</p>
</section>
<section id="Still-using-Beanstalk">
<h2>Still using Beanstalk</h2>
<p>This is not new, but I am using <a href="https://beanstalkd.github.io">Beanstalk</a> for <a href="https://finegrain.ai">Finegrain</a>. I was already using it <a href="https://blog.separateconcerns.com/2013-06-20-three-years-proprietary-projects.html">at Moodstocks</a> over a decade ago. In the meantime, I have used several other queues, but Beanstalk is still my favorite. It works well and it is <a href="#Easy-vs-Simple">simple</a>. I love tools like that.</p>
<p>I am using Beanstalk in a <a href="https://quart.palletsprojects.com">Quart</a> application with <a href="https://github.com/koodaamo/aiostalk">aiostalk</a>, but I still maintain my <a href="https://github.com/catwell/haricot">Lua client</a> so maybe this will be how I sneak some Lua at yet another company this time&#8230; :)</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>FOSDEM 2024</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2024-02-07-fosdem.html"
    />
    <id>tag:blog.separateconcerns.com,2024-02-07:fosdem</id>
    <published>2024-02-07T23:10:00Z</published>
    <updated>2024-02-07T23:10:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Last weekend I attended my 12th <a href="https://fosdem.org/2024/">FOSDEM</a>, not counting the two years of &#8220;remote FOSDEM&#8221; due to COVID.</p>
<p>For a few years now I&#8217;ve been going less for the talks than to meet old acquaintances and make new ones. Still, I did see several interesting talks, and like <a href="https://blog.separateconcerns.com/2014-02-09-fosdem-2014.html">10 years ago</a> I decided to blog about them.</p>
<blockquote>
<p>Note: I saw other talks that were less interesting, I will not mention them.</p>
</blockquote>
<section id="Lightning-talks">
<h2>Lightning talks</h2>
<p>I started my Saturday with a series of lightning talks.</p>
<section id="Problems-and-solutions-for-running-a-distributed-virtual-world-Vadim-Troshchinskiy-Shmelev">
<h3><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-2783-problems-and-solutions-for-running-a-distributed-virtual-world/">Problems and solutions for running a distributed virtual world</a> (Vadim Troshchinskiy Shmelev)</h3>
<p>A talk about <a href="https://overte.org">Overte</a>, a system similar to Second Life but distributed. Advantages: it&#8217;s much cheaper to run and users are more in control. Drawbacks: the world cannot be coherent, and it&#8217;s harder to make things reliable and durable. It cannot be censored or prevent copyright infringement by design, which is an advantage or a drawback depending on how you look at it.</p>
</section>
<section id="Open-Food-Facts:-Acting-on-the-health-and-environmental-impacts-of-the-food-system-Pierre-Slamich">
<h3><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-3595-open-food-facts-acting-on-the-health-and-environnemental-impacts-of-the-food-system/">Open Food Facts: Acting on the health and environmental impacts of the food system</a> (Pierre Slamich)</h3>
<p><a href="https://world.openfoodfacts.org">Open Food Facts</a> is 12 years old. They contributed to the success of Nutri-Score and the upcoming Eco-Score. They are expanding into other areas such as circular economy with <a href="https://world.openproductsfacts.org">Open Product Facts</a>.</p>
</section>
<section id="Observations-on-a-DNSSEC-incident:-the-Russian-TLD-Stéphane-Bortzmeyer">
<h3><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-3740-observations-on-a-dnssec-incident-the-russian-tld/">Observations on a DNSSEC incident: the Russian TLD</a> (Stéphane Bortzmeyer)</h3>
<p>A few days before FOSDEM the .ru TLD was down for a lot of people (not everyone) for a few hours. Because of the context, there was wild speculation online regarding what caused it. Eventually, it looks like it was a simple technical error involving an incorrectly signed DNSSEC root key, which broke the entire TLD for people using validating resolvers.</p>
</section>
<section id="A-simple-caching-service-for-your-CI-Rémi-Duraffort">
<h3><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-2671-a-simple-caching-service-for-your-ci/">A simple caching service for your CI</a> (Rémi Duraffort)</h3>
<p>The <a href="https://lkft.linaro.org">Linux Kernel Functional Testing</a> project runs the same CI tests on many machines (with different architectures) simultaneously, which all download the same assets. They logically wanted to introduce a caching proxy, but transparent proxies like <a href="https://www.squid-cache.org">Squid</a> could not do the job so they <a href="https://gitlab.com/Linaro/kisscache">wrote their own</a>.</p>
</section>
<section id="Reinventing-database-exploration-with-Azimutt-Loïc-Knuchel">
<h3><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-3669-reinventing-database-exploration-with-azimutt/">Reinventing database exploration with Azimutt</a> (Loïc Knuchel)</h3>
<p>My friend Loïc presented his Open Source project <a href="https://azimutt.app">Azimutt</a>, a tool to explore large database schema and data, specifically tailored to very large databases. I had not looked at Azimutt in a long time but it has become super nice. The UI looks great and there are tons of useful features to go beyond exploration and actually document the database. If you ever have to deal with a large database or explore undocumented databases <a href="https://blog.separateconcerns.com/2021-05-01-inch.html#Dealing-with-integrations">like I did at Inch</a>, you should certainly have a look at it.</p>
</section>
<section id="Passbolt-—-Open-source-password-manager-for-teams-Remy-Bertot">
<h3><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-2181-passbolt-open-source-password-manager-for-teams/">Passbolt — Open source password manager for teams</a> (Remy Bertot)</h3>
<p><a href="https://www.passbolt.com">Passbolt</a> is the team password manager we used at Inch. I had seen <a href="https://archive.fosdem.org/2023/schedule/event/passbolt/">their lightning talk last year</a>, I saw it again this year. The project is still progressing well and I would certainly recommend it if you need to share passwords as a team — which you probably do.</p>
</section>
</section>
<section id="Writing-a-consistent-hashing-load-balancer-for-the-Kong-API-gateway-ketama-principle-Thijs-Schreijer">
<h2><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-1936-writing-a-consistent-hashing-loadbalancer-for-the-kong-api-gateway-ketama-principle-/">Writing a consistent-hashing load balancer for the Kong API gateway (ketama principle)</a> (Thijs Schreijer)</h2>
<p>Kong is using consistent hashing in the load balancer to ensure a client always gets the same backend, for cache optimization purposes. Thijs explained consistent hashing and the DNS-specific complexities of using it (this talk was in the DNS room). Someone from the audience suggested <a href="https://en.wikipedia.org/wiki/Rendezvous_hashing">Rendezvous hashing</a> which I&#8217;d heard about but never looked at in-depth, this prompted me to read the Wikipedia article which was interesting.</p>
</section>
<section id="Magic-and-Software-Steven-Goodwin">
<h2><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-2332-magic-and-software/">Magic and Software</a> (Steven Goodwin)</h2>
<p>A very fun talk by an actual magician about how they share and protect their tricks. Sadly the amphitheater was far from full, probably because it was the last talk of the day. The video deserves a watch.</p>
</section>
<section id="You-too-could-have-made-curl-Daniel-Stenberg">
<h2><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-1931-you-too-could-have-made-curl-/">You too could have made curl!</a> (Daniel Stenberg)</h2>
<p>Daniel&#8217;s talks are always great and this one was no exception despite technical issues at the beginning. It was about his experience running the cURL project which is now old enough to drink in Europe. The content of the talk pretty much matches his online book <a href="https://un.curl.dev">Uncurled</a> which I had read before and recommend.</p>
</section>
<section id="Introducing-Refiners-–-A-Micro-Framework-for-Seamless-Integration-of-Adapters-in-Neural-Networks-Benjamin-Trom">
<h2><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-1821-introducing-refiners-a-micro-framework-for-seamless-integration-of-adapters-in-neural-networks/">Introducing &#8216;Refiners&#8217; – A Micro-Framework for Seamless Integration of Adapters in Neural Networks</a> (Benjamin Trom)</h2>
<p>This was a talk by a colleague from <a href="https://finegrain.ai">Finegrain</a> on our Open Source micro-framework for foundation models adaptation <a href="https://refine.rs">Refiners</a>. Obviously, you should go check it out <strong>immediately</strong> and star <a href="https://github.com/finegrain-ai/refiners">the GitHub repository</a> :)</p>
</section>
<section id="Five-years-of-Teal:-minimalism-versus-growth-in-language-design-Hisham-Muhammad">
<h2><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-2564-five-years-of-teal-minimalism-versus-growth-in-language-design/">Five years of Teal: minimalism versus growth in language design</a> (Hisham Muhammad)</h2>
<p><a href="https://github.com/teal-language/tl">Teal</a>, a typed dialect of Lua, is another project I use and occasionally contribute to. This year Hisham talked about upcoming features, and how and why he picked simple but somehow less powerful solutions instead of more complex alternatives.</p>
</section>
<section id="So-you-think-you-know-Git-Scott-Chacon">
<h2><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-3611-so-you-think-you-know-git/">So you think you know Git</a> (Scott Chacon)</h2>
<p>Scott Chacon is an incredible speaker, and the FOSDEM crowd apparently knew it: the amphitheater was full and many people could not get in. The talk was a whirlwind of recent and older lesser-known Git options; watch it and you will certainly learn something.</p>
<p>Toward the end, Scott presented his current project <a href="https://gitbutler.com">GitButler</a>, a graphical Git client leveraging virtual branches. It was recently open sourced and I tried it earlier this week, because I like the idea which could work very well with my workflow. I found it promising but still too rough around the edges to use it at work for now. I might look at the codebase someday because I am curious about the stack (<a href="https://tauri.app">Tauri</a> and <a href="https://svelte.dev">Svelte</a>).</p>
</section>
<section id="Version-control-post-Git-Pierre-Étienne-Meunier">
<h2><a href="https://fosdem.org/2024/schedule/event/fosdem-2024-3423-version-control-post-git/">Version control post-Git</a> (Pierre-Étienne Meunier)</h2>
<p>A talk about Pijul, a DVCS I know about but never actually used — although I did use its spiritual predecessor Darcs back in the day. It uses a very different approach from Git, representing edits as a graph that does not include the content. Having worked a lot with <a href="Distributed-filesystem-synchronization">tree CRDTs</a> (operation-based and state-based) and things like <a href="https://blog.separateconcerns.com/2017-05-07-itc.html">Interval Tree Clocks</a> I can certainly see the advantages but also some of the drawbacks of such an approach. The project also has a <a href="https://pijul.org/posts/2021-02-06-rethinking-sanakirja/">fast K-V store in Rust</a> somewhat similar to LMDB and a <a href="https://nest.pijul.com">forge</a> hosting its source code and offering free hosting.</p>
</section>
<section id="Conclusion">
<h2>Conclusion</h2>
<p>FOSDEM is a bit tiring, but FOSDEM is great. Like I said, the talks sure are nice, but you should also go for the people (and the beer!). This will certainly not be my last FOSDEM, see you next year in Brussels!</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>The Talos Principle 2</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2024-01-06-talos.html"
    />
    <id>tag:blog.separateconcerns.com,2024-01-06:talos</id>
    <published>2024-01-06T10:45:00Z</published>
    <updated>2024-01-06T10:45:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>Warning: this post includes some spoilers for The Talos Principle 1 and 2. If you intend to play them — and you should! — do it first and come back later.</p>
</blockquote>
<p>I do not have much free time since the birth of my first son in 2020, so I have almost entirely given up video games. But I had to make an exception for The Talos Principle 2, which was released last November and which I finished earlier this week.</p>
<p>The Talos Principle came out in 2014, but I only played it in late 2021 and it instantly became one of my favorite games. On the surface, you play a robot solving puzzles, but it is actually a game designed to make you think, rooted in philosophy.</p>
<p>The first game touched on the themes of AI and consciousness, free will, religion, and the perils of progress among others. The second game expands on that last theme and adds more such as society / politics and (late game) the nature of love.</p>
<p>In both games, there are several layers to the story. The &#8220;main scenario&#8221; takes place in the &#8220;physical world&#8221; but a lot of content is accessed through text found in computer terminals, audio logs, text adventure games, an in-game BBS, or even inside your own subconscious. Some characters are very impactful, and yet you never interact with them otherwise than through messages they left here and there. One such character is Lifthrasir, and I cannot resist quoting some of his messages here:</p>
<blockquote>
<p>When you sit in the dunes and you hear only the wind, and nothing else at all, and all the complexities of civilization fade away, you truly understand that spiritual peace is a great evil, a kind of shallow banality that we must always strive against. It is spiritual excitement and enthusiasm which sustain our humanity; spiritual peace is a vile and cowardly surrender to oblivion.</p>
</blockquote>
<p>and:</p>
<blockquote>
<p>That is what we do now, we seek facts rather than truth, because truth might frighten and unsettle the comfortable people who like to sit in their conference rooms and debate which corners we should cut today.</p>
</blockquote>
<p>A core theme of the game is whether Humanity should face extinction risks it causes to itself (e.g. climate change) through restraint (limiting energy consumption and population growth etc) or techno-solutionism and growth (including becoming an interstellar species). Your choices about this issue influences the scenario of the game, and some characters are avatars of one way or the other as well as several middle-ground options. In the techno-solutionist camp are Byron and Melville. The latter is the engineer on your team, so for obvious reasons I can sympathize with her. A quote that resonated with me:</p>
<blockquote>
<p>All we do anymore is think about the worst case scenario. You know, I didn&#8217;t even realize how much I&#8217;d limited my own imagination, how I talked myself into just accepting this incredibly poor future we&#8217;d been offered. A future where things just keep getting slightly worse every day and we accept it because we&#8217;re ashamed of ourselves. Not of something we&#8217;ve done, but just of our existence. Like we&#8217;re a virus on this planet. Like our existence is a sin.</p>
</blockquote>
<p>In any case The Talos Principle 2 is, perhaps even more than the first one, a game that will make you think. It will force you to consider philosophical and ethical issues and make choices about them. You could say it&#8217;s a giant trolley problem, but that wouldn&#8217;t make it justice: it is much more than that. It is not everyday a work of fiction changes my view of some important issues, and this game did.</p>
<p>Oh, and the puzzles are fun, too!</p>
<p>If you haven&#8217;t played the Talos Principle series, I hope this post encouraged you to try it. I recommend starting with the first game if you can, since the second one has <strong>major</strong> spoilers. Personally I think you can skip the Road to Gehenna DLC if you are short on time.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Automating myself out of a job?</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-10-21-automating-job.html"
    />
    <id>tag:blog.separateconcerns.com,2023-10-21:automating-job</id>
    <published>2023-10-21T14:20:00Z</published>
    <updated>2023-10-21T14:20:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Since I&#8217;m <a href="https://blog.separateconcerns.com/2023-03-31-joining-finegrain.html">back in AI</a>, a recurring question has been whether we are collectively automating ourselves — software engineers and other kinds of tech people — out of our jobs. So, are we? And if so, how long will it take until that becomes a problem, and is this ultimately bad? I don&#8217;t have all the answers, but here is some insight.</p>
<p>First, we have always tried to automate repetitive things. This is why we write libraries and frameworks to move up the ladder of abstraction — which by the way comes with its own set of challenges. We are reasonably good at it, and that is part of what justifies our high salaries, but it is clear that <a href="https://www.youtube.com/watch?v=l2btv0yUPNQ">very small shell scripts</a> will not be enough to replace us entirely.</p>
<p>In the last few years, large language models have shown somewhat impressive ability to generate code, to the point that AI replacing human programmers in the next decade has become a possibility. Like many, I have been experimenting with those tools, and my impressions are mixed.</p>
<p>On the one hand, I am convinced by tools that are integrated into editors and work like a better autocomplete. I have been using GitHub Copilot for a few months and it is helpful. It does not <strong>always</strong> suggest the right thing, but it does so often enough that it saves me time.</p>
<p>On the other hand, I am skeptical of the approach that consists of generating larger chunks of code using tools such as ChatGPT. It may work for one-shot throwaway scripts, but it is rarely helpful for writing &#8220;real&#8221; software. The reason is that it fails in two ways. The first one is generating completely wrong code (too simplistic, solving the wrong problem&#8230;), and the second one is making less obvious mistakes in the middle of code that otherwise looks good. While the former is not such a problem, the latter definitely is.</p>
<p>An analogy you could make is that they both work like junior programmers making mistakes, but Copilot pairs with you whereas the larger code chunks generation approach is similar to the pull request / code review workflow. If you have high-quality standards, reviewing and fixing bad code is often more time-consuming than writing it from scratch. With junior developers you do it anyway because you invest in their growth, hoping eventually they will write good code that saves you time. With current AI that learning doesn&#8217;t happen, or at least not fast enough.</p>
<p>Also, there is clearly a difference depending on the kind of code you write and how innovative it is. For instance, for my job at Finegrain, Copilot is very helpful with Web backend code (using <a href="https://github.com/pallets/quart">Quart</a>, SQL requests&#8230;), but much less so when I work on deep learning models using <a href="https://github.com/finegrain-ai/refiners">our Open Source framework Refiners</a>. This reinforces my view that programming bootcamps that teach superficial concepts to put people on the market as early as possible are a trap; if you are a programmer and worry about your job safety, I suggest you invest in fundamentals.</p>
<p>If that wasn&#8217;t reason enough, AI appears to be better at solving high-level problems. By that I mean that it is good at answering questions that an average non-technical person could ask, such as &#8220;create a nature-themed landing page for my new business which sells coconut oil shampoo&#8221;, but less good at understanding the kind of problems developers can only talk about with other developers.</p>
<p>So it is clear to me that I will not be replaced by AI next year, but what about in 10 years? What about in 20? That is where knowing a bit about how AI works helps.</p>
<p>Let&#8217;s start by saying I was not surprised that code generation turned out to be an area where deep learning shines. I have been saying for over a decade that <a href="https://marshallbrain.com/manna1">this revolution will affect white-collar jobs before blue-collar</a>. Moreover, the current wave of AI is good at replicating things for which it has tons of examples, and we gave it that with Open Source code. This is also why AI is good at generating pictures, stories, or web pages: it is all out there on the Internet. Humans are still better at learning from fewer examples, even though there has been a lot of progress in that area recently with foundational models and few-shot learning.</p>
<p>Now, my belief is that although recent advances are a good predictor for upcoming short-term improvements, it is not for the long term (by that I mean a few years away). I am 100% sure that we will get better copilots and image models in 2024, but I also think it is extremely hard to predict what will happen in 2030. The reason for this is that large foundational models exhibit a property called <a href="https://www.quantamagazine.org/the-unpredictable-abilities-emerging-from-large-ai-models-20230316/">emergence</a>, which you can basically interpret as: &#8220;we know increasing the resources available to the model will make it better, but we do not know exactly at what&#8221;. And let us be clear here: that does not mean we do not know how to improve a model along a specific dimension, how to teach it to be better at something specific. This is precisely what I am working on! This means I believe the major advances in AI have not and will not come from such deliberate approaches, but from just throwing more hardware, more / better data, and marginally better core architectures at models, and seeing what they learn to do.</p>
<p>In other words, I do think AI may get better at the things it doesn&#8217;t do well enough to replace programmers, but I would say it is about as likely to happen to other &#8220;intellectual&#8221; professions such as managers, lawyers, doctors, architects, and so on.</p>
<p>One point that I&#8217;d like to emphasize though: a few years ago people who don&#8217;t work in AI used to think that &#8220;creativity&#8221; was a human prerogative and that AI would never challenge &#8220;artistic&#8221; professions. I hope by now you have figured out this was wrong. I&#8217;ll go even further: one of the main problems in AI today is that it tends to be <strong>too</strong> creative. We keep trying to figure out ways to curb that tendency to be like a child who tells you about their day at school but invents half of it. My personal view on it is that this is not something we learned about AI, this is something we confirmed about human nature: that evolution made us powerful pattern-matching machines, and that creativity is just an emergent property that came out of it. And I say confirmed because personally I have always thought it to be the case: there were hints at it even before AI, from observing how children learn to our unconscious biases.</p>
<p>That digression aside, let us now assume AI <strong>does</strong> effectively replace programmers. What then? Does that depress me? What am I to do with my life?</p>
<p>Well, the truth is I am not concerned. Programming is an essential part of me but I had been writing code for over a decade before I started doing it professionally, and even nowadays I still write some code for fun with no financial reward at all. I&#8217;ll keep doing that even if AI beats us at it. Did people stop playing chess or any of the many games AI has beaten us at for years? Did we stop making tools and furniture by hand now that most of the industry is automated? Of course not. So I&#8217;ll probably turn to a form of craftsmanship I already enjoy practicing, or even to more <a href="https://www.camilleroux.com/2023/07/26/art-generatif-de-la-decouverte-a-la-publication-dun-projet-dans-un-studio-prestigieux/">artistic forms of code</a>.</p>
<p>Will I still make a living out of it? Probably not. But I am confident I will adapt. Even if the entire tech industry is automated I know that I can learn other unrelated marketable skills in a matter of months if not weeks — because I have already done it. And I am in a better position than most to notice what jobs are under threat.</p>
<p>Extrapolating to the entire society, will it not result in a major problem if too many jobs are automated? Well yes, it will, and I do believe at some point we will need to tackle that issue. Note that the issue is <strong>not</strong> that there won&#8217;t be enough jobs for everyone. Jobs are not something we fundamentally need, if anything most of us work too much today. And it is not that there won&#8217;t be enough value creation for everyone either: those machines <strong>will</strong> create value. The problem is one of allocation.</p>
<p>Here is how I explain my view on it: I actually like capitalism, and I think it is in part responsible for a lot of the progress — including <strong>social</strong> progress — that has happened in the world in the last few centuries. However, capitalism was designed on the assumption that the majority of the value-add comes from human work, and a minority from capital. Automation will reverse that, and in a system where capital is responsible for a large majority of the value-add capitalism breaks down.</p>
<p>So how do we prepare for this? Well to start let me recommend <a href="https://marshallbrain.com/manna1">a short novel I already linked earlier</a>. But I think the most important thing to understand is that we are not there yet, and the worst thing to do would be to try to implement parts of the endgame now. See, this is not a zero-sum game, but the world is not a bunch of altruistic parties either. So if you start — for instance — taxing machines now, or worse trying to slow technical progress, rest assured some of your neighbors won&#8217;t, and the end result is <strong>they</strong> will own the machines and not you. So the only reasonable thing to do if you are a benevolent but realistic government is accelerate as fast as you can, capture a large enough chunk of that capital, and <strong>then</strong> once things settle down make sure it benefits your population. All that while avoiding exploding under the pressure of the inevitable social unrest in the meantime.</p>
<p>Democratic governments of the world, I wish you good luck and hope you will succeed.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Linear code is more readable</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-09-11-linear-code.html"
    />
    <id>tag:blog.separateconcerns.com,2023-09-11:linear-code</id>
    <published>2023-09-11T22:35:00Z</published>
    <updated>2023-09-11T22:35:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>You can only claim to be contrarian if people actually defend the opposite viewpoint. Well, one of the &#8220;best practices&#8221; I <a href="https://blog.separateconcerns.com/2023-08-06-disagreeing-best-practices.html">disagree with</a> was recently <a href="https://testing.googleblog.com/2023/09/use-abstraction-to-improve-function.html">featured in the Google Testing Blog</a> — usually a very good resource, there is a reason that post appeared in my newsreader!</p>
<p>The authors present two versions of a function and ask which one is the most readable.</p>
<p><img alt="createPizza" src="img/linear-code.png"/></p>
<p>At first glance, we can already notice the presentation is a bit partisan :) In addition to the obvious background color bias, the authors ellipsed some code on the right-hand side, making both implementations appear roughly the same size when the right one is really much longer.</p>
<p>The authors argue that the function on the right is more readable because it does not mix levels of abstraction, and that makes it more &#8220;top-down&#8221;. Well, OK, but the function of the left reads linearly from the top of the screen to the bottom, whereas if you want to understand everything that happens on the right-hand side you need to jump back and forth.</p>
<p>You may tell me, sure, but you never need to look at the whole code, that is what abstraction is for! OK. Quick, tell me this: does the function that bakes the pizza also heat the oven, or do you need to preheat it first? Hint: there are <strong>two</strong> functions. One is called <code>bake</code> and takes a Pizza, and the other is called <code>bakePizza</code>&#8230;</p>
<p>Also, what happens if you pass a pizza to those functions twice? Are they idempotent or do you end up eating cinder?</p>
<p>So, you may have guessed that I do not like the code style on the right. But I have to admit something: it is somehow easier to understand than the code on the left. Is that because of the structure that separates the levels of abstraction? Let us see. What about that version?</p>
<pre><code class="language-go">func createPizza(order *Order) *Pizza {
  // Prepare pizza
  pizza := &amp;Pizza{Base: order.Size,
                  Sauce: order.Sauce,
                  Cheese: “Mozzarella”}

  // Add toppings
  if order.kind == “Veg” {
    pizza.Toppings = vegToppings
  } else if order.kind == “Meat” {
    pizza.Toppings = meatToppings
  }

  oven := oven.New()
  if oven.Temp != cookingTemp {
    // Heat oven
    for (oven.Temp &lt; cookingTemp) {
      time.Sleep(checkOvenInterval)
      oven.Temp = getOvenTemp(oven)
    }
  }

  if !pizza.Baked {
    // Bake pizza
    oven.Insert(pizza)
    time.Sleep(cookTime)
    oven.Remove(pizza)
    pizza.Baked = true
  }

  // Box and slice
  box := box.New()
  pizza.Boxed = box.PutIn(pizza)
  pizza.Sliced = box.SlicePizza(order.Size)
  pizza.Ready = box.Close()

  return pizza
}
</code></pre>
<p>Do you recognize it? This is just the left-hand side function code, with function names from the right-hand side added as comments.</p>
<p>I don&#8217;t know about you, but this is my favorite. And it looks like the readability just came from explaining what we did properly here, not from extra abstraction layers and indirection.</p>
<p>In conclusion, I stand by what I said earlier: do not extract small functions from linear code, especially if you only use them once. None of the benefits offsets the loss in linearity.</p>
<section id="One-more-thing">
<h2>One more thing</h2>
<p>I wasn&#8217;t sure if I wanted to mention this or not, but I ended up editing the post because there is something that bothers me with this function, and it is that business with the oven.</p>
<p>First, pre-heating the oven is self-contained and should probably be a method of the oven itself. But beyond that, this code makes no sense: why would you create a whole new oven to make a pizza? In real life, you get an oven <strong>once</strong>, and then you bake a whole lot of pizzas with it, without going through the whole heating cycle.</p>
<p>I know this is a synthetic example but this kind of issue actually occurs in real code and sometimes causes performance issues. It is likely that this code should <strong>take</strong> the oven as a parameter. Providing it is the job of the caller.</p>
<p>(And since you put the pizza in the box, you probably want an interface where you return the box, not the pizza. Oh well.)</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts 7 — Microblogging, Solarpunk, AI and success</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-08-12-thoughts-7.html"
    />
    <id>tag:blog.separateconcerns.com,2023-08-12:thoughts-7</id>
    <published>2023-08-12T16:30:00Z</published>
    <updated>2023-08-12T16:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>&#8220;Thoughts&#8221; are posts about what has been on my mind. Sometimes practical, sometimes not; often just things I read recently. Less thought out than regular posts.</p>
</blockquote>
<section id="Microblogging">
<h2>Microblogging</h2>
<p>First a small announcement: <a href="https://bsky.app/profile/catwell.info">I have joined Bluesky</a>. I like it so far and I think it has a good founding team, so I want to believe in its long-term potential. On the other hand, I will likely stop using Mastodon soon; it is not working for me. I will stay on X for now, but I can see Bluesky replacing it entirely after a while.</p>
</section>
<section id="The-future-is-Solarpunk">
<h2><a href="https://feldspaten.org/2023/07/17/The-future-is-solarpunk/">The future is Solarpunk</a></h2>
<blockquote>
<p>Let’s acknowledge the difficulties of our times but without accepting defeat in the process of trying to solve those issues. [&#8230;] We are at the point where we can decide if we want to go full Cyperpunk or something more positive. Solarpunk is the movement, the idea behind envisioning and then creating a better future based on humans which live in harmony with nature.</p>
</blockquote>
<p>If there is one thing I am certain of regarding climate change, it is that no amount of moderation will be enough to solve it without terrible consequences on a planetary scale. But there most likely won&#8217;t be a magical technological breakthrough either. We need to seriously start looking at technologies and ways of life that are both sustainable and acceptable for the whole planet.</p>
<p>On a side note, I also think important technological breakthroughs are not easily predictable in detail. For instance, I think it is highly likely that AI will play a role in fighting climate change,
but I currently have no idea how.</p>
</section>
<section id="StochasticDeterministic">
<h2><a href="https://matt-rickard.com/stochastic-deterministic">Stochastic/Deterministic</a></h2>
<blockquote>
<p>Generative AI introduces much more stochasticity into programming. [&#8230;] Ironically, this makes the deterministic parts that much more important.</p>
</blockquote>
<p>One of the first things I did at Finegrain was making sure I knew about all the sources of randomness, and then adding deterministic end-to-end tests.</p>
</section>
<section id="MiniGPT-4">
<h2><a href="https://minigpt-4.github.io">MiniGPT-4</a></h2>
<p>The authors have taken the visual understanding part of <a href="https://arxiv.org/abs/2301.12597">BLIP-2</a> (a ViT and a Querying Transformer) and aligned it with <a href="https://lmsys.org/blog/2023-03-30-vicuna/">Vicuna</a>. They achieved that by connecting them through a single 5120x768 linear layer. This illustrates well the unintuitive effectiveness of simple linear projections in high-dimensional spaces.</p>
</section>
<section id="What-took-you-here-won't-take-you-there">
<h2>What took you here won&#8217;t take you there</h2>
<blockquote>
<p>It is hard to grasp for some engineers early in their careers what took them here won&#8217;t take them there. Shipping features will probably take you to senior, shipping 10x more features is not how you&#8217;ll become a principal. What will get you to principal is removing chaos, unblocking others, fighting for things to be built in the right order, fighting scope creep, having backbone while knowing when to delegate decision making.</p>
<p>&#8211; <a href="https://twitter.com/rakyll/status/1666592449207336960">Jaana Dogan (@rakyll) on Twitter^WX</a></p>
</blockquote>
</section>
<section id="Why-it's-necessary-to-shoot-yourself-in-the-foot">
<h2><a href="https://jacobgw.com/blog/observation/2023/07/08/shoot-yourself-in-the-foot.html">Why it&#8217;s necessary to shoot yourself in the foot</a></h2>
<blockquote>
<p>To fully understand a &#8220;best practice&#8221; or why something is necessary, it’s important to experience how things go wrong without it. When teaching programming, we should let people make these mistakes, and [only] then show them the tools to correct them.</p>
</blockquote>
</section>
<section id="The-Happiness-Advantage">
<h2>The Happiness Advantage</h2>
<p>There is <a href="https://www.shawnachor.com/books/happiness-advantage/">a whole book</a> dedicated to the fact that happiness fuels success and (mostly) not the other way around, and how to take advantage of it.</p>
<p>I haven&#8217;t read the book (yet) but I have come to that conclusion independently for a while now. I found the book through <a href="https://engineering.prezi.com/shifting-to-the-right-place-my-transition-back-from-em-to-engineer-d435acbabf2f">this post</a> which is one of several about people moving back from management to engineering.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Three Little Pigs</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-08-09-three-little-pigs.html"
    />
    <id>tag:blog.separateconcerns.com,2023-08-09:three-little-pigs</id>
    <published>2023-08-09T14:10:00Z</published>
    <updated>2023-08-09T14:10:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>The Three Little Pigs is a popular bedtime story, but it strikes me as unrealistic and not teaching the right lesson. So I decided to revisit it.</p>
<p><img alt="Illustration: the Big Bad Wolf, Three Little Pigs and three houses" src="img/three-little-pigs.jpg"/></p>
<p>Image by <a href="https://www.freepik.com/free-vector/three-little-pigs-illustration_33805483.htm">Freepik</a></p>
<hr/>
<blockquote>
<p>The Three Little Pigs — A Cautionary Tale about Over-Engineering</p>
<p>Once upon a time, there were three Little Pigs who lived in the forest. One day, they learned that a Big Bad Wolf would soon come to the forest. They decided to build houses to ensure their safety. The first Little Pig decided to build a straw house, the second one a wooden house. As for the third one he elected to build his home out of stone.</p>
<p>A few days later, the Big Bad Wolf arrived in the forest. He saw the straw house of the first Little Pig. He knocked on the door, asking to come in. The Little Pig refused, so the Big Bad Wolf huffed and puffed and blew the house down. Scared, the Little Pig ran off. Thankfully, the Big Bad Wolf was too exhausted from blowing so hard to catch him. The Little Pig sought refuge in the wooden house of the second Little Pig.</p>
<p>Once rested, the Big Bad Wolf followed the tracks of the Little Pig, and soon he arrived at the door of the wooden house. He knocked on the door, asking to come in, but the little pigs refused. So the Big Bad Wolf huffed and puffed and&#8230; nothing happened, because how the hell would a wolf blow down a wooden house?</p>
<p>Disappointed, the Big Bad Wolf gave up and walked down the road, giving up on a pork meal for the day. But as he was leaving, he saw the stone house of the third Little Pig. And he did not knock on the door. Because there was no door, no roof and no windows. The third Little Pig simply did not have the time to finish his house, and he was still there with his trowel, spreading mortar.</p>
<p>For the sake of the faint-hearted, this is where the story concludes. Let me just say it does not end well for the third Little Pig.</p>
</blockquote>
<p>Here it is, a much better twist on the classic.</p>
<p>Ah, and of course the moral:</p>
<blockquote>
<p>Trade-offs are everything, pick the right ones!</p>
</blockquote>

      </div>
    </content>
  </entry>
  <entry>
    <title>Disagreeing with "best practices"</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-08-06-disagreeing-best-practices.html"
    />
    <id>tag:blog.separateconcerns.com,2023-08-06:disagreeing-best-practices</id>
    <published>2023-08-06T16:35:00Z</published>
    <updated>2023-08-06T16:35:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>When I interview software developers, I usually ask some variation of the following questions:</p>
<blockquote>
<p>What Software Engineering practices do you consider critical to achieve your objectives? Are there &#8220;best practices&#8221; that do not matter, or which can be actively harmful?</p>
</blockquote>
<p>My goal in asking this is mainly to understand if the candidate is opinionated, and if so where those opinions come from. For the most part there is no right or wrong answer, but there are good and bad <strong>ways</strong> to answer.</p>
<p>I have already posted some of my answers to the first question <a href="https://blog.separateconcerns.com/2019-02-15-architecture-principles.html">here</a>. Some can be reversed to become answers to the second one too:</p>
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">Don&#8217;t Repeat Yourself</a> is easily one of the most abused principles. It leads to unnecessary over-abstraction and coupling. See &#8220;AHA&#8221; in the Alternatives section of the Wikipedia page.</p>
</li>
<li>
<p>&#8220;Don&#8217;t ship the Org Chart.&#8221; Conway&#8217;s Law is not something you can easily fight, so odds are you <strong>will</strong> ship the org chart. Instead, acknowledge Conway&#8217;s Law and architecture <strong>both</strong> your software and organization with that in mind.</p>
</li>
</ul>
<p>In addition, here are some of my other answers to that second question:</p>
<ul>
<li>
<p>Putting a limit on function sizes, and systematic <a href="https://refactoring.guru/extract-method">method / function extraction</a>. This appears to make code superficially more readable, but in reality it makes it less linear and harder to debug. Other posts sharing that opinion: <a href="https://250bpm.com/blog:36/">Martin Sústrik</a>, <a href="https://loup-vaillant.fr/articles/physics-of-readability">Loup Vaillant</a>.</p>
</li>
<li>
<p>Systematic <a href="https://en.wikipedia.org/wiki/Test-driven_development">Test-driven development</a>. TDD is very useful when the problem is well-defined and the implementation error-prone, for instance when implementing precise specs or an RFC. It is harmful when you do exploratory programming. In some code bases, I go as far as having no unit tests — only end-to-end and regression ones, in addition to plenty of inline assertions in the code.</p>
</li>
<li>
<p>Trying to achieve strict typing of dynamic languages. Don&#8217;t get me wrong, type-checking is helpful as a tool to catch bugs and guide development. But trying to adhere to some theoretical principles too strictly can make you lose all the benefits of the dynamic language underneath. If you want to make that trade-off, great, but then use a statically typed language instead! There are good reasons why <a href="https://www.typescriptlang.org/docs/handbook/type-compatibility.html#a-note-on-soundness">TypeScript is unsound</a>.</p>
</li>
<li>
<p>Writing extensive documentation. Some people tend to think documentation is a silver bullet, and it is often because they have a bad mental model of how users behave. There are two main ways users — including other developers — will possibly consume your documentation: they will read the Getting Started / tutorials, and then they will look for solutions when they encounter problems. Optimize your docs for that.</p>
</li>
<li>
<p>&#8220;Elegance&#8221; is overrated when writing software for production. It should usually be traded off for robustness first — i.e. lower MTBF and MTTR, which implies understandability — and performance second. &#8220;Elegant&#8221; is great if it means &#8220;straightforward&#8221;, harmful <a href="https://blog.separateconcerns.com/2014-05-27-magic.html">if it means magic</a>.</p>
</li>
</ul>
<p>To end this post with something related, <a href="https://www.onebigfluke.com">Brett Slatkin</a> is hosting <a href="https://www.youtube.com/@WorstPractices">a podcast called Worst Practices</a> where developers talk about something terrible they do. I am sure you will recognize yourself in some of those. For instance I have only used a simple editor for a long time like <a href="https://mitchellh.com">Mitchell Hashimoto</a> does, I debug with print statements like <a href="https://www.leahculver.com">Leah Culver</a> and I even sometimes put them in system libraries like <a href="https://sedimental.org">Mahmoud Hashemi</a>!</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Goodbye luafr.org</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-07-25-bye-luafr.html"
    />
    <id>tag:blog.separateconcerns.com,2023-07-25:bye-luafr</id>
    <published>2023-07-25T21:30:00Z</published>
    <updated>2023-07-25T21:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Ten years ago, I started a French-speaking mailing list about Lua. It was somehow active for around two years, but there was never really enough of an active community for it to keep going. To accompany that mailing list, I bought the domain <a href="https://luafr.org">luafr.org</a> and set up a small static webpage with a few links about Lua in French.</p>
<p>Recently, my registrar Gandi was acquired by Total Web Solutions. Prices went up, service went down, so I will be migrating my domains elsewhere when they renew. I am also using the opportunity to let go of a few unnecessary domains, and luafr.org will be one of them. It will expire on October 9, 2023.</p>
<p>Nobody should miss the static webpage, but there is one important thing hosted on that domain, and that is the only <a href="https://luarocks.org">LuaRocks</a> mirror enabled by default besides the official website and GitHub.</p>
<p>I have opened <a href="https://github.com/luarocks/luarocks/pull/1517">a pull request</a> to change the URL to <a href="https://loadk.com/luarocks/">loadk.com</a>, which points to the same IP, but if you have somehow hardcoded it in your configuration file please change <code>luafr.org</code> to <code>loadk.com</code> to avoid disruption.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Locking down the GCP VPC firewall</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-04-15-gcp-firewall.html"
    />
    <id>tag:blog.separateconcerns.com,2023-04-15:gcp-firewall</id>
    <published>2023-04-15T15:45:00Z</published>
    <updated>2023-04-15T15:45:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I have done that three times now, so it is time to make a quick blog post about it.</p>
<p>When you create a new Google Cloud Platform account, its VPC firewall comes configured like this:</p>
<p><img alt="default rules" src="img/gcp-vpc-firewall-default.jpg"/></p>
<p>The first two rules, <code>default-allow-http</code> and <code>default-allow-https</code>, only apply to machines with the <code>http-server</code> and <code>https-server</code> network tags and they are fine. The third one, <code>default-allow-icmp</code>, allows ICMP which is the protocol used by <code>ping</code>; some people do not want that but I typically keep it on. The three last rules, though, are too lax for my taste.</p>
<p>We start with <code>default-allow-rdp</code>. The Remote Desktop Protocol is typically used to access remote Windows servers, even though it is now <a href="https://gitlab.gnome.org/GNOME/gnome-remote-desktop">also supported by Gnome</a>. You are probably not a Windows shop and you certainly do not want that open on all your instances, so disable it.</p>
<p>Now, <code>default-allow-ssh</code>. It is the same thing for the Secure Shell Protocol. I typically do not want to allow SSH access to instances from the outside; instead, I enforce the use of <a href="https://cloud.google.com/iap">Identity-Aware Proxy</a> through <code>gcloud</code> like this:</p>
<pre><code class="language-shell">gcloud compute ssh --tunnel-through-iap my-instance-name
</code></pre>
<p>So you can disable that rule, but you also need to create one which is exactly the same with the source set to the IAP IP range i.e. <code>35.235.240.0/20</code>. I call it <code>iap-allow-ssh</code>.</p>
<p>You may also still want to allow SSH access from anywhere on <strong>some</strong> machines such as SFTP servers, so I create a rule with source <code>0.0.0.0/0</code> that only applies to machines with the <code>sshable</code> network tag.</p>
<p>I also enable logs on both SSH rules so I can easily know exactly who connects to instances and when.</p>
<p>Finally, the <code>default-allow-internal</code> rule allows all traffic between machines in your VPC. For some of you it may be fine, but I prefer configuring all flows explicitly using tags, so I disable it as well.</p>
<p>This is how it all should look eventually:</p>
<p><img alt="secure rules" src="img/gcp-vpc-firewall-secure.jpg"/></p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts 6 — Unpredictability, AI and Education</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-04-10-thoughts-6.html"
    />
    <id>tag:blog.separateconcerns.com,2023-04-10:thoughts-6</id>
    <published>2023-04-10T17:20:00Z</published>
    <updated>2023-04-10T17:20:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>&#8220;Thoughts&#8221; are posts about what has been on my mind. Sometimes practical, sometimes not; often just things I read recently. Less thought out than regular posts.</p>
</blockquote>
<section id="Navigating-the-unpredictability-of-everything">
<h2>Navigating the unpredictability of everything</h2>
<p>Jason Cohen posted <a href="https://longform.asmartbear.com/predict-the-future/">this long article</a> on his blog A Smart Bear. It is about how despite - and really because of - us being bad at predicting anything, the best way to move forward is still to have a strategy.</p>
<blockquote>
<p>Making a decision and moving forward is often more effective than extended deliberation about the decision. Deliberation assumes we know how to reason about the future, but even experts aren’t good at that. Making decisions and gaining experience is how to find the right answers, if the organization is introspective enough to also face the truth when it turns out the original strategy is incorrect.</p>
</blockquote>
<p>Still, some strategies are better than others. One is having several ways to succeed to reduce unpredictability. Perhaps less obviously, doing something seemingly impossible with a very high upside is also a good strategy.</p>
<p>Go read the whole post when you have 30 minutes, it has other motivated advice seen elsewhere such as <a href="https://blog.separateconcerns.com/2023-03-02-thoughts-5.html#Invest-in-things-that-don't-change">betting on things that don&#8217;t change</a>, <a href="https://blog.separateconcerns.com/2016-01-03-five-books-2015.html#The-Four-Steps-to-the-Epiphany---Steve-Blank">looking at what customers do</a>, and keeping things simple. It also features an interesting history of Flickr and Slack.</p>
</section>
<section id="Growth-of-AI-Through-a-Cloud-Lens">
<h2>Growth of AI Through a Cloud Lens</h2>
<p>Mitchell Hashimoto <a href="https://mitchellh.com/writing/ai-through-a-cloud-lens">compares</a> the growth of AI today to what happened with Cloud Computing and finds many similarities. He also points how that was not the case for Web3 (cryptocurrencies).</p>
</section>
<section id="Duct-Tape-Removal-Engineer">
<h2>Duct Tape Removal Engineer</h2>
<p>I love creative job titles and Jaana Dogan found <a href="https://twitter.com/rakyll/status/1592583835950383105">a great one</a>. When you have the experience, you immediately understand what it means.</p>
<p>At Lima my &#8220;unofficial&#8221; job title was VP of Data Corruption, and <a href="https://twitter.com/denisleroy">Denis</a> was Chief Packet Loss Officer. I never went as far as putting it on my LinkedIn though ;)</p>
</section>
<section id="The-Diamond-Age">
<h2>The Diamond Age</h2>
<p>Scott Chacon <a href="https://twitter.com/chacon/status/1645341107981631491">tweeted</a> about how he thinks that personalized AI-based tools will change education and his concern that some countries will not adapt fast enough. I share both parts of this opinion.</p>
<p>I have had my own issues with how education works in France and I have been thinking about this for a long time. Neal Stephenson&#8217;s book The Diamond Age is a must-read about that topic, and also yet another warning to make sure AI does not end up ossifying the privileges of an elite class.</p>
<p>I <strong>want</strong> the Primer, but IMO the current breed of foundational models is poorly adapted to the task. We need online training and scalable user personalization. I am hopeful that will get there though, because there are <a href="https://arxiv.org/abs/2209.07663">other lucrative use cases</a> with similar requirements.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Porting this blog to djot</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-04-09-djot.html"
    />
    <id>tag:blog.separateconcerns.com,2023-04-09:djot</id>
    <published>2023-04-09T11:20:00Z</published>
    <updated>2023-04-09T11:20:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p><a href="https://blog.separateconcerns.com/2013-01-02-hello-world.html">Over 10 years ago</a>, I created this blog and wrote the static generator that powers it. I used Markdown for the articles and <a href="https://github.com/jgm/lunamark">lunamark</a>, a library written by John MacFarlane of <a href="https://commonmark.org">CommonMark</a> and <a href="https://pandoc.org">Pandoc</a> fame.</p>
<p>Recently, John created <a href="https://djot.net">djot</a>, a markup syntax intended to be an evolution of Markdown. The <a href="https://github.com/jgm/djot.lua">initial reference implementation</a> was written in Lua and I decided to port my static generator to it.</p>
<p>Converting the Markdown parts of the post themselves was not very hard, the main think I can think of was switching my old posts from intented code blocks - which are not supported by djot - to fenced code blocks. However, my posts were not pure vanilla Markdown. I used two specific features from lunamark and a few extensions of my own.</p>
<p>The first lunamark feature I had to find a replacement for was Lua metadata. djot <a href="https://github.com/jgm/djot/issues/35">does not support metadata</a> yet but it does support <a href="https://htmlpreview.github.io/?https://github.com/jgm/djot/blob/master/doc/syntax.html#raw-block">raw blocks with a format</a> which I could easily abuse.</p>
<p>The second feature is Pandoc-style title blocks, which I could just <a href="https://github.com/catwell/cw-web/commit/6518e8284880d6e64ec769ed47517c9dcbba6373">move to the metadata section</a> so I did that.</p>
<p>I also had a custom block format syntax that I used for three things: raw blocks, syntax highlighting language choice and post descriptions. The first two are natively supported by djot, and I moved the description to the metadata as well.</p>
<p>For those transformations I used Perl one-liners such as this one which converts the metadata format:</p>
<pre><code class="language-shell">for i in separateconcerns/blog/articles/*.md; do
    perl -0pe 's/&lt;!\-\-@(.*)\-\-&gt;/"```=lua-meta". join("\n", split(\/\n  \/, $1)) ."```"/es' \
        $i &gt; "$(dirname $i)/$(basename $i .md).dj"
done
</code></pre>
<p>Once that was done, it was time to port the generator itself. I started with the HTML part. As I said some of the things I was doing manually in lunamark are supported natively in djot, there were two things left to do: support my metadata blocks and detect posts with code in them so I can include the JavaScript syntax highlighting library only when needed.</p>
<p>Djot has a step when you can get the AST and I could have used it to extract this information, but I decided to use the same method I used with lunamark instead, which is <a href="https://github.com/catwell/cw-web/blob/93fa373949b16ec30950877bd817a72e8a6f7bf8/separateconcerns/blog/generate.lua#L45-L66">overriding parts of the renderer</a>. To do that I created <a href="https://github.com/catwell/cw-web/blob/master/separateconcerns/blog/cwdjot/init.lua">a small helper library</a> which mostly exposes the StringHandle used internally in djot.lua. I would need it for the next part anyway.</p>
<p>All in all, it was pretty smooth. I just hit a small <a href="https://github.com/jgm/djot/issues/101#issuecomment-1500966800">issue with URL parsing</a> which I worked around for now by using URL encoding in my .dj source files.</p>
<p>Since I did not change my output format much and kept exactly the same metadata, my index and Atom feed generation worked out of the box. But there was still one last thing to do: because this blog is also <a href="https://blog.separateconcerns.com/2022-02-05-gemini.html">available on Gemini</a>, I had to implement a <a href="https://gemini.circumlunar.space/docs/gemtext.gmi">Gemtext</a> renderer.</p>
<p>In lunamark, there was a generic writer which I overloaded for that purpose. As djot.lua only supports HTML output natively for now, this time I just <a href="https://github.com/catwell/cw-web/blob/master/separateconcerns/blog/cwdjot/gemini.lua">wrote a renderer</a> from scratch. I could also have gone the Pandoc route as djot includes a custom writer and reader, but I wanted to avoid it and Pandoc does not natively support Gemtext anyway.</p>
<p>All in all, this took a few hours to do, and the blog post you are reading now has been published with this new stack. I like djot, it is an improvement over CommonMark even though it is still has a few rough edges. I like parts of the djot.lua library a bit less, especially <a href="https://github.com/jgm/djot.lua/blob/5970f1cff2fe6b5905ec1cdeab795d5b5b3b8b97/djot/inline.lua">the parser</a>. lunamark <a href="https://github.com/jgm/lunamark/blob/master/lunamark/reader/markdown.lua">uses LPeg</a> instead and I find it simpler, but it&#8217;s still fine.</p>
<p>This experience also conforts me in the choice I made 10 years ago to write my own static generator using a language I know well with few dependencies. It is very low maintenance most of the time compared to the likes of Hugo, Pelican or Jekyll, and it lets me do changes like this easily when I want to.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Joining Finegrain</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-03-31-joining-finegrain.html"
    />
    <id>tag:blog.separateconcerns.com,2023-03-31:joining-finegrain</id>
    <published>2023-03-31T22:15:00Z</published>
    <updated>2023-03-31T22:15:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>It&#8217;s been a week since I <a href="https://blog.separateconcerns.com/2023-03-11-leaving-inch.html">left Inch</a>, and now it is time to disclose what I am up to.</p>
<p>Last Monday <a href="https://twitter.com/pchapuis/status/1640254206148767745">I joined</a> a very early-stage startup called <a href="https://finegrain.ai">Finegrain</a>. We&#8217;re working on improving online images using AI with no humans in the loop. The founders of the company are the <a href="https://blog.separateconcerns.com/2013-06-20-three-years-proprietary-projects.html">Moodstocks</a> founders Denis and Cédric, so we get to work together again after 10 years.</p>
<p>I won&#8217;t hide it, I am not an AI specialist. Even though I keep informed on advances in the field, I have read <a href="https://www.manning.com/books/deep-learning-with-python-second-edition">books</a> and written some deep learning code, I am far from the level required at a company like that.</p>
<p>I do intend to learn more, but it turns out we <strong>may</strong> also need the things I do have experience with, such as building scalable and resilient systems with few resources, designing simple APIs to do complex things, integrating with customers and more generally being a technical jack-of-all-trades at a small company :)</p>
<p>If <strong>you</strong> know about AI though, <a href="https://www.linkedin.com/company/finegrain-ai/jobs/">we are hiring</a>!</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Leaving Inch</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-03-11-leaving-inch.html"
    />
    <id>tag:blog.separateconcerns.com,2023-03-11:leaving-inch</id>
    <published>2023-03-11T11:55:00Z</published>
    <updated>2023-03-11T11:55:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>In two weeks, I will no longer be an <a href="https://inch.fr">Inch</a> employee. I <a href="https://blog.separateconcerns.com/2020-12-16-personal-news.html#joining-inch">joined the company</a> a bit over three years ago, but it feels like much longer. Back then I had no child, and the first thing the word &#8220;Pandemic&#8221; brought to mind was a good board game.</p>
<p>Three years later, Inch is not so different from the company I joined, and yet much better in many ways. As for me, I did what I came for initially, and then more. Now I have an opportunity I could not pass. It is too early to talk about it except <a href="https://framapiaf.org/@catwell/109904487542868111">in cryptic form</a>, but when I do you will understand.</p>
<p>So I close this chapter of my professional life, leaving Inch and its team. Which is the hardest part, because they&#8217;re a fun and endearing bunch, and we&#8217;ve been through those not-so-great years together, and we&#8217;ve made so many memories. And now <a href="https://blog.separateconcerns.com/2023-03-02-thoughts-5.html#using-the-word-we">we&#8217;re friends</a>. But well, I am not leaving Paris, so it&#8217;s not like we won&#8217;t see each other again. :)</p>
<p>And by the way, Inch is hiring a software engineer! It is a French-speaking, semi-remote position. Get in touch if you are interested.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts 5 — Being a good engineer; using the word We</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-03-02-thoughts-5.html"
    />
    <id>tag:blog.separateconcerns.com,2023-03-02:thoughts-5</id>
    <published>2023-03-02T11:45:00Z</published>
    <updated>2023-03-02T11:45:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>&#8220;Thoughts&#8221; are posts about what has been on my mind. Sometimes practical, sometimes not; often just things I read recently. Less thought out than regular posts.</p>
</blockquote>
<section id="What-is-a-good-engineer">
<h2>What is a good engineer?</h2>
<p>When I was a student at <a href="https://www.imt-atlantique.fr/en">IMT Atlantique</a> (back when it was still called Telecom Bretagne) I took an optional class about the history of telecommunication systems. It was mostly taught by retired engineers from the field.</p>
<p>It was a fascinating class. A recurring theme was what an engineer&#8217;s job was about. One of the teachers, who had been instrumental in the development of <a href="https://en.wikipedia.org/wiki/Electronic_switching_system">electronic switching</a> in Europe, said something among those lines: &#8220;a good engineer delivers systems that are scalable, cheaper, and ship faster&#8221;.</p>
<p>I have been thinking about that topic lately, and even though I will not deny the &#8220;it&#8217;s all about trade-offs&#8221; line I have been using for years, it is good to remember that those trade-offs should be made only on the optimum curve.</p>
<p>Add to that the idea that engineers should know what systems <strong>not</strong> to build, and you have my definition of what makes a good engineer.</p>
</section>
<section id="Using-the-word-We">
<h2>Using the word We</h2>
<p><a href="https://www.la-grange.net/karl/">Karl</a> wrote <a href="https://www.la-grange.net/2023/01/23/reveur">something interesting</a> about using the word We to talk about a company or a team. He wrote it in French so here is a rough translation:</p>
<blockquote>
<p>I often see a company&#8217;s employees use the word We (&#8220;nous&#8221; in French). For a very long time I have been trying to avoid using this turn of phrase in my mail, bugs, etc. For instance, at Mozilla, I used to say &#8220;the Webcompat team&#8221; or &#8220;Mozilla&#8221;, or to change the sentence to focus on the product itself.</p>
</blockquote>
<blockquote>
<p>Instead of &#8220;We should add feature H to solve this bug&#8221;, I would say &#8220;Product A needs feature H to solve this bug&#8221;.</p>
</blockquote>
<blockquote>
<p>When I notice myself unconsciously using &#8220;we&#8221;, I correct it immediately. But why? To preserve the emotional distance between work and pseudo-belonging to a company.</p>
</blockquote>
<blockquote>
<p>&#8220;We&#8221; has a very inclusive meaning of identity for me, and so I avoid it in contractual relationships. The company no longer has a &#8220;we&#8221; when the time to reduce its workforce for financial gain comes. It is one of my struggle techniques, a small resistance.</p>
</blockquote>
<p>I understand what he is saying and it makes a lot of sense, yet I make a different choice. In fact, I cannot fathom working for a company or at least a team where I would not feel comfortable saying &#8220;we&#8221;.</p>
<p>It&#8217;s the same uneasy feeling I have when I see people say that small startups branding themselves as family is a red flag. I understand why they would say that. And sure, we are not family, but when you work that closely with people for years, I think there should be some sense of belonging. Maybe &#8220;friends&#8221; is a better word.</p>
<p>Also, I am never going to work for a company if I am not aligned with its mission. If I start trying to distance myself from it and notice it, things will have to change one way or another.</p>
</section>
<section id="Opportunity-Cost">
<h2>Opportunity Cost</h2>
<p><a href="https://twitter.com/rakyll/status/1631032634779525122">This tweet by Jaana Dogan</a> made me remember <a href="https://erikbern.com/2020/03/10/never-attribute-to-stupidity-that-which-is-adequately-explained-by-opportunity-cost.html">this blog post by Erik Bernhardsson</a>, which I often find to be true, especially when dealing with startups.</p>
<blockquote>
<p>Never attribute to stupidity that which is adequately explained by opportunity cost.</p>
</blockquote>
</section>
<section id="Theory-of-Mind">
<h2>Theory of Mind</h2>
<p><a href="https://boz.com/articles/theory-mind">A great post by Andrew Bosworth</a> (CTO of Meta) about how some people such as John Carmack can have an influence even after they&#8217;re gone.</p>
</section>
<section id="Chrome-10-years-later">
<h2>Chrome, 10 years later</h2>
<p><a href="https://neugierig.org/software/blog/2022/12/chrome.html">A long post by Evan Martin</a> about his experience working on Chrome from 2007 to 2012. Toward the end, he turns to the state of Chrome and the Web today.</p>
<p>I love this kind of retrospective post, which are full of anecdotes, deeper insight, and food for thought.</p>
<p>By the way, Evan posts interesting things on a variety of topics. I have been subscribing to his feed for a very long time, I think for Arch-related content initially. You may want to look at his other posts as well.</p>
</section>
<section id="Invest-in-things-that-don't-change">
<h2>Invest in things that don&#8217;t change</h2>
<p>Here is <a href="https://world.hey.com/dhh/invest-in-things-that-don-t-change-6f7f19e1">DHH saying something</a> I&#8217;ve been saying for a very long time as well, but it bears repeating. There is way too much stuff happening to follow it all. If you want to last in this job, especially as a generalist, you must figure out the fundamental things that will matter even more in 10 years than today, and ignore most of the rest unless it&#8217;s a deliberate strategy.</p>
</section>
<section id="CRDTs-Automerge-and-Braid">
<h2>CRDTs, Automerge and Braid</h2>
<p>Even though it&#8217;s not my main focus anymore, I am still following CRDT-based state synchronization systems attentively. Two projects have caught my attention recently. The first one is <a href="https://braid.org">Braid</a> which has been progressing steadily, and the second is Automerge which has announced <a href="https://automerge.org/blog/automerge-2/">a major 2.0 release</a>.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>The Staff Software Engineer role at small companies</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2023-02-03-staff-engineer-inch.html"
    />
    <id>tag:blog.separateconcerns.com,2023-02-03:staff-engineer-inch</id>
    <published>2023-02-03T12:20:00Z</published>
    <updated>2023-02-03T12:20:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>When I was <a href="https://blog.separateconcerns.com/2021-05-01-inch.html">hired at Inch</a> my &#8220;official&#8221; position quickly became an issue. For various reasons neither the title they wanted to give me initially (Engineering Manager) nor the one I would be given externally (CTO) nor the obvious Senior Software Engineer worked. So I proposed to help them define the next position on the technical ladder.</p>
<p>What follows is a translation of a document I wrote in French, slightly edited to remove Inch-specific details. It is still written from a European - and more specifically French - point of view. That document was later used to promote a 2nd engineer to Staff. I publish it here so it can help people needing to do something similar elsewhere.</p>
<section id="General-information-on-technical-ladders">
<h2>General information on technical ladders</h2>
<p>Typical early career levels for software engineers (or developers) are relatively well-known:</p>
<ul>
<li>
Junior Software Engineer
</li>
<li>
(Mid-level) Software Engineer
</li>
<li>
Senior Software Engineer
</li>
</ul>
<p>Progression is based on experience and it is expected that a good engineer will reach mid-level after 2 to 5 years of experience and senior between 5 to 10.</p>
<p>Senior developers have two ways to evolve: branch into management or stay on the technical track. This document describes the second option.</p>
<p>Let&#8217;s start with a few key things to understand regarding management. A development &#8220;team&#8221; (project or run) is typically 3 to 10 people. It has a &#8220;lead&#8221;, which is not a level or a management position. It is a technico-organizational role assumed by a Senior+ developer at a point in time.</p>
<p>The names of levels after Senior differ depending on companies but can be for instance:</p>
<ul>
<li>
Staff Software Engineer
</li>
<li>
Senior Staff Software Engineer
</li>
<li>
Principal Software Engineer
</li>
<li>
Distinguished Software Engineer
</li>
<li>
Fellow
</li>
</ul>
<p>At some large tech companies the &#8220;Distinguished&#8221; level is equivalent to VP and Fellow to SVP or CXO. At Inch, Staff corresponds to level F. The difference between Staff+ levels is often defined by impact:</p>
<ul>
<li>
Staff / Senior Staff -&gt; impact at team level
</li>
<li>
Principal -&gt; impact at company level (strategy)
</li>
<li>
Distinguished -&gt; external impact (aura)
</li>
</ul>
<p>Those levels constitute a pyramid where each stage must be much smaller than the one below (e.g. by a factor of 5 at least) otherwise they stop making sense.</p>
<p>Given the size of Inch, only the Staff level makes sense. A Principal level may not be created until the company is large enough to have several independent technical teams (at least 12 developers, ideally around 30). Consequently, some things relating to strategy and aura are expected from the Staff level at Inch.</p>
</section>
<section id="Becoming-a-Staff-Engineer">
<h2>Becoming a Staff Engineer</h2>
<section id="Not-mandatory">
<h3>Not mandatory</h3>
<p>A key point is that Senior is a &#8220;terminal level&#8221;, which means it is not expected that all Senior engineers will become Staff at some point. An engineer may very well remain at the Senior level for their whole career.</p>
</section>
<section id="The-end-of-experience">
<h3>The end of &#8220;experience&#8221;</h3>
<p>Progression from Junior to Mid to Senior is very related to experience and hard skills (soft as well, especially for Senior). But the value of marginal experience goes down with the years and is harder and harder to measure.</p>
<p>The Staff level is still partially related to experience - at least 8 years are expected in general - but more importantly to impact within the company. This means hiring at this level is rare, and it is not unusual for a Staff Engineer to go back to Senior for a few years after a job change.</p>
<p>Important note: Staff is not a management level but it <strong>does</strong> require more soft skills than previous levels (more on that later).</p>
</section>
<section id="A-polymorphic-job">
<h3>A polymorphic job</h3>
<p>Staff is a technical specialization level, hence not all Staff engineers look the same. To understand the differences, here are a few axes.</p>
<p>A developer can specialize in one or several fields or technologies and become a true technical expert. For instance, they can be a master of their language and framework and contribute to their core or ecosystem. They can also become experts in a business domain. Those are depth-first approaches.</p>
<p>Others, on the other hand, expand their knowledge horizontally and know about numerous domains, technologies and parts of the stack. This is the generalist, breadth-first approach.</p>
<p>In general it is rather a mix of both approaches: developers with a very wide background and a few specialty topics they master. We talk about <a href="https://en.wikipedia.org/wiki/T-shaped_skills">T-Shaped</a> people.</p>
<p>Will Larson defines <a href="https://staffeng.com/guides/staff-archetypes">4 Staff+ archetypes</a>: tech leads, architects, solvers and right hands.</p>
</section>
</section>
<section id="Expectations">
<h2>Expectations</h2>
<section id="Competences">
<h3>Competences</h3>
<p>A Staff Engineer should be able to:</p>
<ul>
<li>
<p>Grapple with a complex, poorly documented system quickly. For instance, identify the root cause of a bug in a code base they do not know well.</p>
</li>
<li>
<p>Understand what limits a system, anticipate problems and propose realistic and pragmatic architectural changes while taking existing assets and resources into account.</p>
</li>
<li>
<p>Know and understand high-level software and system architecture principles (Conway&#8217;s Law, Gall&#8217;s Law, permission models, different kinds of data flows&#8230;)</p>
</li>
<li>
<p>Communicate with their team as a Lead, organize a project, implement new processes.</p>
</li>
<li>
<p>Communicate with their management: report their results and those of their team, give visibility on load and work in progress.</p>
</li>
<li>
<p>Communicate outside the company, for instance: with customers, with prospects, with candidates, with investors, with Open Source communities&#8230;</p>
</li>
<li>
<p>Deal with a crisis, for instance organize production incident response.</p>
</li>
<li>
<p>Analyze a development opportunity while taking all company-level parameters into account (cash flow, strategy and positioning, long-term vision). Think ahead 2 / 6 / 18 months.</p>
</li>
<li>
<p>Understand the concepts of backlog, velocity / capacity / pressure. Know how to prioritize, understand when to say yes and when to say no. Know how and when they should defend their opinion depending on the topic (when to &#8220;be right&#8221;).</p>
</li>
<li>
<p>Think ahead developments and choices, considering impact on maintainability, stability, evolutivity, complexity and overall performance.</p>
</li>
<li>
<p>Anticipate hiring needs and departure risks. Understand hiring may take 6 months, plus 6 extra months to become really efficient. Understand that at Inch scale not everyone is replaceable, but still reduce risk for the company in the event of a departure, including their own.</p>
</li>
<li>
<p>Do technical watch, implement new tools and processes when it is necessary - and not when it is not. Retiring tools and processes whose benefits are dubious. Tech watch channels available include HN / Lobste.rs / Tilde, blogs, podcasts, meetups, the GitHub feed, social networks&#8230;</p>
</li>
<li>
<p>Be visible. Communicate internally on their progress and that of their team, in spoken and written form.</p>
</li>
<li>
<p>Develop their own network. At this stage of their career, an engineer must know people to get in touch with regarding specific topics, recruiting, etc. This kind of network is developed through previous experiences, participation in meetups and conferences, Open Source contribution and so on.</p>
</li>
</ul>
</section>
<section id="Achievements">
<h3>Achievements</h3>
<p>A Staff Engineer should tick several (not all) of those boxes:</p>
<ul>
<li>
<p>Be the designated expert of one or several significant parts of the technical stack or technical topics (e.g frontend, backend, infra / deployment, security&#8230;)</p>
</li>
<li>
<p>Be the designated expert of one or several significant parts of the product&#8217;s code base.</p>
</li>
<li>
<p>Have realized or led a development or technical evolution which is undoubtedly an important achievement at company level, recognized outside the bonds of the technical team. This kind of very visible project can be handed to a Senior engineer ready to evolve to Staff as a Staff Project.</p>
</li>
<li>
<p>Mentor one or several junior developers. This is in &#8220;achievements&#8221; and not &#8220;competences&#8221;: any Staff - and even Senior - developer should be able to help a junior get better or understand something, but some can be true career accelerators for the juniors they work with.</p>
</li>
</ul>
</section>
</section>
<section id="References">
<h2>References</h2>
<section id="Bedrock">
<h3>Bedrock</h3>
<ul>
<li>
StaffEng (Will Larson) - <a href="https://staffeng.com/">the website</a> and <a href="https://staffeng.com/book">the book</a>
</li>
<li>
<a href="https://www.levels.fyi/?compare=Google,Facebook,Microsoft&amp;track=Software%20Engineer">Levels.fyi</a>
</li>
<li>
<a href="https://career-ladders.dev">Career Ladders</a>
</li>
<li>
<a href="http://www.engineeringladders.com">Engineering Ladders framework</a>
</li>
</ul>
</section>
<section id="Ladder-examples">
<h3>Ladder examples</h3>
<ul>
<li>
<a href="https://basecamp.com/handbook/appendix-04-titles-for-programmers">Basecamp&#8217;s Handbook</a>
</li>
<li>
<a href="https://twitter.com/Gankra_/status/1046438955439271936">Ladder at Mozilla</a>
</li>
<li>
<a href="https://dresscode.renttherunway.com/blog/ladder">Ladder at Rent The Runway</a>
</li>
<li>
<a href="https://gist.github.com/jamtur01/aef437a79fee5a9cefdc">Ladder at Kickstarter</a>
</li>
<li>
<a href="https://labs.criteo.com/2019/02/criteo-engineering-career-tracks-and-leveling/">Ladder at Criteo</a>
</li>
<li>
<a href="https://about.gitlab.com/handbook/engineering/career-development/">How GitLab works</a>
</li>
<li>
<a href="https://engineering.atspotify.com/2016/02/15/spotify-technology-career-steps/">How Spotify works</a>
</li>
<li>
<a href="https://developer.squareup.com/blog/squares-growth-framework-for-engineers-and-engineering-managers/">Square&#8217;s Growth Framework</a>
</li>
<li>
<a href="https://dropbox.github.io/dbx-career-framework/">Dropbox Engineering Career Framework</a>
</li>
<li>
<a href="https://goomics.net/59/">Google =)</a>
</li>
</ul>
</section>
<section id="More-reading">
<h3>More reading</h3>
<ul>
<li>
<a href="https://eventuallycoding.com/2021/06/24/senior-avec-6-ans-dexperience-et-apres/">Hugo Lassiège at Malt</a> (French)
</li>
<li>
<a href="https://www.touilleur-express.fr/2021/04/11/premier-mois-chez-doctolib/">Nicolas Martignole on being Principal Engineer at Doctolib</a> (French)
</li>
<li>
<a href="https://blog.danielna.com/understanding-project-management-will-improve-your-developer-job/">Understanding Project Management Will Improve Your Developer Job</a>
</li>
<li>
<a href="https://sparktoro.com/blog/if-management-is-the-only-way-up-were-all-fd/">If Management is the Only Way Up, We’re All F’d</a>
</li>
<li>
<a href="https://frontside.com/blog/2016-07-07-the-conjoined-triangles-of-senior-level-development/">The Conjoined Triangles of Senior-Level Development</a>
</li>
<li>
<a href="https://blog.separateconcerns.com/2013-03-24-vogels-skills.html">Werner Vogels on skills</a>
</li>
<li>
<a href="https://spin.atomicobject.com/2015/02/19/software-architect-role/">Software Architect – A Role, Not a Job</a>
</li>
<li>
<a href="https://touilleur-express.fr/2022/07/17/devenir-staff-engineer/">Becoming Staff Engineer: how and why?</a> (French)
</li>
</ul>
</section>
<section id="See-also">
<h3>See also</h3>
<ul>
<li>
<a href="https://progressionapp.com">Progression app</a>
</li>
</ul>
</section>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts 4 — SSO Tax and various links</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2022-12-11-thoughts-4-sso-tax.html"
    />
    <id>tag:blog.separateconcerns.com,2022-12-11:thoughts-4-sso-tax</id>
    <published>2022-12-11T18:20:00Z</published>
    <updated>2022-12-11T18:20:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>&#8220;Thoughts&#8221; are posts about what has been on my mind. Sometimes practical, sometimes not; often just things I read recently. Less thought out than regular posts.</p>
</blockquote>
<section id="The-SSO-Tax">
<h2>The SSO Tax</h2>
<p>I have had several discussions about how SSO should be priced by SaaS providers. On the one hand, making it prohibitively expensive weakens security for everyone, and there is <a href="https://sso.tax">a website about that</a>. On the other hand, features that distinguish between business categories are often related to security and compliance (audit logs, SLAs, etc).</p>
<p>My personal position - and I do not speak for anyone here including my employer - is the following:</p>
<ul>
<li>
not having any SSO for free plans is fine;
</li>
<li>
any paying customer should be able to use protocols such as OpenID Connect;
</li>
<li>
charging extra for SAML support is fair.
</li>
</ul>
</section>
<section id="Amazon's-Distributed-Computing-Manifesto">
<h2>Amazon&#8217;s Distributed Computing Manifesto</h2>
<p>I often say SOA started to become mainstream when Jeff Bezos mandated it at Amazon around 2002, a story famously told by Steve Yegge. But Werner Vogels has <a href="https://www.allthingsdistributed.com/2022/11/amazon-1998-distributed-computing-manifesto.html">shared a document</a> that shows the move began in 1998 and was advocated by engineers.</p>
<p>The Manifesto already emphasized moving data to the process, hiding data models from clients, data consistency issues&#8230; A fascinated read, almost 25 years later.</p>
</section>
<section id="Fix-the-machine-not-the-person">
<h2>Fix the machine, not the person</h2>
<p><a href="http://www.aaronsw.com/weblog/nummi">This essay by Aaron Swartz</a> is ten years old. A good time to read it again.</p>
<blockquote>
<p>An organization is not just a pile of people, it’s also a set of structures. It’s almost like a machine made of men and women. [&#8230;] True, sometimes you have the wrong gears and need to replace them, but more often you’re just using them in the wrong way. When there’s a problem, you shouldn’t get angry with the gears — you should fix the machine. [&#8230;] You can’t force other people to change. You can, however, change just about everything else. And usually, that’s enough.</p>
</blockquote>
</section>
<section id="Journal-of-Comprehensible-Explanations">
<h2>Journal of Comprehensible Explanations</h2>
<p><a href="https://third-bit.com/2022/11/20/journal-of-comprehensible-explanations/">Greg Wilson would like a journal of peer-reviewed summaries of research findings</a>. No new results, just good explanations. Me too!</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts 3 — The end of Twitter?</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2022-11-18-thoughts-3-twitter.html"
    />
    <id>tag:blog.separateconcerns.com,2022-11-18:thoughts-3-twitter</id>
    <published>2022-11-18T22:45:00Z</published>
    <updated>2022-11-18T22:45:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>&#8220;Thoughts&#8221; are posts that relate to things that have been on my mind recently. Some are practical and some are just reflections on a given topic. They are less thought out than regular posts.</p>
</blockquote>
<p>So, <a href="https://twitter.com/pchapuis">the Bird</a>, of course. Not sure if or when it will collapse. Better safe than sorry so I am planning my retreat to <a href="https://framapiaf.org/@catwell">the Pachyderm</a>, but I do not really believe in the Fediverse model.</p>
<p><a href="https://eric.daspet.name">Eric</a> said on Twitter - where he deletes his tweets so I won&#8217;t link it - that it might be time to bring back RSS/Atom feeds. I agree, especially since I finally found <a href="https://github.com/nkanaev/yarr">a feed reader I like</a>. I know I won&#8217;t have the discipline to post as frequently as him, <a href="https://www.la-grange.net">Karl</a> or <a href="http://www.landley.net/notes.html">Rob</a>, still that&#8217;s what those &#8220;Thoughts&#8221; posts were supposed to be for initially.</p>
<p>But feeds by themselves are not enough. The value is in the graph and the discovery that comes with it. I follow about 450 feeds, and you cannot see which ones. I won&#8217;t publish my raw <a href="https://en.wikipedia.org/wiki/OPML">OPML</a> though. It&#8217;s not properly categorized so it wouldn&#8217;t be very useful anyway. It&#8217;s like my <a href="https://catwell.info/booklist/">booklist</a>, which I consider deprecating soon: too many items, not enough value.</p>
<p>Maybe the solution is to publish lists of links here from time to time like <a href="https://lemire.me/blog/2022/10/16/science-and-technology-links-october-16-2022/">Daniel</a>. You can also follow <a href="https://pinboard.in/u:catwell">my Pinboard</a>, which has feeds. <a href="https://lobste.rs">Lobsters</a> is great too.</p>
<p>Something else feeds don&#8217;t do is discussion / debate. But maybe that&#8217;s a good thing; I was growing tired of that aspect of Twitter lately. I think I prefer topic-specific spaces to social networks. I&#8217;m on a bunch of Slacks, Google Groups and mailing lists already. I liked forums but they&#8217;re out of fashion.</p>
<p>Oh, and for private messages, well&#8230; just send me an email, I guess.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Pallene support in localua</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2022-10-10-localua-pallene.html"
    />
    <id>tag:blog.separateconcerns.com,2022-10-10:localua-pallene</id>
    <published>2022-10-10T17:50:00Z</published>
    <updated>2022-10-10T17:50:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Today I attended Lua Workshop, and Roberto Ierusalimschy&#8217;s keynote was about <a href="https://github.com/pallene-lang/pallene">Pallene</a>, a language designed as a system counterpart to Lua in a scripting architecture. The language is a typed subset of Lua and can be used to replace C or as an interface between Lua and C. It is still a work in progress, there is no stable release yet.</p>
<p>Pallene works by accessing the internals of the Lua VM, so it requires <a href="https://github.com/pallene-lang/lua-internals">a patched version of Lua</a>. I wanted to try it so I added support for it to <a href="https://loadk.com">localua</a>. You can just use &#8220;pallene&#8221; instead of the Lua version and it will pull the latest sources of Pallene and its Lua fork and install them in a self-contained directory.</p>
<p>The Pallene compiler does not have an easy way to specify a local Lua directory and I decided against hacking it so you will have to pass <code>CFLAGS</code> as an environment variable for it to work.</p>
<p>I have just pushed a localua version that supports this so you too can try Pallene now. Be aware that I have only tested this on Linux, and that it is an undocumented feature which means I do not guarantee I will support it forever. That being said, this works now:</p>
<pre><code class="language-shell">curl "https://loadk.com/localua.sh" -O
chmod +x localua.sh
./localua.sh .lua pallene
curl -O "https://raw.githubusercontent.com/pallene-lang/pallene/master/examples/fibonacci/fibonacci.pln"
CFLAGS="-I $(pwd)/.lua/include -O2" ./.lua/bin/pallenec fibonacci.pln
./.lua/bin/lua -e 'print((require "fibonacci").fibonacci(10)[8])' # prints 13
</code></pre>

      </div>
    </content>
  </entry>
  <entry>
    <title>Dependency Injection</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2022-08-15-dependency-injection.html"
    />
    <id>tag:blog.separateconcerns.com,2022-08-15:dependency-injection</id>
    <published>2022-08-15T21:20:00Z</published>
    <updated>2022-08-15T21:20:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>In the list of application architecture patterns I like to use, <a href="https://en.wikipedia.org/wiki/Dependency_injection">Dependency Injection</a> comes rather high. Here is how and why I use it.</p>
<section id="How-I-use-Dependency-Injection">
<h2>How I use Dependency Injection</h2>
<p>If you have already seen dependency injection used in practice, you may believe it requires the use of a framework such as <a href="https://dagger.dev">Dagger</a>. Although I did use such frameworks - especially in Angular where <a href="https://angular.io/guide/dependency-injection">it is native</a> - most of the time I use a simpler form of DI where I just pass dependencies to functions or constructors.</p>
<p>For instance, in Lua object-oriented code, instead of writing this:</p>
<pre><code class="language-lua">local json = require "dkjson"

local obj_mt = {
    __index = {
        as_json = function(self)
            return json.encode(self.data)
        end
    }
}

local function new_obj(data)
    return setmetatable({data = data}, obj_mt)
end

local o = new_obj({foo = 5})
o:as_json()
</code></pre>
<p>I could write something like this:</p>
<pre><code class="language-lua">local obj_mt = {
    __index = {
        as_json = function(self)
            return self.json_encoder(self.data)
        end
    }
}

local function new_obj(data, json_encoder)
    return setmetatable(
        {data = data, json_encoder = json_encoder},
        obj_mt
    )
end

local json = require "dkjson"
local o = new_obj({foo = 5}, json.encode)
o:as_json()
</code></pre>
<p>Note that this follows the <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">Dependency Inversion principle</a>, which is often confused with dependency injection but not exactly the same thing. It may not be obvious in a dynamic language such as Lua but the implementation of <code>obj</code> implicitly defines the signature of the JSON encoder it expects, and you may substitute the encoder for something else.</p>
<p>Also, on a stylistic note, in a larger program I would probably not pass every injected dependency as a different parameter, instead I would use a single container for this.</p>
<p>In case you&#8217;re interested, here is the same example closer to how I&#8217;d write it in practice in <a href="https://github.com/teal-language/tl">Teal</a>:</p>
<pre><code class="language-lua">local type JsonAble = {string: any}
local type JsonEncoder = function(JsonAble): string

local record ObjDeps
    json_encoder: JsonEncoder
end

local record Obj
    data: JsonAble
    as_json: function(Obj): string
    _deps: ObjDeps
end

local obj_mt = {
    __index = {
        as_json = function(self: Obj): string
            return self._deps.json_encoder(self.data)
        end
    }
}

local function new_obj(data: JsonAble, deps: ObjDeps): Obj
    return setmetatable({data = data, _deps = deps}, obj_mt)
end

local json = require "dkjson"
local o = new_obj(
    {foo = 5},
    {json_encoder = json.encode as JsonEncoder}
)
o:as_json()
</code></pre>
<p>Now let us see a few use cases for this.</p>
</section>
<section id="Testing-IO">
<h2>Testing I/O</h2>
<p>Probably the most well-known use case for DI is simplifying testing of code that does I/O, for instance code that makes network requests or interacts with a database. It makes it easy to replace the problematic part with a mock. You can mock just what you need or the entire dependency, for instance you can replace Redis with <a href="https://luarocks.org/modules/catwell/fakeredis">fakeredis</a>.</p>
</section>
<section id="Supporting-different-implementations-of-dependencies">
<h2>Supporting different implementations of dependencies</h2>
<p>This is a less well-known but very good use-case, especially in Lua. Let us consider my JSON example above. Users of this code may want to use <a href="https://luarocks.org/modules/dhkolf/dkjson">dkjson</a>, but maybe they want to use a faster, pure C module, or maybe they are running in OpenResty and have <a href="https://openresty.org/en/lua-cjson-library.html">cjson</a> available. With dependency injection, it&#8217;s easy to just use it.</p>
</section>
<section id="Eliminating-randomness">
<h2>Eliminating randomness</h2>
<p>This is in fact the use case that prompted me to write this blog post. I was writing some algorithmic code in Teal for which I had a reference in Python, and I wanted to apply <a href="https://blog.separateconcerns.com/2013-06-20-three-years-proprietary-projects.html#seed">the dual-implementation comparison technique I like</a>. However, this was AI code that had random parts.</p>
<p>What I did was that I refactored the code in both languages so that all sources of randomness were injected, and then I injected deterministic pseudo-random values instead, which meant I could now compare the state of both implementations at all times and easily debug things such as numerical problems.</p>
</section>
<section id="When-not-to-use-DI">
<h2>When not to use DI</h2>
<p>DI is a great tool, but it tends to make code a bit more complicated, so for instance I do not use it to inject pure functions or libraries from the same codebase.</p>
<p>If you have used Angular with <a href="https://storybook.js.org">Storybook</a>, you may know what abuse of DI looks like. It can be super verbose because sometimes you need to inject a lot of things you do not really care about for it to work.</p>
<p>A way to work around that if you still want to use DI may be to have sensible defaults for some injected objects. That way you can still override them if needed, but you can still have simple sample code.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>The push-to-poll pattern</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2022-03-05-push-to-poll.html"
    />
    <id>tag:blog.separateconcerns.com,2022-03-05:push-to-poll</id>
    <published>2022-03-05T13:00:00Z</published>
    <updated>2022-04-04T09:45:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Here I want to discuss a system design pattern that I call &#8220;push-to-poll&#8221;; if it has another name I am not aware of it. I have applied that pattern successfully a few times, and used systems that did not but should have way too often.</p>
<section id="Polling">
<h2>Polling</h2>
<p>Suppose you are responsible for a &#8220;server&#8221; system. That system generates events (messages), and authenticated &#8220;clients&#8221; need to receive those messages.</p>
<p>A simple solution is to provide some kind of feed: the client authenticates and provides a small piece of state (a timestamp or a cursor) which allows the server to return the messages they haven&#8217;t processed yet. Ideally individual messages also have properties which allow the client to process them in an idempotent way, e.g. skip messages it has already processed.</p>
<blockquote>
<p>EDIT (2022-04-04): I was made aware <a href="https://news.ycombinator.com/item?id=30904220">through HN</a> of a spec called <a href="https://www.http-feeds.org">HTTP Feeds</a> which looks like a very good format for those feeds. Something like Atom can still work too.</p>
</blockquote>
<p>The client can then just process the feed in a loop, in pseudocode:</p>
<pre><code class="language-text">cursor = INCEPTION

loop do
    messages, new_cursor = fetch_messages_since(cursor)
    for message in messages do
        if not processed(message)
            process(message)
        end
    end
    cursor = new_cursor
    sleep(DELAY)
end
</code></pre>
<p>This solution is called polling, but the main problem with it is the <code>DELAY</code> variable. If it is set too low, both the server and the client will keep doing work and exchanging data for nothing, but if it is too high messages won&#8217;t be received by the client in a timely fashion.</p>
</section>
<section id="Server-Push">
<h2>Server Push</h2>
<p>If we want message reception to be realtime, we may use a push-based design instead. In that model, the client starts by registering with the server. The server will then send the messages to the client as they arrive.</p>
<p>In practice you might not really want to send each message on its own so you will send message batches instead and client code looks like that:</p>
<pre><code class="language-text">def messages_handler(messages)
    for message in messages do
        process(message)
    end
end

register_with_server(messages_handler)
</code></pre>
<p>This design, however, has a few issues as well.</p>
<p>First, there is the bootstrap problem. The client might need messages that arrived before they registered. The server could theoretically just send all the previous messages to every client on connection, but in practice this is almost never what you want because of volume, performance, etc.</p>
<p>Even if you don&#8217;t need to bootstrap, what should the server do when it tries to send a message to the client and it doesn&#8217;t work? It could be that the client has gone down, or it could just be a network issue. In some systems the server keeps the failed messages for a while and retries, but that complexifies the design because it means the server needs to keep per-client state.</p>
<p>Finally, in practice, authentication is often more complicated that way. The server needs to authenticate the client, of course, but the client also needs a way to make sure the data it receives comes from the server. Here we might need to take a few real-life examples: the client could be a single-page app, in which case the push channel would be something like SSE or websockets; it could also be two HTTP servers communicating in which case we are talking webhooks and might need some ad hoc <a href="https://docs.github.com/en/developers/webhooks-and-events/webhooks/securing-your-webhooks">signature scheme</a>. And by the way, the GitHub scheme does not have any form of protection against replay attacks, which might or might not be a problem for your use case&#8230;</p>
</section>
<section id="Push-to-poll">
<h2>Push-to-poll</h2>
<p>The push-to-poll pattern combines the best of both worlds. The idea is simple: start with the same feed as polling, but instead of using a delayed loop to decide when to fetch it let the server tell you like with the push pattern.</p>
<p>It looks like this:</p>
<pre><code class="language-text">cursor = INCEPTION

def poll_now()
    messages, new_cursor = fetch_messages_since(cursor)
    for message in messages do
        if not processed(message)
            process(message)
        end
    end
    cursor = new_cursor
end

poll_now()
register_with_server(poll_now)
</code></pre>
<p>It solves the problems from the poll design, because there is no more arbitrary delay. The server tells clients when to poll, which might be every time a new message comes, or with a slight delay to optimize the number of requests and ensure messages are processed in batch. Clients might decide not to poll immediately when they receive a server push as well.</p>
<p>There is no more bootstrap problem or reliability problem since it is built on the poll design: every time you poll, you catch everything up. If you want to be extra safe and messages are very rare, you can decide to poll even if you didn&#8217;t receive any message after a reasonably long delay.</p>
<p>The authentication story is better than in the push case, because pushes contain no data. All data access uses regular, client-calls-server authentication. It is still a good thing to authenticate server pushes (for various reasons I won&#8217;t go into) but mistakes there have less impact, especially if you have client-side rate-limiting.</p>
<p>There are many small tweaks that can be added on top of that design, for instance you can include a little bit of metadata in the push messages to let clients decide whether they should actually poll or not.</p>
<p>Finally, note that you get polling for free! Implementers who do not need realtime can just use the feed endpoint with the polling pattern.</p>
<p>The only drawback is that it takes an extra request for every exchange, but in practice I have seen very few cases where the server keeps message history where it would not have been an improvement over server push. So I hope you think about it next time you consider serializing data into websockets or webhooks.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Hello Gemini</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2022-02-05-gemini.html"
    />
    <id>tag:blog.separateconcerns.com,2022-02-05:gemini</id>
    <published>2022-02-05T19:45:00Z</published>
    <updated>2022-02-05T19:45:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I have wanted to play with <a href="https://gemini.circumlunar.space">Gemini</a> for while now, so today being <a href="https://fosdem.org/2022/">the first day of FOSDEM</a> I decided to do what I would have done if I was in Brussels and hack on something between two talks.</p>
<p>I ended up adding Gemini support to <a href="https://github.com/catwell/cw-web/tree/master/separateconcerns/blog">the static generator I use for this blog</a>, which meant implementing a Gemini writer for <a href="https://github.com/jgm/lunamark">Lunamark</a>, plus a small trick to display links in the right place.</p>
<p>To host it, I went with <a href="https://github.com/mbrubeck/agate">Agate</a> which is a simple static content server; I will revisit this choice if I ever need dynamic content.</p>
<p>If you want to check it out, point a Gemini browser - I use <a href="https://gmi.skyjake.fi/lagrange/">Lagrange</a> - to <a href="gemini://separateconcerns.com">separateconcerns.com</a>.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Blog posts for founders (and early employees)</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2021-10-31-blog-posts-founders.html"
    />
    <id>tag:blog.separateconcerns.com,2021-10-31:blog-posts-founders</id>
    <published>2021-10-31T15:45:00Z</published>
    <updated>2021-10-31T15:45:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Over the years, I have accumulated links to blog posts I intend to re-read every time find myself in a position to influence the early stage of a company.</p>
<p>I thought it might be helpful to someone if I published part of that list here. I will avoid links which are too technical and focus on links that can be interest non-technical founders as well.</p>
<p>Note that I haven&#8217;t included books. There are many good books for founders, but if you must read only one make it <a href="https://www.amazon.com/Four-Steps-Epiphany-Steve-Blank/dp/0989200507">The Four Steps to the Epiphany</a>.</p>
<p>If this isn&#8217;t enough for you, you&#8217;re always welcome to explore <a href="https://pinboard.in/u:catwell/">my Pinboard account</a>.</p>
<section id="My-own-posts">
<h2>My own posts</h2>
<p>Let&#8217;s get started by mentioning posts from this blog which transcribe the opinions of two influential people, which I share (on those topics).</p>
<ul>
<li>
<p><a href="https://blog.separateconcerns.com/2013-03-24-vogels-skills.html">Werner Vogels on Skills</a>, where the CTO of Amazon.com describes the qualities he is looking for in leaders at Amazon, in particular Ownership and the willingness to get their hands dirty doing operations.</p>
</li>
<li>
<p><a href="https://blog.separateconcerns.com/2014-05-28-hacker-founders.html">Hacker Founders</a>, where Paul Graham, founder of Y Combinator, explains how programmers have an edge as company founders, including as CEOs.</p>
</li>
</ul>
</section>
<section id="Titles-are-Toxic">
<h2><a href="https://randsinrepose.com/archives/titles-are-toxic/">Titles are Toxic</a></h2>
<p>Michael Lopp (Rands) on issues with giving people titles. Personally I have never liked titles, which can be a source of conflicts and bad decisions. I have also often held titles that didn&#8217;t really correspond to the job I did - which was almost always multi-faceted. Yet, titles are a proxy used by people who don&#8217;t know you to understand what you do at work.</p>
<p>Like Rands I don&#8217;t have a good solution to that. I write <a href="https://blog.separateconcerns.com/2013-06-20-three-years-proprietary-projects.html">some</a> <a href="https://blog.separateconcerns.com/2018-01-06-four-years.html">blog</a> <a href="https://blog.separateconcerns.com/2021-05-01-inch.html">posts</a> explaining what I do in more details that a title ever could, for people who care.</p>
<p>In any case I always suggest avoiding giving some titles to people too early, including to founders: having a &#8220;technical co-founder&#8221; instead of a CTO will make things easier if you grow fast and need to hire someone later on.</p>
</section>
<section id="Creating-a-Software-Company-9-Decisions-You-Have-to-Make">
<h2><a href="https://spin.atomicobject.com/2014/06/02/software-company-decisions/">Creating a Software Company? 9 Decisions You Have to Make</a></h2>
<p>A list of questions to ask yourself when founding a software company, by Michael Marsiglia, CEO of Atomic Object. It can also be a good idea to ask them before joining one.</p>
</section>
<section id="The-40%-rule">
<h2><a href="https://avc.com/2015/02/the-40-rule/">The 40% rule</a></h2>
<p>A simple but powerful rule of thumb for SaaS companies by Brad Feld, relayed by Fred Wilson:</p>
<blockquote>
<p>annual revenue growth rate + operating margin should equal 40%</p>
</blockquote>
</section>
<section id="Why-it’s-nice-to-compete-against-a-large-profitable-company">
<h2><a href="https://blog.asmartbear.com/compete-on-profit.html">Why it’s nice to compete against a large, profitable company</a></h2>
<p>Jason Cohen explains how a startup can disrupt a large competitor by making a part of their business unprofitable and forcing them to abandon it. It&#8217;s not as simple as this summary makes it sound, and it&#8217;s not the Innovator&#8217;s Dilemma. Read the article :)</p>
</section>
<section id="Product-design-at-GitHub">
<h2><a href="https://warpspire.com/posts/product-design">Product design at GitHub</a></h2>
<p>Kyle Neath on how, in the early days of GitHub, everyone was a &#8220;product designer&#8221;. Many successful SaaS products started with the same concept:</p>
<blockquote>
<p>We only hire smart people we trust to make our product better. We don’t have managers dictating what to work on. We don’t require executive signoff to ship features. Executives, system administrators, developers, and designers concieve, ship, and remove features alike.</p>
</blockquote>
<p>Actually, I think I have never seen a company ship good product fast without doing some version of this.</p>
</section>
<section id="Joel-Spolsky's-Strategy-Letters">
<h2>Joel Spolsky&#8217;s Strategy Letters</h2>
<p>If you don&#8217;t know that series of blog posts, you are missing something. They are super insightful essays by a multi-successful founder about building companies.</p>
<ul>
<li>
<p><a href="https://www.joelonsoftware.com/2000/05/12/strategy-letter-i-ben-and-jerrys-vs-amazon/">Ben and Jerry’s vs. Amazon</a> - How to decide between slow profitable growth or fast VC-funded growth.</p>
</li>
<li>
<p><a href="https://www.joelonsoftware.com/2000/05/24/strategy-letter-ii-chicken-and-egg-problems/">Chicken and Egg Problems</a> - Understanding the Chicken and Egg problem and some ways to solve it.</p>
</li>
<li>
<p><a href="https://www.joelonsoftware.com/2000/06/03/strategy-letter-iii-let-me-go-back/">Let Me Go Back!</a> - On barriers to entry, and how letting customers understand they can easily move <strong>out</strong> of your product (maybe back to what they used before) is important.</p>
</li>
<li>
<p><a href="https://www.joelonsoftware.com/2001/03/23/strategy-letter-iv-bloatware-and-the-8020-myth/">Bloatware and the 80/20 Myth</a> - 80% of software users use 20% of features, so you can win the market with just 20% of the features, right? No, because not everyone uses the <strong>same</strong> 20%! I can&#8217;t state how often I meet founders who don&#8217;t understand this.</p>
</li>
<li>
<p><a href="https://www.joelonsoftware.com/2002/06/12/strategy-letter-v/">Strategy Letter V</a> - How companies have an advantage in commoditizing their complements, and how this can explain some investments in Open Source software.</p>
</li>
</ul>
<p>(There is at least a <a href="https://www.joelonsoftware.com/2007/09/18/strategy-letter-vi/">sixth strategy letter</a>, but it is less interesting IMO.)</p>
</section>
<section id="Ev-William's-10-rules-for-Web-Startups">
<h2>Ev William&#8217;s 10 rules for Web Startups</h2>
<p>This post used to be on Ev William&#8217;s blog which went offline some time ago, thankfully I <a href="http://files.catwell.info/misc/mirror/evan-williams-10-rules-startups.txt">mirror articles that interest me that much</a>.</p>
</section>
<section id="Your-company's-most-valuable-resource">
<h2><a href="https://twitter.com/williampietri/status/732602463082188801">Your company&#8217;s most valuable resource</a></h2>
<p>Just a tweet, but an important one, by William Pietri:</p>
<blockquote>
<p>Your company&#8217;s most valuable resource is people giving a shit. Ask yourself: does your system encourage or discourage that?</p>
</blockquote>
</section>
<section id="Wants-needs-and-chasm-crossing">
<h2><a href="https://apenwarr.ca/log/20211024">Wants, needs, and chasm-crossing</a></h2>
<p>A recent post by Avery Pennarun, Tailscale CEO. It shows how the best strategy to acquire customers is often to solve a single <strong>Want</strong> - something their current solution doesn&#8217;t provide - and then to resolve all their <strong>Needs</strong> (blockers) so they can actually flock to your product instead of attempting to implement any more <strong>Wants</strong>.</p>
</section>
<section id="Financial-modeling-for-startups">
<h2><a href="https://www.slideshare.net/rodrigo1971/financial-modeling-for-startups">Financial modeling for startups</a></h2>
<p>A slide deck by Rodrigo Sepulveda with a simple and effective approach to business models and PnLs for startups.</p>
</section>
<section id="Startup-Therapy:-Ten-questions-to-ask-yourself-every-month">
<h2><a href="https://blog.asmartbear.com/startup-business-plan.html">Startup Therapy: Ten questions to ask yourself every month</a></h2>
<p>Jason Cohen (again) shares his alternative to business plans: a list of 10 questions to help you figure out where you are and where to go next.</p>
</section>
<section id="The-Small-Teams-Manifesto">
<h2><a href="http://files.catwell.info/misc/mirror/2015-08-17-codemanship-small-teams-manifesto.txt">The Small Teams Manifesto</a></h2>
<p>Jason Gorman says small teams win because:</p>
<ul>
<li>
the probability that a project fails increases rapidly with size;
</li>
<li>
small teams interact more effectively with the customer and/or end users;
</li>
<li>
small teams are easier to build (hiring good people is hard).
</li>
</ul>
</section>
<section id="Innovating-with-purposeful-anger">
<h2><a href="https://www.icopilots.com/innovation-mindset/innovating-purposeful-anger-12965">Innovating with purposeful anger</a></h2>
<blockquote>
<p>One of the very interesting tools using anger as a driver to innovate is the “You Got Fired!” game.</p>
<p>Get a bunch of managers in a business unit and role-play that their whole team is fired. Indicate also that as a cockup from legal their non-compete clause isn’t applicable.</p>
<p>Then, give them an hour to build a competitor startup that will take revenge on their company on a “That’ll teach them!” mode.</p>
</blockquote>
</section>
<section id="How-To-Decide-What-To-Build">
<h2><a href="http://files.catwell.info/misc/mirror/2019-04-dcgross-decide-build.txt">How To Decide What To Build</a></h2>
<p>Daniel Gross (a founder I have been following since his first YC startup, Greplin) on ways to decide what company to build on a personal level. I wish he had published that before my last attempt.</p>
</section>
<section id="Qu’est-ce-qu’un-projet-entrepreneurial-viable">
<h2><a href="https://philippesilberzahn.com/2011/10/03/projet-entrepreneurial-viable/">Qu’est-ce qu’un projet entrepreneurial viable?</a></h2>
<p>A blog post in French by Philippe Silberzahn. A viable project stems from an individual acting on an idea and convincing people.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>What I do at Inch</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2021-05-01-inch.html"
    />
    <id>tag:blog.separateconcerns.com,2021-05-01:inch</id>
    <published>2021-05-01T18:00:00Z</published>
    <updated>2021-05-01T18:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I have been working at <a href="https://inch.fr">Inch</a> for about a year and a half now, so I thought it was a good time to write a bit about what I do there.</p>
<p>First, a bit of context: Inch is SaaS software for property managers that operates in the French (and Belgian) market. Many of our customers are <a href="https://fr.wikipedia.org/wiki/Syndic_de_copropriété">co-ownership trustees</a>, which is a much bigger deal in France than in most countries, but we also serve other professionals such as rental managers and social housing landlords.</p>
<p>The software can be seen as a mix between a CRM and a ticketing solution. The code base dates back to 2013. The backend is a Rails monolith and the frontend is a React application. There were two other developers on the team when I joined, now we are five, of which I am the most senior. We all directly report to the founder responsible for product, but I am sometimes presented as the CTO to customers because from their point of view I act as such (more on that later).</p>
<p>Now, what do I do there in practice? As you may guess if you know me, a few different things.</p>
<section id="Dealing-with-integrations">
<h2>Dealing with integrations</h2>
<p>That is my main role, and the reason I was hired in the first place. See, our software is used by our customers to manage the relationship with their own customers and suppliers, but they invariably already have pre-existing sotware with overlapping data: their accounting software or ERPs. Some have built them in-house, but most picked from a very fragmented market of industry-specific software which we have to integrate with. So I maintain somewhere between 20 and 30 different integrations with those pieces of software you have probably never heard about.</p>
<p>You may not understand the complexity until you realize that none of those integrations looks the same, because the software itself doesn&#8217;t. Some is cloud-based, some is on-prem. In some cases they provide APIs or flat-file data export mechanisms, but sometimes we have to go get the data directly in their database. Of course, we almost never have technical documentation for their data model, and the databases themselves are all different. I have code for over 10 different major DBMS, not all of them using SQL, and not all of them running on typical OSs (hello AS400, hello SCO&#8230;).</p>
<p>Add to that integration with a few APIs we use, the maintenance of our own APIs so others can integrate with <strong>us</strong> and a few custom features for large customers, and you will have an idea of the scope. It is a role that requires domain knowledge, technical insight about many systems and the ability to understand new ones quickly. And maybe most importantly, I have to model our own software and systems so that they can support all of this. If you think about it it&#8217;s all about synchronizing data between systems, so I am not all that far from my specialty after all. :)</p>
<p>This role means that when we talk to large customers or prospects I am often the person representing the technical side of the company (hence the CTO thing).</p>
</section>
<section id="Operations-and-security">
<h2>Operations and security</h2>
<p>You know the pattern now: I arrive at a startup with a small team of developers where nobody has significant operations experience and I end up becoming responsible for them. It never bothered me, quite the opposite actually: I have been doing systems administration for 20 years and I have always liked it.</p>
<p>In this case, there had been some people who knew what they were doing on the team before, so it was not that bad. For instance, they had a reasonable backup strategy already (yay!).</p>
<p>One of the first initiatives I took was look at spending, which was too high, rationalize a few things and get the hosting bills down. Also, Inch had four main hosting providers for historical reasons: AWS, GCP, Digital Ocean and OVH. The plan was to move everything to GCP, for simplification and compliance reasons. I&#8217;m still not done but I got out of Digital Ocean and reduced our usage of AWS by a lot.</p>
<p>We still had three servers left at OVH when <a href="https://www.reuters.com/article/us-france-ovh-fire-idUSKBN2B20NU">their DCs burned</a> last March. We lost two which served as integration gateways, and I took the opportunity to move them to GCP. Losing those servers has made me very busy in the last two months because their IP adresses were all over our customers&#8217; and partners&#8217; config, so I had to get in touch with them all to fix it, since there was sadly no way we could get back the IPs from OVH in time. That won&#8217;t happen again now, I used reallocatable IPs this time. The third server will remain at OVH for the time being because it is a very special machine with very specific hardware hosting needs.</p>
<p>At small companies like this, operations also come with a lot of security-related responsibilities. Security is pretty important for Inch, which deals with a lot of personal data. So far, I have worked on improving our operational practices, added a team password manager, rationalized internal auth{n,z} around the GCP tools, and written some documentation. I have also upgraded several important software components and reviewed / fixed all the usual configuration (systems, TLS, CORS, CSP&#8230;). I have also started working on the Web application security itself, I have less experience in that space - especially regarding the frontend - than in systems security but I am learning and we have a few experienced Web developers on the team to help.</p>
<p>As usual, nothing is ever done in that space and I still have a lot of work coming up, but at least I believe we&#8217;ve significantly improved since I joined.</p>
</section>
<section id="Fullstack-Web-development">
<h2>Fullstack Web development</h2>
<p>Finally, the third leg of my role is the same as every developer at Inch: working on the product.</p>
<p>I know the &#8220;fullstack&#8221; wording makes some people cringe. Of course we all have our favorite part of the stack but I think its is extremely important, especially on small teams, that everyone be able to write or at least understand a feature in its entirety.</p>
<p>With the other two roles taking much of my time, I don&#8217;t do as much feature work as the rest of the team but I still try to implement features myself regularly. I had never done frontend stuff seriously before Chilli and it was a different stack so I learn a lot about React and its ecosystem. I do my share of performance and bug fixes too. On the backend especially, I also do quite a lot of architecture and code reviews.</p>
</section>
<section id="Other-things">
<h2>Other things</h2>
<p>Besides those three main parts of my role, there are of course other things I take part in. Inch encourages its employees to participate in many cross-cutting activities.</p>
<p>An important one is that we all do support in rotation, which means the whole team ends up knowing the customers and identifying the parts of the product that need improvement. This also means everyone can, and does, participate in product decisions.</p>
<p>But that doesn&#8217;t stop at product. Inch founders are very transparent about the business, our finances and future plans. Everyone is also encouraged to chime in on strategic decisions for the company.</p>
<p>This article is already long enough so I&#8217;ll stop here. I hope that gives you an idea of what I&#8217;ve been doing at work since November 2019. If any of this interests you in any way, don&#8217;t be shy, get in touch. :)</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Booting GDM on my XPS with kernel 5.11</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2021-03-27-archlinux-boot-xps-511.html"
    />
    <id>tag:blog.separateconcerns.com,2021-03-27:archlinux-boot-xps-511</id>
    <published>2021-03-27T20:15:00Z</published>
    <updated>2021-03-27T20:15:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>When I updated my Linux kernel to 5.11 I had the bad surprise to end up with a blinking underscore on reboot. It had been many years since an update had broken my system like that. I fixed it rather easily by booting in rescue mode and downgrading the kernel. I had no time to investigate so I just added <code>linux</code> to <code>IgnorePkg</code> at the time, But I don&#8217;t use Arch to run old kernels so today I took the time to fix it &#8220;properly&#8221;.</p>
<p>To do so, I reproduced the issue, then downgraded again and looked at the logs with <code>journalctl -b --boot=-1</code>. It quickly let me understand that it was GDM that was failing due to something wrong with graphics initialization.</p>
<p>To keep things short, let me skip to the conclusion: if you run into this issue on an old-ish Dell XPS with an Intel Iris Plus 640 graphics card like mine with GDM, Arch and Wayland (or something similar), try <a href="https://wiki.archlinux.org/index.php/kernel_mode_setting#Early_KMS_start">enabling early KMS</a> by adding <code>i915</code> to the <code>MODULES</code> array in <code>mkinitcpio.conf</code> and rebuilding the initramfs, that fixed it for me.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Personal news, 2020 edition</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2020-12-16-personal-news.html"
    />
    <id>tag:blog.separateconcerns.com,2020-12-16:personal-news</id>
    <published>2020-12-16T13:50:00Z</published>
    <updated>2020-12-16T13:50:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I haven&#8217;t posted anything here for 6 months so I thought it would be a good idea to post a personal news update before the end of 2020.</p>
<section id="Shutting-down-Chilli">
<h2>Shutting down Chilli</h2>
<p>I haven&#8217;t posted about it here yet, but my co-founder Julien and me decided to shut down <a href="https://blog.separateconcerns.com/2019-04-23-spicing-things-up.html">Chilli</a> at the end of last year, in agreement with eFounders. Basically, some of our initial hypotheses about the state of the market we were in (french SMBs) were wrong and the business couldn&#8217;t be profitable enough.</p>
<p>In retrospect, it was an interesting experience. I really appreciated being part of <a href="https://www.efounders.com">eFounders</a>, I do recommend it for people who want to start a B2B SaaS company.</p>
<p>However, I wanted to get out of my comfort bubble too much with this one, by tackling a problem in a market I didn&#8217;t know. Because of that, I had to rely on others regarding core business choices, and while that was fine with me initially it ended up being frustrating in the end when things didn&#8217;t work well and I couldn&#8217;t help much. So if I start another company someday, it will be one where I know the problem domain better.</p>
</section>
<section id="Joining-Inch">
<h2>Joining Inch</h2>
<p>After we shut down Chilli, I decided to join a small startup editing a SaaS CRM and ticketing solution for property managers called <a href="https://inch.fr">Inch</a>, only available in the French market for now.</p>
<p>I didn&#8217;t pick Inch randomly, I have known one of the founders for years since he was a <a href="https://blog.separateconcerns.com/2013-06-20-three-years-proprietary-projects.html">Moodstocks</a> user! Fun fact: at the time, I had met him and he was looking for a technical co-founder for <a href="https://fr-fr.facebook.com/Qrators/">his project</a>. I told him he should learn to code instead and gave him Ruby sample code&#8230; and this is why I am back to Rails today. Karma? :)</p>
<p>Anyway, I had been following Inch with interest since its creation, because it is the company I like: solving a real need in a market where tools were either terrible or non-existent. Now they have a unique place in the market and some interesting technical challenges to solve, so I decided to join and help.</p>
</section>
<section id="Starting-a-family">
<h2>Starting a family</h2>
<p>And here comes the last piece of news: despite all the madness that happened this year, the biggest change for me is that I am now a father! My son was born last week, and I took a holiday until the end of the year to spend time with him and his mother. I don&#8217;t intend to post too much personal news here, but this one deserved it. =)</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>[Quora] Transparency in distributed systems UX</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2020-06-19-quora-transparency-distributed.html"
    />
    <id>tag:blog.separateconcerns.com,2020-06-19:quora-transparency-distributed</id>
    <published>2020-06-19T18:52:00Z</published>
    <updated>2020-06-19T18:52:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Yet another <a href="https://blog.separateconcerns.com/2020-04-09-quora-lua-call.html">Quora answer</a>, this time to with <a href="https://www.quora.com/Why-is-Transparency-a-major-issue-in-distributed-databases">this question</a> which I answered on August 24, 2016:</p>
<blockquote>
<p>Why is Transparency a major issue in distributed databases?</p>
</blockquote>
<hr/>
<p>First, a few words about what &#8220;transparency&#8221; is. Transparency is a <a href="https://en.wikipedia.org/wiki/Transparency_%28human%E2%80%93computer_interaction%29">UX term</a> about the user not noticing that they are using a distributed system. We actually talk about transparencies in the plural, because there are several kinds of transparencies: fault transparency, location transparency, concurrency transparency, access transparency, etc. In my opinion, the choice of wording is not so good: when we talk about &#8220;transparency&#8221; we actually mean we hide things from the user, so &#8220;opacity&#8221; would be more logical. (The name comes from the fact that, if we replace a single node system by a distributed system, it will be transparent for the user, i.e. then will not notice it.)</p>
<p>The reason why transparency is important is usability. The more transparencies our system has, the less cognitive burden there is on the user. In other words: <strong>transparencies simplify the API of the system</strong>.</p>
<p>However, what transparencies we implement or not is a trade-off between that simplicity of API and things like flexibility, performance, and sometimes correctness. Years ago (when Object Oriented programming à la Java was booming) it was fashionable to abstract everything and make the user forget that they were using an actual distributed system. For instance, we had RPC everywhere, which kind of hid the network from the user. Since then we learnt that <a href="http://www.rgoarchitects.com/Files/fallacies.pdf">abstracting the network entirely is a bad idea</a>.</p>
<p>On the other hand, exposing too many knobs to the user is dangerous as well: they might turn them without really understanding what they do and set the system on fire.</p>
<p>So, determining what to expose to the user and what to implement &#8220;transparently&#8221; is a crucial point in all distributed systems work, not only databases.</p>
<p>In databases in particular, conflict resolution is a contention point. Do we only provide the user with databases that are consistent, knowing that this severly impacts performance and availability? Do we let them tweak the parameters (the R and W parameters in a quorum system, for instance)? Do we tolerate divergence, detect it, inform the user and let them reconcile (à la CouchDB)? Do we provide the user with constrained datastructures that resolve conflicts by themselves (CRDTs)?</p>
<p>Some people have gone as far as saying that <a href="https://bravenewgeek.com/distributed-systems-are-a-ux-problem/">Distributed Systems Are a UX Problem</a> and I tend to agree with this line of reasoning.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>[Quora] Explaining classes to a 10 year old</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2020-04-11-quora-class-concept.html"
    />
    <id>tag:blog.separateconcerns.com,2020-04-11:quora-class-concept</id>
    <published>2020-04-11T13:00:00Z</published>
    <updated>2020-04-11T13:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Continuing my <a href="https://blog.separateconcerns.com/2020-04-09-quora-lua-call.html">Quora answers series</a> with <a href="https://www.quora.com/How-would-you-explain-the-concept-of-a-class-in-Python-to-a-10-year-old">this question</a> which I answered on June 26, 2012:</p>
<blockquote>
<p>How would you explain the concept of a &#8220;class&#8221; in Python to a 10 year old?</p>
</blockquote>
<hr/>
<p>You cannot distinguish the concept of &#8220;class&#8221; from the concept of &#8220;instance&#8221;. I think OOP is often taught the wrong way around, paradoxically because it is taught with languages that have support for class-based Object Oriented Programming such as Python (or Java for that matter). So excuse me but I will use another language (Lua, but you don&#8217;t need to know to understand) to explain it. (Note: this will be <strong>bad</strong> Lua on purpose, but the point is not to teach Lua, it is to explain OOP).</p>
<p>Since you wrote &#8220;to a 10 year old&#8221; let&#8217;s proceed with examples.</p>
<p>Imagine you come from another planet and you do not know what cats are. You encounter something small that purrs. You decide to name it Sam. Later on, you see something else very similar, except it is bigger, and you name it Max.</p>
<p>Let us describe Sam and Max in Lua.</p>
<pre><code class="language-lua">sam = {
    name = "Sam",
    size = "small",
}

max = {
    name = "Max",
    size = "big",
}
</code></pre>
<p>Now we said that they purr, so let&#8217;s define purring:</p>
<pre><code class="language-lua">purr = function(self)
    print(self.name .. " purrs!")
end
</code></pre>
<p><code>purr</code> is a function that has its first argument called <code>self</code> and represents the thing that purrs. For instance you could make Max purr
like this:</p>
<pre><code class="language-lua">purr(max)
</code></pre>
<p>Now you could stop here, or you could see purring as a property of Sam and Max. To represent that we could make <code>purr</code> a &#8220;method&#8221; of the &#8220;objects&#8221; Sam and Max:</p>
<pre><code class="language-lua">sam.purr = purr
max.purr = purr
</code></pre>
<p>Now with the Lua syntax we cound also make Max purr like this:</p>
<pre><code class="language-lua">max:purr()
</code></pre>
<p>Which is a short way to write this:</p>
<pre><code class="language-lua">max.purr(max)
</code></pre>
<p>Since we said that <code>max.purr = purr</code> it works as expected.</p>
<p>After some time on Earth you realize there are lots of things like Sam and Max. Moreover there are lots of things Sam, Max and their friends do, such as sleep on keyboards. They also have things in common such as the fact they have two eyes.</p>
<p>You grow tired to say: &#8220;Max purrs. Max has two eyes. (&#8230;). Sam purrs. (&#8230;)&#8221;. It would be much simpler to say give a name to the set of Sam, Max and their friends (for instance &#8220;Cats&#8221;) and say &#8220;Cats purr. Cats have two eyes.&#8221;.</p>
<p>Note that &#8220;Cats&#8221; is nothing physical, it is an idea, a <strong>category</strong> you have created for Sam, Max and their friends in order to be able to express things about them in an easier way.</p>
<p>Let&#8217;s switch to Python to show how this is done now:</p>
<pre><code class="language-python">class Cat:
    eyes = 2

    def __init__(self, name, size):
        self.name = name
        self.size = size

    def purr(self):
        print(self.name + " purrs!")
</code></pre>
<p>And how you use it:</p>
<pre><code class="language-python">sam = Cat(name="Sam", size="small")
sam.purr()
</code></pre>
<p>Note that we have never said explicitly that Sam can purr. He can purr because he is a Cat.</p>
<p>In this example:</p>
<ul>
<li>
<p>Cat is a class, ie. a category of objects ;</p>
</li>
<li>
<p>Sam and Max are instances of the Cat class ;</p>
</li>
<li>
<p><code>purr</code> is a method of the Cat class, ie. not much more conceptually than a function that takes a Cat instance as its first argument and some syntactic sugar (ie. special notation) to call it.</p>
</li>
</ul>
<hr/>
<p>By the way, this answer got one of the best comments I ever got on a Quora answer:</p>
<blockquote>
<p>Sam and Max are not cats!</p>
</blockquote>
<p>;)</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>[Quora] What is the call metamethod in Lua?</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2020-04-09-quora-lua-call.html"
    />
    <id>tag:blog.separateconcerns.com,2020-04-09:quora-lua-call</id>
    <published>2020-04-09T08:40:00Z</published>
    <updated>2020-04-09T08:40:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>From 2011 to 2014, I used to post answers on <a href="https://www.quora.com/">Quora</a>. I don&#8217;t anymore, because I don&#8217;t really like what the website has become. I have a copy of some of my answers <a href="http://files.catwell.info/misc/mirror/quora-answers/">here</a> but someone <a href="https://www.quora.com/What-is-the-__call-metamethod-in-Lua-and-what-are-some-of-its-uses-and-basic-examples/all_comments/Pierre-Chapuis?__nsrc__=4&amp;__snid3__=7556751152&amp;comment_id=135057589&amp;comment_type=2">commented</a> on one of my answers that it should be available more prominently on the Web, so I decided to repost a few of my answers here, starting with this one.</p>
<p>The <a href="https://www.quora.com/What-is-the-__call-metamethod-in-Lua-and-what-are-some-of-its-uses-and-basic-examples/">original question</a> was:</p>
<blockquote>
<p>I&#8217;m really new to lua and relatively new to programming.,so kindly excuse if I say something stupid.</p>
<p>I have a table named x and its metatable named y.
When I have a <code>__call</code> method defined for the metatable <code>y</code>, then I can call <code>x()</code> but if I have a <code>__call</code> for <code>x</code> then I can not call <code>x()</code>.</p>
<p>What is <code>__call</code> used for? How does it work and what are some examples of usage</p>
</blockquote>
<p>I answered it on February 25, 2013.</p>
<hr/>
<p><code>__call</code> is a metamethod, that means it is meant to be defined in a
metatable. A <code>__call</code> field added to a regular table (<code>x</code> in your example)
does nothing.</p>
<p>The role of <code>__call</code> is to make something that is not a function (usually
a table) act like a function. There are a few reasons why you may want
to do that. Here are two examples.</p>
<p>The first one is a memoizing factorial function. In Lua you could write
a recursive factorial like this:</p>
<pre><code class="language-lua">local function fact(n)
    if n == 0 then
        return 1
    else
        return n * fact(n - 1)
    end
end
</code></pre>
<p>Note: this is not a good way to write a recursive factorial because you
are not taking advantage of tail calls, but it&#8217;s enough for what I want
to explain.</p>
<p>Now imagine your code uses that function to calculate the factorials of
numbers from 1 to <code>N</code>. This would be very wasteful since you would
calculate the factorial of <code>N</code> once, the factorial of <code>N-1</code> twice, and so
on. You would end up computing approximately <code>N²/2</code> factorials.</p>
<p>Instead you could write that:</p>
<pre><code class="language-lua">local fact
fact = setmetatable(
    {[0] = 1},
    {
        __call = function(t, n)
            if not t[n] then
                t[n] = n * fact(n - 1)
            end
            return t[n]
        end
    }
)
</code></pre>
<p>It is an implementation of factorial that memoizes the results it has
already computed, which you can call like a function. You can use it
exactly like the previous implementation of factorial and get linear
complexity.</p>
<p>Another use case for <code>__call</code> is matrices. Imagine you have a matrix
implementation that works like that:</p>
<pre><code class="language-lua">local methods = {
    get = function(self, i, j)
        return self[i + 1][j + 1]
    end
}

local mt = {__index = methods}

local new_matrix = function(t)
    return setmetatable(t, mt)
end
</code></pre>
<p>You can use it like that:</p>
<pre><code class="language-lua">local M = new_matrix({ {1, 2}, {3, 4} })
local v = M:get(0, 1)
assert(v == 2)
</code></pre>
<p>However scientists would probably expect something like this:</p>
<pre><code class="language-lua">local v = M(0, 1)
assert(v == 2)
</code></pre>
<p>You can achieve that thanks to <code>__call</code>:</p>
<pre><code class="language-lua">local mt = {
    __index = methods,
    __call = function(self, i, j)
        return self:get(i, j)
    end
}
</code></pre>
<p>I hope this gives you enough information to understand how you can use
<code>__call</code>. A word of warning though: like most other metamethods, it is
useful but it is important not to abuse it. Simple code is better :)</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Two-factor authentication with pass and oathtool</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2020-04-03-2fa-pass-oathtool.html"
    />
    <id>tag:blog.separateconcerns.com,2020-04-03:2fa-pass-oathtool</id>
    <published>2020-04-03T09:05:00Z</published>
    <updated>2024-02-10T21:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>If you&#8217;re like me, you don&#8217;t want to depend on your phone to log into a website, and you wish <a href="https://www.passwordstore.org">your favorite password manager</a> would support 2FA. Well, it can.</p>
<p>When asked to setup 2FA on a website, get a text code for TOTP. If the website doesn&#8217;t give you that option, just use <a href="http://zbar.sourceforge.net">zbar</a>. For instance, with the QR code from the <a href="https://help.github.com/en/github/authenticating-to-github/configuring-two-factor-authentication">GitHub documentation</a>:</p>
<pre><code class="language-text">$ zbarimg totp-click-enter-code.png
QR-Code:otpauth://totp/GitHub:LyaLya?secret=qmli3dwqm53vl7fy&amp;issuer=GitHub
scanned 1 barcode symbols from 1 images in 0.03 seconds
</code></pre>
<p>Once you get the secret, put it in <code>2fa/github</code> in <code>pass</code>.</p>
<p>Finally, add this to your <code>.bashrc</code> (or the equivalent for whatever shell you use):</p>
<pre><code class="language-shell">2fa () { oathtool --totp --base32 $(pass 2fa/"$1" | head -n 1) ; }
</code></pre>
<p>You can now get your 2FA codes like this:</p>
<pre><code class="language-text">$ 2fa github
795864
</code></pre>
<p>Finally, you can get Bash completion with this simple script, that you must put in <code>/usr/share/bash-completion/completions/2fa</code>:</p>
<pre><code class="language-shell">#/usr/bin/env bash

&gt;/dev/null pushd "${PASSWORD_STORE_DIR:-$HOME/.password-store}/2fa"
    l="$(find . -type f | sed s#^./## | sed s#.gpg\$##)"
&gt;/dev/null popd

complete -W "$l" 2fa
</code></pre>
<p>All the tools used in that article are <a href="https://archlinux.org/packages/extra/any/pass/">available</a> <a href="https://archlinux.org/packages/extra/x86_64/oath-toolkit/">as</a> <a href="https://www.archlinux.org/packages/extra/x86_64/zbar/">packages</a> in the Arch Linux repositories.</p>
<section id="Complements">
<h2>Complements</h2>
<p>It was <a href="https://lobste.rs/s/abmkdz/2fa_2_factor_authentication_terminal_app">a post on Lobsters</a> that prompted me to post this. <a href="https://lobste.rs/s/abmkdz/2fa_2_factor_authentication_terminal_app#c_c0y9io">Someone from the comments</a> and <a href="https://twitter.com/gawenr/status/1245973593453932544">a former colleague on Twitter</a> told me about <a href="https://github.com/tadfisher/pass-otp">a pass extension</a> I didn&#8217;t know about which does almost the same thing.</p>
<p>Also, some people think that putting 2FA codes in a password manager defeats the purpose. But in practice TOTP 2FA does not really add much more to the security of my accounts than the strong random passwords I generate with pass. The &#8220;second factor&#8221; part isn&#8217;t really the true benefit.</p>
<p>One actual advantage is that nobody on the network can sniff all of my credentials (like digest-based password verification methods). Another, and I think this is the main one, is that the owner of the website has chosen part of the credentials and hence ensured some degree of strength. What I do preserves both of those properties, so I&#8217;m fine with it. By the way, note that password managers like <a href="https://support.1password.com/one-time-passwords/">1Password</a> and <a href="https://help.passbolt.com/configure/totp/time-based-one-time-password-mobile">Passbolt</a> do the same thing.</p>
<p>One thing you can do to improve the security of the whole thing is use 2FA <strong>to access pass</strong> by storing the GPG key in a Yubikey.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Tools</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2020-03-01-tools.html"
    />
    <id>tag:blog.separateconcerns.com,2020-03-01:tools</id>
    <published>2020-03-01T18:00:00Z</published>
    <updated>2023-05-01T12:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>A few days ago I read <a href="https://medium.com/@kunaljasty/how-a-2-person-startup-already-uses-26-other-tools-318da014cf38">this article</a> which made me want to list some of the tools used at the four startups I have worked at so far.</p>
<p>I have mostly listed SaaS tools here, but you can also check out <a href="https://pinboard.in/u:catwell/t:~stack/">the ~stack tag on my Pinboard</a> for more.</p>
<p>I have also added a section at the end for some tools I use for my own projects.</p>
<section id="Moodstocks-2010---2013">
<h1>Moodstocks (2010 - 2013)</h1>
<ul>
<li>
<a href="https://www.fastmail.com">Fastmail</a> - E-mail
</li>
<li>
<a href="https://github.com">GitHub</a> - Code hosting &amp; issues
</li>
<li>
<a href="https://basecamp.com">Basecamp</a> - PM
</li>
<li>
<a href="https://basecamp.com/retired/campfire">Campfire</a> - Chat &amp; Customer Support
</li>
<li>
<a href="https://www.salesforce.com">Salesforce</a> - CRM
</li>
<li>
<a href="https://desk.com">Desk.com</a> - Customer Support
</li>
<li>
<a href="https://gandi.net">Gandi</a> - DNS
</li>
<li>
<a href="https://uptimerobot.com">Uptime Robot</a> - Alerting
</li>
<li>
<a href="https://aws.amazon.com">AWS</a> - Hosting
</li>
<li>
<a href="https://mandrillapp.com">Mandrill</a> - Transactional e-mails
</li>
<li>
<a href="https://konghq.com">Kong</a> - API Gateway
</li>
</ul>
</section>
<section id="Lima-2014---2019">
<h1>Lima (2014 - 2019)</h1>
<ul>
<li>
<a href="https://gsuite.google.com">GSuite</a> - E-mail &amp; Calendar
</li>
<li>
<a href="https://github.com">GitHub</a> - Code hosting, issues &amp; PM
</li>
<li>
Flowdock then <a href="https://slack.com">Slack</a> - Chat
</li>
<li>
<a href="https://www.lucca.fr">Lucca</a> then <a href="https://payfit.com">Payfit</a>
</li>
<li>
<a href="https://segment.com">Segment</a> - Customer workflows
</li>
<li>
<a href="https://customer.io">customer.io</a> - Customer base, emailing
</li>
<li>
<a href="https://www.zendesk.com">Zendesk</a> - Customer support
</li>
<li>
<a href="https://www.invisionapp.com">Invision</a> - Design work
</li>
<li>
<a href="https://www.oneskyapp.com">OneSky</a> - App translation
</li>
<li>
<a href="https://www.talent.io">Talent.io</a> - Hiring
</li>
<li>
<a href="https://gandi.net">Gandi</a> - DNS
</li>
<li>
<a href="https://www.datadoghq.com">Datadog</a> - Monitoring
</li>
<li>
<a href="https://uptimerobot.com">Uptime Robot</a> - Alerting
</li>
<li>
<a href="https://pushover.net">Pushover</a> - Alerting
</li>
<li>
<a href="https://sentry.io">Sentry</a> - Error monitoring
</li>
<li>
<a href="https://www.appveyor.com">AppVeyor</a> - Windows build &amp; CI
</li>
<li>
<a href="https://travis-ci.com">Travis</a> - Build &amp; CI
</li>
<li>
<a href="https://firebase.google.com/">Firebase</a> (<a href="https://get.fabric.io">Fabric</a>&#8230;)
</li>
<li>
<a href="https://aws.amazon.com">AWS</a> (+ many others including <a href="https://www.ovh.com">OVH</a> and <a href="https://www.scaleway.com">Scaleway</a>) - Hosting
</li>
<li>
<a href="https://sendgrid.com">Sendgrid</a> - Transactional e-mails
</li>
<li>
<a href="https://www.cloudflare.com">Cloudflare</a> - CDN
</li>
</ul>
</section>
<section id="Chilli-eFounders-2019">
<h1>Chilli (eFounders, 2019)</h1>
<ul>
<li>
<a href="https://gsuite.google.com">GSuite</a> - E-mail, Calendar, Drive
</li>
<li>
<a href="https://github.com">GitHub</a> - Code hosting
</li>
<li>
<a href="https://slack.com">Slack</a> - Chat
</li>
<li>
<a href="https://slite.com">Slite</a> - EDM
</li>
<li>
<a href="https://airtable.com">Airtable</a> - Process modeling
</li>
<li>
<a href="https://www.pipedrive.com">Pipedrive</a> - CRM
</li>
<li>
<a href="https://trello.com">Trello</a> - PM
</li>
<li>
<a href="https://payfit.com">Payfit</a> - Payroll, Leaves &amp; absences
</li>
<li>
<a href="https://www.spendesk.com">Spendesk</a> - Expenses
</li>
<li>
<a href="https://zoom.us">Zoom</a> - Video calls
</li>
<li>
<a href="https://www.intercom.com">Intercom</a> - Lead acquisition
</li>
<li>
<a href="https://aircall.io">Aircall</a> - Centralized phone calls
</li>
<li>
<a href="https://moqups.com">Moqups</a> - Design work
</li>
<li>
<a href="https://www.invisionapp.com">Invision</a> - Design work
</li>
<li>
<a href="https://analytics.google.com">Google Analytics</a> - Analytics
</li>
<li>
<a href="https://www.squarespace.com">Squarespace</a> - Blog
</li>
<li>
<a href="https://1password.com">1Password</a> - Team password management
</li>
<li>
<a href="https://codility.com">Codility</a> - Hiring (screening)
</li>
<li>
<a href="https://hiresweet.com">Hiresweet</a> - Hiring (sourcing)
</li>
<li>
<a href="https://www.workable.com">Workable</a> - Hiring
</li>
<li>
<a href="https://gandi.net">Gandi</a> - DNS
</li>
<li>
<a href="https://uptimerobot.com">Uptime Robot</a> - Alerting
</li>
<li>
<a href="https://aws.amazon.com">AWS</a> - Hosting
</li>
<li>
<a href="https://www.mailjet.com">Mailjet</a> - Transactional e-mails
</li>
</ul>
</section>
<section id="Inch-2019---2023">
<h1>Inch (2019 - 2023)</h1>
<ul>
<li>
<a href="https://workspace.google.com">Google Workspace</a> - E-mail, Calendar, Drive
</li>
<li>
<a href="https://github.com">GitHub</a> - Code hosting &amp; issues
</li>
<li>
<a href="https://slack.com">Slack</a> - Chat
</li>
<li>
<a href="https://www.notion.so">Notion</a> - EDM
</li>
<li>
<a href="https://www.hubspot.fr">Hubspot</a> - CRM
</li>
<li>
<a href="https://payfit.com">Payfit</a> (previously <a href="https://www.lucca.fr">Lucca</a>) - Payroll, Leaves &amp; absences
</li>
<li>
<a href="https://mixpanel.com">Mixpanel</a> - Analytics
</li>
<li>
<a href="https://www.intercom.com">Intercom</a> - Customer support
</li>
<li>
<a href="https://aircall.io">Aircall</a> - Centralized phone calls
</li>
<li>
<a href="https://uptimerobot.com">Uptime Robot</a> - Alerting
</li>
<li>
<a href="https://rollbar.com">Rollbar</a> - Error monitoring (backend)
</li>
<li>
<a href="https://sentry.io">Sentry</a> - Error monitoring (frontend)
</li>
<li>
<a href="https://scoutapm.com">Scout</a> - APM
</li>
<li>
<a href="https://cloud.google.com">GCP</a> (+ <a href="https://www.ovh.com">OVH</a>) - Hosting
</li>
<li>
<a href="https://mandrillapp.com">Mandrill</a> - Transactional e-mails
</li>
<li>
<a href="https://www.xero.com">Xero</a> - Accounting
</li>
<li>
<a href="https://www.postman.com">Postman</a> - API documentation
</li>
<li>
<a href="https://www.pipefy.com">Pipefy</a> - Customer lifecyce
</li>
<li>
<a href="https://www.vonage.com">Vonage</a> and <a href="https://www.smsmode.com/">smsmode</a> - Transactional SMS
</li>
</ul>
</section>
<section id="Finegrain-2023">
<h1>Finegrain (2023)</h1>
<ul>
<li>
<a href="https://workspace.google.com">Google Workspace</a> - E-mail, Calendar, Drive
</li>
<li>
<a href="https://github.com">GitHub</a> - Code &amp; documentation hosting
</li>
<li>
<a href="https://linear.app">Linear</a> - Project management and issues
</li>
<li>
<a href="https://slack.com">Slack</a> - Chat
</li>
<li>
<a href="https://www.notion.so">Notion</a> - EDM
</li>
<li>
<a href="https://uptimerobot.com">Uptime Robot</a> - Alerting
</li>
<li>
<a href="https://sentry.io">Sentry</a> - Error monitoring
</li>
<li>
<a href="https://vercel.com">Vercel</a> - Frontend platform
</li>
</ul>
</section>
<section id="Personal">
<h1>Personal</h1>
<ul>
<li>
<a href="https://www.fastmail.com">Fastmail</a> - Email
</li>
<li>
<a href="https://github.com">GitHub</a> - Code hosting
</li>
<li>
<a href="https://pinboard.in">Pinboard</a> - Bookmarks
</li>
<li>
<a href="https://gandi.net">Gandi</a> - DNS
</li>
<li>
<a href="https://uptimerobot.com">Uptime Robot</a> - Alerting
</li>
<li>
<a href="https://my.vultr.com">Vultr</a> - Hosting
</li>
</ul>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Opinions</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2019-10-19-opinions.html"
    />
    <id>tag:blog.separateconcerns.com,2019-10-19:opinions</id>
    <published>2019-10-19T15:30:00Z</published>
    <updated>2019-10-19T15:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>You know how some discussions can make you pause and introspect for a while after they happen? Well, I have had such a discussion recently about how strong my opinions are nowadays, and I decided to write something about it.</p>
<section id="Forming-opinions">
<h2>Forming opinions</h2>
<p>People who have spent significant time around me know all too well how I behave when I get interested in a topic. I can spend weeks (and sometimes even much longer) reading all I can find about it until I know its ins and outs. This results in me being able to discuss and have opinions about things which are apparently completely random, but which I ended up picking up along the way for some reason.</p>
<p>For the longest time, I have believed in <a href="https://blog.asmartbear.com/strong-opinions-somewhat-weakly-held.html">strong opinions (somewhat) weakly held</a>, and for the most part I still do. In particular, I agree with the &#8220;somewhat&#8221; part, which says that the strength with which you should hold an opinion depends on how you formed it.</p>
<p>What has changed in the last 5-7 years is my view on how explicit those opinions should be, and how much I should fight for them.</p>
</section>
<section id="Expressing-opinions">
<h2>Expressing opinions</h2>
<p>I was strongly influenced by the Open Source community of the early 2000s where, if you wanted something to happen, you had to state your opinion and be ready to defend it - sometimes ferociously - with arguments. If you didn&#8217;t, you would be ignored.</p>
<p>What outsiders often overlook about this method is that it worked, and it was pretty efficient. Most people got used to it, and in general it did not turn into endless debates, because in the end we had <a href="https://en.wikipedia.org/wiki/Benevolent_dictator_for_life">benevolent dictators</a> to settle the matter.</p>
<p>But a problem I could not see for a long time is that this excludes a lot of people from the discussion. People who, because of their education or the position society put them in, won&#8217;t express their own opinion if it contradicts the current consensus or that of someone they either respect or fear; or people who won&#8217;t engage in anything remotely resembling conflict because that&#8217;s not in their nature.</p>
<p>It is especially easy to ignore the existence of these people when the only way you are communicating is through asynchronous text over the Internet. However they often have very interesting things to say, with different points of view that can make headway or prevent big mistakes.</p>
<p>There are lots of ways to work around that issue, including timeboxing contributions on a topic while keeping them secret, or simply having people in positions of power and people more comfortable with their opinion express it last.</p>
</section>
<section id="Defending-opinions">
<h2>Defending opinions</h2>
<p>Another matter is how much you should fight for your opinion. I am not talking about <a href="https://xkcd.com/386/">the famous XKCD comic</a>, I know I can be this guy sometimes, but that is something else.</p>
<p>Some time ago I was struggling with how to handle disagreement at work, and I became an adept of the way Amazon does things, its <a href="https://www.amazon.jobs/en/principles">Leadership Principles</a>, and in particular Disagree and Commit:</p>
<blockquote>
<p>Leaders are obligated to respectfully challenge decisions when they disagree, even when doing so is uncomfortable or exhausting. Leaders have conviction and are tenacious. They do not compromise for the sake of social cohesion. Once a decision is determined, they commit wholly.</p>
</blockquote>
<p>When organizations follow this principle, it helps a lot with the issue, because it makes it clear that you can - and should - express dissenting opinion, and how you can align on things you do not agree with without making it look like you changed your mind when you did not.</p>
<p>(On a side note, I even think in some cases making dissent mandatory by instituting a <a href="https://www.thestar.com/news/insight/2017/05/21/how-israeli-intelligence-failures-led-to-a-devils-advocate-role.html">Tenth Man / Devil&#8217;s Advocate rule</a> can be beneficial.)</p>
<p>However, it turns out this principle is more complicated than it sounds, and there are two important points I did not immediately understand, which are much more explicit in <a href="https://blog.aboutamazon.com/company-news/2016-letter-to-shareholders">Bezos&#8217; 2016 letter to shareholders</a>.</p>
<p>The first is that the person who &#8220;disagrees but commits&#8221; is not necessarily the subordinate in a power relationship. Bezos says:</p>
<blockquote>
<p>This isn’t one way. If you’re the boss, you should do this too. I disagree and commit all the time. We recently greenlit a particular Amazon Studios original. I told the team my view: debatable whether it would be interesting enough, complicated to produce, the business terms aren’t that good, and we have lots of other opportunities. They had a completely different opinion and wanted to go ahead. I wrote back right away with “I disagree and commit and hope it becomes the most watched thing we’ve ever made.” Consider how much slower this decision cycle would have been if the team had actually had to convince me rather than simply get my commitment.</p>
</blockquote>
<p>The second point I missed is the meaning of the sentence &#8220;they do not compromise for the sake of social cohesion.&#8221; The &#8220;compromise&#8221; part is clear enough; here compromising would have meant giving the green light but with, say, fewer resources. From experience compromises like this often end up poorly. But the hard part is &#8220;for the sake of social cohesion&#8221;. Here is what Bezos has to say:</p>
<blockquote>
<p>Note what this example is not: it’s not me thinking to myself &#8220;well, these guys are wrong and missing the point, but this isn’t worth me chasing.&#8221; It’s a genuine disagreement of opinion, a candid expression of my view, a chance for the team to weigh my view, and a quick, sincere commitment to go their way.</p>
</blockquote>
<p>Unlike Bezos my current (weakly held) opinion is that sometimes keeping social peace is worth not engaging in some minor issues. Some people will always appreciate being told when you think they&#8217;re mistaken, but others won&#8217;t even if they end up admitting they were wrong in the end, so it only makes sense to contradict them if it is worth risking being resented for it.</p>
</section>
<section id="Tolerating-opinions">
<h2>Tolerating opinions</h2>
<p>The first step for all this to work is probably to admit that opinions can exist without being &#8220;right&#8221; or &#8220;wrong&#8221;.</p>
<p>That may be obvious to you but for a long time it was not for me. When I was a kid I looked at things in binary: true or false, right or wrong, better or worse. This made me enjoy CS and math, but paradoxically learning more advanced math (<a href="https://en.wikipedia.org/wiki/Order_theory#Partially_ordered_sets">partial orders</a>, <a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpson&#8217;s paradox</a>, <a href="https://en.wikipedia.org/wiki/Gödel%27s_incompleteness_theorems">Gödel&#8217;s incompleteness theorems</a>&#8230;) showed me that even in the hardest of sciences things were more nuanced.</p>
<p>Anyway, there are reasons why people come to hold a set of beliefs which makes sense at least locally. Learning about this background is important, whether it helps you convince them or changes your own mind.</p>
<p>Don&#8217;t worry though, I still hold a few strong opinions, both in my field (some quite strongly - you won&#8217;t easily make me change <a href="https://blog.separateconcerns.com/2019-02-15-architecture-principles.html">those</a> for instance) and outside of it!</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Truncating an Alembic migrations history</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2019-06-01-truncating-alembic.html"
    />
    <id>tag:blog.separateconcerns.com,2019-06-01:truncating-alembic</id>
    <published>2019-06-01T19:00:00Z</published>
    <updated>2019-06-01T19:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>In projects that use SQLAlchemy and <a href="https://alembic.sqlalchemy.org">Alembic</a> via <a href="https://flask-migrate.readthedocs.io">Flask-Migrate</a>, you may want to truncate the migrations history. By that I mean: rewrite all the migrations up to some point as a single initial migration, to avoid replaying them every single time you create a new database instance. Of course, you only want to do that if you have already migrated all your database instances at least up to that point.</p>
<p>As far as I know, there is no Alembic feature to do this automatically. However, I found a way to avoid having to write the migration by hand. Here is an example of how you can achieve this with a project using Git, PostgreSQL, and <a href="https://12factor.net">environment variables for configuration</a>.</p>
<p>First, checkout a commit of your project where the first migration you want to keep is the current migration, and create a temporary branch. Then, take a note of the ID of that migration (for instance <code>abcd12345678</code>), delete the whole <code>migrations</code> directory and reinitialize Alembic.</p>
<pre><code class="language-shell">git checkout $my_commit
git checkout -b tmp-alembic
rm -rf migrations
flask db init
</code></pre>
<p>At this point, using Git, revert changes to files where you should keep your changes, such as <code>script.py.mako</code> and <code>env.ini</code>. Then, create a temporary empty database to work with.</p>
<pre><code class="language-shell">git checkout migrations/script.py.mako
git checkout migrations/env.py
createdb -T template0 my-temp-db
</code></pre>
<p>Now create the initial migration that corresponds to your model, with the ID that you noted previously, e.g.:</p>
<pre><code class="language-shell">MY_DATABASE_URI="postgresql://postgres@localhost/my-empty-db" \
    flask db migrate --rev-id abcd12345678
</code></pre>
<p>Finally, you can delete the temporary database, commit your changes to your temporary branch, merge it into your main development branch and delete it:</p>
<pre><code class="language-shell">dropdb my-empty-db
git commit
git checkout dev
git merge tmp-alembic
git branch -D tmp-alembic
</code></pre>

      </div>
    </content>
  </entry>
  <entry>
    <title>Changing the SSH port on Arch Linux</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2019-05-04-ssh-port.html"
    />
    <id>tag:blog.separateconcerns.com,2019-05-04:ssh-port</id>
    <published>2019-05-04T18:00:00Z</published>
    <updated>2020-04-07T10:40:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <section id="April-2020-update">
<h2>April 2020 update</h2>
<p>This article is out of date. Arch Linux <a href="https://bugs.archlinux.org/task/62248">stopped shipping OpenSSH with socket activation</a> due to the risk of DoS attack. Now you can just set <code>Port</code> in <code>sshd_config</code> as usual.</p>
</section>
<section id="Original-article">
<h2>Original article</h2>
<p>I often change the default SSH port from 22 to something else on servers I run. It kind of is a dangerous operation, especially when the only way you have to connect to that server <strong>is</strong> SSH.</p>
<p>The historical way to do this is editing <code>sshd_config</code> and setting the <code>Port</code> variable, but with recent versions of Arch Linux and the default configuration, this will <strong>not</strong> work.</p>
<p>The reason is that SSH is configured with systemd socket activation. So what you need to do is run <code>sudo systemctl edit sshd.socket</code> and set the contents of the file to:</p>
<pre><code class="language-toml">[Socket]
ListenStream=MY_PORT
Accept=yes
</code></pre>
<p>where <code>MY_PORT</code> is the port number you want.</p>
<p>I hope this short post will avoid trouble for other people, at least it will be a reminder for me the next time I have to setup an Arch server&#8230;</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Spicing things up</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2019-04-23-spicing-things-up.html"
    />
    <id>tag:blog.separateconcerns.com,2019-04-23:spicing-things-up</id>
    <published>2019-04-23T21:45:00Z</published>
    <updated>2019-04-23T21:45:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>In my last post I <a href="https://blog.separateconcerns.com/2019-02-15-goodbye-lima.html#what-are-you-going-to-do-next">told you</a> I had plans that I was not ready to talk about yet. Well, the time has come. I am happy to announce that I am now the CTO and co-founder of a startup called <a href="https://hellochilli.com">Chilli</a>.</p>
<p>Chilli is not a typical startup, it is an <a href="https://www.efounders.com">eFounders</a> project. You may know eFounders as the first startup studio in France, which originated companies such as <a href="https://frontapp.com">Front</a>, <a href="https://aircall.io">Aircall</a> and <a href="https://www.spendesk.com">Spendesk</a>. The way they usually work is that they identify a problem that needs solving and find founders to tackle it, providing them both support and funding in exchange for equity. When the studio was created, I had doubts about the model, but later on I became <a href="https://twitter.com/pchapuis/status/806463326842712067">quite enthusiastic</a> about it.</p>
<p>Most eFounders companies are Software-as-a-Service businesses, and several of them were born of a need identified in traditional SMBs and SMEs. However, many pivoted to serve a different market, either tech companies or enterprises, and we can see the same pattern in other SaaS companies as well. So we end up with software that doesn&#8217;t sell in the market it was originally designed for, and SMBs left on the side of the road with unaddressed digital needs. The reason, we believe, lies with the SaaS-to-SMBs distribution model, and that is the issue Chilli intends to solve.</p>
<p>We are certain that the solution to that problem must involve software. However, we also think technology alone will not be enough; a human touch is necessary, which is why my co-founder and CEO Julien comes from a consulting background. What we will build is a hybrid platform to help leaders identify the pain points in their companies and match them with the best digital tools to solve them. By starting from the customer&#8217;s needs, we will work around the distribution cost issues and become the missing link between SaaS vendors and traditional SMBs and SMEs.</p>
<p>For me, this is a new and exciting challenge. Despite having been a very early employee at startups twice, I have never been a founder yet, and it is something I have wanted to do for a while. Moreover, it means I will be doing a lot of Product and Web development again, which will change from the last five years I spent mostly in the world of systems software in C and Lua.</p>
<p>On that note, our Web stack is (typed) Python 3 / Flask and TypeScript / Angular, and I am looking for a full stack developer to join the team. This is a junior to mid position based in Paris, France (no remote); since most of the work is on the frontend experience with Python is not a requirement. If you are interested, <a href="https://catwell.info">get in touch</a>.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Goodbye Lima</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2019-02-15-goodbye-lima.html"
    />
    <id>tag:blog.separateconcerns.com,2019-02-15:goodbye-lima</id>
    <published>2019-02-15T19:40:00Z</published>
    <updated>2019-02-15T19:40:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>You may have heard it already: five years after I <a href="https://blog.separateconcerns.com/2013-12-12-infinity-beyond.html">joined Lima</a>, the company <a href="https://medium.com/@MeetLima/this-time-its-goodbye-5573a97be7d4">is shutting down</a>.</p>
<p>Obviously, things did not go like we hoped they would. Customers are disappointed, and wondering what will happen now. Let me try to answer some of the questions I read online the best I can.</p>
<blockquote>
<p>Please note that this is my personal take on things, and does not represent the views of anyone else but me (i.e. not Lima, not other employees&#8230;).</p>
</blockquote>
<section id="What-happened-to-the-company-exactly">
<h2>What happened to the company exactly?</h2>
<p>Lima as a company no longer exists. It ran out of money. Its employees (including me) have all been fired, and its assets will be sold to pay its debts.</p>
<p>Regarding why the company died, it is a long story and it is not my place to tell it all. What I can say is that it ran into unexpected funding problems in early 2017, shortly after we started shipping the Lima Ultra. During most of 2017, there was strong demand for the product but we could not fulfill it because we did not have enough cash to pay for production and shipping (Remember the never-ending waiting list?) At the end of the year, we had to fire a large part of the team and we switched our business model to sell our software to other companies. We made a deal where we worked for another startup. The deal was good enough to keep the company afloat and the product alive for a year, but it forced us to stop selling Lima devices. What happened recently is that this deal eventually fell through, leaving us with no viable options.</p>
<p>This past year was not the best time of my life, or for any of the other employees who stayed. Many of us could have left for much better jobs at any time, some did and I cannot blame them. All those who stayed on board all this time did so hoping for a better end for the company and its customers.</p>
</section>
<section id="What-will-happen-to-the-devices">
<h2>What will happen to the devices?</h2>
<p>Once Lima&#8217;s servers shut down, Lima will keep working on your local LAN with the devices you have already paired with it. However, a lot of things will stop working.</p>
<p>First, it won&#8217;t be possible to add new devices to the system. That&#8217;s because, when you log a new device into Lima, you do so with an email and password. To find out which Lima those credentials belong to, the system asks a server, and that server won&#8217;t answer anymore.</p>
<p>Second, it won&#8217;t be possible to reset your password, because email confirmation will be broken. If you have forgotten your password, change it now while the servers are still up.</p>
<p>Third, the sharing feature will be broken, because it relies on sending HTTP requests to relay servers which will go down as well.</p>
<p>Finally, it won&#8217;t be possible to access Lima from outside your home. This is a little harder to explain than the rest. Basically all communications between anything related to Lima (Lima devices, your devices, servers&#8230;) happen in a peer-to-peer VPN. To &#8220;locate&#8221; devices within the VPN (basically figure out how to talk to something), devices rely on a node which is called the ZVPN master. The IP address and public key of that node are hardcoded into every Lima client, and that node will go down as well. The use of that node is not needed on local networks because Lima devices and applications have a protocol to pair with other devices associated to the same account on a LAN without talking to any server.</p>
</section>
<section id="Is-there-a-risk-for-my-personal-data">
<h2>Is there a risk for my personal data?</h2>
<p>At that moment, not that I know of. Your data was never stored on Lima&#8217;s servers, and all data traffic going through relay servers is end-to-end encrypted, which means that even if an attacker took control of one they couldn&#8217;t decipher your data.</p>
<p>However in the long run there are two issues.</p>
<p>First, we won&#8217;t be able to publish updates for the Lima firmware and applications anymore. If a security issue is found in one of the components they use, they may become vulnerable with no way to fix them.</p>
<p>Second, if someone was to acquire all the assets or Lima, including the domain and code signing certificate, they could theoretically do everything Lima was able to do, including publishing updates. That means they could publish malicious updates of the applications and firmware.</p>
<p>That second issue sounds scary but I do not think there is any chance it will happen. Potential acquirers will probably be more interested in Lima&#8217;s technological IP, there are very few chances that an acquirer will get all the assets necessary for such an attack, and even if they do they probably won&#8217;t have an interest in performing it. Even if it did happen, it would be easy to notice. Still, I have to mention it for transparency.</p>
<p>What I will personally do now, and what I advise users to do as well, is <a href="https://lima.gitbook.io/support">export all my data out of Lima</a>, unplug the device and uninstall all the applications.</p>
<blockquote>
<p>Note: If you have problems when trying to recover your data (due to e.g. a hardware issue with the USB drive), <strong>do not</strong> uninstall the applications. The data on your desktop might sometimes help recovering some of the files.</p>
</blockquote>
<p>If you have an issue with the Decrypt Tool, check <a href="https://github.com/catwell/postlima">here</a> for potential answers.</p>
<p>EDIT (2022-02-06): What I feared when I wrote this post did happen a while ago. Someone did get hold of the <code>meetlima.com</code> domain and uses it to host what is clearly a scam. They want you to think they are us, but they are not. I do not think they have performed any attack on the devices themselves, but it is definitely not safe to keep using the original software anymore.</p>
</section>
<section id="What-can-users-replace-Lima-with">
<h2>What can users replace Lima with?</h2>
<p>It depends on the users. I don&#8217;t know anything that is exactly like Lima. There was Helixee, which I have never tried out, but I just found out they are <a href="http://www.helixee.me/end-of-adventure/">shutting down as well</a>. I also learned that a project I had never heard about before called Amber had a <a href="https://www.myamberlife.com/news/an-open-letter-to-lima-customers/">special offer for Lima customers</a>.</p>
<p>For technical people, you can probably do most of what you were doing with Lima with a Synology NAS, or a setup based on some small computer and Open Source software such as <a href="https://nextcloud.com">Nextcloud</a> or <a href="https://cozy.io">Cozy Cloud</a>.</p>
<p>However, Lima was never designed for technical customers. It was built for, marketed to and mostly bought by non-technical people. For them, I don&#8217;t have a good answer. I heard that <a href="https://mycloud.com">WD My Cloud Home</a> had become a lot better than it once was, but I have not tried it personally.</p>
</section>
<section id="Can-you-open-source-the-code">
<h2>Can you open-source the code?</h2>
<p>To the best of my knowledge, there is no way that can happen. This makes me extremely sad, especially since I know there are parts of the code I would <a href="http://lua-users.org/lists/lua-l/2018-11/msg00418.html">love to reuse myself</a>, and that could be useful to other projects.</p>
<p>The reason why we cannot open-source is that the code does not belong to us, the employees, or the CEO. Intellectual property is considered an asset of a bankrupt company, and as such will be sold to the highest bidder to pay the company&#8217;s debts.</p>
<p>That being said, Lima has contributed some source code to a few Open Source projects already. Most importantly we fixed the issues in OSXFUSE that prevented it from being used for something like Lima, and those fixes are now in the main branch.</p>
<p>Completely independently from the company, the former CTO of Lima has also released <a href="https://github.com/gawen/wirehub">a project</a> which looks a lot like a second, fully decentralized iteration of the Lima network layer ZVPN (using a DHT instead of a master node, and WireGuard instead of TLS). Let me be clear: this project contains no code or IP from Lima, it is a clean room implementation.</p>
</section>
<section id="Can-you-give-us-root-access-to-the-device">
<h2>Can you give us root access to the device?</h2>
<p>For Lima Original, no, I think that would be impossible (or rather, I can&#8217;t see a solution that doesn&#8217;t involve soldering&#8230;). The device is not worth much today anyway, its specs are so low I don&#8217;t think you could run any other private cloud software on it.</p>
<p>For Lima Ultra, a few of us ex-Lima employees (and the CEO) are trying to figure out a way to let users get root access. We can&#8217;t promise anything, but we will keep you informed if we do.</p>
<p>EDIT (2019-02-18): <a href="https://github.com/catwell/postlima">We did it, check this out!</a></p>
</section>
<section id="Why-does-it-say-something-different-in-the-Kickstarter-FAQ">
<h2>Why does it say something different in the Kickstarter FAQ?</h2>
<p>Some people have mentioned that what was happening was not in line with what had been said in the <a href="https://www.kickstarter.com/projects/cloud-guys/plug-the-brain-of-your-devices/faqs#project_faq_62443">Kickstarter FAQ</a>.</p>
<p>This FAQ has been written in 2013, before I or any other Lima developer joined the company. At the time Lima was a very small project with two founders trying to raise $70,000 to make their dream happen. Instead they raised $1,229,074, hired 12 people (including me), and the rest is history.</p>
<p>I do not think we have not communicated like that ever since, especially regarding decentralization. As far as what I know we have been transparent that our servers were needed for some major features of the product, as it was obvious the few times they went down. You may ask why we didn&#8217;t amend this page then, and the answer is (I think) that it is technically impossible to edit it after the campaign is over.</p>
<p>Regarding Open Source, I sincerely believe the CEO of Lima would have done it if it was possible, but with the success of the Kickstarter the company had to take VC funding very early on (see below), and from that moment on I do not think it was in his hands.</p>
</section>
<section id="Where-did-all-that-Kickstarter-money-go">
<h2>Where did all that Kickstarter money go?</h2>
<p>OK, let&#8217;s address this last. What Kickstarter money?</p>
<p>Yeah, the founders raised over a million dollar. But do you remember how much the backers paid for those devices? From $59 to $79 each. Well, as bad as the hardware was, it was planned for about 1000 devices, not over 10,000. And it was pretty expensive.</p>
<p>I don&#8217;t know the exact figures, but basically Lima did not make money on those devices, or no significant amount of money at least. Which is why it raised extra cash from VCs just afterwards, to pay the team that worked on the project, the production of more devices to sell, etc&#8230;</p>
<p>If you still think something shady went on with that money, rest assured: when a company like Lima goes bankrupt, its books are closely investigated by the state, which is one of its main creditors. So if you are right, the people responsible will end up in jail. (Spoiler: I really don&#8217;t think it will happen.)</p>
</section>
<section id="What-are-you-going-to-do-next">
<h2>What are you going to do next?</h2>
<p>Yes, I have plans.</p>
<p>No, they are not in any way related to Lima.</p>
<p>I will tell you more next month, probably.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Software Architecture Principles</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2019-02-15-architecture-principles.html"
    />
    <id>tag:blog.separateconcerns.com,2019-02-15:architecture-principles</id>
    <published>2019-02-15T10:20:00Z</published>
    <updated>2025-08-21T17:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>This is just a short post to share what I now consider, after 10 years in the industry (and almost twice as many writing code), my core software architecture principles.</p>
<p>You may or may not agree with them all, but if you design software or systems, you should have a similar list in your head; it really helps a lot when making decisions.</p>
<p>Without further ado, the principles are:</p>
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Separation_of_concerns">Separation of Concern</a> often trumps not repeating oneself (<a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a>). In other words, avoiding duplication does not justify introducing coupling.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/John_Gall_(author)#Gall%27s_law">Gall&#8217;s Law</a>: &#8220;A complex system that works is invariably found to have evolved from a simple system that worked.&#8221;</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Conway%27s_law">Conway&#8217;s Law</a>: &#8220;Organizations produce designs which are copies of their communication structures.&#8221;</p>
</li>
<li>
<p>When writing code or designing, stop and think &#8220;consequences&#8221;. What will be the impact of what you are doing on the rest of the systems? Could there be adverse side-effects?</p>
</li>
<li>
<p>Think about debuggability in production. There is nothing worse than having your software break and not being able to figure out why. Do not automate things you do not understand.</p>
</li>
<li>
<p><a href="https://programmingisterrible.com/post/139222674273/write-code-that-is-easy-to-delete-not-easy-to">Write code that is easy to delete, not easy to extend.</a></p>
</li>
<li>
<p><a href="https://lobste.rs/s/a1njck/what_trick_trade_took_you_too_long_learn#c_ml21et">Shorten feedback loops.</a> (added on 2025-08-21)</p>
</li>
</ul>

      </div>
    </content>
  </entry>
  <entry>
    <title>Fixing right click on touchpads in Gnome</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2018-03-30-gnome-touchpad.html"
    />
    <id>tag:blog.separateconcerns.com,2018-03-30:gnome-touchpad</id>
    <published>2018-03-30T19:00:00Z</published>
    <updated>2018-03-30T19:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>If you are like me, maybe you have recently updated your Linux laptop and found out that right click had stopped working on the touchpad. It took me half an hour to figure out why. I was looking at low-level stuff until I realized <code>libinput debug-events</code> saw the right thing:</p>
<pre><code class="language-text">event11  POINTER_BUTTON    +3.35s
    BTN_RIGHT (273) pressed, seat count: 1
event11  POINTER_BUTTON    +3.49s
    BTN_RIGHT (273) released, seat count:
</code></pre>
<p>It turns out Gnome decided to <a href="https://help.gnome.org/misc/release-notes/3.28/">change the default behavior of touchpads</a> in version 3.28:</p>
<blockquote>
<p>All touchpads now use a gesture for secondary click (the equivalent to right click on a mouse) by default. To use the gesture, keep one finger in contact with the touchpad and tap with another finger. In many cases this replaces tapping areas of the touchpad as the default secondary click method. A choice between the two behaviors is available in the Tweaks application.</p>
</blockquote>
<p>Of course the new behavior is terrible if you use physical clicks, plus you have to re-train your muscle memory&#8230; To revert to clicks in the bottom-right corner, you can use the gnome-tweaks application as advised, or simply this gsettings command:</p>
<pre><code class="language-shell">gsettings set org.gnome.desktop.peripherals.touchpad \
    click-method areas
</code></pre>
<p>But seriously, Gnome developers, if you are going to change an important default like that, why not at least add an option in the obvious place where it belongs?</p>
<p><img alt="gnome-touchpad-settings" src="img/gnome-touchpad-settings.jpg"/></p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Four years at Lima</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2018-01-06-four-years.html"
    />
    <id>tag:blog.separateconcerns.com,2018-01-06:four-years</id>
    <published>2018-01-06T14:10:00Z</published>
    <updated>2018-01-06T14:10:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Today marks the fourth birthday of <a href="https://blog.separateconcerns.com/2013-12-12-infinity-beyond.html">my joining Lima</a>, and it is a good occasion to talk a bit about some of the things I have been doing there.</p>
<section id="Distributed-filesystem-synchronization">
<h2>Distributed filesystem synchronization</h2>
<p>For the public, Lima makes a device which turns a USB hard drive into personal &#8220;cloud&#8221; data storage. We actually shipped two devices, Lima Original in July 2015 and Lima Ultra in Decemner 2016.</p>
<p>Technically, Lima is really a personal distributed filesystem. Every single machine running a Lima application logged into to the same user account is a node in the system. All nodes keep a copy of all the filesystem metadata, which means the user can always browse the whole file tree, create or remove files, move them around, etc. The actual data, however, may or may not be on the device, which makes it possible to access a multi-terabyte filesystem on a mobile device. In theory, the Lima device is just another node in the system, except it always stores all the data.</p>
<p>To make this all work, we need a mechanism to keep the filesystem metadata synchronized on all nodes. I have designed and implemented the algorithm and protocol behind this. It is tricky, because we always want users to be able to write to their filesystem, even on an offline device, so when devices come back online there may be conflicts to resolve. It is sometimes tempting to do something simple and correct, but which would not result in what the end user would expect. Yes, <a href="http://bravenewgeek.com/distributed-systems-are-a-ux-problem/">distributed systems are a UX problem</a>&#8230;</p>
<p>I can&#8217;t get into too much detail here, this being proprietary technology and all, but I have drawn a lot of inspiration from <a href="https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type">CRDTs</a> as well as older systems like Bayou and WinFS.</p>
</section>
<section id="Minicore:-fitting-into-a-tiny-box">
<h2>Minicore: fitting into a tiny box</h2>
<p>Like I said, in theory, the Lima device just runs a slightly modified Lima application. And in theory, theory and practice are the same thing. But in practice&#8230;</p>
<p>The Lima Original hardware was very limited, with a slow exotic CPU, 32 MB of RAM and 8 MB of Flash. At some point we realized that we would never succeed in running our software on it with reasonably good performance, so shortly before shipping we decided we had to do something radical: write entirely different software for it. We called that software &#8220;minicore&#8221;, and I wrote its first version in a 6-week rush.</p>
<p>Unlike the Lima filesystem, minicore is designed to be very conservative about its use of memory and I/O resources. It uses a different data model and synchronization protocol, which relies on client machines running Lima to do the heavy lifting. It prioritizes what Lima devices have to do best, which is downloading or serving file data.</p>
<p>The trade-off here was a huge increase in the complexity of the system. Minicore itself is not that complex, but we had to introduce a separate protocol between client nodes and Lima devices, and a third protocol to deal with replication between Lima devices (if you add several Lima devices to the same account they mirror one another).</p>
</section>
<section id="Other-things">
<h2>Other things</h2>
<p>I won&#8217;t get into too much detail about all the other things I have written or worked on over the last four years, but important ones include:</p>
<ul>
<li>
our build system, which builds our software and its dependencies on five different OSs and three major architectures ;
</li>
<li>
an integration test suite designed among other things to replicate timing-related edge cases for the synchronization protocol ;
</li>
<li>
our &#8220;identity server&#8221; which lets users log into their account with just an email and a password ;
</li>
<li>
our Lua scripting layer, which I didn&#8217;t implement initially but maintain now, and on which we rely more and more.
</li>
</ul>
</section>
<section id="What's-next">
<h2>What&#8217;s next</h2>
<p>Lately, my role has changed as I have become responsible for software architecture for the whole company. I now work more closely with the developers outside of my team (Core Engineering), who implement the user-facing parts of our stack. I also do some hiring - and by the way, if you are interested, get in touch. :)</p>
<p>All in all, it was four interesting years. Things have not always been easy to say the least, but a relaxing job is not what I expect from a startup anyway. We have some really great people on the team, challenging plans for the future, and we learn a lot, so here&#8217;s to the next years of Lima!</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>knetstat: checking socket options on Linux</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2017-06-11-knetstat.html"
    />
    <id>tag:blog.separateconcerns.com,2017-06-11:knetstat</id>
    <published>2017-06-11T19:10:00Z</published>
    <updated>2017-06-11T19:10:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>A few weeks ago I was debugging network code, and I needed to check if some
sockets were bound with <code>SO_REUSEADDR</code> and/or <code>SO_REUSEPORT</code>. I researched how
I could inspect that, and was surprised to find out that the Linux kernel did
not expose those options to userland.</p>
<p>Thankfully, there is
<a href="https://github.com/veithen/knetstat">a kernel module called knetstat</a>
which lets you do this very easily by adding new files into <code>procfs</code>. When I
found it it only supported TCP, but I needed the information for UDP as well so
I <a href="https://github.com/veithen/knetstat/pull/11">contributed the code</a> to
support it.</p>
<p>If you write networking code on Linux or just run servers, I encourage you to
check it out. It is a nice little tool that can come very handy in some
situations, including when you need to check options like <code>SO_{RCV,SND}BUF</code>.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>A short introduction to Interval Tree Clocks</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2017-05-07-itc.html"
    />
    <id>tag:blog.separateconcerns.com,2017-05-07:itc</id>
    <published>2017-05-07T14:30:00Z</published>
    <updated>2024-11-24T07:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>This post is a rough transcription of <a href="http://files.catwell.info/presentations/2017-04-dotscale-itc/">a lightning talk I gave at dotScale
2017</a>.</p>
</blockquote>
<blockquote>
<p>EDIT (2024-11-24): this post is <a href="https://news.ycombinator.com/item?id=42212543">on HN</a> today.
For people finding this now, <a href="https://blog.separateconcerns.com/2019-02-15-goodbye-lima.html">Lima has shut down</a> since then.</p>
</blockquote>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/PgCziibErvU?rel=0" frameborder="0" allowfullscreen="true"></iframe>
<p>One of the things I work on at <a href="https://blog.separateconcerns.com/2019-02-15-goodbye-lima.html">Lima</a> is master-master
filesystem replication. In this kind of system, we need to
<a href="http://queue.acm.org/detail.cfm?id=2917756">track causality</a>. In a nutshell,
given two events modifying a given piece of data and originating from different
nodes in the system, we want to know if one of those events could have
influenced the other one, or in other words if one of those events
<a href="https://en.wikipedia.org/wiki/Happened-before">&#8220;happened before&#8221;</a> the other
one.</p>
<p>To do that, we use constructs such as
<a href="https://en.wikipedia.org/wiki/Version_vector">Version vectors</a>. The idea is
that we give each node in the system a globally unique identifier, and we
associate it to a counter.</p>
<p><img alt="Version Vector" src="img/itc-vv.png"/></p>
<p>When an event modifying data on a node occurs,
we increment the local value of the corresponding counter by one.</p>
<p><img alt="inc" src="img/itc-vv-inc.png"/></p>
<p>Version Vectors are partially ordered. Given two vectors, if we can find one
such that, for every node, its counter is higher than the other one, then
we say it descends the other one, meaning the related event &#8220;happened after&#8221;
the other one. Otherwise, we say that the vectors are concurrent, and typically
that means we will probably have some kind of data conflict to solve.</p>
<p><img alt="compare" src="img/itc-vv-cmp.png"/></p>
<p>When we merge data changes we also merge the vectors, and to do so we take
the maximum value of the counter for every node.</p>
<p><img alt="merge" src="img/itc-vv-merge.png"/></p>
<p>This works fine in most cases, but there is one case where it breaks down:
highly dynamic systems experiencing a lot of churn. This means systems where
nodes join the system, modify some data, then leave forever. The issue with
such systems is that, even though there may not be a lot of active devices at
any given point in time, the number of unique node identifiers in version
vectors keeps increasing. We call that issue actor explosion.</p>
<p>Interval Tree Clocks are an attempt to solve this problem. Instead of
giving a unique identifier to every node in the system, we take the
real-valued interval <code>[0, 1]</code> and attribute a part of it (not necessarily
contiguous) to every node. On top of it, we draw an integer-valued curve.
We call the combination of the interval share and the curve a stamp.</p>
<p><img alt="stamp" src="img/itc-stamp.png"/></p>
<p>To add a new node to the system, we start from an existing node and we fork it,
meaning we give part of its share of the interval to the new node.</p>
<p><img alt="fork" src="img/itc-fork.png"/></p>
<p>When an event occurs on a node, it increases the height of the curve of its
copy of the stamp anywhere within its share of the interval. Comparison works
similarly to Version Vectors: if the curve of a stamp is above the other one,
it descends it, otherwise the curves intersect and the stamps are concurrent.</p>
<p>When a node wants to leave the system, it merges back with any other node and
surrenders its share of the interval. To merge, we just take the maximum
curve.</p>
<p><img alt="join" src="img/itc-join.png"/></p>
<p>The beauty of this scheme is that a node only has to know about its share of
the interval, not information about all other nodes. There are no globally
unique node identifiers.</p>
<p>If we choose how we increase the height of the curve when an event occurs in a
clever way which I will not detail here, we can ensure the complexity of the
curve remains low. We can then encode it efficiently using a tree-shaped data
structure and a custom binary format, with a size that depends more on the
number of nodes interacting with the data at a given point in time than
on the overall number of nodes which have touched it since inception.</p>
<p><img alt="results" src="img/itc-results.png"/></p>
<p>If you want to know more, I encourage you to read
<a href="https://gsd.di.uminho.pt/members/cbm/ps/itc2008.pdf">the 2008 paper</a> by Paulo Sérgio
Almeida, Carlos Baquero and Victor Fonte; it is one of the best I know on the
topic of causality. You can also check out <a href="https://github.com/catwell/cw-lua/tree/master/itc.lua">my Lua implementation of
ITC</a> or one of the other implementations
linked in the README.</p>
<p>EDIT (2024-11-24): other interesting resources are <a href="https://cbaquero.github.io/web/pdf/SDLtime2021.pdf">this slide deck by Carlos Baquero</a>
and <a href="https://ferd.ca/interval-tree-clocks.html">those</a> <a href="https://ferd.ca/a-bridge-over-a-river-never-crossed.html">posts</a> by Fred Hebert.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Goodbye Lua Toolbox</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2016-12-22-goodbye-lua-toolbox.html"
    />
    <id>tag:blog.separateconcerns.com,2016-12-22:goodbye-lua-toolbox</id>
    <published>2016-12-22T08:00:00Z</published>
    <updated>2016-12-22T08:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>In November 2013, I gave
<a href="http://files.catwell.info/presentations/2013-11-lua-workshop-lua-ecosystem">a talk</a>
about the Lua Ecosystem at <a href="https://www.lua.org/wshop13.html">Lua Workshop</a>, in
which I mentioned that finding the best module for some job could be hard and
introduced a website I had built to solve that problem.</p>
<p>That website, Lua Toolbox, was inspired by the popular
<a href="https://www.ruby-toolbox.com/">Ruby Toolbox</a>. It had two major features:
modules classification (&#8220;labels&#8221;) and endorsements by users. I had written it
using Leaf Corcoran&#8217;s relatively new Lua Web framework,
<a href="http://leafo.net/lapis/">Lapis</a>, and Redis as the datastore.</p>
<p><img alt="Lua Toolbox homepage" src="img/lua-toolbox.jpg"/></p>
<p>In August 2014, MoonRocks, one of Leaf&#8217;s many projects, became the official
website for LuaRocks. It offered many features including user accounts,
manifests and the ability to upload rocks on the Web. We quickly
<a href="https://github.com/catwell/lua-toolbox/issues/18">started to discuss</a>
merging Lua Toolbox into MoonRocks, but it led nowhere at first and the two
websites continued their separate lives.</p>
<p>Eventually, in March 2016, Etiene Dalcol
<a href="https://github.com/luarocks/luarocks-site/pull/86">took up the project</a>.
By September her and Leaf had written the code for labels and &#8220;follows&#8221;,
which replace endorsements. They also added a feature for users to convert
their Toolbox endorsements to LuaRocks follows. I sent them a data dump which
they imported into the production LuaRocks website, and I turned Lua Toolbox
read-only.</p>
<p>Today, I finally replaced the whole website by
<a href="https://lua-toolbox.com">a static page</a>
redirecting users to LuaRocks. In the end, the Toolbox had 232 users and
referenced 1217 modules. The source code
<a href="https://github.com/catwell/lua-toolbox">remains available</a> but
I would not advise you to do anything with it (it uses old Lapis APIs, from
a time where plain Lua support was not official).</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts 2</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2016-12-07-thoughts-2.html"
    />
    <id>tag:blog.separateconcerns.com,2016-12-07:thoughts-2</id>
    <published>2016-12-07T22:35:00Z</published>
    <updated>2016-12-07T22:35:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <section id="On-Call">
<h2>On Call</h2>
<p><a href="https://twitter.com/alicegoldfuss">Alice Goldfuss</a> started
<a href="https://blog.dbsmasher.com/2016/12/07/on-being-on-call.html">a debate</a> about having
developers on call. I am firmly in the camp of those who think it is a good
thing, probably because I was a sysadmin before being a software engineer.
But this means those developers must have the power to refuse to ship broken
code that may make the pager go off as well.</p>
<p>In fact, it is all about fostering the sense of ownership, which is the N.1
trait I look for in developers. And this won&#8217;t be the first time I have
<a href="https://twitter.com/pchapuis/status/222690433308966913">quoted great people</a>
<a href="https://blog.separateconcerns.com/2013-03-24-vogels-skills.html">saying similar things</a>!</p>
</section>
<section id="The-value-of-metrics">
<h2>The value of metrics</h2>
<p>Here is something people who haven&#8217;t worked in B2B software companies may not
understand: sometimes knowing your product&#8217;s metrics, how its users behave and
the market it is operating in can be more valuable than the product itself.
Small B2B2C software vendors often end up knowing things about their (huge)
customers&#8217; clients that the customers themselves don&#8217;t.</p>
<p>What that means is: if you provide third-party software to your users, ask the
third-party vendor what data points they collect, what they can do with them,
and if they can feed them back to you. And if you are the third-party vendor,
consider the value of that data, and maybe find clever ways to turn it into a
competitive advantage.</p>
</section>
<section id="Why-did-the-robot-do-that">
<h2>Why did the robot do that?</h2>
<p><a href="https://insights.sei.cmu.edu/sei_blog/2016/12/why-did-the-robot-do-that.html">Explaining why AI makes decisions</a>
is going to be very important in the years to come. Trusting algorithms is
hard for humans. This slows down adoption and progress the most in areas that
<a href="https://twitter.com/CalebWatney/status/747772853102084097">really</a>
<a href="https://blog.separateconcerns.com/2015-11-06-e-voting.html">matter</a>. So we
need a way to let concerned people &#8220;feel&#8221; why machines do things the way they
do it. Because writing papers is nice, but we all know simply telling people to
trust experts is never going to work. This means those topics are now
<a href="https://blog.separateconcerns.com/2016-09-16-thoughts-1.html#distributed-systems-are-a-ux-problem">also UX problems</a>.</p>
</section>
<section id="Can't-you-just">
<h2>Can&#8217;t you just&#8230;?</h2>
<p>Someone made a nice web page to answer a question we hear pretty often. :)</p>
<p>EDIT: That was about <code>cantyoujust.no</code> which does not exist anymore.</p>
</section>
<section id="Applications-and-Data">
<h2>Applications and Data</h2>
<p>Here is something I have been believing in for a long time: there is no good
technical reason why most Web-based application vendors force you to store
your data on <strong>their</strong> servers. It should be possible to use, say, a presentation
application from Google to edit slides stored on Microsoft&#8217;s servers.</p>
<p>Sadly, for reasons that probably have a lot to do with business models,
things like
<a href="https://unhosted.org/adventures/7/Adding-remote-storage-to-unhosted-web-apps.html">remoteStorage</a>
did not really take off. But I hope someone will revisit that idea someday,
and find a way to make it take off.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Thoughts 1</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2016-09-16-thoughts-1.html"
    />
    <id>tag:blog.separateconcerns.com,2016-09-16:thoughts-1</id>
    <published>2016-09-16T17:00:00Z</published>
    <updated>2016-09-16T17:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <section id="Thoughts">
<h2>Thoughts</h2>
<p>I have not found the motivation to write here for a while, so I will be trying
something new. This is the first of a series of posts which will be composed of
a few smaller unrelated snippets, mostly things I would usually post in a
smaller form on Twitter. They will relate to anything I will have found
interesting recently. Some will be practical and some will just be reflections
about a given topic.</p>
</section>
<section id="MSYS2">
<h2>MSYS2</h2>
<p>If, like me, you are mostly a Linux user but sometimes have to work on a
Windows machine, have a look at <a href="https://msys2.github.io/">MSYS2</a>. It allows
you to quickly get a decent environment set up, with Bash and a package manager,
(<a href="https://www.archlinux.org/pacman/">pacman</a>), which you can use to install
things like Git.</p>
</section>
<section id="Sailfish">
<h2>Sailfish</h2>
<p>I have had my <a href="https://jolla.com/jollac/">Jolla C</a> for two months now. I have
not spent as much time as I would like playing with it, but so far I am pretty
happy with Sailfish. Like <a href="https://en.wikipedia.org/wiki/WebOS">WebOS</a>, it
relies heavily on gestures, which makes most of the features of the phone
usable with the thumb of a single hand. There are not many applications in
the store so far but the default applications are good in general and most
Android applications work well, I could run <a href="https://blog.separateconcerns.com/2019-02-15-goodbye-lima.html">Lima</a> on it
without any problem for instance.</p>
<p>From a programmer&#8217;s point of view, it is all I hoped for. I went from zero to
Hello World on the device in less than an hour. Coding happens in QT Creator
and the UI of the application is described with
<a href="https://en.wikipedia.org/wiki/QML">QML</a>. The SDK ships with an emulator that
runs in VirtualBox, but also with a second virtual machine which is used to
compile code, which means you don&#8217;t have to install a cross-compiler on your
local machine. Applications, which are technically RPM packages, can be deployed
to hardware devices via USB or SSH over WiFi.</p>
<p>It also has to be noted that the native terminal application is very good,
much better than anything I saw on Android. A SSH client is included so it
can occasionally be used to log into a server.</p>
<p>The main reason I have not made that device my main phone yet is that its
battery life is much worse than that of my Android phone, but hopefully that
is something that can be solved.</p>
</section>
<section id="The-fractal-dimension-of-software">
<h2>The fractal dimension of software</h2>
<p>I stumbled upon <a href="https://twitter.com/jtolds/status/758716505320075266">an insightful tweet</a>
about software development time estimation. The larger the tasks we try to
estimate, the more wrong we will be. Maybe an estimate as a single number
representing time is not enough; maybe we should also try to figure out
the <a href="https://en.wikipedia.org/wiki/Fractal_dimension">fractal dimension</a>
of the job to be done.</p>
</section>
<section id="Distributed-systems-are-a-UX-problem">
<h2>Distributed systems are a UX problem</h2>
<p>Everyday I grow more convinced that
<a href="http://bravenewgeek.com/distributed-systems-are-a-ux-problem/">this is true</a>.
Not only of failure conditions, but even more so of things like reconciliation
strategies in case of causally concurrent events, for instance how to represent data with <a href="https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type">CRDTs</a>.</p>
<p>It is a problem, because people doing distributed systems often either do not
want to do UX, do not have the competence to do it, or just do not have the
permission. We tend to be at the bottom of the stack, and some people think it
would be a disaster to let us work on anything user-facing. On the other hand,
most people actively doing UX do not understand or care for distributed systems
issues.</p>
<p>The result of this is that, if we design without taking technical constraints
into account, we end up with systems that cannot be implemented without relying
on central authority. Add to that the fact that it is almost always much easier
to implement something in a centralized way, and you have one reason why the
Cloud is winning and distributed alternatives to popular services never seem
to take off.</p>
</section>
<section id="Palm">
<h2>Palm</h2>
<p>I stumbled upon two fantastic documents related to Palm recently. The first
is a series of blog posts called
<a href="http://lowendmac.com/2016/a-history-of-palm-part-1-before-the-palmpilot/">A History of Palm</a>.
Very interesting, even though I disagree with the conclusion of the fifth
post. What killed the Pre line at HP was not that WebOS did not take off; they
never let it a chance to. I have been using a Pre 3 for a long time (I had
pre-ordered it so I was one of the lucky few to have it in France) and it was
a fantastic device, extremely influential on future evolutions of both iOS and
Android (after all, the interface was the brainchild of
<a href="https://en.wikipedia.org/wiki/Mat%C3%ADas_Duarte">Mathias Duarte</a>). What ended
Palm&#8217;s legacy was the
<a href="https://en.wikipedia.org/wiki/Mark_Hurd#Resignation">eviction of Mark Hurd</a>
and his replacement with
<a href="https://en.wikipedia.org/wiki/L%C3%A9o_Apotheker">Léo Apotheker</a>,
who hates hardware. Probably one of the worst mistakes the HP board ever made.</p>
<p>The second document is the
<a href="https://archive.org/details/zen-of-palm">Zen of Palm</a>,
a design guide for Palm OS from 2003 which is still pretty relevant today
in some ways.</p>
</section>
<section id="Is-preemption-the-root-of-all-evil">
<h2>Is preemption the root of all evil?</h2>
<p>Two decades years ago <a href="https://en.wikipedia.org/wiki/Computer_multitasking#Cooperative_multitasking">cooperative scheduling</a> was more frequent than
preemptive scheduling. Windows 3.1 was completely cooperatively scheduled,
which means that all applications had to yield to the system scheduler, or
they would block the whole system. In Mac OS 9, the threading API was
cooperative as well within a process, even though different applications would
be scheduled preemptively by the kernel.</p>
<p>Modern OSs do not make much distinction between a thread and a process anymore,
threads are basically processes which share memory, and they are scheduled
preemptively. I have come to think that this design results in code of lower
quality, and which is harder to reason about. Of course, it is still possible
to use event loops or programming languages which do their own preemptive
scheduling (like Lua)&#8230;</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>The LMDB file format</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2016-04-03-lmdb-format.html"
    />
    <id>tag:blog.separateconcerns.com,2016-04-03:lmdb-format</id>
    <published>2016-04-03T23:00:00Z</published>
    <updated>2016-04-03T23:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>At <a href="https://blog.separateconcerns.com/2019-02-15-goodbye-lima.html">Lima</a>, we use
<a href="https://www.symas.com/lmdb">the LMDB database</a> extensively, and we looked into its
source code in order to debug a few issues we had. To help us diagnose broken
databases, and also because I wanted to learn more about it, I wrote <a href="https://github.com/catwell/cw-lua/tree/master/lua-mdb">a parser
for the LMDB database file format in
Lua</a> in my spare time,
which I published under the Open Source MIT license.</p>
<p>In this post, I will give an overview of how a data.mdb file is structured.
Note that I will sometimes skip over some things and operate under the
assumption that you are running on a little-endian platform with 4 kB pages,
etc.</p>
<section id="Portability">
<h2>Portability</h2>
<p>The first thing to know is that the data.mdb format is platform-specific,
which means that you cannot necessarily open a database created on a machine
on another one. In practice, on ARM and x86, the only thing you have to care
about is whether the machine is 32 or 64 bits. On a 64 bit machine, you can
read the data from a 32 bit database by exporting it to a text format using
the <code>mdb_dump</code> utility compiled in 32 bits and reimporting it with a 64 bits
<code>mdb_load</code>. With lua-mdb, you can read a 32 bits database directly by passing
the <code>bits</code> option to the constructor.</p>
</section>
<section id="Pages">
<h2>Pages</h2>
<p>A data.mdb file is made to be mapped into memory, and as such is organized into
a set pages of 4 kB. All pages start with a header which contains the page
number and some flags which determine the type of the page. For all page types
except overflow pages, the header also includes the bounds of the free space
in the page.</p>
</section>
<section id="Meta-pages">
<h2>Meta pages</h2>
<p>The first two pages (page numbers 0 and 1) are called meta pages. Meta pages
start with a magic number (<code>0xBEEFC0DE</code>), a version (currently 1), and the
address and size of the memory mapping. The address is only valid if the
mapping is fixed,
i.e. if LMDB is used with the option <code>MDB_FIXEDMAP</code>.</p>
<p>After that, we find two structures describing what LMDB calls databases.
The first one is the &#8220;free&#8221; database, which is used to track free pages,
and the second one is the &#8220;main&#8221; database.</p>
<p>Finally come the number of the last page used in the file and the ID of
the last transaction that wrote to the page successfully. Indeed, those meta
pages is the mechanism LMDB uses to implement
<a href="https://en.wikipedia.org/wiki/Multiversion_concurrency_control">MVCC</a>.
There can be a single writer at a time, and it will always write to page ID
<code>N % 2</code>, where <code>N</code> is the current write transaction ID. Meanwhile, readers will
read page <code>N % 2 + 1</code>, providing readers - writer isolation. This means that,
when opening a .mdb file, the latest data can be found in the databases pointed
to by the meta page with the highest transaction ID.</p>
</section>
<section id="Databases">
<h2>Databases</h2>
<p>As we saw, a meta page contains two structures describing databases. Databases
in LMDB are technically B+ trees. The structures contain some environment flags
used at runtime, information about the tree including its depth, the number
of pages of each type and the total number of entries, and finally the page
number of the root of the tree.</p>
<p>Pages of the tree itself can be one of three types: branch pages, leaf pages
and overflow pages. There are two other types (<code>BRANCH2</code> and <code>SUBP</code>) which are
only used with specific DB options (<code>MDB_DUPFIXED</code> and <code>MDB_DUPSORT</code>) and that
we will ignore.</p>
</section>
<section id="Branch-pages">
<h2>Branch pages</h2>
<p>Branch pages represent internal nodes of the tree. After the header, they
contain an array of &#8220;pointers&#8221; (technically, 16 bit indices within the page)
to &#8220;branch nodes&#8221; within that page. The number of branch nodes, which is the
number of keys in the page, can be deduced from the boundaries of the free
space in the header.</p>
<p>Branch nodes are allocated from the bottom of the page up. They start with a
page number, then a key prefixed by its size. Branch node pointers are sorted
according to the key and the current key comparison function, and the page
number indicates the page which should be visited to look up keys between the
key of the node (included) and the key of the next node. That page can be a
branch or a leaf.</p>
</section>
<section id="Leaf-pages">
<h2>Leaf pages</h2>
<p>Like branch pages, leaf pages start with a number of pointers to leaf nodes.
Leaves store the actual keys and values contained into the DB. Small values
are stored in the leaf node itself and large values are stored in overflow
pages.</p>
<p>Leaf nodes are slightly more complex than branch nodes. They contain flags,
which determine if the value is contained in the node or in an overflow page,
and the key which corresponds to the node. For small values, they contain the
value itself, and for larger values they contain the page number of the
corresponding overflow page.</p>
</section>
<section id="Overflow-pages">
<h2>Overflow pages</h2>
<p>Large values are stored in so-called overflow pages. Those pages are pretty
simple: after the header, they contain the raw value (not prefixed by its size).
This value can be larger than the size of a page, which explains the name:
they overflow on later pages. Note that this means those later pages do not
start by the usual header.</p>
</section>
<section id="Learning-more">
<h2>Learning more</h2>
<p>I have explained the basics of the data.mdb file format. Should you have to
debug broken databases, it will help you get started. If you need more, read
<a href="https://github.com/catwell/cw-lua/tree/master/lua-mdb">the lua-mdb source code</a>
or <a href="https://github.com/LMDB/lmdb">the LMDB source code</a> (it is only about 10000
lines, although sometimes not easy to understand given that its author adopts a
style that favors performance to readability).</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Five books I read in 2015</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2016-01-03-five-books-2015.html"
    />
    <id>tag:blog.separateconcerns.com,2016-01-03:five-books-2015</id>
    <published>2016-01-03T11:40:00Z</published>
    <updated>2016-01-03T11:40:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>It is that time of the year where my RSS feed fills with book recommendations,
so I decided I would try my hand at the exercise this year and write a short
paragraph about five books I read in 2015 that left me with a good impression.</p>
<section id="The-Year-Without-Pants---Scott-Berkun">
<h2><a href="https://www.amazon.com/gp/product/1118660633/">The Year Without Pants - Scott Berkun</a></h2>
<p>Scott Berkun was a management writer and consultant when he was hired by
WordPress. Before that, he had been a UX designer and team lead at Microsoft,
on the Internet Explorer project. When he joined WordPress, the company had
over 50 employees, it was completely flat and had a culture of remote work.
The founder wanted to experiment with a team-based structure, and Scott was
to be the first team lead.</p>
<p>The book is not a story about how WordPress was a doomed company, and how
Scott came in to save the day. On the contrary, WordPress was already working
much better than most companies that size, and Scott was part of a series of
changes they implemented to scale to the next level without losing too much
of their culture.</p>
<p>That culture, rooted in Open Source and documented by Berkun, an outsider,
is what makes the book interesting. I would say it is a must read for
anybody considering starting or leading a team at a small software company.</p>
</section>
<section id="The-Open-Organization---Jim-Whitehurst">
<h2><a href="https://www.amazon.com/gp/product/1625275277/">The Open Organization - Jim Whitehurst</a></h2>
<p>This book is somehow similar to the one above, but on a larger scale.
Jim Whitehurst is the current CEO of Red Hat, a company with over $1.5B in
yearly revenue, over 8000 employees, and a culture firmly rooted in Open
Source (I started using Linux with their distribution, Red Hat 6.2, in 2000).</p>
<p>Before joining Red Hat, Whitehurst was COO of Delta Airlines. When he arrived
at Red Hat, he quickly realized it was a company that worked in a very
different way, following the core values of Open Source, transparency and
meritocracy (Whitehurst uses the word with the meaning it had in the
Free Software community in the 90s and 00s, without the background that makes
it controversial nowadays).</p>
<p>The book is both analytical and prescriptive, and it shows how the way
Open Source projects are organized can be successfully adopted by a large
company.</p>
</section>
<section id="The-Systems-Bible-Systemantics---John-Gall">
<h2><a href="https://www.amazon.com/gp/product/0961825170/">The Systems Bible (Systemantics) - John Gall</a></h2>
<p>A 1975 classic. Gall is a (retired) pediatrician, but he is well-known in
software engineering circles for this book which contains, among other things,
what is now known as Gall&#8217;s Law:</p>
<blockquote>
<p>A complex system that works is invariably found to have evolved from a simple
system that worked. A complex system designed from scratch never works and
cannot be patched up to make it work.</p>
</blockquote>
<p>The book is a curious mix of humor and philosophy, written in faux-scientific
style and full of things which people working in Distributed Systems will be
painfully aware of:</p>
<blockquote>
<p>In complex systems, malfunction and even total non-function may not be
detectable for long periods, if ever.</p>
</blockquote>
<blockquote>
<p>Any large system is going to be operating most of the time in failure mode.</p>
</blockquote>
<blockquote>
<p>Intermittent failure is the hardest case.</p>
</blockquote>
<blockquote>
<p>One does <strong>not</strong> know all the expected effects of known bugs.</p>
</blockquote>
<blockquote>
<p>In setting up a new system, tread softly. You may be disturbing another
system that is actually working.</p>
</blockquote>
<blockquote>
<p>Bad design can rarely be overcome by more design, whether good or bad.</p>
</blockquote>
<blockquote>
<p>A system that ignores feedback has already begun the process of terminal
instability.</p>
</blockquote>
<blockquote>
<p>In dealing with large systems, the striving for perfection is a serious
imperfection.</p>
</blockquote>
<p>Remember: this book is originally not about <strong>computer</strong> systems. Not at all.
But read it anyway!</p>
</section>
<section id="The-Four-Steps-to-the-Epiphany---Steve-Blank">
<h2><a href="https://www.amazon.com/gp/product/0989200507/">The Four Steps to the Epiphany - Steve Blank</a></h2>
<p>I have read <a href="https://www.amazon.com/gp/product/B004J4XGN6/">several</a> <a href="https://www.amazon.com/gp/product/1492180742/">other</a>
<a href="https://www.amazon.com/gp/product/111829534X/">books</a> <a href="https://www.amazon.com/gp/product/B006UKFFE0/">about</a> Lean Startup,
but this is the one I would recommend now, especially if you already have
some experience with startups.</p>
<p>It exposes the Customer Development model, composed of four steps:
Customer Discovery, Customer Validation, Customer Creation and Company
Building. The most interesting ones, in my opinion, are the first two,
the ones that occur before Product / Market Fit.</p>
<p>Read this book if you want to understand what this Lean Startup thing is
about, and offer it to your friends who want to start their own business.</p>
</section>
<section id="Flash-Boys:-Not-So-Fast---Peter-Kovac">
<h2><a href="https://www.amazon.com/gp/product/0692336907/">Flash Boys: Not So Fast - Peter Kovac</a></h2>
<p>This book is an answer to Michael Lewis&#8217; Flash Boys and a defence of
High-Frequency Trading.</p>
<p>I have long thought that the financial world used HFT as a scapegoat
(especially since I read
<a href="https://www.chrisstucchio.com/blog/2012/hft_apology.html">Chris Stucchio&#8217;s blog</a>).
Flash Boys: Not So Fast follows the structure of Lewis&#8217; book; it provides a
nice overview of what HFT is and why it may not be as evil as you think it is.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Electronic Voting</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2015-11-06-e-voting.html"
    />
    <id>tag:blog.separateconcerns.com,2015-11-06:e-voting</id>
    <published>2015-11-06T23:20:00Z</published>
    <updated>2015-11-06T23:20:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>French politician Axelle Lemaire
<a href="https://twitter.com/axellelemaire/status/662247104123904001">tweeted</a>
today that, like half of French voters, she was in favor of electronic voting.
This tweet has resulted in a strong reaction among most of my techno-saavy
friends which could be summed up as &#8220;OMG no, e-voting cannot be secure,
please educate yourself&#8221;.</p>
<p>On this topic, my views differ with the majority opinion among people in
technology, even though I support the same organizations fighting abuses
in e-voting such as
<a href="https://www.eff.org/issues/e-voting">Electronic Frontier Foundation</a>.</p>
<p>If you speak French, please read
<a href="http://binaire.blog.lemonde.fr/2015/01/19/quest-ce-quun-bon-systeme-de-vote/">these</a>
<a href="http://binaire.blog.lemonde.fr/2015/01/29/le-vote-papier-est-il-reellement-plus-sur-que-lelectronique/">three</a>
<a href="http://binaire.blog.lemonde.fr/2015/03/16/les-bonnes-proprietes-dun-systeme-de-vote-electronique/">articles</a>
by LORIA reasearcher Véronique Cortier. They may change your mind on e-voting
somehow. In particular, she argues that, although e-voting cannot be as secure
as physical voting, it could very well be better than absentee voting.</p>
<p>Véronique is one of the researchers working on
<a href="https://www.belenios.org">Belenios</a>, which is
<a href="https://github.com/glondu/belenios">Open Source</a> and
<a href="http://www.loria.fr/~cortier/Belenios.pdf">scientifically proven</a>
e-voting software. Belenios provides privacy, verifiability and full
correctness, properties which many erroneously think cannot be satisfied
simultaneously.</p>
<p>I am not denying that there are issues that will be hard or impossible to
solve. The two main ones, for me, are the security of client terminals and
the capacity for random citizen to trust the process. Indeed, understanding
and verifying something like Belenios requires relative proficiency in
math and computer science. I am willing to let the scientific community
do that work, but some consider this view elitist.</p>
<p>However, I would like to see more research and experiments with e-voting.
I think that making the organization of votes easier and cheaper will allow
our political systems to evolve towards something where citizen have more
direct influence on the democratic process.</p>
<blockquote>
<p>I have to disclose that I know one of the authors of Belenios
(<a href="http://stephane.glondu.net/">Stéphane Glondu</a>) personally, which is how I
came to learn about systems like Helios and Belenios in the first place.</p>
</blockquote>

      </div>
    </content>
  </entry>
  <entry>
    <title>Four easy reads to understand distributed systems issues</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2015-07-07-four-easy-reads-distsys.html"
    />
    <id>tag:blog.separateconcerns.com,2015-07-07:four-easy-reads-distsys</id>
    <published>2015-07-07T09:00:00Z</published>
    <updated>2016-05-16T17:20:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Even among software people, those of us who work with distributed systems and algorithms are sometimes seen as mad scientists. We use words like like consistency, causality, consensus, commutativity, idempotence, immutability and &#8220;impossibility theorems&#8221;. How come we have to read papers and tear our hair out just to make software run correctly on a few machines? Are we all failed academics incapable of pragmatism?</p>
<p>I have selected four documents to help you understand the kind of things we spend our days thinking about, the physical limits we work with and the trade-offs we make. You may want to read them, because distribution is becoming the norm rather than the exception, so you may have to think about at least some of those issues sooner than you expected. Those are simple documents that any programmer should be able to read. Only the last one is an actual paper, and it is a simple position paper with no math, I promise.</p>
<section id="There-is-No-Now">
<h2><a href="https://queue.acm.org/detail.cfm?id=2745385">There is No Now</a></h2>
<p>Most distributed systems are <strong>asynchronous</strong>, which means that the usual notion of time does not make sense within them. This article by Justin Sheehy, former Basho CTO (now at VMWare), published in ACM Queue in March 2015, is about that fact and its consequences. It inspired me to make this list, because as soon as I read it my first thought was that I should share it with all of my colleagues and every single person I will ever work with. It introduces two important impossibility theorems (FLP and CAP) and adversarial models, discusses the existence of &#8220;reliable&#8221; clocks and networks, and touches on some solutions such as consensus protocols and CRDT.</p>
</section>
<section id="Eventually-Consistent---Revisited">
<h2><a href="http://www.allthingsdistributed.com/2008/12/eventually_consistent.html">Eventually Consistent - Revisited</a></h2>
<p>This 2008 blog post by Werner Vogel (Amazon CTO) explains the trade-off between availability and consistency, introduces consistency models, and hints at the relationship between the replication factor of data and the level of consistency that can be achieved. If you want to go further after that, you can read the famous Dynamo paper (which is not too complicated), preferably in <a href="http://docs.basho.com/riak/2.0.1/theory/dynamo/">its version annotated by Basho</a>.</p>
</section>
<section id="Distributed-systems-for-fun-and-profit">
<h2><a href="http://book.mixu.net/distsys/">Distributed systems for fun and profit</a></h2>
<p>This document, by Mikito Takada (Trifacta), is longer than the others. It is the best short (meaning: not a whole course or book) introduction to distributed systems I know. In a nutshell, it expands on the ideas presented in the first two documents and gives you most of the necessary concepts and vocabulary to understand actual distributed systems papers, should you want to read them.</p>
</section>
<section id="Building-on-quicksand">
<h2><a href="https://arxiv.org/abs/0909.1788">Building on quicksand</a></h2>
<p>I could hardly leave that 2009 paper by Pat Helland and Dave Campbell out of this list. It starts with the idea that, as the distribution of systems increases, latency makes synchronicity intractable and pushes us towards asynchronous designs. The rest of the paper is a discussion of the trade-offs involved. The very interesting idea in that paper (also found in other papers by Pat Helland) is that it all comes down to a problem of risk management and reconciliation. If asynchronous software can not ensure something will happen, it may make a guess and fix the result later if it was wrong. That may include having to make excuses to an actual human being. An important corollary is that the distributed nature of software permeates <a href="http://bravenewgeek.com/distributed-systems-are-a-ux-problem/">all the way to the user interface</a> (which is why you may have seen me ranting about how we need to start forming cross-functional teams, with developers who understand UX and designers who get distributed systems).</p>
</section>
<section id="Bonus:-Why-Logical-Clocks-are-Easy">
<h2>Bonus: <a href="http://queue.acm.org/detail.cfm?id=2917756">Why Logical Clocks are Easy</a></h2>
<p>I said on Hacker News that, if I wrote that article today (in May 2016), I would add this article to the list. I <a href="https://news.ycombinator.com/item?id=11690113">was advised</a> to edit the original blog post, so I did.</p>
<p>Published in April 2016 in ACM Queue, this article by Carlos Baquero and Nuno Preguiça may be the best introduction to causality I know. Causality is a very important concept in distributed systems. In a nutshell, the idea is to answer the question: given two events, could one have influenced the other? In other words: when the entity performing the second event did, dit it have any knowledge that the first happened? This article introduces causality and gives usual ways to represent it in theory, with causal histories, and in practice, with vector clocks and version vectors as well as their dotted variants.</p>
</section>
<section id="Conclusion">
<h2>Conclusion</h2>
<p>When I started programming as a child, I was hooked by the idea that the computer was a perfect machine that, unlike a teacher, would never be unjust: it would work if I got the code right, and if I did not I just had to fix it and try again. Once it worked, it would always work! Everything was reproducible, and all issues could be diagnosed and understood.</p>
<p>Of course, I grew up and the messy reality caught up with me. I went into distributed systems, which are a lot more like physics than maths. There are laws that govern the world out there, and they are always coming in your way. Everything works as expected, until something unexpected happens. And sometimes, you will not even be able to explain what it was after the fact.</p>
<p>Distributed systems work is about that adversarial world out there, and how we write programs to cope with it. It is about dealing with the unreliability of clocks, communications, hardware and, sometimes, people. It is about reading papers, drawing diagrams, writing proofs sometimes, and finding solutions to obtain the guarantees we want. More than anything else, distributed systems is the science (or art? or game?) of trade-offs. It is hard, error-prone and <a href="https://aphyr.com/tags/jepsen">usually broken</a>, <a href="https://en.wikipedia.org/wiki/Paxos_%28computer_science%29">terribly</a> <a href="https://en.wikipedia.org/wiki/Byzantine_fault_tolerance">complicated</a> sometimes, but it is my field, and so far I like it.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>My love-hate relationship with LuaJIT</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2015-06-18-love-hate-luajit.html"
    />
    <id>tag:blog.separateconcerns.com,2015-06-18:love-hate-luajit</id>
    <published>2015-06-18T02:00:00Z</published>
    <updated>2015-06-18T02:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <blockquote>
<p>Clarification: The title is exaggerated. I have never hated LuaJIT, I just went back to using PUC Lua primarily.</p>
</blockquote>
<p>I started using Lua in early 2007. I had already been programming for years, but I had reached a point where I had decided that I wanted to know exactly what was going on when my computer executed dynamic code. That meant understanding two critical pieces of the software stack: the OS and the interpreter.</p>
<p>I already had notions of how an interpreter works and I could tell the main functions of a Unix kernel, but really understanding software, for me, implied reading its source code. I quickly realized that I would not succeed if I started with Perl or Python and Linux, which were what I was using at the time, so I set my sights on Lua and Minix3.</p>
<p>Knowing software also implies using it, so Minix3 and Lua became my main OS and language for several months. To be honest, I was running Minix3 in a VM due to the lack of drivers for my hardware. I started to study their code, with the help of <a href="http://www.minix3.org/doc/#book">the book</a> for Minix3 and resources found online for Lua. I learnt a lot during that period.</p>
<p>Eventually, I went back to Linux for practical reasons, but I had been charmed by the down-to-Earth elegance of Lua. It became my favorite programming language. I was still a student though, so I mostly wrote small utilities, Web pages and game prototypes with it. Coursework was Java, Python and C, and for &#8220;serious&#8221; stuff at <a href="http://resel.fr/">ResEl</a> I used Perl, Python or Bash.</p>
<p>Then in 2010 I went to <a href="https://moodstocks.com/">Moodstocks</a> for my MSc Thesis. We were a very tiny startup then, just the founders and a couple of interns. They were a Ruby and C++ shop, so I learnt Ruby, but I didn&#8217;t like it: too much magic, and the object-oriented interface to write bindings was a mess compared to the very clean Lua C API.</p>
<p>Eventually, Moodstocks hired me and I worked for them for over three years. I ended up writing most of their server-side code, I already gave <a href="https://blog.separateconcerns.com/2013-06-20-three-years-proprietary-projects.html">details here</a>. A lot of that code leveraged LuaJIT. It was the perfect tool for the job: as flexible and dynamic as Ruby so it worked well as a scripting language, about as fast as C++ so it could be used to implement Computer Vision algorithms, and the FFI made it very easy to call into our existing C / C++ libraries.</p>
<p>Those are the features that make LuaJIT so attractive: its blazing speed and the FFI. They are why I could write Lua professionally for several years, and I could never thank Mike Pall enough for this. Moreover, LuaJIT has been playing a huge role in the growing popularity of Lua those last few years.</p>
<p>However, paradoxically, LuaJIT negates the very reason that made me pick Lua in the first place. And by that I mean: I do not deeply understand how LuaJIT works. I have tried, and I will certainly try again, but it is one or two orders of magnitude more complicated than PUC Lua.</p>
<p>Beyond the purist ideal of understanding the whole stack, this has practical implications. When you find a bug in LuaJIT, understanding it and fixing it is terribly complicated. The best I can do is usually to try to produce a small test case that reproduces the bug (even that is not always easy) and hope Mike Pall finds a fix. With PUC Lua I could probably fix it myself - but of course PUC Lua is so simple that I have never found a bug in it!</p>
<p>Another issue is that PUC Lua and LuaJIT are diverging. LuaJIT implements Lua 5.1. Lua 5.2 code can be made to work as long as it does not use <code>_ENV</code>, but code that leverages the new features in Lua 5.3 is not supported at all (although modules like <a href="https://github.com/keplerproject/lua-compat-5.3">lua-compat-5.3</a> can probably help). On the other hand, more and more modules require the FFI, making them incompatible with PUC Lua (of course <a href="https://github.com/catwell/luajit-msgpack-pure">I am a culprit of that myself</a>). And to top it all, the interpreters work so differently that efficient code in LuaJIT is not necessarily good in PUC Lua, and vice versa.</p>
<p>These days, the purist, simplicity-loving part of me tends to win over the pragmatist in my (rare) non-work code, and my current target of choice is PUC Lua. At work, I write almost exclusively C and almost no Lua, and the little I do write runs on <a href="https://blog.separateconcerns.com/2019-02-15-goodbye-lima.html">a machine</a> which does not support LuaJIT. The only reasons I still use LuaJIT are maintenance of luajit-msgpack-pure and my use of OpenResty, which for my purposes could as well be built with PUC Lua instead.</p>
<p>That being said, I like knowing that I could take my Lua code and, with a few tweaks and a change of interpreter, get a serious performance boost. So I still hope someone (if not Mike Pall) will make a version of LuaJIT that supports the Lua 5.3 interface. Otherwise, I guess I can still decide that learning more about JIT compilation is worth it and spend a few months diving into that LuaJIT codebase!</p>
<p>Oh, and by the way, with this whole systemd thing, I am semi-seriously considering giving Minix3 a second chance :)</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Continuous Integration for Lua with Travis</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2015-03-08-travis-lua.html"
    />
    <id>tag:blog.separateconcerns.com,2015-03-08:travis-lua</id>
    <published>2015-03-08T12:00:00Z</published>
    <updated>2015-10-16T16:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p><a href="https://travis-ci.org">Travis</a> is a Continuous Integration service which is free for Open Source projects and has very good GitHub integration. We will see how to use it for your Lua projects.</p>
<p>Your test suite will work well with Travis as long as executing it returns 0 on success and nonzero on failure. If you use plain Lua assertions, it is already the case. If you use a test framework, make sure that it works that way. I have added <a href="https://github.com/catwell/cwtest#exit">a helper</a> to cwtest for that purpose.</p>
<p>Travis does not support Lua out of the box, but using it with Lua projects is not hard because <a href="https://github.com/moteus">moteus</a> has done all the hard work for you. You just have to clone <a href="https://github.com/moteus/lua-travis-example">this repository</a> and copy the <code>.travis</code> directory to yours.</p>
<p>After that, you only have to write a single YAML file, <code>.travis.yml</code>. For example, here is <a href="https://github.com/catwell/haricot/blob/2d5320633c76f14f12c0d8486606de4b9d95c015/.travis.yml">the one I wrote for Haricot</a>.</p>
<p>Most sections should be self-explanatory. <code>install</code> is where you set up your dependencies. The first line calls moteus&#8217; script which lets you use Lua and LuaRocks. A separate build and test run will occur for every Lua version declared in <code>matrix</code>; you can comment some lines there if you do not want to test some Lua versions. For Haricot I need <a href="http://kr.github.io/beanstalkd/">Beanstalk</a> running in the background so I start it in <code>before_script</code>. <code>script</code> is where you run your actual tests.</p>
<p>To enable Travis, sign up, allow Travis to access your GitHub account, then go to <a href="https://travis-ci.org/profile">your profile</a> and flip the switch for your repository:</p>
<p><img alt="travis" src="img/travis.png"/></p>
<p>After that, commit <code>.travis</code> and <code>.travis.yml</code> and push to GitHub. It will trigger a test build, and so will every subsequent commit. If you want, you can now add <a href="https://travis-ci.org/catwell/haricot.png?branch=master">a badge</a> with the status of your build to your README or your project&#8217;s home page.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Indie Web</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2015-01-04-indie-web.html"
    />
    <id>tag:blog.separateconcerns.com,2015-01-04:indie-web</id>
    <published>2015-01-04T20:10:00Z</published>
    <updated>2015-01-04T20:10:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>It is not a secret that I don&#8217;t like Web technology. I prefer XHTML to HTML5, I think JavaScript is a terrible language, and don&#8217;t get me started on microformats (let&#8217;s just say that SoC &gt; DRY&#8230;). I&#8217;d rather see this mess replaced by something much simpler that <strong>only</strong> deals with linked documents and feeds, and maybe a separate platform for portable applications.</p>
<p>However, the Web is here to last, and given its importance, its centralization is concerning. This is why I am interested in the <a href="http://indiewebcamp.com/">Indie Web</a> movement, which I see as part of the larger effort to decentralize Internet. By the way, if you are into this and live in Paris, check out <a href="http://www.meetup.com/Paris-Meetup-pour-la-decentralisation-dInternet/">this meetup</a> which is held every six weeks at Mozilla&#8217;s office. I have been there every time since its inception and it is well worth it.</p>
<p>Anyway, I have seen today via my feed reader that <a href="http://tantek.com/2014/357/b1/2015-indieweb-site-launch-commitment">some people had made commitments for 2015-01-01</a>. I am a bit late, but I decided to follow suit by adding <a href="http://indiewebcamp.com/Why_web_sign-in">Web sign-in</a> and <a href="http://indiewebcamp.com/h-card">a h-card</a> to <a href="https://catwell.info">my home page</a>. I will probably add <a href="http://indiewebcamp.com/h-entry">h-entry</a> markup to this blog later this week, too.</p>
<p>If you want to do the same, you can use <a href="http://indiewebify.me/">this handy tool</a> to check everything is working.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Lean tools</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-11-23-lean-tools.html"
    />
    <id>tag:blog.separateconcerns.com,2014-11-23:lean-tools</id>
    <published>2014-11-23T21:45:00Z</published>
    <updated>2014-11-23T21:45:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Two people I respect a lot, <a href="https://avdi.codes/about/">Avdi Grimm</a> and <a href="http://soveran.com/">Michel Martens</a>, are having <a href="http://devblog.avdi.org/2014/11/21/in-defense-of-fat-tools/">an interesting debate</a> about the complexity of programming tools and libraries.</p>
<p>In the Ruby community, Michel is well-known for writing simple tools that do their job well. Avdi defends the framework approach of Rails, arguing that using fatter tools allows you to make your own code simpler. If you want to hear them debate it, listen to <a href="https://topenddevs.com/podcasts/ruby-rogues/episodes/182-rr-keeping-libraries-and-utilities-small-and-simple-with-michel-martens">the podcast</a>.</p>
<p>It will not surprise people who know me that I side with Michel here. Actually, I am probably more extreme than he is: I used his <a href="https://github.com/soveran/ohm">Redis Object Mapper</a> at Moodstocks some years ago, but I eventually went back to using redis-rb directly, and finally dropped the Ruby language entirely. You can also see by yourself how much I obsess about simplicity by looking as <a href="http://files.catwell.info/notes/quotes.txt">my list of quotes</a>.</p>
<p>I feel like most programmers do not reason like Michel and me regarding this, and it seems to me those who do often have similar backgrounds in Unix and maintenance of production systems. Maybe as a result, we tend to take a system approach to everything, so when we evaluate the complexity of software, we take into account the complexity of dependencies as well as the complexity of the application code itself.</p>
<p>When running production systems, the most important thing you want to optimize for is the speed with which you can diagnose and recover from a problem. Reliability is also important, sure, but you quickly learn that no matter how good the software you use is, it <strong>will</strong> fail (coincidentally, another host of the podcast <a href="https://jessitron.com/2014/03/20/weakness-and-vulnerability/">talks about that on her blog</a>). For that purpose, you want few moving pieces, each one being simple enough for you to understand it.</p>
<p>You can take this idea very far. Around 2007 I thought about how nice it would be to know a programming language so well that 1) there would be nothing in it I would not know about and 2) I would be able to know exactly what every line of code I wrote did internally. At the time, I wondered if it would require me to pick a language like Forth or LISP implement it myself. It turned out not to: I discovered Lua, whose reference implementation is roughly 15000 lines of (readable) C code. It has been my dynamic language of choice ever since.</p>
<p>When I have a problem to solve, I look for the simplest Open Source tool that does it and weigh the cost of implementing the feature myself against the cost of using and maintaining this tool. Tools usually win when they just do what I wanted; they lose when they do too many things or pull in too many dependencies I did not already use.</p>
<p>Many Ruby programmers, when they install a gem that pulls in several dependencies and compiles some C code, think: &#8220;How nice! All of this is automated for me!&#8221; The reaction of an operations person, on the other hand, is closer to this:</p>
<p><img alt="nope" src="img/nope.gif"/></p>
<p>When I write Open Source tools myself, I try to reason the same way. For instance, I wrote a small <a href="http://kr.github.io/beanstalkd/">Beanstalk</a> client for Lua called <a href="https://github.com/catwell/haricot">haricot</a>. The protocol used by Beanstalk has a few methods that return YAML. Those methods are for monitoring and are typically not used by job producers or consumers.</p>
<p>YAML being a <a href="http://yaml.org/spec/1.2/spec.html">terribly complicated format</a> (please do not use it), all the YAML parsers I know about in Lua land are bindings to C libraries, making them annoying to install and maintain. I had to decide between choosing one of them and making it a dependency or writing my own code to parse the subset of YAML used by Beanstalk.</p>
<p>I chose a third solution: <a href="https://github.com/catwell/haricot#note-about-yaml">returning raw YAML to the user</a>. Yes, this is &#8220;pushing the complexity upstream&#8221;. But most users of this library will never need those methods. In the test suite, I auto-detect the presence of a YAML parser and skip related tests if none is available.</p>
<p>Eventually, this is a matter of choice. Avdi is right: fat tools usually exist for good reasons, not because their authors did not think of a simpler solution. Choosing whether to use them or not has to be a conscious trade-off. I just personally decided there are very few things I want to trade simplicity off against.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Disabling graphical password prompts</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-10-24-cli-passwords.html"
    />
    <id>tag:blog.separateconcerns.com,2014-10-24:cli-passwords</id>
    <published>2014-10-24T21:30:00Z</published>
    <updated>2015-08-31T21:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>These days Linux systems tend to open graphical password prompts when a CLI
application needs user authentication. I don&#8217;t know about you but I really
don&#8217;t like that.</p>
<p>The first offender is git, which uses x11-ssh-askpass if installed. The
simplest solution would be not to install it but it is a dependency of
virt-manager on Arch Linux&#8230; Thankfully you can tell git not to use it:</p>
<pre><code class="language-shell">git config --global core.askpass ""
</code></pre>
<p>The second one, in my case, was <a href="http://www.passwordstore.org/">pass</a>.
If you try to use it in Gnome, the keyring hijacks the GPG agent
and you get that message (plus a graphical prompt):</p>
<pre><code class="language-text">gpg: WARNING: The GNOME keyring manager hijacked the GnuPG agent.
gpg: WARNING: GnuPG will not work properly - please configure
that tool to not interfere with the GnuPG system!
</code></pre>
<p>The Gnome keyring is an annoying piece of software that replaces password
prompts for several tools including SSH and GPG. you can disable it this way:</p>
<pre><code class="language-shell">mkdir -p ~/.config/autostart
cd !$
cp /etc/xdg/autostart/gnome-keyring-* .
for i in *; do echo "Hidden=true" &gt;&gt; $i; done
</code></pre>
<p>&#8230; but then GPG will use yet another graphical prompt! To finally stay in your
terminal, create the file <code>~/.gnupg/gpg-agent.conf</code> with the following content:</p>
<pre><code class="language-shell">pinentry-program /usr/bin/pinentry-curses
</code></pre>

      </div>
    </content>
  </entry>
  <entry>
    <title>Microservices</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-09-25-microservices.html"
    />
    <id>tag:blog.separateconcerns.com,2014-09-25:microservices</id>
    <published>2014-09-25T23:00:00Z</published>
    <updated>2014-09-25T23:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Several people have asked me what I think about microservices. The tl;dr is: I like small services, but I don&#8217;t like what some call microservices, which is isolating every single feature within its own service and aiming at services at small as possible (I heard about a target of &#8220;a few hundred lines of code&#8221; per service and a hard limit at 5000 LOC).</p>
<p>I <a href="https://blog.separateconcerns.com/2013-01-02-startups-soa.html">see SOA</a> (and modularization in general) as a technique to design a system so that it scales with the number of people on a team. The way it works is by dividing complexity between people. The following will be terribly simplified, but bear with me.</p>
<p>Imagine a team working on a monolithic application. It is becoming too large and complicated to understand, so they split it into three parts, A, B and C. A third of the team will be responsible for each part. Each team is tasked with exposing an interface to the others, so that team A only has to worry about the internals of A and the interfaces of B and C. For each team, complexity has gone from the complexity of the monolithic application to a third of that complexity plus the complexity of communicating with the other parts of the system, or at least just knowing they exist, so given <code>N</code> the number of parts in the system and <code>M</code> the total complexity of the system, complexity seen from a service is: <code>M/N + k*N</code>.</p>
<p>Now assuming the complexity of the system increases linearly with team size <code>S</code> (it probably increases faster in practice but let&#8217;s approximate), complexity seen from a service is <code>l*S/N + k*N</code>. With everything else constant, the function <code>N(S)</code> to minimize that looks like a square root.</p>
<p>In practice, this is not entirely true: as the system grows, not every service talks to other services and not every developer needs to know about every service. But because system architects and, more importantly, operations people do, my argument still holds.</p>
<p>So here is my point: the number of services you have should look like a constant times the square root of the size of your team. Meaning, with a constant of three:</p>
<p><img alt="graph" src="img/microservices.jpg"/></p>
<p>This is the problem I have with the idea to bound the size of single services while ignoring the complexity of inter-service communication. SOA is a practice which can help you curb local complexity as you scale but there is <strong>no way</strong> it can make it constant without making a mess of the whole system.</p>
<p>That being said, the value of the constant can be discussed. Some people think it should be lower than one, others think it should be very large.</p>
<p>I am not a huge fan of small constants when they result in services that do too many things and require too many people. They end up looking like a few monoliths, with the same issues as a single monolith. Moreover, if you are going to do services, inter-service calls should be the norm and not an exception. Very large constants, on the other hand, result in too much accidental complexity, harder debugging and operational nightmares.</p>
<p>I guess mileages vary but I like numbers around three. If you look at the curve above you may (or may not) agree that it looks reasonable; I think it does.</p>
<p>Note that the title of this blog is still &#8220;Separate Concerns&#8221;: you should still draw clear lines between services, and you should still modularize as much as possible <strong>within</strong> services. But not every function call needs to be turned into a message sent over a network, and not every data structure needs its own process and source control repository.</p>
<p>And finally, just to be clear: do not look too much at the left part of the curve if you are a very early stage startup looking for product-market fit. You can still - and probably should - start with a monolith as long as you choose an architecture or framework with good modularization capabilities (like <a href="https://flask.palletsprojects.com/en/2.2.x/blueprints/">Flask Blueprints</a>). Only consider SOA when you start to have a good rough idea of what the product will look like.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Iris</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-09-20-iris.html"
    />
    <id>tag:blog.separateconcerns.com,2014-09-20:iris</id>
    <published>2014-09-20T15:00:00Z</published>
    <updated>2014-09-20T15:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p><a href="https://github.com/project-iris/iris">Iris</a> is a &#8220;decentralized Cloud messaging&#8221; middleware that I have really started looking into with the recent release of version 0.3.0. It had struck me as interesting when I first heard of it <a href="https://www.youtube.com/watch?v=WTRORimPvHE">at FOSDEM 2014</a>. The reason for that, beyond the great presentation skills of its author, is that it implements principles I think are sound to build SOA upon.</p>
<p>In Iris, the logical and physical layers of services are cleanly separated. Each box in the system runs a local instance of the Iris broker (&#8220;Iris node&#8221;). The broker is written in Go, and all broker instances in the system converse in a proprietary protocol.</p>
<p>To provide or consume a service, you never have to open a connection to a remote machine: you just talk to your local broker using the Iris relay protocol. This means you can use any programming language you want as long as you implement this protocol, which is much simpler than the protocol used between brokers. There are official clients for the relay protocol (Iris calls them &#8220;bindings&#8221;, but I think that name is confusing) in Go, Erlang and Java. I have <a href="https://github.com/catwell/cw-lua/tree/master/iris-lua">written one in Lua</a> that I will use for examples in the rest of this post (if you prefer, you will find corresponding code in Go for most examples <a href="https://github.com/catwell/cw-lua/tree/2e74fcb3546ac4ef1a2f659e8012ff8a78fa7a36/iris-lua/examples">here</a>).</p>
<p>In Iris, services are represented by names. To provide a service you register with its name, to consume one you address it by its name. That means you never dial into a specific instance of a service explicitly. From the consumer&#8217;s point of view, the service could be provided by a single box as well as hundreds across different datacenters. Boxes can go up or down, and you will almost never have to care about it when writing code: it is an operational concern. The way Iris&#8217; author puts it is that in Iris the smallest logical entity is a cluster, there is no concept of individual machine or process.</p>
<p>Iris supports three usual basic patterns for communication: Request/Response, Publish/Subscribe and Broadcast. A fourth one, Tunnel, is slightly more complicated.</p>
<section id="RequestResponse">
<h1>Request/Response</h1>
<p>This is the pattern everybody knows about from HTTP, and probably the workhorse of most SOAs. A client sends a request to a cluster, and a single node of the cluster answers it. Iris just does the messaging here: the request and the response are binary blobs, there is no notion of headers.</p>
<p>Here is how it looks in Lua on the client side:</p>
<pre><code class="language-lua">local iris = require "iris"

local c = iris.new()
assert(c:handshake(""))

local req = c:request("echo", "hello", 1000)
c:process_one()
local r = assert(req:response())

c:teardown()

print("reply arrived: " .. r)
</code></pre>
<p>and on the service side:</p>
<pre><code class="language-lua">local iris = require "iris"

local c = iris.new()
assert(c:handshake("echo"))

c.handlers.request = function(req)
    print("request arrived: " .. req)
    return req
end

for i=1,5 do c:process_one() end

c:teardown()
</code></pre>
</section>
<section id="PublishSubscribe">
<h1>Publish/Subscribe</h1>
<p>Another well-known pattern. Consumers subscribe to a channel identified by a name, producers send messages into the channel and all subscribers receive them. There is no response from the subscriber. Channels are completely independent from clusters, i.e. channel &#8220;X&#8221; and cluster &#8220;X&#8221; can coexist and have nothing in common, and there is no restriction that a channel only works within a given cluster (any entity on the same Iris network can access it).</p>
<p>Here is a publisher to channel &#8220;somechan&#8221; in Lua:</p>
<pre><code class="language-lua">local iris = require "iris"
local socket = require "socket"

local c = iris.new()
assert(c:handshake(""))

for i=1,5 do
    c:publish("somechan", "message " .. i)
    socket.sleep(1)
end

c:teardown()
</code></pre>
<p>and a consumer:</p>
<pre><code class="language-lua">local iris = require "iris"
local socket = require "socket"

local c = iris.new()
assert(c:handshake(""))

c.handlers.pubsub.somechan = function(msg)
    print("message arrived: " .. msg)
end

c:subscribe("somechan")

for i=1,5 do c:process_one() end

c:teardown()
</code></pre>
</section>
<section id="Broadcast">
<h1>Broadcast</h1>
<p>We have seen that requests are sent to a single instance of a cluster. What if you want to notify <strong>all</strong> members of a cluster of some event? This is what Broadcast is for. It is kind of redundant with Publish/Subscribe (you could have all members of each cluster subscribe to a channel) but it is somehow cleaner to have a separate message type for this. You could use it to build more complicated things on top, for instance a full-fledged service bus.</p>
<p>Here is how to send a broadcast message in Lua:</p>
<pre><code class="language-lua">local iris = require "iris"

local c = iris.new()
assert(c:handshake(""))

c:broadcast("bcst", "hello")
c:teardown()
</code></pre>
<p>and how to handle them:</p>
<pre><code class="language-lua">local iris = require "iris"

local c = iris.new()
assert(c:handshake("bcst"))

c.handlers.broadcast = function(msg)
    print("message arrived: " .. msg)
end

for i=1,5 do c:process_one() end

c:teardown()
</code></pre>
</section>
<section id="Tunnel">
<h1>Tunnel</h1>
<p>Tunnels are the last and most complicated way to communicate provided by Iris. To understand why we need them, remember how requests work.</p>
<p>The fact that any member of a cluster can answer a request prevents you from doing anything stateful, because you cannot know if you are talking to the same instance or not in two separate requests. Moreover, the nature of the request and response does not allow any of them to be composed of multiple parts sent in separate messages. A request cannot trigger multiple responses.</p>
<p>Tunnels are a solution to all that. When you open a tunnel, you address a cluster, but what you obtain is a persistent, bidirectional, ordered pipe to a specific instance of that cluster. You can think of it as a TCP socket or a circuit if you come from a telecom background (although there are no latency guarantees). Tunnels implement a throttling algorithm so that both ends of the tunnel can specify a maximum size for their input buffer.</p>
<p>For now, here is what I think of tunnels in the context of a SOA: they are very powerful but tricky to use. If you can avoid them, you should. If not, you should not use raw tunnels anyway: you should define your protocol, write an abstraction for it and never expose the tunnel itself to the application.</p>
<p>One valid use case I can see for tunnels, and which is used in Iris examples, is streaming. But this can go much further. Like the name indicates, you could tunnel most protocols into them, so they could serve as the foundation for some kind of VPN.</p>
<p>Anyway, here is an example client with multiple responses and state:</p>
<pre><code class="language-lua">local iris = require "iris"

local c = iris.new()
assert(c:handshake(""))

local tun = c:tunnel("tunnel", 1000)
tun:confirm()
tun:allow(1024)

tun.handlers.message = function(msg)
    if msg == "data" then
        print("got data")
    elseif msg == "continue" then
        print("got continue, sending request")
        tun:cosend("request")
    elseif msg == "bye" then
        print("got bye, quitting")
        tun:close()
    else
        print("got invalid message: " .. msg)
        tun:close()
    end
end

local xfer = tun:transfer("request")
while not xfer:run() do c:process_one() end

local op
while op ~= iris.OP.TUN_CLOSE do op = c:process_one() end

c:teardown()
</code></pre>
<p>and the server on the other end:</p>
<pre><code class="language-lua">local iris = require "iris"

local c = iris.new()
assert(c:handshake("tunnel"))

local MAX_COUNT = 3
local count = 0

c.handlers.tunnel = function(tun)
    tun:allow(1024)
    tun.handlers.message = function(msg)
        if msg == "request" then
            if count &lt; MAX_COUNT then
                count = count + 1
                print(string.format(
                    "got request, sending %dx data + continue",
                    count
                ))
                for i=1,count do tun:cosend("data") end
                tun:cosend("continue")
            else
                print("got request, sending bye")
                tun:cosend("bye")
            end
        else
            print("got invalid message: " .. msg)
            tun:close()
        end
    end
end

local op
while op ~= iris.OP.TUN_CLOSE do op = c:process_one() end

c:teardown()
</code></pre>
</section>
<section id="Conclusion">
<h1>Conclusion</h1>
<p>Iris is a very interesting piece of software which implements a vision of systems that I like and cannot find in any other product out of the box. It is still very young and probably not ready for serious production yet, although I have found it stable during the (limited) testing I have done. Even though my current job does not involve SOA I will probably come back to it someday, so Iris will join the list of tools whose progress I follow attentively.</p>
<p>On a side note, Iris was built for its authors&#8217; thesis, and he is now looking for a sponsor to allow him to continue working on it. If you have the power to make that happen, give it a look. Think how VMWare / Pivotal must be happy of the deal they did with <a href="http://invece.org/">Antirez</a> :)</p>
<p>Finally, if you try <a href="https://github.com/catwell/iris-lua">my Iris client</a> and find bugs, do not hesitate to report them on Github! I have no real world Iris system to try it on so there are certainly plenty.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Hacker Founders</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-05-28-hacker-founders.html"
    />
    <id>tag:blog.separateconcerns.com,2014-05-28:hacker-founders</id>
    <published>2014-05-28T00:00:01Z</published>
    <updated>2014-05-28T00:00:01Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Note: I posted what follows <a href="https://gist.github.com/catwell/5387617">as a Gist</a> over a year ago. Recently I was looking for it and couldn&#8217;t find it, so I am re-posting it here for the next time.</p>
<p>At the last Human Talks Paris meetup, Fabien Charbit (founder of <a href="http://sush.io">sush.io</a>) gave <a href="http://humantalks.com/talks/131-developpeurs-montez-votre-boite">a talk</a> in French whose title could be translated as: &#8220;Programmers, create your company!&#8221;</p>
<p>Of course I agree with the idea, but at the end of it <a href="http://www.youtube.com/watch?v=0nxDKTJ5Ovc&amp;t=641s">I said</a> I was disappointed because <a href="https://www.youtube.com/watch?v=0nxDKTJ5Ovc&amp;t=439s">he said</a> you should find a marketing / commercial-minded CEO and be CTO. This is a commonplace, and I thought his message would be bolder than that. You can always discuss whether this is right or wrong but I think a tech startup where <strong>all</strong> the founders are tech-minded makes a lot of sense.</p>
<p>It turns out, Paul Graham <a href="https://www.youtube.com/watch?v=BDA0t49AaZ4&amp;t=1383s">said exactly that</a> in a video interview back in 2005. He is is much more credible than me on the topic, so I reproduced what he has to say about it below.</p>
<p>Note that Fabien later clarified that this was not an issue of degree or even competence, but rather that one of the founders should have the motivation to deal with the softer aspects of the company, so we agree after all. But it is still way too common in France to assume every startup&#8217;s CEO should have a business degree&#8230;</p>
<p>Anyway, the question was: &#8220;What is the relationship in startups between programmers and the business types?&#8221;, and PG answered:</p>
<blockquote>
<p>The relationship between the programmers and the business types? Well&#8230;
I believe, and Y Combinator is kind of an experiment to test this&#8230;
I believe that programmers can become business types. I think that business is
kind of like chess, in the sense that the hard part is not knowing the rules
about how the pieces move, the hard part is actually being able to, like&#8230;
look ahead and make strategies and stuff like that, right. The hard part about
playing chess well is being smart, right, not knowing how to play the rules of
chess. And I think business is like that, that there&#8217;s a few rules of business
and that hackers are capable of learning them, most hackers, and that&#8230;
once they learn them, they&#8217;ll be as good at it as business guys, you know?
So&#8230; I think hackers can <strong>be</strong> business guys. Hackers are perfectly capable
of being business guys. Look at Bill Gates, right! He didn&#8217;t go to business
school. I mean&#8230; you might wonder, why would <strong>anyone</strong> want to go to business
school? You know, when you look at the example of Bill Gates, he seems to be
doing fine at business, right? He sort of picked it up as he went along,
and that did not seem to hurt him at all. Larry and Serguey, they didn&#8217;t go to
business school either, right, they&#8217;re just hackers, and they seem to be doing
fine too. So I think the relationship between hackers and business guys, at
least in the beginning, is that you need hackers and you don&#8217;t need business
guys.</p>
</blockquote>

      </div>
    </content>
  </entry>
  <entry>
    <title>Indistinguishable from Magic</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-05-27-magic.html"
    />
    <id>tag:blog.separateconcerns.com,2014-05-27:magic</id>
    <published>2014-05-27T23:30:00Z</published>
    <updated>2014-05-27T23:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I have just watched a small <a href="https://www.youtube.com/watch?v=Ia55clAtdMs">TEDx talk by Simon Peyton Jones</a> (of Haskell fame) on CS education. Something he said struck me as relevant to what I was saying in <a href="https://blog.separateconcerns.com/2014-04-25-design-alan-kay.html">my last post</a>:</p>
<blockquote>
<p>Arthur C. Clarke once famously remarked that &#8220;any sufficiently advanced technology is indistinguishable from magic&#8221;. And I think it is very damaging if our children come to believe that the computer systems they use are essentially magic. That is: not under their control.</p>
</blockquote>
<p>If you have a programming background, you may experience a feeling close to disgust when you hear the word &#8220;magic&#8221;. But I have heard &#8220;product people&#8221; use it as if it was a <strong>good</strong> thing way too many times. Short term, maybe. But eventually I want to master my tools, to understand them inside out. I want to be able to rely on them, and for that I expect them <strong>not</strong> to surprise me.</p>
<p>I think it is time for the pendulum to swing back to products that optimize for how high the asymptote of the learning curve is, not the time it takes to reach it. The kind of products that come with manuals and teach you things instead of trying very hard not to make you feel stupid, or in other words: not to make you think.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Modern design and Alan Kay</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-04-25-design-alan-kay.html"
    />
    <id>tag:blog.separateconcerns.com,2014-04-25:design-alan-kay</id>
    <published>2014-04-25T00:30:00Z</published>
    <updated>2014-04-25T00:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I have long been thinking that there is something wrong with modern product design thinking. I see designs that trade off almost all power, flexibility and composability for a smoother learning curve. I see designs that remove explicit controls and replace them by magic, choosing to hide essential complexity instead of reducing accidental complexity. I see designs optimized for new users and prospects instead of regular users, and designers who apparently consider documentation as something evil.</p>
<p>I do not like that trend. Learning from a community where <a href="http://en.wikipedia.org/wiki/RTFM">RTFM</a> was often the right answer has been very beneficial to me when I was a child. I am also a proponent of simplicity and <a href="https://web.archive.org/web/20140519002633/https://wiki.archlinux.org/index.php/The_Arch_Way#Simplicity">complexity without complication</a>, as should be obvious from <a href="http://files.catwell.info/notes/quotes.txt">the quotes</a> I have been collecting over the last years.</p>
<p>The name of Alan Kay can be found a few times in this file, and so I was very pleased to find out that he recently gave a talk where <a href="https://www.youtube.com/watch?v=gTAghAJcO1o&amp;t=765s">he puts words</a> on that hard-to-describe feeling: that this design school, which postulates that educating users is a bad idea and that everything should be natural, is hindering progress.</p>
<p>I found it so spot on that I decided to transcribe part of it below. I encourage you to read, and then watch the whole video if you can!</p>
<blockquote>
<p>Human beings tend to hate learning curves, [&#8230;] and marketing people really hate learning curves. [&#8230;]</p>
</blockquote>
<blockquote>
<p>Any product today that requires a substantial learning curve is not what marketing people are looking for. As the joke goes, they want a brand new idea that has been perfectly tested. They would like something that people instantly recognize, but you&#8217;re the only person who has it. So they want something, essentially, that would have appealed to any cave person 100000 years ago, something that fits into what our genes set us up to be interested in.</p>
</blockquote>
<blockquote>
<p>An interesting question is: if the bicycle were invented tomorrow, would it actually be carried through? Think of how dangerous a bicycle is, think of the lawsuits! The bicycle is only tolerated today because it has been around for a long time, when people didn&#8217;t sue when a kid got danked.</p>
</blockquote>
<blockquote>
<p>Another way to look at it is that the larger world out there is kind of a low pass filter. And this is still going on: the iPad has a much more brain-dead interface than the Mac. [&#8230;] If you think of the iPad as a gesture device, a gesture is inherently something that gives you not just naturalness but efficiency. And so when you&#8217;re doing gestures-oriented computing, and the origin of that goes back into the 60s - there were some really wonderful systems back then, what you really want to do is to learn a bunch of gestures to make you fluent and efficient on the thing. And the iPad doesn&#8217;t have any particular way of teaching you those gestures. They don&#8217;t force the developers to put a teaching thing for those gestures in there. And so basically everything is devolved down to the few simple gestures that are generic to the iPad.</p>
</blockquote>
<blockquote>
<p>This is kind of a dumb-down-ism that has been incredibly successful for people who are only interested in making money. It has not been good for personal computing. [&#8230;]</p>
</blockquote>
<blockquote>
<p>If we look at human psychometrics, [&#8230;] when a new idea or tool appears, about 95% of us are what are called instrumental reasoners. [&#8230;] And an instrumental reasoner is a person who judges the new idea or tool on whether it will advance their current goals. [&#8230;] They are very conservative about shifting their goals. 5% of us are interested in the new idea or tool just because we&#8217;re interested in new ideas and tools, and many of these people actually change their goals when a new idea or tool appears.</p>
</blockquote>
<blockquote>
<p>If we look at the other axis, about 85% of us do things primarily for social approval. That&#8217;s what extroversion actually means: it doesn&#8217;t mean you&#8217;re a performer, it means you are actually interested in the opinions of others. About 15% of us are inner-directed.</p>
</blockquote>
<p><img alt="change in groups" src="img/kay-change-groups.png"/></p>
<blockquote>
<p>If you combine these two (and I realize that they might not be completely independent dimensions, but they are independent enough for this talk) you get this interesting thing: 1% of us is inner-directed, not so interested in the approval of others, and intrinsically interested in new ideas and tools.</p>
</blockquote>
<blockquote>
<p>And 80% of us are goal-conservative, instrumental and directed by what our society thinks of us. This group requires almost everybody to agree on something before anybody agrees on something. [&#8230;] So this group generally cannot do something just because it is a good idea. This is just not a concept that this group has, the majority of human beings. They&#8217;ll do something if it is actually part of a sanction. And so this group is capable of doing things that are terrible ideas [&#8230;] if they&#8217;re sanctioned by the group. [&#8230;]</p>
</blockquote>
<blockquote>
<p>And it turns out of you want to make a change in the larger world, you have to do something with the 80%. The 1% are more or less always with us and doing things. Some eras they get burnt at the stake, some eras they get rejected. In the 60s they actually got funded for a while. Xerox PARC came out of the funding of those people in the 60s, but they&#8217;re always with us.</p>
</blockquote>

      </div>
    </content>
  </entry>
  <entry>
    <title>Learning in the small</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-04-22-learning-small.html"
    />
    <id>tag:blog.separateconcerns.com,2014-04-22:learning-small</id>
    <published>2014-04-22T23:59:00Z</published>
    <updated>2014-04-22T23:59:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <section id="Writing-a-Lisp">
<h2>Writing a Lisp</h2>
<p>I like to learn new tools and concepts by experimenting with small projects whose sole purpose is to help me grasp something better. Working on a larger project in a team with other people is invaluable, but doing things on a smaller scale on my own offers a different perspective.</p>
<p>Having recently started to write a lot more C at work than I used to, I felt that it was a good idea to do a smaller project in the language. It turned out <a href="http://www.buildyourownlisp.com/">Build Your Own Lisp</a> came out just when I needed it, so I <a href="https://github.com/catwell/ownlisp">had a go at it</a>.</p>
<p>I cannot recommend this book enough if you feel like you would enjoy building a dynamic language in C from scratch (using just a parser library). It is one of the best tutorial-style books I have ever read. It achieves a perfect balance between being didactic and leaving freedom to the user.</p>
<p>My Lisp ended up being different from the one described in the book in several minor ways. For instance: it has more types, builtins take expressions instead of values, values are based on a union (which saves memory), memory management works differently, the source more organized&#8230; In that respect the book delivers exactly what it promised: the reader is encouraged to build &#8220;his own&#8221; Lisp.</p>
<p>In the end I got just what I wanted from this experience: I clearly improved my C and had the satisfaction to write a working programming language in a few hours scattered over three weekends.</p>
<p>Oh, just in case you were wondering, nobody paid me to write that blog post!</p>
</section>
<section id="Moving-on-to-Go">
<h2>Moving on to Go</h2>
<p>Next, I will probably be <a href="https://gobyexample.com/">learning Go</a>. Go is a weird language in that about half of the technical people I follow and look up to like it a lot, and the other half hates it. The latter tend to be users of languages with stricter type systems&#8230;</p>
<p>I have to admit that, if I had looked solely at the technical merits of both languages, I would probably have learned more <a href="http://www.rust-lang.org/">Rust</a> instead. I already know some Rust, but not enough to use it productively. Its main advantages are its (arguably) better type system and the fact that it can run without a GC or a frontend, making it suitable to write dynamic libraries.</p>
<p>However, Rust doesn&#8217;t look completely stable yet, whereas Go is already used in production by several serious companies. Also, I am a distributed systems programmer, and <a href="https://perkeep.org">most</a> <a href="https://github.com/coreos/etcd">of</a> <a href="https://github.com/ha/doozerd">the</a> <a href="https://github.com/bitly/nsq">interesting</a> <a href="https://github.com/project-iris/iris">codebases</a> I see popping up around in that field are written in Go.</p>
<p>Moreover, Go appears to be a simpler language than Rust. I suspect I can learn enough of it to read code &#8220;fluently&#8221; and write some much faster. So Go it is, and Rust will probably be next.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Editing Sublime Text packages</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-03-03-sublime-packages.html"
    />
    <id>tag:blog.separateconcerns.com,2014-03-03:sublime-packages</id>
    <published>2014-03-03T21:30:00Z</published>
    <updated>2014-03-03T21:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I have finally decided to configure Sublime Text 2 to have it autocomplete
Lua code the way I want it to.</p>
<p>For instance, by default, when you start typing <code>function</code> and hit TAB,
you get the following result:</p>
<pre><code class="language-lua">function function_name( ... )
  -- body
end
</code></pre>
<p>Instead I wanted this:</p>
<pre><code class="language-lua">function(self)
  error("unimplemented")
end
</code></pre>
<p>It turns out this is very simple. Go to <code>Preferences -&gt; Browse Packages...</code>
and open the Lua directory. There are several files there, including two
named <strong>function-(fun).sublime-snippet</strong> and <strong>function-(function).sublime-snippet</strong>
which do almost the same thing.</p>
<p>Remove the first one and open the second one in a text editor. Its content
should be something like:</p>
<pre><code class="language-xml">&lt;snippet&gt;
    &lt;content&gt;&lt;![CDATA[function ${1:function_name}( ${2:...} )
    ${0:-- body}
end]]&gt;&lt;/content&gt;
    &lt;tabTrigger&gt;function&lt;/tabTrigger&gt;
    &lt;scope&gt;source.lua&lt;/scope&gt;
    &lt;description&gt;function&lt;/description&gt;
&lt;/snippet&gt;
</code></pre>
<p>Replace it by:</p>
<pre><code class="language-xml">&lt;snippet&gt;
    &lt;content&gt;&lt;![CDATA[function(${1:self})
    ${0:error("unimplemented")}
end]]&gt;&lt;/content&gt;
    &lt;tabTrigger&gt;function&lt;/tabTrigger&gt;
    &lt;scope&gt;source.lua&lt;/scope&gt;
    &lt;description&gt;function&lt;/description&gt;
&lt;/snippet&gt;
</code></pre>
<p>&#8230; and that is all, the deed is done!</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>FOSDEM 2014</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-02-09-fosdem-2014.html"
    />
    <id>tag:blog.separateconcerns.com,2014-02-09:fosdem-2014</id>
    <published>2014-02-09T19:30:00Z</published>
    <updated>2014-02-09T19:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Last weekend I attended <a href="https://fosdem.org/2014/">FOSDEM</a>, the largest Open Source conference in Europe that takes place every year in Brussels. This was my fourth year in a row. Not much Lua this year, although I saw some <a href="https://github.com/ladc">familiar</a> <a href="http://specfun.inria.fr/tassi/">faces</a>. But I did listen to lots of interesting talks which I will try to summarize briefly.</p>
<section id="Reproducible-Builds-for-Debian-Jérémy-Bobbio">
<h2><a href="https://fosdem.org/2014/schedule/event/reproducibledebian/">Reproducible Builds for Debian</a> (Jérémy Bobbio)</h2>
<p>Debian developers want to provide their users a way to verify that the binary packages they distribute correspond to the source. To achieve reproducible builds they have to patch code that depends on things such as timestamps at build time. To make things worse, using a standard VM for builds would help but they refuse to do it &#8220;because they&#8217;re Debian.&#8221;</p>
</section>
<section id="Is-distribution-level-package-management-obsolete-Donnie-Berkholz">
<h2><a href="https://fosdem.org/2014/schedule/event/obsolete/">Is distribution-level package management obsolete?</a> (Donnie Berkholz)</h2>
<p>The Gentoo leader thinks distribution are doing a poor job of meeting the needs of users - especially developers and system administrators - in terms of package management. They are increasingly relying on configuration management tools (CFEngine, Puppet, Chef, Ansible&#8230;), language-specific package managers (RubyGems, NPM, LuaRocks&#8230;) and tools like Docker; however, distribution package managers do not integrate well with those.</p>
<p>This is a topic that interests me, following all the discussion that occurred at <a href="http://www.lua.org/wshop13.html">the last Lua Workshop</a>. After the talk I asked Donnie whether there was a discussion list somewhere dedicated to those issues. He told me that, to his knowledge, there was not. It may be a good idea to start one.</p>
</section>
<section id="Minix-3-on-ARM-Kees-Jongenburger">
<h2><a href="https://fosdem.org/2014/schedule/event/minix_3_on_arm/">Minix 3 on ARM</a> (Kees Jongenburger)</h2>
<p>Kees talked about the <a href="http://www.minix3.org/">Minix 3</a> architecture, how it was ported to ARM (with the BeagleBoard and BeagleBone devices as first targets) and plans for the future.</p>
<p>The main priority of the project is porting the NetBSD userland. As a former user I think this is an excellent idea. I may try the OS again someday if it becomes more &#8220;usable&#8221;, I really like some of the ideas behind it.</p>
</section>
<section id="Technical-introduction-to-the-deeper-parts-of-Sailfish-OS-Carsten-Munk">
<h2><a href="https://fosdem.org/2014/schedule/event/technical_introduction_to_the_deeper_parts_of_sailfishos,_a_qt5_wayland_based_mobile_os/">Technical introduction to the deeper parts of Sailfish OS</a> (Carsten Munk)</h2>
<p>Sailfish is probably the most interesting mobile OS project today, go <a href="https://sailfishos.org/">check it out</a> if you don&#8217;t know it yet. Carsten gave us an overview of the main parts of the OS and explained some funny things they did, such as making glibc and the Bionic libc co-exist within the same process. He also provided the audience an SSH access to an actual terminal. I <a href="https://twitter.com/pchapuis/status/429619422592905217">found liblua 5.1</a> on it :)</p>
</section>
<section id="Postfix:-lessons-learned-and-recent-developments-Wietse-Venema">
<h2><a href="https://fosdem.org/2014/schedule/event/postfix_lessons_learned_and_recent_developments/">Postfix: lessons learned and recent developments</a> (Wietse Venema)</h2>
<p>This talk introduced the Postfix least-privilege architecture, and then went on to explain recent improvements. Most of them revolve around fighting spam more efficiently. Postfix also migrated from Berkley DB to LMDB (see later), mostly for licensing reasons.</p>
</section>
<section id="NixOS:-declarative-configuration-Linux-distribution-Domen-Kožar">
<h2><a href="https://fosdem.org/2014/schedule/event/nixos_declarative_configuration_linux_distribution/">NixOS: declarative configuration Linux distribution</a> (Domen Kožar)</h2>
<p><a href="http://nixos.org/">Nix OS</a> is a Linux distribution built around the Nix package manager. It is one of those few distributions that completely disrupt the FHS, another one being <a href="http://www.gobolinux.org/">GoboLinux</a>.</p>
<p>The idea of Nix is that a package is the output of a function provided with some arguments and without side effects. There are a lot of interesting ideas there, such as atomic updates based on symlinks. However, doing this involves some heavy patching and that makes me uncomfortable.</p>
</section>
<section id="Iris-Decentralized-Messaging-Péter-Szilágyi">
<h2><a href="https://fosdem.org/2014/schedule/event/iris_decentralized_messaging/">Iris Decentralized Messaging</a> (Péter Szilágyi)</h2>
<p><a href="https://github.com/project-iris/iris">Iris</a> is a messaging backend written in Go but with a language-agnostic interface. It is somehow similar 0MQ but goes further by removing the notion of a specific instance or process in favor of sets of those. Each machine runs a single daemon that does all the heavy lifting, and each client connects to it locally to interact with the system.</p>
<p>This is a very interesting project and I was a bit surprised I had never heard about it until now. The slides and live demos were also really good, with multiple Go code snippets running concurrently in a browser. Oh, and Gopher drawings!</p>
</section>
<section id="Camlistore-Brad-Fitzpatrick-and-Mathieu-Lonjaret">
<h2><a href="https://fosdem.org/2014/schedule/event/camlistore/">Camlistore</a> (Brad Fitzpatrick and Mathieu Lonjaret)</h2>
<p>The speakers showed off what the latest release of <a href="https://perkeep.org">Camlistore</a>, a personal file storage system, can do. I already knew and liked the technical design of the project, but I was impressed by the progress made on usability since Brad&#8217;s talk at dotScale 2013. They have a new Web UI which is not complete yet but looks very promising. I really have to install my own node someday.</p>
</section>
<section id="Statically-compiling-Ruby-with-LLVM-Laurent-Sansonetti">
<h2><a href="https://fosdem.org/2014/schedule/event/llvmruby/">Statically compiling Ruby with LLVM</a> (Laurent Sansonetti)</h2>
<p>A very interesting talk on LLVM and how it helps when statically compiling a (very) dynamic language such as Ruby. Among other things, the optimization passes do an incredible job. However, it looks like JIT compilation is not as good as static compilation yet.</p>
</section>
<section id="What's-new-in-OpenLDAP-Howard-Chu">
<h2><a href="https://fosdem.org/2014/schedule/event/whats_new_in_openldap/">What&#8217;s new in OpenLDAP</a> (Howard Chu)</h2>
<p>This was, as I had hoped, mostly a talk about <a href="https://www.symas.com/lmdb">LMDB</a>. It confirmed what I already suspected: at least according to its author&#8217;s benchmarks, it outperforms any kind of competition in this space (embedded key-value stores). It is also one of the rare NoSQL DBs to implement MVCC transactions, in less than 10000 lines of C code and 32 kB of object code. If there is a piece of Open Source software I think you should not have missed in 2013, it is this one.</p>
</section>
<section id="Persistent-Memory:-Changing-the-way-we-store-data-Ric-Wheeler">
<h2><a href="https://fosdem.org/2014/schedule/event/persistent_memory/">Persistent Memory: Changing the way we store data</a> (Ric Wheeler)</h2>
<p>An interesting talk about how the shift away from rotating disk towards persistent memory storage affects the way we develop filesystems, kernels and any code that does I/O. This is not only about SSDs, but also about new kinds of devices that will come out soon and be an order of magnitude faster according to Ric.</p>
</section>
<section id="Concurrent-programming-with-Python-and-my-little-experiment-Benoit-Chesneau">
<h2><a href="https://fosdem.org/2014/schedule/event/concurrent_programming_with_python/">Concurrent programming with Python and my little experiment</a> (Benoit Chesneau)</h2>
<p>Benoit explained how he ported the Go concurrency model (Goroutines and Channels) to Python. I know Benoit and his <a href="https://github.com/benoitc/offset">offset</a> project so this was not foreign to me, but there are two pieces of interesting news: first, the next version will support multiple processes, freeing users from the GIL (yay!), and second he is thinking about changing the API to make it more like <a href="http://julialang.org/">Julia</a> and less like Go, because Julia is more similar to Python.</p>
</section>
<section id="NSA-operation-ORCHESTRA:-Annual-Status-Report-Poul-Henning-Kamp">
<h2><a href="https://fosdem.org/2014/schedule/event/nsa_operation_orchestra/">NSA operation ORCHESTRA: Annual Status Report</a> (Poul-Henning Kamp)</h2>
<p>This was a fun talk where <a href="http://phk.freebsd.dk/">phk</a> endorsed the role of a NSA agent who mistakes the FOSDEM amphitheater for the European Commission and explains how they sabotage attempts to give the general public more privacy. Lots of conspiracy theory in there obviously, but given the recent events, is this really so absurd? phk argued at the end of the talk that the solution should be political and not technical.</p>
<p>The format of the talk was a very good idea that worked really well on my brain tired by two days of conference, but also by two consecutive nights out filled with Belgian beer and other strong drinks. :)</p>
</section>
<section id="Conclusion">
<h2>Conclusion</h2>
<p>FOSDEM is still a very good event which you should consider attending next year. Besides the talks, you will enjoy the parties and meeting people you only knew online. I hopefully will see you there.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>How I write Lua modules</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-01-03-lua-module-policy.html"
    />
    <id>tag:blog.separateconcerns.com,2014-01-03:lua-module-policy</id>
    <published>2014-01-03T00:00:01Z</published>
    <updated>2014-01-03T00:00:01Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Hisham just published an article about his personal <a href="http://hisham.hm/2014/01/02/how-to-write-lua-modules-in-a-post-module-world/">guidelines for writing Lua modules</a>. Interestingly, I do a lot of things differently. Let us see how.</p>
<blockquote>
<p>Policy Bit #1: always require a module into a local named after the last component of the module’s full name.</p>
</blockquote>
<p>I tend to do that, but not always. Exceptions include:</p>
<ul>
<li>
modules with names that are too generic such as<code>path</code>, <code>utils</code> or <code>types</code> from Penlight, where I add an <code>x</code> at the end of the name (e.g. <code>pathx</code>);
</li>
<li>
modules which I use as alternatives for others, for instance <code>cjson</code> which I call <code>json</code>;
</li>
<li>
modules with names that are too long such as my own <code>multipart-post</code> which I call <code>mp</code> (it is not a valid identifier anyway, I would have to replace the dash by an underscore).
</li>
</ul>
<blockquote>
<p>Policy Bit #2: start a module by declaring its table using the same all-lowercase local name that will be used to require it.</p>
</blockquote>
<blockquote>
<p>Policy Bit #3: Use local function to declare local functions only: that is, functions that won’t be accessible from outside the module.</p>
</blockquote>
<blockquote>
<p>Policy Bit #4: public functions are declared in the module table, with dot syntax.</p>
</blockquote>
<p>I do something entirely different. First, I <strong>never</strong> use the function sugar in Lua, so instead of writing <code>local function f()</code> I write <code>local f = function()</code>.</p>
<p>I also do not declare the module table at the top of the module, I return it at the end, listing public functions explicitly. That means public functions are declared as locals. Arguably, they could be confused with private functions but that doesn&#8217;t bother me: if you are editing the code of the module, you probably know its interface. My public functions are also usually located at the end of the module.</p>
<p>To illustrate, Hisham&#8217;s module example is:</p>
<pre><code class="language-lua">local bar = {}

local function happy_greet(greeting)
   print(greeting .. "!!!! :-D")
end

function bar.say(greeting)
   happy_greet(greeting)
end

return bar
</code></pre>
<p>I would write instead:</p>
<pre><code class="language-lua">local happy_greet = function(greeting)
   print(greeting .. "!!!! :-D")
end

local say = function(greeting)
  happy_greet(greeting)
end

return {
  say = say,
}
</code></pre>
<p>One advantage of doing this is that when you call a public function in the module itself it is a local. That means that you avoid a table lookup, but also that <strong>it acts as a private function from the point of view of other functions in your module</strong>.</p>
<p>To understand what I mean, imagine that we change our mind and now want to expose <code>happy_greet</code> as well.</p>
<p>Hisham&#8217;s module becomes:</p>
<pre><code class="language-lua">local bar = {}

function bar.happy_greet(greeting)
   print(greeting .. "!!!! :-D")
end

function bar.say(greeting)
   bar.happy_greet(greeting)
end

return bar
</code></pre>
<p>Mine becomes:</p>
<pre><code class="language-lua">local happy_greet = function(greeting)
   print(greeting .. "!!!! :-D")
end

local say = function(greeting)
  happy_greet(greeting)
end

return {
  say = say,
  happy_greet = happy_greet,
}
</code></pre>
<p>The first thing we can notice is that we had to modify <code>say</code> in Hisham&#8217;s module and not in mine. But now imagine a &#8220;malicious&#8221; user does this:</p>
<pre><code class="language-lua">local bar = require "bar"

local fishy_greet = function(greeting)
  print(greeting .. " &gt;&lt;&gt;")
end

bar.happy_greet = fishy_greet

bar.say("yay")
</code></pre>
<p>With my module, the output would be <code>yay!!!! :-D</code>. With Hisham&#8217;s, the output would be <code>yay &gt;&lt;&gt;</code>: the user is allowed to monkey patch their module in a way that has an effect on functions they do not explicitly touch.</p>
<blockquote>
<p>Policy Bit #5: construct a table for your class and name it LikeThis so we know your table is a class.</p>
</blockquote>
<blockquote>
<p>Policy Bit #6: functions that are supposed to be used as object methods should be clearly marked as such, and the colon syntax is a great way to do it.</p>
</blockquote>
<p>Again, not how I do it :) Using CamelCase is a good idea but in the wild I see it more often for the actual module table, not for what Hisham calls the &#8220;class&#8221; table that is associated to <code>__index</code> in the metatable (I call it &#8220;methods&#8221;). Usually, it means (to me) that the constructor is <code>MyClass()</code>, whereas with a lowercase module name it would be <code>myclass.new()</code>. I use the latter and Penlight is an example of the former.</p>
<p>Just like I do not use the <code>function</code> sugar, I do not use the colon syntax to define functions. Moreover, <strong>I often call methods with explicit self in the module itself</strong>. Any idea why? Yeah, same as above, resistance to monkey patches. I agree that this is not a very convincing argument given that I often skip the little <code>local print = print</code> dance.</p>
<p>Other advantages include, again, less call overhead and the ability to call methods consistently on objects before they have their metatable. This is sometimes useful in constructors.</p>
<p>So where Hisham&#8217;s class example is:</p>
<pre><code class="language-lua">local myclass = {}

local MyClass = {}

function MyClass:some_method()
   -- code
end

function MyClass:another_one()
   self:some_method()
   -- more code
end

function myclass.new()
   local self = {}
   setmetatable(self, { __index = MyClass })
   return self
end

return myclass
</code></pre>
<p>I would write:</p>
<pre><code class="language-lua">local some_method = function(self)
  -- code
end

local another_one = function(self)
  some_method(self)
  -- more code
end

local methods = {
  some_method = some_method,
  another_one = another_one,
}

local new = function()
  return setmetatable({}, {__index = methods})
end

return {new = new}
</code></pre>
<p>Of course sometimes I do <strong>not</strong> want to resist monkey patches, and in that case I use colon syntax for calls, but never for definitions.</p>
<blockquote>
<p>Policy Bit #7: do not set any globals in your module and always return a table in the end.</p>
</blockquote>
<p>This one I cannot disagree with. It is the only rule that has an obvious externally visible effect. Do this or you will annoy all your users.</p>
<p>I think this is what matters the most in the end: modules always return tables and never create globals. The rest is mostly implementation details!</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>C: what I had forgotten</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2014-01-02-clang-forgotten.html"
    />
    <id>tag:blog.separateconcerns.com,2014-01-02:clang-forgotten</id>
    <published>2014-01-02T22:10:00Z</published>
    <updated>2014-01-02T22:10:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Thanks to my <a href="https://blog.separateconcerns.com/2013-12-12-infinity-beyond.html">new job</a> I will have the opportunity to write a lot more C than in the last three years. To prepare for this, I decided to read some old C89 books again and see what I remembered. Here are some of the quirks I had forgotten (or never known about).</p>
<ul>
<li>
<p>Declarations cannot be interleaved with other statements in ANSI C. They have to happen at the beginning of a bloc.</p>
</li>
<li>
<p>The default type of functions is <code>int</code>, i.e. <code>f(void) {};</code> is valid and equivalent to <code>int f(void) {};</code>.</p>
</li>
<li>
<p>The C89 standards allows implementations to only consider the first 31 characters of identifiers. It is possible to use longer identifiers but they must differ in their first 31 characters to avoid collisions. External identifiers (seen by the linker) are even worse: the implementation can be case-insensitive and only take the first 6 (!) characters into account.</p>
</li>
<li>
<p>Using the wrong type on an union is usually undefined. However, if some members of the union start with the same attributes, that common initial part can be used interchangeably.</p>
</li>
<li>
<p>This:</p>
</li>
</ul>
<pre><code class="language-c">const struct stuff_s {
  /* stuff */
} stuff_t;
</code></pre>
<p>means the same thing as:</p>
<pre><code class="language-c">struct stuff_s {
  /* stuff */
} const stuff_t;
</code></pre>
<p>but if you wrote it you probably meant this instead:</p>
<pre><code class="language-c">struct stuff_s {
  /* stuff */
};
typedef const struct stuff_s stuff_t;
</code></pre>
<ul>
<li>
<p>I already knew sequence points can be tricky, but this bit of code tricked me anyway: <code>a[i] = i++;</code>. There is no sequence point so the result is undefined.</p>
</li>
<li>
<p>The standard allows the <strong>representation</strong> of <code>NULL</code> to be different from <code>0</code>, but its <strong>value</strong> has to be <code>0</code> so you can almost always write code that assumes <code>NULL == 0</code> and be right provided you do not <strong>actually test</strong> <code>NULL == 0</code>.</p>
</li>
</ul>

      </div>
    </content>
  </entry>
  <entry>
    <title>To Infinity and Beyond</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2013-12-12-infinity-beyond.html"
    />
    <id>tag:blog.separateconcerns.com,2013-12-12:infinity-beyond</id>
    <published>2013-12-12T21:30:00Z</published>
    <updated>2013-12-12T21:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <section id="Goodbye-Moodstocks">
<h2>Goodbye Moodstocks</h2>
<p>Friday 20th will be my last day at Moodstocks. I am leaving a company where, after three years and a half, I was the most senior employee. As you may imagine, it was not an easy decision.</p>
<p>Moodstocks has grown up since I joined it. After several pivots, the founders have assembled a <a href="https://moodstocks.com/humans.txt">great team</a> I will miss, and together I dare say we have advanced the state of mobile image recognition. Recently, we have also been looking at other technologies related to mobile.</p>
<p>We have released two new products. The first one is what <a href="https://blog.separateconcerns.com/2013-06-20-three-years-proprietary-projects.html">was known as Physalis</a> and took the commercial name <a href="https://winch.io/">Winch</a>. This is what I have been mostly involved with for the last few months. I believe it has the potential to become the reference solution to write native mobile applications that react quickly and work offline.</p>
<p>The second product is Overlay, a mobile application that lets you buy products from paper catalogs online. Years after Pikadeo and Notes, it is finally time for a real application available in the stores, leveraging Moodstocks&#8217; <a href="https://moodstocks.com/">image recognition SDK</a> and Winch, showcasing the best of both technologies. But beyond pure tech, it is also a demonstration of Augmented Reality as we like it: fast, predictable, purposeful. No need for 3D models.</p>
<p>With those two products in the pipes, choosing to leave was incredibly difficult. But I did nevertheless, because of an opportunity I could not turn down.</p>
</section>
<section id="Hello-Lima">
<h2>Hello Lima</h2>
<p>So, what next for me? After two weeks to see my family, eat too much and have some welcome rest, I <a href="http://www.kickstarter.com/projects/cloud-guys/plug-the-brain-of-your-devices/posts/691351">will be joining</a> the team developing <a href="https://blog.separateconcerns.com/2019-02-15-goodbye-lima.html">the Lima</a> as a core developer.</p>
<p>The Lima, which promises no less than to solve the personal data storage problem, is the first hardware product I backed on Kickstarter. I was thinking: &#8220;this won&#8217;t be easy, but if those guys can do it, I want that device.&#8221;</p>
<p>The Kickstarter went (very) well, so they started looking for help and got in touch. I was curious and decided to meet the founders. After a Saturday morning spent discussing the project at Starbucks, I was convinced: they are the right people to do this.</p>
<p>For years I have been convinced that ubiquitous computing is one of the next big things in technology and wanted to be part of it. As I see it, Lima gives me this opportunity today.</p>
<p>So it looks like my short-term future holds some Unix development and a good dusting of my rusty C. I may try to sneak a Lua interpreter in that box at some point, but please don&#8217;t tell the others! ;) Severin and Gawen have high expectations and I do not expect much relaxing but hey, it should be fun to live the adventure of Early Stage again.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Lapis: Lua for the Web</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2013-09-01-lapis.html"
    />
    <id>tag:blog.separateconcerns.com,2013-09-01:lapis</id>
    <published>2013-09-01T16:00:00Z</published>
    <updated>2013-09-01T16:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I use different programming languages for different tasks, but the one I prefer is <a href="http://www.lua.org/">Lua</a>. I have always wanted to use it for the Web, and in a way I already do: this blog is a static website generated by a custom Lua program. I have also written several services that can speak HTTP+JSON in Lua. For larger, HTML-based Web applications however, I have never found the framework I wanted. I have tried <a href="http://keplerproject.github.io/orbit/">several</a> <a href="https://github.com/zedshaw/Tir">of</a> <a href="https://github.com/nrk/mercury">them</a>, but kept coming back to <a href="http://flask.pocoo.org/">more dependable platforms</a>.</p>
<p>Last March, I gave <a href="http://leafo.net/lapis/">Lapis</a> a try. It is a relatively new framework written by <a href="http://leafo.net/">Leaf Corcoran</a>, the author of <a href="http://moonscript.org/">MoonScript</a>, a programming language that compiles to Lua (like CoffeeScript for JavaScript). Lapis is powered by <a href="http://openresty.org/">OpenResty</a>, an <a href="http://www.techempower.com/benchmarks/">incredibly fast</a> web application server that run <strong>inside</strong> the <a href="http://nginx.org/">nginx</a> Web server and is already used by large websites like <a href="http://en.wikipedia.org/wiki/Taobao">Taobao</a> and <a href="https://www.cloudflare.com/">CloudFlare</a>.</p>
<p>Lapis was built with MoonScript in mind, so I had to hack around it to make it work with plain Lua. It worked but was too verbose, so I eventually gave up on that and on Lapis altogether. But that was Lapis version 0.0.1! Leaf continues to improve it and recently released version 0.0.4. Last Friday evening, on a train to Bordeaux, I decided to give it another try.</p>
<p>Lapis now <a href="http://leafo.net/lapis/reference.html#lapis-in-lua">natively supports Lua</a> and has improved in various aspects. I have found it comfortable to write the views and the configuration file with the MoonScript DSLs provided by the framework. For logic (models and controllers) I used Lua directly since I prefer its syntax to MoonScript for regular code.</p>
<p>I have published <a href="https://github.com/catwell/badakhshan">a small skeleton application</a> which demonstrates this dual languages style to GitHub. I chose to use Redis for the datastore because I know it well and had it running on my laptop, so I did not use the database integration layer of MoonScript which is designed primarily for PostgreSQL (but it looks nice as well). This application is a kind of Hello World but it demonstrates most features of the framework, including <a href="http://leafo.net/lapis/reference.html#lapis-applications-sub-applications">sub-applications</a>, <a href="http://leafo.net/lapis/reference.html#html-generation-html-widgets">widgets</a>, <a href="http://leafo.net/lapis/reference.html#html-generation-layouts">layouts</a>, <a href="http://leafo.net/lapis/reference.html#exception-handling">exception-handling</a> and <a href="http://leafo.net/lapis/reference.html#input-validation">input validation</a>.</p>
<p>If you want an example of a larger Lapis codebase with a different style, <a href="http://rocks.moonscript.org/">MoonRocks</a> is written in Lapis and <a href="https://github.com/leafo/moonrocks-site">its code is on GitHub</a>.</p>
<p>So, what did I think of it? Well, finally I could see myself write a serious Web application in Lua! I will still choose Python and Flask in a professional setting because it is is a more stable, more feature-complete stack, and because I would not want to ask a whole team to learn both Lua <strong>and</strong> MoonScript to work on the project. But if I make a Web application as a personal side project, I will certainly try to use Lapis for that.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>Three years of (proprietary) projects</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2013-06-20-three-years-proprietary-projects.html"
    />
    <id>tag:blog.separateconcerns.com,2013-06-20:three-years-proprietary-projects</id>
    <published>2013-06-20T00:40:00Z</published>
    <updated>2015-11-11T21:15:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Some of the code I write is Open Source, but these days most of it is closed source and property of <a href="http://www.moodstocks.com/">Moodstocks</a>, the startup I work for. For the last three years I have had the chance to work on a lot of really interesting projects, the most significant of which I will talk about now. If you are still a student, maybe that can inspire you to join a startup. Maybe you will even decide to join us in our quest to advance mobile image recognition and applications in general.</p>
<section id="Harvest-the-Pikadeo-crawler">
<h2>Harvest, the Pikadeo crawler</h2>
<p>When I joined Moodstocks in April 2010 the team was working on a mobile price comparison application called Pikadeo. The pitch was that you could take a picture of any cultural product (CD, DVD, book&#8230;) and it would give you a list of places where you could buy it, sorted by price.</p>
<p>The iOS application itself, largely designed by <a href="https://twitter.com/Arcank">Louis Romero</a> who had interned at Moodstocks and left just as I arrived, was working. The image recognition technology was working too, although it was purely server-side. The team was already researching how to leverage client-side processing but it was really just a crazy idea at that point, so Pikadeo was doing what most &#8220;mobile&#8221; image recognition software still does: send JPEG frames to the server.</p>
<p>What was missing was the data. We needed to crawl several large e-commerce websites, extract product images and metadata, send the former to the image recognition engine and the store the latter in a database. So I set out to write a crawler in Ruby, which was the dynamic language of choice of the team at the time. Moodstocks was a Ruby / C++ shop due to the background of the founders. Obviously things have changed a lot since then.</p>
<p>I tried to use Hadoop for the job, mostly because it was trending at that time and I had access to Amazon&#8217;s Elastic MapReduce. I soon understood that 1) the Hadoop Streaming interface was not quite there yet so I would have to switch to Java and 2) the Map/Reduce paradigm was not the best for the job anyway.</p>
<p>After reading a few papers on crawling (I had to anyway, since that project would be the basis of my MSc thesis, but it actually helped a lot) I ended up writing a kind of Master/Worker system, with work queues in <a href="http://kr.github.io/beanstalkd/">Beanstalkd</a> and metadata storage in Amazon&#8217;s SimpleDB, which did the job. It did the job a little too well, actually, since it ended up DDoSing an e-commerce website for a few seconds during a performance test for my thesis. Fortunately I was monitoring it and hit the stop button&#8230;</p>
<p>After setting reasonable speed limits and balancing the requests between various websites, Harvest was fast enough for our needs. The bottleneck became the image search engine itself, I will expand on that later.</p>
<p>Due to the deprecation of the Pikadeo product, Harvest is no longer used today. It is probably a good thing: it was my first Ruby program so the code was awful, it was way too complex and too tied to AWS (the master instance would run and kill worker instances, it relied a lot on SimpleDB&#8230;). That being said, the crawling model was sound.</p>
</section>
<section id="Acorn">
<h2>Acorn</h2>
<p>Once we got crawling sorted out, the image recognition engine itself became the problem. Oak (it has become a tradition to use plant-related names for our projects internally) had been almost entirely written by <a href="https://twitter.com/deltheil">Cédric</a>, Moodstocks&#8217; CTO. It was a piece of C++ software, with the image recognition parts isolated in dynamic libraries and a <a href="http://thrift.apache.org/">Thrift</a> layer to interface with the core Ruby on Rails Web application. It was multithreaded, designed to run on a single multicore EC2 instance.</p>
<p>The scalability pain point, it turned out, was not CPU load. The index was stored in a B+ Tree in <a href="https://dbdb.io/db/tokyo-cabinet">Tokyo Cabinet</a>, a tool we like a lot and still use today in other parts of our system. The problem was that when we indexed millions of images the dataset would inevitably become very large, larger than the available memory. The system would still be very responsive on most reads, but writes would invalidate large chunks of the in-memory cache and result in long pauses.</p>
<p>Latency is the enemy when you write image recognition software, so we decided not to sacrifice it: all the index had to fit in RAM. We decided to consider RAM as our primary datastore. That decision would bring about our later choices.</p>
<p>Since rebuilding an index can be <strong>very</strong> long we wanted something that could persist even if the engine crashed or had to be restarted for an update. Soon it became obvious that Redis could be the answer. However it was missing some commands that we needed, especially one that would insert the same key with different values in different maps (if you have already written inverted indices you may understand why, otherwise have a look at <a href="http://files.catwell.info/presentations/2011-osdcfr-redis-iidx/">that presentation</a>). Lua scripting was what we needed, but it wasn&#8217;t there yet so I ended up forking Redis to develop it in C while <a href="http://files.catwell.info/presentations/2011-osdcfr-redis-iidx/img03.png">lobbying for scripting support</a>. Acorn was, to my knowledge, the first application to run Redis 2.5 in production, and the first one to use Redis scripting too. We never encountered any Redis-related crash.</p>
<p>Now, to have the index fit entirely in RAM, we would have to distribute it across different machines, so Acorn would have to be a distributed system. Knowing that, I chose to make Acorn nodes single-threaded: they would communicate by message passing and we would have several of them per instance.</p>
<p>We chose <a href="http://msgpack.org/">MessagePack</a> for serialization of Redis values, and I started looking at <a href="https://github.com/msgpack/msgpack-rpc">MessagePack-RPC</a>. It had a lot of the pieces that I wanted for the distribution part, and one major problem: it was only usable in Ruby. But we were not CPU-bound&#8230; Would it be sensible to write the engine in a dynamic language? I started investigating that possibility. Our C++ libraries already had Ruby bindings that we used for vision R&amp;D, and the little number crunching Oak Core did (mostly different scoring algorithms) turned out to be fast enough in Ruby.</p>
<p>So Acorn ended up as a distributed system written in Ruby, with MessagePack-RPC for communication and a fork of the development branch of Redis at its heart. It used MessagePack-RPC for communication with our Rails stack too.</p>
<p>In retrospect, relying on two unstable pieces of software was risky. It turned out well, and Redis was definitely the right choice, especially since Lua Scripting now allows us to use a regular, stable 2.6 version. <a href="http://www.zeromq.org/">0MQ</a> would probably have been a better technical choice than MessagePack-RPC, and plain C better than Ruby, but I believe those choices saved us development time, and time to market was important. Acorn is still in production today, doing its job for legacy clients who use online recognition.</p>
</section>
<section id="Moodstocks-Notes">
<h2>Moodstocks Notes</h2>
<p>You now know that when I joined Moodstocks it was trying to be a B2C company. However we were seeing interest in licensing our technology, and began to envision a B2B product: Moodstocks API.</p>
<p>When you write an API, especially as a product, you must write applications for it simultaneously. They serve two purposes: demonstrate what your API can do, and help you figure out how it should be improved. We set out to do that with two mobile applications, one of which was Notes.</p>
<p>The original idea I proposed was, I think, simple: <a href="https://en.wikipedia.org/wiki/Google_Sidewiki">Google SideWiki</a> (RIP) for the real world. That is: you walk in the street, you see something interesting, you take a picture of it, you get a comments thread. If you are the first to do so, you get to leave the first comment (yay, first!!1).</p>
<p>As we were looking to add virality to it, that idea developed into a kind of mostly mobile social network where both people and objects could be followed. Objects actually had their own timeline with an associated Atom feed, which you could reach by browsing or, of course, as the result of an image search.</p>
<p>Technically the server-side part of Notes was a rather classic Sinatra application. The most interesting part of it was that it used some kind of CQRS architecture with all reads coming from Redis and all writes going to log-structured storage. The very nice thing about it was that any part of it could be replayed so it was almost trivial to reproduce bugs or replicate production incrementally to a development setup.</p>
<p>The iPhone application, on the other hand, was one of the nicest and most complex ones we have ever written. I wasn&#8217;t responsible for it so I won&#8217;t get into details here but the latest internal version we never actually released was IMO a thing of beauty.</p>
<p>As it turned out, Notes got a reasonable amount of <a href="http://techcrunch.com/2010/12/10/moodstocks-notes-is-stickybits-without-the-barcodes/">online</a> <a href="http://mashable.com/2010/12/18/moodstocks/">press</a> after our CEO showed it to Michael Arrington at the Le Web conference. This got us a few users and we briefly thought about making it a product in its own right. I wrote a wxPython GUI to analyze logs, trying my hand for the first time at techniques like cohort analysis.</p>
<p>Eventually we took the decision not to invest more time in the idea: we were a small team and our now core B2B business needed our attention. Notes&#8217; success was a long shot and would have required significant time and money investment so I guess it was the right decision, although I would love to see someone revisit the idea.</p>
</section>
<section id="Moodstocks-API-v2">
<h2>Moodstocks API v2</h2>
<p>As I said, Notes was written to help us design our API. Using its feedback and that from the few users of our v1 API, which was more some kind of beta, I set out to write version two.</p>
<p>I will not expand too much on all its aspects here, REST-ish API design being well covered in the literature and online (start <a href="https://www.amazon.com/gp/product/0596801688/">here</a>).</p>
<p>The main differences with API v1 were the use of JSON instead of XML, and the ability to index a single image by uploading it to the API using multipart post. Previously, users would upload a XML list of image URLs and associated IDs; we would download them and tell you when indexing was over. Now users index single images and changes are taken into account instantly. The necessity for that was a lesson from Notes and user feedback, and it was made possible by Acorn.</p>
<p>Another interesting choice was the authentication method, HTTP Digest, which we kept from version one. Theoretically, it had all the right properties and was a standard, so it was the best choice. What we had not realized is how many <a href="http://devblog.avdi.org/2013/02/04/the-trouble-with-http-digest-authentication/">implementations were broken</a> or incomplete (i.e. not supporting nonce reuse, which is a necessity on mobile to reduce the number of HTTP requests). I ended up having to submit patches to a lot of them, and I am not even mentioning .NET land&#8230; If I had to do it again today I would probably go with Basic Auth and SSL.</p>
</section>
<section id="Acorn-Quantizer">
<h2>Acorn Quantizer</h2>
<p>Earlier, I wrote about how I had made Acorn processes single-threaded. This had some advantages, but also a big inconvenient.</p>
<p>Part of the image search process involves quantizing features, which means associating vectors in a many-dimensional space to integers. To do this the <a href="http://en.wikipedia.org/wiki/Curse_of_dimensionality">curse of dimensionality</a> forces you to use an approximate nearest-neighbor search algorithm.</p>
<p>The way it works is: take a large number of features from a representative dataset and use some kind of clustering algorithm (e.g. k-means) on them to obtain a bunch of centroids (a &#8220;vocabulary&#8221;), then process these centroids to obtain a datastructure called kd-forest which will be used to perform nearest-neighbor search (a &#8220;dictionary&#8221;).</p>
<p>Vocabulary generation is clearly an offline task that requires a lot of number crunching and is done as little as possible. Generating the kd-forest, on the other hand, takes from a handful of seconds to a few minutes depending on the size of the vocabulary, so it is frequently done on engine startup. The kd-tree itself only exists in RAM.</p>
<p>The problem with that was that a kd-forest is a rather large datastructure. In our case it occupied hundreds of MB of RAM and took about one minute to generate. That was OK with Oak, where it was shared between threads, but with Acorn that overhead had to be paid for every process, both in space and time. We had to find a way to share the kd-forest across Acorn nodes on the same machine, and if possible to make startup faster.</p>
<p>The solution I opted for was to rewrite the whole quantizer. Previously we had been using popular Open Source libraries for this, but they didn&#8217;t do what I wanted.</p>
<p>I wrote the kd-forest generation algorithm as a <a href="http://luajit.org/">LuaJIT</a> program. It was the first Lua program officially used in production at Moodstocks, although as you will see it was only run offline. What it does is take centroids as input, generate a kd-forest and serialize it in a way easily readable in C thanks to the FFI. It can also actually perform nearest-neighbor searches but this is only used for test purpose.</p>
<p>Once the kd-forest is serialized, it can be loaded into <a href="https://beej.us/guide/bgipc/html/#shm">system shared memory</a> quite fast. A C library can then be used in every Acorn process to access this shared memory read-only and perform nearest-neighbor searches.</p>
<p>The idea is simple once you stop under-estimating the capabilities of SHM on Linux. By default it usually limited to a few MB so you have to increase it a lot for this to work (it can be done with <a href="http://linux.die.net/man/8/sysctl">sysctl</a>). The implementation, on the other hand, is far from trivial. My code uses a <strong>lot</strong> of pointer arithmetics, I should probably clean it up someday, but in the meantime it does its job perfectly.</p>
</section>
<section id="Seed">
<h2>Seed</h2>
<p>The Acorn Quantizer was the last major improvement to our online search stack. Around that time, we resolved on a major technological shift: we would perform image recognition on mobile devices directly instead of doing it on the server. Of course, initially, we would have an hybrid approach where on-device recognition would work as a kind of cache, but the mobile was where we would focus our efforts.</p>
<p>Doing on-device image recognition, though, almost meant starting from scratch: we had to make different technological trade-offs, use very different algorithms, and that meant writing an almost entirely new image recognition stack. We named that project Seed.</p>
<p>Seed encompasses a lot of things now, but at its core are proprietary Computer Vision algorithms that we set out to develop with Cédric and <a href="https://twitter.com/mbrenon">Maxime</a>, who had joined us by then. We would discuss them as a team, then Maxime and Cédric would implement them in C while I would work on a Lua version.</p>
<p>The big picture is that some processing is done on the server at indexing time to generate signatures which are then sent to the client. Server-side software used to be entirely Lua, client-side software entirely C, but we decided to implement the whole stack in both languages. I think that was one of the best ideas we ever had. Being able to compare results avoided errors on both sides (tricky things like off-by-ones were always noticed thanks to the fact that Lua is 1-based, floating-point math issues were found&#8230;). Lua allowed faster prototyping on some parts and it was interesting to compare the different architectural choices we were making.</p>
<p>With the current (second) generation of the Seed algorithms, we are actually mostly using the C implementation through the LuaJIT FFI on the server side now. That is because I have been working on other projects while the rest of the team (which is not as comfortable with Lua) was developing them, so I would have been a bottleneck if we had kept the dual stack approach. I may well bring the Lua branch up to date someday though, who knows?</p>
</section>
<section id="chksrv-and-chkcoherence">
<h2>chksrv and chkcoherence</h2>
<p>Moodstocks&#8217; server-side architecture is <a href="https://blog.separateconcerns.com/2013-01-02-startups-soa.html">some kind of SOA</a>. That means we have a lot of different services that run as daemons and need to stay up. chksrv is a medium-sized program in Bash that takes care of this. It is deployed on every instance with a configuration file that indicates which services should be running on that instance, and it makes sure that they are (correctly). It also checks if other instances are up. If something goes wrongs, it warns the &#8220;ops team&#8221;, who is basically me and Cédric as a backup in case I am not available.</p>
<p>chksrv is a very useful piece of software but I was a bit worried by its growth as we added services. Standardizing the way we deamonize processes helped a lot with that by increasing code reuse (thank you <a href="http://libslack.org/">libslack</a>).</p>
<p>chkcoherence is the ideal complement to chksrv: where the latter checks if services are running, the former verifies that they are doing things right. It is also written in Bash at the top level. I have already written about its concept <a href="https://blog.separateconcerns.com/2013-05-28-coherence-checks.html">here</a>.</p>
</section>
<section id="Anemone">
<h2>Anemone</h2>
<p>Anemone is the project that deals with everything related to metrics and measurements at Moodstocks. It is written in Lua and has quite a few different roles:</p>
<ul>
<li>
collect logs and data from production instances;
</li>
<li>
generate internal daily and weekly reports with business metrics for the platforms and email them to the team;
</li>
<li>
generate technical reports for operations (e.g. growth of different datasets);
</li>
<li>
generate weekly reports per application and email them to our platform customers;
</li>
<li>
generate custom reports tailored to the needs of our enterprise customers.
</li>
</ul>
<p>It also has a web-based dashboard for the team with high-level KPI, written in JavaScript and <a href="http://code.google.com/p/flot/">flot</a>. Someday I might integrate Brett Slatkin&#8217;s <a href="https://bslatkin.github.io/cohorts/">Cohort Visualizer</a> into it.</p>
</section>
<section id="Dandelion">
<h2>Dandelion</h2>
<p>I said earlier that with Seed we generate image signatures on the server and send them to the mobile clients where they are used for recognition. Dandelion is the code name of the service responsible for that.</p>
<p>It turns out efficiently sending millions of image signatures per day, over slow and unreliable networks, to devices everywhere in the world, is not trivial. So Dandelion, more than software, is a synchronization protocol and its implementation; a range of tricks to make the best of mobile networks packaged as software. It is one of the reasons (along with all the innovation on CV algorithms and their optimized client-side implementation) why we can propose client-side recognition with databases of thousands of images or even videos, an order of magnitude more than our competitors.</p>
<p>The server part of Dandelion is written in Lua and depends on pieces like Redis and Beanstalkd, which is why I wrote <a href="https://github.com/catwell/haricot">haricot</a>.</p>
</section>
<section id="Physalis">
<h2>Physalis</h2>
<p>Finally, Physalis is the project I am currently working on. It has not been released yet so I won&#8217;t get into the details, but I can explain the reasoning behind it.</p>
<p>While we were building Dandelion and through our experience with our clients, we learned the following things:</p>
<ul>
<li>
writing mobile applications that work offline but keep their data up to date is tricky;
</li>
<li>
most developers who attempt to implement it from scratch end up with a broken solution or just give up;
</li>
<li>
when you succeed it makes your applications a <strong>lot</strong> better.
</li>
</ul>
<p>So we thought: we have done it, why not make it accessible to everybody? This is what Physalis is: Moodstocks&#8217; image signature distribution system generalized so that you can leverage it for your own mobile application.</p>
<p>Physalis will be available in private alpha for selected users soon, under its real brand name (Physalis is only its &#8220;internal plant-themed name&#8221;). If you are interested in trying it out, <a href="https://twitter.com/pchapuis">get in touch</a>. The requirements are that you should be making a mobile application and ready to communicate on a regular basis with us: we are doing this alpha to collect useful feedback.</p>
<blockquote>
<p>EDIT: Physalis was eventually released in August 2013 as <a href="https://winch.io/">Winch</a>.</p>
</blockquote>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Coherence checks in SOA</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2013-05-28-coherence-checks.html"
    />
    <id>tag:blog.separateconcerns.com,2013-05-28:coherence-checks</id>
    <published>2013-05-28T23:10:00Z</published>
    <updated>2013-05-28T23:10:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Recently I found a rare, ugly bug in a piece of software that had been in production at Moodstocks for 6 months. The bug itself is not that interesting, but the way I found and fixed it is.</p>
<section id="Story-of-a-bug">
<h2>Story of a bug</h2>
<p>Imagine you have a database where you can index some documents in a full text search engine. Indexing can be turned on and off on a per document basis.</p>
<p>As the size of your dataset increases, you outgrow it and decide to use a separate service for search. So you change your code such that documents which must be indexed are sent to that service, and you add a boolean field in your main datastore to indicate whether the document is indexed or not.</p>
<p>All is fine until one day you refactor this code a bit too fast and part of the logic for document updates becomes something like this:</p>
<pre><code class="language-lua">if document.indexed then
  search_engine:index(document)
  document.indexed = false -- &lt;-- WAT?
end
</code></pre>
<p>Of course, in practice, it is less trivial and only happens in rare corner cases, so your tests don&#8217;t catch it&#8230;</p>
</section>
<section id="This-ain't-normalized">
<h2>This ain&#8217;t normal(ized)</h2>
<p>This kind of bug in a system can be very nasty. What happens when it is triggered is that the worldviews of two subsystems (here the datastore and the index) are not coherent anymore.</p>
<p>If you are a programmer not used to distributed systems, you may think that the problem is that the information &#8220;the document is indexed&#8221; is duplicated. State is bad, but duplicate state is plain wrong, just always ask the index for that information and drop that &#8220;indexed&#8221; field!</p>
<p>In a normal application setting you would be right, but this is one of the main differences between SOA and OOP. There are two reasons why you do not want to do that. The first one is performance: this may generate more internal network requests. Its importance could be discussed at length (&#8220;Is it some form of premature optimization?&#8221;).</p>
<p>The second reason is much more important though: if you do that, your index becomes a data-critical service. That means you cannot lose its state without losing information, so you have to back it up seriously. This simple boolean field in the datastore is enough to rebuild the whole index, making it non-critical.</p>
<p>So that leaves us with denormalized data and its own problems. How do we mitigate them?</p>
</section>
<section id="Invariants-are-sexy">
<h2>Invariants are sexy</h2>
<p>Once you have denormalized data, your problem is to keep it coherent. That means that there are invariants that must be verified at all times by the various states of the subsystems. Or rather, because of asynchronous jobs, invariants that shouldn&#8217;t remain unverified for too long.</p>
<p>Those invariants are almost always properties on sets. For instance, if you have a forum where only registered users can comment, users who have commented must be a subset of users who have confirmed their email. In my case, the set of documents indexed in the search engine must be equal to the set of documents flagged as indexed in the main datastore.</p>
<p>The big idea is that every time you denormalize data you should write invariants that ensure coherence. These invariants are checked by scripts that can be run at every transaction in some cases, but are more usually cronned. You should also have procedures to reconcile (repair) the data in case of incoherence. I am not a huge fan of having them run automatically: incoherence often reveals bugs, so humans should check where it comes from and fix it.</p>
<p>In our case, the script responsible for coherence checks warned me that a few documents belonging to the same user were present in the search engine but not flagged as indexed. I asked the application logs what had happened to these documents around the time when the incoherence occurred, and saw they had all been updated. I looked up the relevant code path in application code&#8230; and facepalm-ed. I had pushed that code to production half a year ago, and it was obviously wrong.</p>
</section>
<section id="Conclusion">
<h2>Conclusion</h2>
<p>The moral of it all is not, as I already discussed, that you should not denormalize data. It is not that we should write more tests, either. At least it is not what I want the takeaway to be (we do test these things more carefully now, but edge cases can always slip through).</p>
<p>What I think this story shows is that, if you write distributed systems that handle denormalized data, you should have:</p>
<ul>
<li>
something to check invariants to detect issues;
</li>
<li>
exhaustive logs and tools to diagnose them;
</li>
<li>
reconciliation scripts to fix them.
</li>
</ul>
<p>I cannot imagine releasing a distributed system that does not have those things. They are even more important than a comprehensive test suite to me. Moreover, the coherence checks can also be run in the test suite itself (on mocks for instance) so writing them is always a win-win.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Werner Vogels on Skills</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2013-03-24-vogels-skills.html"
    />
    <id>tag:blog.separateconcerns.com,2013-03-24:vogels-skills</id>
    <published>2013-03-24T19:30:00Z</published>
    <updated>2013-03-24T19:30:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I found a talk by Werner Vogels, the CTO of Amazon <a href="https://blog.separateconcerns.com/2013-01-02-startups-soa.html">who is a role model of mine</a>, on <a href="http://skillsmatter.com/podcast/design-architecture/21st-century-application-architectures">21st century application architectures</a>.</p>
<p>After his presentation, someone from the audience asks him what skills he is looking for to run these services. His answer (starting at about 40:45 in the video) is so interesting that I thought it would be worth it to write it down. Here it is:</p>
<blockquote>
<p>What kind of skillset am I looking for for people to build these [infrastructure services] and manage them? I think I&#8217;m looking for a set of standard things that we look for in every Amazonian PM, which is&#8230;</p>
<p>A very strong sense of ownership. This is: the stuff that you&#8217;re building is not something that your boss tells you to build. You have to take pride in what you do, and you have to be someone [who] &#8220;does not like his or her own smell&#8221;. You have to be [highly] self-critical.</p>
<p>[You] have to be able to disagree but be able to commit to actual decisions being made, things like that. There&#8217;s this set of what we call Amazon leadership skills that I would be looking for in any engineer that we hire.</p>
<p>[In many] of these services we&#8217;re looking for people with very good distributed systems skills, or at least with very good fundamental distributed systems skills which they have learned in school. Actually, it isn&#8217;t that you have to have built a distributed system when you were in school. Remember: no professor ever had a real job in their life, right? And so they didn&#8217;t teach you how to build systems. But to have a truly fundamental understanding of how to read fault-tolerant algorithms, of how to think in a fundamental way about scaling&#8230; and those kind of things, is something that we are absolutely looking for.</p>
<p>Some demonstration, if you&#8217;re just out of school, [that] you&#8217;ve been involved with some practicals. Have you contributed to an Open Source project? Are you involved with programming groups? We&#8217;re looking for someone that is actually capable of doing hands-on work. [&#8230;]</p>
<p>If you&#8217;re really more experienced, what we will be looking for&#8230; Do we look for particular programming skills, languages? Not really. Most people are able to program in Java, C++&#8230; I don&#8217;t think I&#8217;ve actually met people who are not able to do that. We are in an environment that is pretty unique in that sense.</p>
<p>We don&#8217;t mandate the use of particular programming languages, we don&#8217;t mandate the use of particular middleware pieces or things like that. We believe that our systems, our team should be moving as fast as possible, which means that if we hire the absolute best people they should be able to make the decisions, what the right tools are for them to use in their particular project.</p>
<p>It doesn&#8217;t always go well. I think we&#8217;ve had a few choices around Erlang which did not necessarily work out that well, not because of Erlang, but because it is actually really hard to hire Erlang programmers after that. So we expect our engineers to have some level of business sense.</p>
<p>I think the willingness to do operational work&#8230; We live and breathe the DevOps mentality, where our engineers are responsible for the software that they run at some level, whether that is part time or whether that is actually in full site with some of our other engineers. We strongly believe that there&#8217;s no bigger motivator to fix your software than beepers going off at 4 A.M. And we give you time to actually fix your services if that&#8217;s the case.</p>
<p>These are the first few things that come to mind.</p>
</blockquote>

      </div>
    </content>
  </entry>
  <entry>
    <title>Viterbi, my favorite algorithm</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2013-03-03-viterbi-algorithm.html"
    />
    <id>tag:blog.separateconcerns.com,2013-03-03:viterbi-algorithm</id>
    <published>2013-03-03T18:00:01Z</published>
    <updated>2013-03-03T18:00:01Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <section id="The-State-Machine">
<h2>The State Machine</h2>
<p>Let us consider a system that can take a finite number of states <code>S[1]</code> to <code>S[n]</code> over time.</p>
<p>We can represent the system as a N-node directed graph, where nodes are the states. An arc exists between node <code>S[i]</code> and <code>S[j]</code> if the system can transition from <code>S[i]</code> to <code>S[j]</code>. You probably already know that.</p>
</section>
<section id="In-Chains">
<h2>In Chains</h2>
<p>We will now observe the evolution of the system over time. We will model time discretely. That does not mean that time itself is discrete, but we will observe the system at fixed-interval &#8220;ticks&#8221;. We call <code>S(t)</code> the state of the system at tick <code>t</code>.</p>
<p>If the system is known to be in <code>S[i]</code> at tick <code>t</code> (i.e. <code>S(t) = S[i]</code>) we call <code>P(i-&gt;j)</code> the probability that it will be in <code>S[j]</code> at tick <code>t+1</code>. Here is a definition for the mathematically inclined: <code>P(i-&gt;j) = P(S(t+1) = S[j] | S(t) = S[i])</code>.</p>
<p>A few remarks:</p>
<ul>
<li>
<code>P(i-&gt;j)</code> is considered independent of <code>t</code>;
</li>
<li>
<code>P(i-&gt;i)</code> exists;
</li>
<li>
the sum of outbound probabilities is 1: <code>∀i, ∑[j=1,N]{P(i-&gt;j)} = 1</code>.
</li>
</ul>
<p>By the way, this is called a Markov Chain.</p>
</section>
<section id="Blurry-Sights">
<h2>Blurry Sights</h2>
<p>Now let&#8217;s complicate things a little by introducing a separate system that can take states <code>V[1]</code> to <code>V[M]</code>. This second system <code>V</code> is tied to <code>S</code>: at every tick <code>t</code>, the probability distribution of <code>V(t)</code> only depends on <code>S(t)</code>. We will note: <code>O(i,j) = P(V[j] | S[i])</code>.</p>
<p>You can think of <code>V</code> as something that observes <code>S</code> and reports on its state in an incomplete and probabilistic manner.</p>
<p>If you have understood everything up to now, you should easily get what this means: <code>∀i, ∑[j=1,M]{O(i,j)} = 1</code>.</p>
<p>If you have not, let&#8217;s take a really simple example with <code>N = M = 2</code>. You can imagine that both <code>S</code> and <code>V</code> are lights that can be either red or blue. The relationship between <code>S</code> and <code>V</code> can be expressed by something like this: &#8220;If light <code>S</code> is red, then there is 90% chance that <code>V</code> is red too. If light <code>S</code> is blue, then there is only 40% chance that <code>V</code> is red.&#8221;</p>
<p>Now, add more possible colors to <code>S</code> and <code>V</code>, not necessarily the same number for both, to generalize the system.</p>
</section>
<section id="The-Black-Box">
<h2>The Black Box</h2>
<p>Now, here is our problem: imagine that you know how system <code>S</code> works (the probabilities of transition between the states) but that it is hidden in a black box such that you cannot observe it. What you <strong>can</strong> observe is system <code>V</code>. Is there any way to guess what system <code>S</code> is doing at any time in this setting? If yes, how?</p>
<p>The answer to the first question is: &#8220;sometimes, yes&#8221;. &#8220;Sometimes&#8221; means &#8220;if the probability distributions help us&#8221;.</p>
<p>The second question is the one my favorite algorithm, the Viterbi algorithm, answers. Let&#8217;s see how it works.</p>
</section>
<section id="Make-it-Code">
<h2>Make it Code</h2>
<p>First we need to represent the problem in a way that can be understood by a computer. I will use the Lua programming language for that.</p>
<p>We start by defining a few parameters. We will choose <code>N = 3</code> and <code>M = 2</code> for simplicity. We will observe the system over 1000 ticks.</p>
<pre><code class="language-lua">local N = 3
local M = 2
local L = 1000
</code></pre>
<p>The probabilities of transitions in <code>S</code> will be represented by a NxN matrix, with <code>P(i-&gt;j)</code> as <code>T[i][j]</code>. We use percentages because they are easier to read and avoid some floating point calculation issues.</p>
<pre><code class="language-lua">local T = {
  {  60, 20, 20 },
  {   0, 70, 30 },
  {  70, 10, 20 },
}
</code></pre>
<p>For instance, there is a 70% chance to transition from <code>S[3]</code> to <code>S[1]</code>.</p>
<p>The probablitities of observations will be represented by a NxM matrix, with <code>O(i,j)</code> as <code>O[i][j]</code>.</p>
<pre><code class="language-lua">local O = {
  { 5, 95 },
  { 55, 45 },
  { 90, 10 },
}
</code></pre>
<p>Let us make sure we didn&#8217;t make too many mistakes thanks to our two probability equations from earlier:</p>
<pre><code class="language-lua">local sum = function(t)
  local s = 0
  for i=1,#t do s = s + t[i] end
  return s
end

for i=1,N do
  assert(sum(T[i]) == 100)
  assert(sum(O[i]) == 100)
end
</code></pre>
<p>This is what our example system looks like in graph form:</p>
<p><img alt="graph" src="img/viterbi.png"/></p>
<p>The green part is the Markov chain itself, the blue part corresponds to the observation device. Arcs are labeled with probabilities of transition or observation.</p>
</section>
<section id="Stepping-Forward">
<h2>Stepping Forward</h2>
<p>Now we can simulate the behavior of the system.</p>
<pre><code class="language-lua">local proba_pick = function(v)
  local p,s = math.random(1,100),0
  for i=1,#v do
    s = s + v[i]
    if p &lt;= s then
      return i
    end
  end
  assert(false)
end

local S,V = {},{}

local transition = function(t)
  assert(S[t-1] and not S[t])
  S[t] = proba_pick(P[S[t-1]])
end

local observe = function(t)
  assert(S[t] and not V[t])
  V[t] = proba_pick(O[S[t]])
end

S[1] = math.random(1,N)
observe(1)

for t=2,L do
  transition(t)
  observe(t)
end
</code></pre>
<p>This code is slightly more complicated, but what you should understand is that, at the end of it, <code>S</code> is a vector of <code>L</code> states of the system and <code>V</code> is the corresponding vector of observations. The initial state <code>S[1]</code> is chosen randomly with uniform probabilities.</p>
</section>
<section id="Seeing-Through-the-Box">
<h2>Seeing Through the Box</h2>
<p>Now, let us proceed to guess what happens inside the black box. We do so iteratively: at each tick <code>t</code>, we calculate the most plausible sequence of events that could have led to each possible state of the system, given the observation at <code>t</code> and the results for <code>t-1</code>.</p>
<pre><code class="language-lua">local trellis = {{}}

local prb = function(x)
  return math.log(x/100)
end

local viterbi_node = function(t,i)
  local prev = assert(trellis[t-1])
  local idx,proba = 0,-math.huge
  local p
  for j=1,N do
    p = prev[j].proba + prb(T[j][i]) + prb(1/N*O[i][V[t]])
    if p &gt; proba then proba,idx = p,j end
  end
  return {
    state = i,
    proba = proba,
    prev = prev[idx],
  }
end

local viterbi_step = function(t)
  assert(not trellis[t])
  trellis[t] = {}
  for i=1,N do
    trellis[t][i] = viterbi_node(t,i)
  end
end

-- initialize the trellis
for i=1,N do
  trellis[1][i] = {
    state = i,
    proba = prb(1/N*O[i][V[1]])
  }
end

-- run the algorithm
for t=2,L do
  viterbi_step(t)
end
</code></pre>
<p>Again, not trivial code, but this is the Viterbi algorithm itself. Moreover we use logarithmic sums for probabilities to avoid numerical problems.</p>
<p>What the algorithm does is build a trellis, a special kind of graph. For every step <code>t</code> we calculate the most plausible sequence of events (a path through the trellis) which ends up with the system in each of the possible states. When we reach the end of the simulation, we take the most plausible state of the system and take the path that led to it as our estimate of what happened.</p>
<p>To avoid memory usage explosion, we do not actually store the paths themselves in the nodes of the trellis. Instead, in a node at tick <code>t</code>, we store a pointer to the previous node (at <code>t-1</code>) that led there. This is why we have to backtrack through the trellis to find the actual path:</p>
<pre><code class="language-lua">local getpath = function(node)
  local r = {}
  repeat
    table.insert(r,1,node.state)
    node = node.prev
  until (not node)
  return r
end

local best_node = function(nodes)
  local r = {proba = -math.huge}
  for i=1,#nodes do
    if nodes[i].proba &gt; r.proba then
      r = nodes[i]
    end
  end
  return r
end

local bestpath = getpath(best_node(trellis[L]))
</code></pre>
</section>
<section id="Does-this-thing-really-work">
<h2>Does this thing really work?</h2>
<p>To check if this work, let&#8217;s take the actual system out of the box and calculate how much it looks like our estimate:</p>
<pre><code class="language-lua">local ok = 0
for i=1,L do
  if S[i] == bestpath[i] then
    ok = ok + 1
  end
end

print(100*ok/L)
</code></pre>
<p>The result I got with those parameters is 72% accuracy, to compare to what a naive random process would get (33%).</p>
</section>
<section id="Why-I-love-it">
<h2>Why I love it</h2>
<p>Let&#8217;s go back to the title of this post: now that you know what it does, <strong>why</strong> is Viterbi&#8217;s algorithm my favorite?</p>
<p>I admit that the elegance of the representation of the problem as a trellis is part of the reason, but mainly it&#8217;s because of its implications. Think about it: fundamentally it is an algorithm that allows a machine to <strong>explain what it observes</strong>. Isn&#8217;t that crazy?</p>
<p>Yes, it is. And because of that it has a whole range of applications, from advanced orthographic correction and speech-to-text to the decoding of convolutional codes used in voice codecs. And I suspect its potential has not been fully exploited yet.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Algorithms, Data Structures &amp; Protocols</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2013-01-28-algorithms-data-structures-protocols.html"
    />
    <id>tag:blog.separateconcerns.com,2013-01-28:algorithms-data-structures-protocols</id>
    <published>2013-01-28T22:00:00Z</published>
    <updated>2013-01-28T22:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <section id="Algorithms-Data-Structures">
<h2>Algorithms &amp; Data Structures</h2>
<p>For a long time I have thought that there were only two fundamental parts to Computer Science: Algorithms and Data Structures. This is how it used to be taught, and how I think it should still be taught to beginners.</p>
<p>There are two main categories of parts in a computer: processing units (CPUs, GPUs&#8230;) and data storage units (caches, RAM, disk&#8230;). Your typical information processing program takes data from a durable storage unit, moves it to a temporary storage unit, modifies it thanks to a processing unit and stores the result in a permanent storage unit. Of course there are variations around this theme, and some programs do a bit of extra work such as handling user input, but that is the idea.</p>
<p>We call &#8220;algorithms&#8221; the different ways we instruct the processing units to act on the data and &#8220;data structures&#8221; the different layouts we use to store data in the storage units.</p>
<p>A very simple view of fundamental CS could be summed up to these two disciplines. You may argue that other things are indispensable, for instance theoretical aspects like lambda calculus or Turing machines, or maybe paradigms. You would be right, these things are important, but if you <strong>really</strong> want the baseline, it all comes down to algorithms and data structures.</p>
<p>Or so I thought.</p>
</section>
<section id="Protocols">
<h2>Protocols</h2>
<p>It turns out looking at the aforementioned parts of the computer is not enough. We need to look at the negative space too: how does the
data move around? Inside the computer, data mostly circulates in buses. Between computers, data may circulate in networks, on detachable storage units&#8230;</p>
<p>With computers becoming increasingly parallel, the Internet reaching ubiquity and programs turning into complex distributed systems, understanding the interactions between computer parts, software parts or entirely different systems has become a necessity. This reveals a third fundamental side of CS, on equal footing with algorithms and data structures: protocols.</p>
<p>Protocols are more present in CS than you may think. Even the original vision of OOP by Alan Kay was mostly about protocols. Joe Armstrong, a father of Erlang, <a href="http://erlang.org/pipermail/erlang-questions/2013-January/071944.html">recently insisted</a> on the necessity to teach protocols (and algorithms - if he had added data structures this post would look like plagiarism ;p).</p>
<p>CS classes at engineering school did not teach me much or influence the way I write programs, but majoring in network engineering did. It made me start to think in terms of independent blocks and the protocols they use to communicate. I cultivated that vision during my MSc in distributed systems (it used to be called &#8220;grid computing&#8221;) and I still have it today.</p>
<p>So when I see people arguing endlessly about static versus dynamic typing or such matters, I think: OK, that may be important, but do not forget CS is, at heart, about algorithms, data structures and protocols.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Startups, think about SOA</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2013-01-02-startups-soa.html"
    />
    <id>tag:blog.separateconcerns.com,2013-01-02:startups-soa</id>
    <published>2013-01-02T14:00:01Z</published>
    <updated>2013-01-02T14:00:01Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <section id="What-is-SOA">
<h2>What is SOA?</h2>
<p>When people say SOA (Service Oriented Architecture) they often mean different things. My personal definition of SOA is rather loose and, like all the quotes in this article, <a href="http://queue.acm.org/detail.cfm?id=1142065">comes from Werner Vogels</a>, the CTO of Amazon:</p>
<blockquote>
<p>For us service orientation means encapsulating data with the business logic that operates on the data, with the only access through a published service interface.</p>
</blockquote>
<p>If you are an Object Oriented Programming person this should ring a bell. Indeed, SOA is essentially encapsulation at the system level. Actually, I strongly believe OOP is a good idea (encapsulation) applied at the wrong layer.</p>
<p>The opposite of SOA in the context of the Web is monolithic applications. Think textbook Ruby on Rails or Django, for instance. Monolithic applications are fine as long as they are small, but I think SOA is a better fit for larger projects. If you are a technological startup, that means you should at least start thinking about what SOA could bring you if you are starting to have a clear idea of what your product is. Monolithic applications are great for prototypes and MVPs.</p>
<p>If you are wondering if what you are currently doing is closer to SOA than to monolithic applications, ask yourself these questions:</p>
<ul>
<li>
<p>How many different repositories does our code live in? (If you do <strong>not</strong> use source control you have more urgent problems to think about than SOA.)</p>
</li>
<li>
<p>How many different databases do we have? How many database instances do we have? How many connections? How many schemas? (SOA and NoSQL tend to mix well.)</p>
</li>
<li>
<p>Do we have a Web application that does significantly more than rendering templates? Is it stateful? What parts of that state could we also use in a mobile application? Does the same application render JSON and HTML?</p>
</li>
</ul>
</section>
<section id="Advantages-of-SOA">
<h2>Advantages of SOA</h2>
<p>One of the most obvious benefits of SOA is that services are easier to scale than monolithic applications. Maybe you want to migrate user authentication data to Redis and keep other data in whatever DB you already have? SOA makes it trivial. Maybe some part of your product would benefit from running on an AWS instance that has lots of RAM while another one is CPU-intensive? Just deploy the corresponding services where they run best.</p>
<p>SOA will also help you achieve resilience. You can program user-facing or aggregate services defensively so that they detect the unavailability of backend services and degrade gracefully. You can even use a <a href="https://blog.codinghorror.com/working-with-the-chaos-monkey/">chaos monkey</a> to ensure this.</p>
<p>However in my opinion the main advantages of SOA are not technical, they are organizational.</p>
<p>As the number of your employees increases you will have to separate them into teams. The classical way to do this is by specialty: first developers and operations, then spin off DBAs&#8230; The main problem with that organization is that it hinders innovation. To create a new feature you need to coordinate all these people, and it results in endless meetings and sterile debates (not to mention clan wars).</p>
<p>This is not a fatality. You have probably heard of DevOps, and maybe dismissed it as Yet Another Buzzword. Well SOA is the easiest way to implement True DevOps (TM?), meaning that developers and operations really work together all the time. The trick is that there are no &#8220;devs&#8221; and &#8220;ops&#8221;, because you create teams along another dimension: services. In Werner Vogel&#8217;s words:</p>
<blockquote>
<p>The traditional model is that you take your software to the wall that separates development and operations, and throw it over and then forget about it. Not at Amazon. You build it, you run it. This brings developers into contact with the day-to-day operation of their software.</p>
</blockquote>
<p>These teams are like smaller startups within your growing startup: they have all they need to build new features or even whole products by themselves. And they will keep you nimble if you give them enough leeway:</p>
<blockquote>
<p>We allow teams to function as independently as possible. Developers are like artists; they produce their best work if they have the freedom to do so, but they need good tools.</p>
</blockquote>
<p>SOA also gives you language agnosticism almost for free. Not much prevents different services from being written in different programming languages. Why would you want to do that? Well, beyond the fact that different problems are better solved in Python, Haskell or C, there is lot of talent out there not using Ruby, Python, PHP, Scala, JavaScript or whatever language you have chosen for your monolithic application. Some of those Scheme, Io, Factor, Lua or F# hackers can be real assets for those clever enough to give them a job.</p>
<p>Finally, I can see a (perhaps more abstract) last advantage to SOA which is related to the rise of the Programmable Web. After all, there is little difference between a Web API and a service, except that you wrote the latter and not the former. Embracing SOA will prepare you to work with external APIs, and more importantly to publish your own. For instance, lots of AWS services have started their life as internal services at Amazon.</p>
</section>
<section id="Conclusion">
<h2>Conclusion</h2>
<p>I am not saying SOA <strong>only</strong> has advantages. Such an architecture can be fragile if you do not code with service unavailability in mind. Testing complex operations involving lots of services can be hard, and debugging them even harder. Correctly defining the boundaries and interfaces of services requires a significant amount of reflection and may not be a good idea when you do not know what exactly you are building.</p>
<p>That being said I still think more technological and/or Web startups should consider SOA instead of the &#8220;everything within the Framework&#8221; approach, not really for future scalability reasons, but because they risk limiting their flexibility, speed of iteration and capacity to hire short term if it is not already the case.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>Hello again, World!</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2013-01-02-hello-world.html"
    />
    <id>tag:blog.separateconcerns.com,2013-01-02:hello-world</id>
    <published>2013-01-02T14:00:00Z</published>
    <updated>2013-01-02T14:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p><a href="https://catwell.info">I</a> have not had a blog for over two years. The main reason for that is that writing is hard, so I went shopping on Twitter instead.</p>
<p>This was a bit hypocrite since I am an advocate for the Open Web and a huge consumer of information feeds, with several hundreds of them in my news reader. So for this New Year I have decided to put an end to this situation, thrown together a few lines of Lua code that act as a static blog generator (because reinventing the wheel is fun), and here it is: my new online journal.</p>
<p>I do not know with what frequency I will publish but expect articles about working at startups, distributed systems, programming in Lua, dealing with mobile networks, and whatever I happen to read and find interesting. Oh, and also the occasional rant, I guess.</p>
<p>Now here&#8217;s to the tradition:</p>
<pre><code class="language-lua">local greet = function(name)
  print(string.format("Hello, %s!",name))
end

greet("World")
</code></pre>

      </div>
    </content>
  </entry>
  <entry>
    <title>The Future of Computing: Ubiquity</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2012-01-09-ubiquitous.html"
    />
    <id>tag:blog.separateconcerns.com,2012-01-09:ubiquitous</id>
    <published>2012-01-09T12:00:00Z</published>
    <updated>2012-01-09T12:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>I used to enjoy predicting how computing technology would evolve; it was like a game for me, and I was not too bad at it. But for a few years I have felt like I could not predict anything anymore. Things went too fast, and that bothered me.</p>
<p>During these years I have observed things that, taken separately, did not seem to make much sense. Some that already existed and grew in importance, and some that were new. Mobile &amp; Local computing. The Internet of Things. ARM&#8217;s revenge on x86. The Cloud. Multicore, GPGPU. The HTML5 applications craze. Unhosted. Siri. Minix3 getting funding. Wolfram|Alpha, NKS. JSON, Git, CouchDB, Redis, Riak, DynamoDB, Doozer. JIT compilers, functional languages, event-driven programming. SPDY, 0MQ, MessagePack-RPC. Mechanical Turk and humans computer pieces. LTE, 4G networks, Free disrupting the French cell phone industry.</p>
<p>And then, a few months ago, I took a step back and I found a pattern. If I am right, all this is going somewhere, and that somewhere is ubiquitous computing. But not in a limited sense: &#8220;computation everywhere&#8221;, taken to the extreme. My presentation slide-show moving from my pocket to the overhead projector of the conference room, forking
to the tablets of the attendees. Computation jumping from my desktop computer at work to my cell phone, sitting there peacefully to save battery while I walk to my self-driving car, only to rush to the powerful computer in the dashboard. Software running in the Cloud, on the 1028 cores of my DSL box and my toaster at home, in my headphones and in my AR lens, all simultaneously. One application in several (lots of) places. Ubiquitous.</p>
<p>Now maybe you are thinking &#8220;he&#8217;s nuts&#8221;, and I am thinking &#8220;maybe they&#8217;re right&#8221;. Because for this to work we will have to solve what I consider the hardest problem in Computer Science: large-scale algorithm collaboration. I honestly do not know how long it will take us or even whether it is within the reach of our limited brains. But if I am right, we are going there, and this is an exciting destination. This is a journey that requires planning, and going now would be foolish, but when we will be ready to set sail towards these unknown lands, count me on board of the first ship.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>(French) Neutralité du Net</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2010-02-04-fr-neutralite-du-net.html"
    />
    <id>tag:blog.separateconcerns.com,2010-02-04:fr-neutralite-du-net</id>
    <published>2010-02-04T12:00:00Z</published>
    <updated>2010-02-04T12:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Tout le monde parle de neutralité du Net en ce moment. J&#8217;ai pensé que ça pourrait être une bonne idée de faire un point là-dessus, parce que j&#8217;entends et je lis tout et n&#8217;importe quoi, en particulier dans la presse française.</p>
<p>La première étape pour appréhender le problème de la neutralité du Net, c&#8217;est de la définir. Benjamin Bayart <a href="http://blog.fdn.fr/post/2010/01/12/Rencontre-avec-l-ARCEP-sur-la-neutralit%C3%A9-du-r%C3%A9seau">s&#8217;y est essayé devant l&#8217;ARCEP</a> et je suis d&#8217;accord avec lui pour l&#8217;essentiel, même si nos points de vue divergent probablement sur certains points de détail.</p>
<p>D&#8217;abord, il faut comprendre que la neutralité du Net est une qualité essentielle. J&#8217;entends par là qu&#8217;Internet est par définition neutre, et donc qu&#8217;un réseau non-neutre n&#8217;est pas Internet</p>
<p>Qu&#8217;est-ce qu&#8217;Internet ? Comme son nom l&#8217;indique, c&#8217;est un ensemble de réseaux qui se sont mis d&#8217;accord pour se regrouper et permettre aux entités qui les composent de discuter entre elles. Que les puristes me pardonnent les raccourcis techniques qui vont suivre.</p>
<p>Les réseaux qui composent Internet sont appelés systèmes autonomes (AS), parce que leurs dirigeants sont libres de définir la manière dont les messages sont transportés en leur sein ainsi que les règles utilisées pour que ces messages arrivent à bonne destination. Pour faire une analogie fréquente : peu importe si les facteurs du bureau de poste de Trifouilly-les-oies distribuent le courrier à bicyclette ou en scooter, et peu importe s&#8217;ils utilisent un plan du quartier ou leur GPS pour trouver le 47 rue des Lilas, pourvu que Mme Michu, son occupante, reçoive son courrier en bon état.</p>
<p>Par contre, il est indispensable que le courrier soit distribué dans des enveloppes à un format standard sur lesquelles figure une adresse. Sur Internet, les lettres sont des paquets, composés d&#8217;un message (<strong>Protocol Data Unit</strong>) enveloppé dans des en-têtes au format <strong>Internet Protocol</strong>, parmi lesquels figure l&#8217;adresse du destinataire. Ces en-têtes (enveloppes) sont les mêmes dans tous les AS (bureaux de poste) du monde et les adresses sont uniques. C&#8217;est ce qui fait que Mme Michu peut correspondre avec son amant chinois, M. Chang.</p>
<p>Chaque bureau de poste est, je l&#8217;ai dit, libre de répertorier les adresses qui en dépendent comme il veut, mais il faut que le bureau de Trifouilly-les-oies sache quoi faire des lettres destinées à M. Chang. Sur Internet, chaque AS est identifié par un numéro unique, un peu comme un code postal à l&#8217;échelle mondiale, et maintient des tables permettant de savoir de quel AS dépend chaque adresse IP. Comme la structure d&#8217;Internet est dynamique (de nouveaux AS peuvent apparaitre, d&#8217;autres disparaitre, les associations IP - AS peuvent changer&#8230;), les AS s&#8217;échangent ces informations en permanence suivant le <strong>Border Gateway Protocol</strong>, le protocole de routage dans l&#8217;Internet.</p>
<p>La règle fondamentale de neutralité dans tout ça est très simple à comprendre avec mon analogie : la poste (les FAI) transporte le courrier (les paquets) de son point de départ à son point d&#8217;arrivée, et elle ne fait que ça. Le facteur n&#8217;ouvre pas les lettres pour lire les déclarations enflammées de M. Chang à Mme Michu, et il ne glisse pas de publicité dans les enveloppes. Sur Internet, il n&#8217;y a pas non plus de service de type Chronopost : un AS peut passer un accord avec ses voisins pour qu&#8217;ils transportent certains paquets plus vite, mais il ne l&#8217;écrit pas dans les en-têtes IP, et même s&#8217;il le fait personne n&#8217;a l&#8217;obligation de respecter ces instructions. On dit qu&#8217;un réseau IP, et en particulier Internet, ne gère pas les règles de qualité de service (QoS) mais fait simplement de son mieux (<strong>Best Effort</strong>).</p>
<p>Maintenant, on peut essayer de voir ce qui n&#8217;est pas neutre, et donc pas Internet. Un réseau où les machines n&#8217;ont pas d&#8217;adresses IP publiques n&#8217;est pas Internet. Elles ont des adresses IP, certes, mais une machine sur Internet ne peut pas leur envoyer de paquets directement. Bayart donne l&#8217;exemple des opérateurs mobiles, je vais en prendre un autre : si vous êtes connecté au <a href="http://resel.fr/">ResEl</a>, vous n&#8217;êtes pas sur Internet, parce que l&#8217;adresse attribuée à votre interface réseau n&#8217;est pas accessible de l&#8217;extérieur. C&#8217;est ce qui fait que vous ne pouvez pas héberger votre serveur web, par exemple. C&#8217;est une bonne occasion d&#8217;enfoncer une porte ouverte : Internet a un coût. Je ne connais pas de vrai Fournisseur d&#8217;Accès à Internet pour 10 € par an.</p>
<p>Un FAI ne devrait pas non plus empêcher certains paquets de passer. Si le votre bloque le peer-to-peer, il viole le principe de neutralité. En fait, le simple fait qu&#8217;il sache que vous faites du peer-to-peer suffit : il a regardé dans l&#8217;enveloppe. Si votre FAI traite les paquets d&#8217;un fournisseur de service (disons Dailymotion) plus vite que ceux d&#8217;un autre (disons Youtube), il y a aussi de fortes chances qu&#8217;il viole la neutralité du Net, sans parler de la législation sur la concurrence. Si quand vous consultez le web un bandeau s&#8217;affiche en haut de chaque page et vous rappelle que votre connexion est fournie par Machin, vous n&#8217;êtes pas sur Internet. Si vous ne pouvez pas installer un serveur SMTP sur le port 25 de votre machine&#8230; vous avez compris l&#8217;idée.</p>
<p>Un point tendancieux : je considère personnellement qu&#8217;Internet se limite à ce que j&#8217;ai décrit plus haut, ce qui veut dire qu&#8217;un filtrage BGP ou sur les IP est contraire à la neutralité du Net mais un filtrage au niveau des noms de domaine (DNS) pas forcément, dans le sens où vous bannir des pages blanches n&#8217;empêche pas de vous écrire. Je ne dis pas que j&#8217;y suis favorable, juste que c&#8217;est moins grave.</p>
<p>Maintenant, pourquoi la neutralité du Net est-elle si importante ? Parce que c&#8217;est ce qui lui permet de garantir des droits fondamentaux tels que la liberté d&#8217;expression (c&#8217;est pas moi qui le dit, <a href="http://www.conseil-constitutionnel.fr/conseil-constitutionnel/francais/les-decisions/acces-par-date/decisions-depuis-1959/2009/2009-580-dc/decision-n-2009-580-dc-du-10-juin-2009.42666.html">c&#8217;est le Conseil Constitutionnel</a>) ou la libre concurrence, et aussi parce que c&#8217;est parce qu&#8217;Internet est neutre qu&#8217;il peut fonctionner, techniquement et d&#8217;un point de vue diplomatique. Simplement parce que si on commence à dire qu&#8217;Internet n&#8217;est plus neutre (ou ouvert, c&#8217;est à peu près équivalent), alors c&#8217;est qu&#8217;<a href="http://twitter.com/timoreilly/status/7924286619">on en laisse le contrôle à quelqu&#8217;un</a>, et les autres ne
risquent pas d&#8217;être d&#8217;accord.</p>
<p>Alors évidemment, il y en a que ça tenterait bien de contrôler Internet. On l&#8217;a vu, la neutralité va plus loin que l&#8217;absence de censure, mais elle l&#8217;inclut, et c&#8217;est bien de cela qu&#8217;il est question quand on vous parle de <a href="http://www.generation-nt.com/loppsi-filtrage-net-juge-tardy-actualite-951391.html">filtrage</a>. Bien entendu, le gouvernement et leurs amis des médias vous diront qu&#8217;ils cherchent à empêcher les méchants terroristes et leurs comparses pédophiles de nuire, parce qu&#8217;ils ne vont pas vous dire ouvertement qu&#8217;ils veulent juste reprendre le contrôle de l&#8217;information. Demandez donc à M. Chang ce qu&#8217;il en pense !</p>
<p>Donc non, la neutralité du Net n&#8217;est <a href="http://www.youtube.com/watch?v=mP01t0Z4Hr8">pas une obsession de libristes illuminés</a>, et les artistes qui la comprennent <a href="https://en.wikipedia.org/wiki/Future_of_Music_Coalition">n&#8217;en pensent pas ce qu&#8217;on voudrait bien nous faire croire</a>. La France, en la matière, est en train de nager à contre-courant ; elle finira par s&#8217;épuiser et couler si elle persiste.</p>
<p>Pour conclure, un conseil : si vous voulez vous faire une idée sur le sujet, éteignez votre télévision, débranchez votre radio et oubliez les journaux. On ne juge pas les abus d&#8217;un état en prenant pour argent comptant sa propagande. Le seul endroit où l&#8217;on peut s&#8217;informer objectivement sur Internet en France, c&#8217;est le Net lui-même. Du moins, tant qu&#8217;il lui reste un semblant de liberté&#8230;</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>(French) Râleries multiples</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2010-01-30-fr-raleries.html"
    />
    <id>tag:blog.separateconcerns.com,2010-01-30:fr-raleries</id>
    <published>2010-01-30T12:00:00Z</published>
    <updated>2010-01-30T12:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Ceux qui me connaissent savent que râler, je sais faire. J&#8217;essaie d&#8217;éviter autant que possible, mais parfois c&#8217;est nécessaire.</p>
<section id="Paye-ta-TV">
<h2>Paye ta TV</h2>
<p>On la critique en France mais la redevance TV est bien pire en Angleterre. Si dans l&#8217;hexagone elle est perçue par l&#8217;État, ici c&#8217;est une <a href="http://www.tvlicensing.co.uk">société privée</a> qui s&#8217;en charge. Et contrairement à chez nous, ni les gens qui regardent la télé sur Internet ou sur un téléphone mobile ni les étudiants en résidence ne sont exemptés.</p>
<p>Cette société, TV Licensing, envoie régulièrement des lettres de menace aux délinquants qui osent capter la bonne parole diffusée sur les ondes sans s&#8217;acquitter de la dîme. Hmm, un petit arrière-goût d&#8217;HADOPI ? J&#8217;ai reçu cinq lettres, et je suis d&#8217;après leurs dires &#8220;scheduled for visit&#8221;. Ils peuvent venir, j&#8217;ai l&#8217;esprit tranquille : je ne regarde <strong>pas</strong> la TV, la loi anglaise ne leur permet pas d&#8217;entrer chez moi et de toute façon c&#8217;est tellement difficile techniquement d&#8217;atteindre ma porte que ça m&#8217;étonnerait qu&#8217;ils y arrivent un jour.</p>
</section>
<section id="Le-garçon-qui-criait-au-loup">
<h2>Le garçon qui criait au loup</h2>
<p>Depuis que j&#8217;habite ici, j&#8217;ai bien dû être réveillé une vingtaine de fois par des alarmes incendies en pleine nuit. La première fois, enfiler un manteau, des chaussures et descendre devant l&#8217;entrée se geler pendant une demi-heure en attendant l&#8217;arrivée de la sécurité peut être drôle, mais à la longue ça lasse. Qui plus est, le dispositif d&#8217;alarme permet de savoir aisément quel détecteur a déclenché l&#8217;alerte, et donc de confirmer rapidement que c&#8217;est une erreur, mais la loi anglaise stipule qu&#8217;ignorer l&#8217;alarme et retourner au chaud dans son lit est un crime !</p>
<p>Si jamais un feu se déclenche vraiment, j&#8217;espère que les familles des victimes penseront à faire un procès à tous les responsables du dispositif d&#8217;alarme. Un système d&#8217;alerte qui génère autant de faux-positifs est totalement inutile, simplement parce que personne n&#8217;y prête plus attention. Tous les administrateurs système qui ont déjà essayé de lire des logs doivent bien le savoir&#8230;</p>
</section>
<section id="La-vie-privée-c'est-dépassé">
<h2>La vie privée, c&#8217;est dépassé !</h2>
<p>C&#8217;est en tout cas ce que pense Mark Zuckerberg, le patron de Facebook. Il a le droit, et j&#8217;ai le droit de ne pas être d&#8217;accord. Comme <a href="http://www.alain-bazot.fr/index.php/la-vie-privee-un-concept-depasse/">mon ami Dédé</a>, je vais donc logiquement quitter le célèbre réseau social.</p>
<p>De toute façon, les soi-disant réseaux sociaux sont des aberrations, des substituts au Web pour ceux qui ne l&#8217;ont pas compris. Vous voulez donner des nouvelles, ou même poster des liens débiles ? Ouvrez un blog (on appelait ça &#8220;une page perso&#8221; à l&#8217;époque révolue du Web 1.0), ou twittez si ça vous amuse ! Il semblerait que la raison qui pousse les gens à rejoindre Facebook soit la simplicité d&#8217;ouverture d&#8217;un compte. Ouvrir son blog aussi est très simple.</p>
<p>Pour ma part, je ne consulterai pas Facebook en février. Je ne clôturerai mon compte que début mars de sorte que les gens qui n&#8217;ont que ce moyen pour me joindre puissent m&#8217;en demander un autre par message privé (je les reçois dans ma boite mail). Si vous trouvez que je suis paranoïaque, sachez simplement que l&#8217;un des sujets proposés en <strong>MSc Thesis</strong> à Cranfield consiste à faire du <strong>data-mining</strong> (collecter plein d&#8217;informations sur vous) sur Facebook en utilisant le <strong>Grid Computing</strong> (un paquet d&#8217;ordinateurs, dont des super-calculateurs, en réseau). Si de tels moyens, habituellement réservés à de très grosses industries comme le pétrole, l&#8217;automobile ou la mode, sont déployés dans ce but, c&#8217;est simplement parce que vos données personnelles valent très cher.</p>
</section>
<section id="Java-m'pendre-ou-pas">
<h2>Java m&#8217;pendre (ou pas)</h2>
<p>Java est un langage tout pourri, si je commençais à énumérer toutes les raisons pour ça il me faudrait autant de lignes que pour coder une application de taille moyenne dans le dit langage, et oui ça fait beaucoup.</p>
<p>En tout cas, étant contraint et forcé d&#8217;en faire pas mal en ce moment, j&#8217;ai pu bien m&#8217;arracher les cheveux sur quelques points :</p>
<ul>
<li>
<p><code>string.length()</code>, mais <code>table.length</code>. La cohérence, vous connaissez ?</p>
</li>
<li>
<p>Avec Java, Axis et un programme un peu complexe, il suffit qu&#8217;une exception se déclenche pour afficher une trace qui fait cinq fois la hauteur de votre console. Bien entendu, le message d&#8217;erreur intéressant est en haut.</p>
</li>
<li>
<p>Enfin et surtout, c&#8217;est <strong>lent</strong>, à la compilation comme à l&#8217;exécution.</p>
</li>
</ul>
<p>Voilà, tout ceux qui l&#8217;ont utilisé savent que Java c&#8217;est mal. Après, il y en a qui aiment, et je n&#8217;ai rien contre les masochistes, mais je supporte déjà moins les sadiques qui forcent des gens sains d&#8217;esprit à s&#8217;en servir.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>(French) GTD ROI</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2009-12-04-fr-gtd-roi.html"
    />
    <id>tag:blog.separateconcerns.com,2009-12-04:fr-gtd-roi</id>
    <published>2009-12-04T12:00:00Z</published>
    <updated>2009-12-04T12:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>J&#8217;ai l&#8217;impression que <a href="https://blog.separateconcerns.com/2009-11-16-fr-gen-y.html">mon article</a> sur les habitudes consommatrices de temps en ligne avait intéressé quelques personnes. Je vais revenir brièvement sur ce qui est arrivé depuis et en tirer un rapide bilan.</p>
<p>Dans l&#8217;ensemble, j&#8217;ai fait ce que j&#8217;avais prévu : je ne suis plus le forum d&#8217;archlinux.org ni Tuxmachines et j&#8217;ai arrêté les jeux Motion Twin. Ça m&#8217;arrive encore pas mal de cliquer sur des liens par pure curiosité mais j&#8217;imagine que c&#8217;est une habitude difficile à perdre.</p>
<p>En plus de ça, je consulte beaucoup moins Facebook pour lequel j&#8217;ai perdu de l&#8217;intérêt, j&#8217;ai encore écrémé un peu mes inscriptions aux <strong>mailing-lists</strong>, je relève ma messagerie moins fréquemment, j&#8217;ai quitté certains canaux IRC, et je me suis mis à utiliser <a href="https://surf.suckless.org">surf</a> beaucoup plus que Firefox, ce qui limite la tentation de faire plusieurs choses à la fois (onglets) ou de remettre des choses triviales à plus tard (marque-pages).</p>
<p>J&#8217;ai l&#8217;impression que ces quelques changements n&#8217;ont pas trop mal fonctionné, et j&#8217;apprécie de m&#8217;être dégagé un peu de temps pour faire des choses plus enrichissantes. Je suis aussi content de ne pas avoir eu à recourir à mes idées plus radicales. Je pense que le plus important était surtout de prendre conscience du problème et de commencer à me demander de temps en temps, avant d&#8217;ouvrir une page web : &#8220;n&#8217;ai-je pas mieux à faire ?&#8221;.</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>(French) Chrome OS</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2009-12-04-fr-chrome-os.html"
    />
    <id>tag:blog.separateconcerns.com,2009-12-04:fr-chrome-os</id>
    <published>2009-12-04T12:00:00Z</published>
    <updated>2009-12-04T12:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>J&#8217;avais promis que j&#8217;en parlerais : comme tout le monde (ou pas), j&#8217;ai regardé <a href="http://www.chromium.org/chromium-os">les vidéos</a> diffusées par Google sur Chrome OS et je me suis fait ma petite idée.</p>
<p>La première chose qui me vient à l&#8217;esprit, c&#8217;est que même Benjamin Bayart était probablement loin d&#8217;imaginer combien il était proche de la vérité lorsqu&#8217;il parlait de Minitel 2.0. Le principe de Chrome OS, c&#8217;est le retour aux clients légers, aux terminaux. Toute l&#8217;information est dans les nuages, rien sur votre machine. Il ne supporte même pas les disques durs au profit de la mémoire Flash !</p>
<p>Du point de vue technique, l&#8217;interface emprunte de très bonnes idées aux gestionnaires de fenêtres minimalistes : applications en plein écran, panneaux qui se superposent aux fenêtres à une position fixe&#8230; Tout le travail effectué pour démarrer plus vite est aussi intéressant et se rapproche de ce que font certains utilisateurs d&#8217;Arch Linux amateurs d&#8217;optimisation et de <strong>bootcharts</strong>.</p>
<p>Le problème, comme toujours avec Google, n&#8217;est pas vraiment la technique. C&#8217;est le vrai but de l&#8217;opération qui est difficile à deviner. Chrome OS est <strong>open source</strong>, ce qui est très bien, mais qui ira lire les sources, les comprendre ? Qui saura influer sur l&#8217;évolution du système ? Qui utilisera d&#8217;autres serveurs que ceux de Google pour stocker ses données ?</p>
<p>Et même si le système client est <strong>open source</strong>, je le vois un peu comme un piège qui va influer lentement sur la mentalité du public et lui faire considérer comme normal de ne pas avoir le contrôle de ses données. Google sait bien que dicter leurs habitudes aux gens est une stratégie efficace, c&#8217;est ce qui fait que les tortues asthmatiques que sont Internet Explorer et Outlook dominent encore largement leurs marchés respectifs. Chrome OS, c&#8217;est une drogue dont la première dose est gratuite et ne fait aucun mal, mais ensuite ?</p>
<p>Heureusement, il y a de l&#8217;espoir : je pense que Google s&#8217;est laissé emporter par son élan et que Chrome OS est bien trop en avance sur son temps. Pourquoi ? Il cible principalement le marché des netbooks. Or, les gens achètent des netbooks entre autres parce qu&#8217;ils sont faciles à utiliser dans les transports en commun. Et vous êtes pratiquement certain de ne pas trouver de wifi gratuit dans un train, encore moins dans un avion. Votre netbook sous Chrome OS devient donc soudainement inutile : vous ne pouvez pas regarder votre film préféré parce qu&#8217;il est resté là-haut dans les nuages, et vous ne pouvez pas travailler sur votre rapport parce que Google Docs n&#8217;est pas accessible.</p>
<p>Bref, nous voilà encore une fois sauvés de l&#8217;horrible Big Brother du 21e siècle. Oh, et sinon, je viens de commencer à utiliser ce formidable outil qu&#8217;est Wave ! ;)</p>

      </div>
    </content>
  </entry>
  <entry>
    <title>(French) Ces sites qui ne devraient pas exister</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2009-11-24-fr-websites-that-should-not-exist.html"
    />
    <id>tag:blog.separateconcerns.com,2009-11-24:fr-websites-that-should-not-exist</id>
    <published>2009-11-24T12:00:00Z</published>
    <updated>2009-11-24T12:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Regarder le <a href="http://www.alexa.com/topsites">top 10 d&#8217;Alexa</a> peut faire peur quand on connait un peu ce qu&#8217;est Internet. Ce classement par trafic est assez représentatif de l&#8217;évolution du web ces quelques années. On y trouve évidemment beaucoup de moteurs de recherche : google.com (1er), yahoo.com (3e), live.com (5e), baidu.com (8e) et yahoo.jp (10e). msn.com, le portail de Microsoft, arrive en 9e position, pourquoi pas. Le problème, c&#8217;est les quatre autres. Prenons-les dans le désordre.</p>
<section id="YouTube-4e-et-Blogger-7e">
<h2>YouTube (4e) et Blogger (7e)</h2>
<p>Deux services de Google, bizarrement. Tous deux vous permettent d&#8217;héberger du contenu, vidéo pour YouTube et principalement textuel pour Blogger. Ce contenu pourra ensuite être commenté par d&#8217;autres utilisateurs, c&#8217;est ce qu&#8217;on appelle Web 2.0. Qu&#8217;y a-t-il de mal à cela ? Pas grand-chose, en fait, si ce n&#8217;est la situation de quasi-monopole de ces plates-formes.</p>
<p>En offrant un service simple et gratuit, Google [1] s&#8217;est imposé sur ces secteurs. Or, même si Google n&#8217;est <a href="http://investor.google.com/conduct.html">pas maléfique</a>, il est bon de se rappeler que c&#8217;est une entreprise dont le <strong>business model</strong> repose sur deux choses : vous vendre de la publicité et apprendre des choses sur vous. Vous lui donnez une occasion en or de faire la deuxième en vous créant un compte personnel chez eux et en y hébergeant vos données, quant à la première il n&#8217;y a qu&#8217;à voir le principal changement sur YouTube pour l&#8217;utilisateur depuis le rachat [2].</p>
<p>Autre problème commun à tous les services gratuits gérés par de grosses boites : vous ne valez pas grand-chose pour eux, et ils ne feront rien pour vous aider, par exemple, à éviter la censure. Il suffit de voir le nombre de vidéos supprimées de YouTube sans raison valable, sur simple demande de gens qui ne sont souvent pas les ayant-droits. Certains se souviennent peut-être de la vidéo où Mme Albanel prouvait son incompétence en annonçant qu&#8217;OpenOffice incluait un pare-feu. Cette vidéo a été censurée à de multiples reprises bien qu&#8217;elle ait été filmée de manière officielle à l&#8217;Assemblée Nationale.</p>
<p>Ceci dit, ces problèmes sont mineurs, il suffit d&#8217;en être informé, et ces services ont une raison d&#8217;être sur Internet. Pour les deux qui suivent, c&#8217;est une autre histoire.</p>
<p>[1] OK, pour Youtube c&#8217;était déjà le cas avant que Google achète&#8230;</p>
<p>[2] Pour ceux qui ne l&#8217;utilisent pas, je parle de publicités sous forme de bandeaux qui s&#8217;affichent en superposition sur la vidéo.</p>
</section>
<section id="Wikipedia-6e">
<h2>Wikipedia (6e)</h2>
<p>Wikipedia, l&#8217;un des plus gros succès du libre. Une source d&#8217;information à laquelle chacun peut contribuer s&#8217;il a les compétences nécessaires, accessible instantanément de tout point du monde. Une merveille !</p>
<p>Attendez, ça ne vous fait pas penser à quelque chose ça ? Ah si, le Web&#8230; Sauf que Wikipedia a un modèle centralisé alors que le Web est distribué. Sauf que sur Wikipedia ce sont les modérateurs qui détiennent le pouvoir de décider si une information est valable ou non, alors que sur le Web c&#8217;est à chacun de se faire son idée, même si l&#8217;opinion dominante se trouvera en premier dans les moteurs de recherche. Sauf que sur Wikipedia tout devra s&#8217;appuyer sur des sources &#8220;fiables&#8221;, comme par exemple des publications scientifiques (hum). Bref, Wikipedia, une formidable machine à imposer une pensée unique à des utilisateurs qui ne demandent pas mieux.</p>
<blockquote>
<p>EDIT - Pour ceux qui ne s&#8217;en seraient pas rendu compte, j&#8217;exagère volontairement. Ne prenez pas tout pour argent comptant non plus, la diversité d&#8217;opinion existe bien sur Wikipedia dans une certaine mesure.</p>
</blockquote>
</section>
<section id="Facebook-2e">
<h2>Facebook (2e)</h2>
<p>J&#8217;ai gardé le meilleur pour la fin. Juste derrière le roi des moteurs de recherche, le sultan des réseaux sociaux. Facebook, la toile dans la toile, mais une toile encore une fois centralisée et où on ne communique qu&#8217;avec ses &#8220;amis&#8221;. Pratique, je peux dire des bêtises comme ça, personne ne le verra. Et si jamais un jour je ne les assume plus, j&#8217;efface.</p>
<p>Mouais. Vous faites vraiment une confiance absolue à tous vos contacts, vous ? Si c&#8217;est le cas, bravo. Sinon, une fois que vous aurez réalisé que tout ce que vous mettez sur Facebook est du numérique, donc de l&#8217;information copiable, vous vous rendrez compte que, quels que soient les réglages de votre compte, il vaudrait mieux considérer que tout ce que vous y postez est public.</p>
<p>Et puis même au-delà de ça, comment comprendre qu&#8217;un tel principe ait du succès ? Parce qu&#8217;après tout, soit vous n&#8217;ajoutez pas de contenu et vous ne faites que poster des liens vers des choses que vous avez trouvées en surfant sur le Web ou partager ceux des autres, et ça ressemble fortement aux chaînes d&#8217;emails que personne ou presque n&#8217;aime, soit vous mettez des choses nouvelles en ligne et c&#8217;est souvent égoïste parce que vous réservez (théoriquement) à vos pseudo-amis l&#8217;accès à de l&#8217;information qui n&#8217;est en général pas si privée que ça et qui aurait peut-être pu servir ou faire plaisir à d&#8217;autres. Regardez un peu en arrière, même les kikoolols de la génération Caramail préféraient en général les forums publics aux forums privés.</p>
</section>
<section id="Le-cœur-du-problème">
<h2>Le cœur du problème</h2>
<p>Oui, parce qu&#8217;il faut bien le dire, il y a un problème. Et ce n&#8217;est pas que ces trucs-là existent, ils en ont le droit, c&#8217;est même un des fondements d&#8217;Internet : n&#8217;importe quel service a sa chance.</p>
<p>Non, le problème, c&#8217;est que bien que je voie tous leurs défauts gros comme des maisons, je les utilise ! J&#8217;ai un compte YouTube, un compte Facebook et ça m&#8217;arrive régulièrement de consulter des pages Wikipedia. Seule exception : ces quelques pages ne sont pas chez Google mais bien sur mon VPS, sous mon nom de domaine. Ouf.</p>
<p>La raison pour laquelle je les utilise, c&#8217;est que bien que conceptuellement et idéologiquement ils soient percés de partout, techniquement, ils vont de pas trop mauvais (Facebook, Wikipedia) à très bons (tout ce que fait Google). C&#8217;est un peu la différence avec Windows ou Internet Explorer, vous voyez : le fait qu&#8217;ils sont techniquement mauvais fait que leurs alternatives sont crédibles, pas vraiment la question éthique qui est derrière.</p>
</section>
<section id="Conclusion">
<h2>Conclusion</h2>
<p>Conclusion ? Rien. Que voulez-vous que je dise de plus ? Voir que ces sites-là sont parmi les plus visités du monde me rend un peu triste mais ce n&#8217;est pas pour autant que je vais arrêter de les utiliser. Pas tout de suite en tout cas.</p>
<p>Peut-être qu&#8217;un jour j&#8217;aurai le temps de mettre en place un système simple pour héberger mes vidéos sur mon serveur. Peut-être que je me lasserai de Facebook (les gens que dont je voudrais avoir des nouvelles n&#8217;y postent plus trop de toute façon) et que je fermerai mon compte. Peut-être qu&#8217;on reverra des annuaires collaboratifs de liens vers des pages qui donnent des avis variés sur divers sujets, avec une structure d&#8217;arbre ou de graphe par thématique et un hébergement décentralisé, de la réplication spontanée, du Web quoi&#8230; Houlà, je m&#8217;envole ;)</p>
<p>En attendant le miracle, je profite de la qualité de ces services, comme tout le monde. Je ne suis pas assez fanatique pour les boycotter. J&#8217;essaie juste de me rappeler de temps en temps qu&#8217;on est bien loin de l&#8217;utopie du Web de 90.</p>
<p>La prochaine fois, je parlerai peut-être de Chrome OS, un sujet pas si éloigné finalement.</p>
</section>

      </div>
    </content>
  </entry>
  <entry>
    <title>(French) Le piège de la génération Y</title>
    <link
      rel="alternate" type="text/html"
      href="https://blog.separateconcerns.com/2009-11-16-fr-gen-y.html"
    />
    <id>tag:blog.separateconcerns.com,2009-11-16:fr-gen-y</id>
    <published>2009-11-16T12:00:00Z</published>
    <updated>2009-11-16T12:00:00Z</updated>
    <content type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
        <p>Hier soir, j&#8217;ai joué à <a href="http://www.bigbluecup.com/yabb/index.php?topic=39327.0">Featherweight</a>, un bon petit jeu d&#8217;aventure indépendant qui se finit en quelques minutes. J&#8217;ai beaucoup apprécié, et ça m&#8217;a fait réaliser que ça faisait longtemps que je n&#8217;avais pas fait quelque chose du genre. La raison ? Je suis atteint d&#8217;un syndrome qui touche beaucoup de gens de ma génération : je passe la plupart de mon temps libre à faire des choses inintéressantes sur mon PC. Du coup, je ne fais plus un certain nombre de choses que je faisais avant et qui me plaisaient beaucoup, comme jouer à des jeux vidéos ou coder pour moi, et ça me manque. C&#8217;est grave docteur, ça se soigne ? À mon avis oui, mais il va falloir reprendre les choses en main et supprimer un certain nombre de distractions.</p>
<p>Heureusement, le principal danger est évité : je gère à peu près bien ma messagerie instantanée. Je n&#8217;ai jamais utilisé de réseau type MSN, et je vais beaucoup moins sur IRC depuis que <a href="http://phraktured.net/becoming-a-morning-person.html#comment-6120694">phrakture me l&#8217;a conseillé</a>. J&#8217;ai ajouté un peu trop de contacts dans Skype à mon goût, mais ça reste gérable. Je me suis aussi désinscrit de la plupart des mailing-lists de Télécom qui me prenaient pas mal de temps à lire, et j&#8217;ai délaissé identi.ca (un twitter-like libre). Par contre, je fais un paquet de choses inutiles par habitude, que je vais arrêter immédiatement.</p>
<p>D&#8217;abord, lire les nouveaux messages sur le forum anglophone d&#8217;Arch Linux. Il y en a beaucoup trop maintenant, plusieurs centaines par jour, ça n&#8217;est plus gérable. Je continuerai à lire ceux du forum francophone de temps en temps pour l&#8217;instant.</p>
<p>Ensuite, jouer à des jeux en ligne, du genre de ceux publiés par <a href="http://www.motion-twin.com/">Motion Twin</a>. Jouer à des jeux vidéos n&#8217;est pas forcément mauvais, c&#8217;est jouer à des jeux sans fin le problème (MMORPG, jeux Flash, etc). Je vais faire une exception de <a href="https://www.shinobi.fr">Shinobi</a> pour l&#8217;instant parce que je m&#8217;y suis pas mal impliqué et qu&#8217;il ne me prend pas beaucoup de temps.</p>
<p>Enfin, j&#8217;arrêterai de suivre <a href="http://www.tuxmachines.org/">Tuxmachines</a> ainsi que les liens lorsque je lis un article ou, pire, les suggestions de Youtube quand je regarde une vidéo.</p>
<p>J&#8217;évaluerai l&#8217;efficacité de ces mesures dans environ deux semaines. Si ça ne suffit pas, j&#8217;en prendrai d&#8217;autres.</p>
<p>Je commencerai par supprimer de mes contacts Facebook tous les gens qui ne sont pas des amis proches, surtout ceux qui spamment avec des quiz débiles (SVP, stop).</p>
<p>Je supprimerai des RSS de mon lecteur de news. Certes, le RSS, c&#8217;est du push, donc bon pour la productivité, mais trop de webcomic tue le webcomic, et pareil pour l&#8217;actualité technologique.</p>
<p>J&#8217;arrêterai Shinobi, le forum archlinux.fr et je me désinscrirai de presque toutes les mailing-lists auxquelles je suis abonné.</p>
<p>C&#8217;est un peu violent, certes, mais je pense que j&#8217;y gagnerai beaucoup. Et si jamais tout ça ne suffit pas, j&#8217;ai bien encore des idées comme utiliser un navigateur, un client mail et un lecteur de flux RSS en mode texte seulement, mais j&#8217;espère bien ne pas en arriver à de telles extrémités, pourtant courantes chez les gens adeptes du worse is better. Je n&#8217;irai quand même pas jusqu&#8217;à faire comme Knuth, qui <a href="https://www-cs-faculty.stanford.edu/~knuth/email.html">n&#8217;utilise pas l&#8217;email</a>&#8230;</p>
<p>J&#8217;espère en tout cas que tout ça me permettra de gagner en productivité et en temps libre pour faire des choses utiles et/ou qui me plaisent plus.</p>

      </div>
    </content>
  </entry>
</feed>
