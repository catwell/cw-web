<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta name="description" content="Add automated testing to your Lua open source projects for free.">
    <link rel="canonical" href="https://blog.separateconcerns.com/2015-03-08-travis-lua.html">
    <link href="css/theme.css?cache=1" rel="stylesheet" type="text/css">
      <link href="css/rainbow-github.css" rel="stylesheet" type="text/css">
    <link
      rel="alternate" type="application/atom+xml"
      href="https://blog.separateconcerns.com/feed.atom"
    />
    <title>Continuous Integration for Lua with Travis</title>
  </head>
  <body>
    <div id="container">
    <header>
      <h1>Continuous Integration for Lua with Travis</h1>
      <h4>
        published 2015-03-08,
        updated 2015-10-16
        [ <a href="index.html">home</a> ]
      </h4>
    </header>
    <p><a href="https://travis-ci.org">Travis</a> is a Continuous Integration service which is free for Open Source projects and has very good GitHub integration. We will see how to use it for your Lua projects.</p>
<p>Your test suite will work well with Travis as long as executing it returns 0 on success and nonzero on failure. If you use plain Lua assertions, it is already the case. If you use a test framework, make sure that it works that way. I have added <a href="https://github.com/catwell/cwtest#exit">a helper</a> to cwtest for that purpose.</p>
<p>Travis does not support Lua out of the box, but using it with Lua projects is not hard because <a href="https://github.com/moteus">moteus</a> has done all the hard work for you. You just have to clone <a href="https://github.com/moteus/lua-travis-example">this repository</a> and copy the <code>.travis</code> directory to yours.</p>
<p>After that, you only have to write a single YAML file, <code>.travis.yml</code>. For example, here is <a href="https://github.com/catwell/haricot/blob/2d5320633c76f14f12c0d8486606de4b9d95c015/.travis.yml">the one I wrote for Haricot</a>.</p>
<p>Most sections should be self-explanatory. <code>install</code> is where you set up your dependencies. The first line calls moteus&rsquo; script which lets you use Lua and LuaRocks. A separate build and test run will occur for every Lua version declared in <code>matrix</code>; you can comment some lines there if you do not want to test some Lua versions. For Haricot I need <a href="http://kr.github.io/beanstalkd/">Beanstalk</a> running in the background so I start it in <code>before_script</code>. <code>script</code> is where you run your actual tests.</p>
<p>To enable Travis, sign up, allow Travis to access your GitHub account, then go to <a href="https://travis-ci.org/profile">your profile</a> and flip the switch for your repository:</p>
<p><img alt="travis" src="img/travis.png"/></p>
<p>After that, commit <code>.travis</code> and <code>.travis.yml</code> and push to GitHub. It will trigger a test build, and so will every subsequent commit. If you want, you can now add <a href="https://travis-ci.org/catwell/haricot.png?branch=master">a badge</a> with the status of your build to your README or your project&rsquo;s home page.</p>

    </div>
    <div id="footer">
      [ <a href="index.html">home</a> ]
    </div>
    <script src="js/rainbow.min.js"></script>
    <script
      data-goatcounter="https://separateconcerns.goatcounter.com/count"
      async src="//gc.zgo.at/count.js"></script>
  </body>
</html>
